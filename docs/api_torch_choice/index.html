
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <link rel="canonical" href="https://gsbdbi.github.io/torch-choice/api_torch_choice/">
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.3.0, mkdocs-material-8.2.13">
    
    
      
        <title>API Reference Torch-Choice - Torch Choice</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.e411adfe.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.cc9b2e1e.min.css">
        
      
    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../assets/_mkdocstrings.css">
    
    <script>__md_scope=new URL("..",location),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="" data-md-color-primary="none" data-md-color-accent="none">
  
    
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#api-reference-torch-choice" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="Torch Choice" class="md-header__button md-logo" aria-label="Torch Choice" data-md-component="logo">
      
  
  <?xml version="1.0" encoding="UTF-8"?>
<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="241.9pt" height="365pt" viewBox="0 0 241.9 365" version="1.1">
<defs>
<clipPath id="clip1">
  <path d="M 0 0 L 241.898438 0 L 241.898438 365 L 0 365 Z M 0 0 "/>
</clipPath>
</defs>
<g id="surface1">
<g clip-path="url(#clip1)" clip-rule="nonzero">
<path style=" stroke:none;fill-rule:nonzero;fill:rgb(60.398865%,10.598755%,11.799622%);fill-opacity:1;" d="M 235.886719 119.484375 C 235.886719 118.5625 235.886719 117.898438 235.886719 117.230469 C 235.886719 96.425781 235.875 75.621094 235.917969 54.820313 C 235.921875 53.394531 235.460938 52.414063 234.449219 51.449219 C 219.242188 36.867188 204.058594 22.257813 188.898438 7.625 C 187.800781 6.566406 186.710938 6.074219 185.140625 6.078125 C 142.371094 6.121094 99.605469 6.117188 56.835938 6.078125 C 55.355469 6.078125 54.261719 6.46875 53.21875 7.492188 C 49.527344 11.125 45.773438 14.699219 42.039063 18.289063 C 33.683594 26.320313 25.324219 34.347656 16.96875 42.382813 C 13.335938 45.871094 9.71875 49.378906 6.113281 52.855469 C 6.113281 53.300781 6.113281 53.640625 6.113281 53.980469 C 6.113281 96.339844 6.117188 138.695313 6.085938 181.054688 C 6.085938 182.261719 6.496094 183.066406 7.324219 183.894531 C 20.417969 196.941406 33.492188 210.011719 46.535156 223.109375 C 47.472656 224.050781 48.410156 224.464844 49.75 224.457031 C 57.320313 224.398438 64.890625 224.425781 72.464844 224.433594 C 73.042969 224.433594 73.621094 224.488281 74.644531 224.539063 C 71.742188 227.257813 70.460938 230.371094 69.59375 234.179688 C 71.082031 234.234375 72.199219 234.359375 73.308594 234.300781 C 78.976563 233.992188 84.304688 232.523438 89.242188 229.652344 C 90.832031 228.726563 92.546875 228.898438 94.125 229.796875 C 95.808594 230.753906 96.222656 232.242188 95.316406 233.96875 C 94.910156 234.746094 94.429688 235.511719 93.875 236.195313 C 90.800781 239.984375 86.703125 241.890625 81.96875 242.726563 C 79.636719 243.136719 77.316406 243.722656 75.074219 244.484375 C 73.582031 244.992188 72.875 246.195313 73.230469 247.292969 C 73.503906 248.140625 74.152344 248.90625 74.765625 249.589844 C 75.394531 250.289063 76.183594 250.84375 76.902344 251.460938 C 76.828125 251.609375 76.753906 251.761719 76.679688 251.910156 C 53.242188 251.910156 29.804688 251.910156 6.164063 251.910156 C 6.164063 252.78125 6.164063 253.449219 6.164063 254.117188 C 6.144531 272.804688 6.144531 291.496094 6.082031 310.183594 C 6.074219 311.609375 6.515625 312.585938 7.527344 313.554688 C 16.839844 322.457031 26.117188 331.402344 35.398438 340.34375 C 41.289063 346.019531 47.175781 351.699219 53.039063 357.40625 C 54.113281 358.449219 55.214844 358.96875 56.800781 358.96875 C 99.640625 358.917969 142.476563 358.921875 185.3125 358.960938 C 186.71875 358.960938 187.746094 358.570313 188.742188 357.605469 C 195.199219 351.339844 201.703125 345.117188 208.1875 338.878906 C 216.886719 330.511719 225.566406 322.132813 234.292969 313.792969 C 235.394531 312.738281 235.929688 311.679688 235.925781 310.082031 C 235.878906 270.109375 235.878906 230.140625 235.917969 190.167969 C 235.921875 188.683594 235.5 187.640625 234.445313 186.59375 C 221.4375 173.652344 208.464844 160.679688 195.523438 147.671875 C 194.46875 146.609375 193.417969 146.195313 191.9375 146.203125 C 181.980469 146.261719 172.019531 146.242188 162.0625 146.21875 C 161.265625 146.214844 160.328125 146.230469 159.699219 145.84375 C 155.351563 143.167969 150.949219 140.546875 146.800781 137.585938 C 143.5625 135.273438 141.082031 132.121094 139.085938 128.667969 C 138.125 127.007813 137.503906 125.199219 138.632813 123.179688 C 139.15625 123.265625 139.660156 123.234375 140.050781 123.429688 C 146.277344 126.621094 153.035156 127.347656 159.871094 127.726563 C 162.050781 127.847656 164.191406 128.058594 166.242188 128.980469 C 168.035156 129.785156 169.601563 128.535156 169.25 126.59375 C 169.085938 125.695313 168.609375 124.796875 168.085938 124.027344 C 167.070313 122.539063 165.925781 121.144531 164.660156 119.484375 C 188.476563 119.484375 211.996094 119.484375 235.886719 119.484375 Z M 0 315.160156 C 0 291.964844 0 268.773438 0 245.578125 C 0.609375 245.621094 1.21875 245.703125 1.828125 245.707031 C 23.648438 245.710938 45.472656 245.710938 67.296875 245.707031 C 67.894531 245.707031 68.496094 245.648438 69.097656 245.617188 C 69.898438 243.046875 71.621094 241.488281 73.90625 240.480469 C 74.777344 240.097656 75.699219 239.824219 76.550781 239.402344 C 76.941406 239.207031 77.21875 238.773438 77.542969 238.449219 C 77.46875 238.320313 77.394531 238.191406 77.320313 238.058594 C 76.046875 238.160156 74.773438 238.320313 73.5 238.347656 C 72.214844 238.371094 70.894531 238.429688 69.648438 238.179688 C 66.917969 237.628906 65.417969 235.339844 65.773438 232.585938 C 65.847656 231.992188 65.910156 231.398438 66.003906 230.550781 C 65.113281 230.550781 64.382813 230.550781 63.648438 230.550781 C 58.261719 230.550781 52.875 230.503906 47.488281 230.578125 C 46.007813 230.601563 44.960938 230.179688 43.90625 229.117188 C 29.859375 215.003906 15.769531 200.929688 1.679688 186.855469 C 1.160156 186.335938 0.5625 185.890625 0 185.410156 C 0 140.253906 0 95.09375 0 49.933594 C 0.332031 49.714844 0.710938 49.539063 0.992188 49.265625 C 4.589844 45.828125 8.171875 42.375 11.757813 38.929688 C 22.8125 28.300781 33.875 17.683594 44.917969 7.042969 C 47.3125 4.738281 49.628906 2.351563 51.980469 0 C 97.957031 0 143.9375 0 189.914063 0 C 190.371094 0.496094 190.804688 1.023438 191.292969 1.492188 C 195.417969 5.460938 199.558594 9.414063 203.6875 13.382813 C 211.546875 20.941406 219.402344 28.507813 227.257813 36.074219 C 232.113281 40.753906 236.964844 45.441406 241.703125 50.015625 C 241.703125 75.300781 241.703125 100.425781 241.703125 125.695313 C 218.851563 125.695313 196.160156 125.695313 173.40625 125.695313 C 173.40625 126.246094 173.421875 126.648438 173.402344 127.050781 C 173.167969 131.855469 169.175781 134.410156 164.660156 132.78125 C 163.15625 132.238281 161.507813 132.0625 159.910156 131.832031 C 158.632813 131.648438 157.320313 131.703125 156.039063 131.535156 C 152.410156 131.058594 148.785156 130.523438 145.085938 130.003906 C 145.410156 130.421875 145.71875 130.84375 146.050781 131.246094 C 148.84375 134.617188 152.519531 136.839844 156.195313 139.074219 C 157.402344 139.808594 158.613281 140.144531 160.042969 140.136719 C 171.5 140.09375 182.957031 140.140625 194.414063 140.078125 C 195.976563 140.070313 197.0625 140.550781 198.15625 141.648438 C 212.15625 155.714844 226.191406 169.75 240.261719 183.746094 C 241.410156 184.890625 241.902344 186.011719 241.902344 187.652344 C 241.855469 229.324219 241.867188 270.992188 241.867188 312.664063 C 241.867188 313.410156 241.867188 314.15625 241.867188 314.941406 C 224.503906 331.652344 207.171875 348.335938 189.855469 365 C 143.90625 365 98.019531 365 52.15625 365 C 49.609375 362.539063 47.113281 360.121094 44.609375 357.707031 C 30.621094 344.226563 16.636719 330.742188 2.636719 317.273438 C 1.828125 316.496094 0.882813 315.859375 0 315.160156 "/>
</g>
<path style=" stroke:none;fill-rule:nonzero;fill:rgb(100%,100%,100%);fill-opacity:1;" d="M 12.75 258.398438 C 12.71875 259.09375 12.667969 259.6875 12.667969 260.285156 C 12.632813 275.835938 12.636719 291.386719 12.527344 306.933594 C 12.515625 308.765625 13.140625 309.972656 14.410156 311.164063 C 19.472656 315.925781 24.476563 320.757813 29.488281 325.574219 C 38.429688 334.175781 47.375 342.777344 56.285156 351.40625 C 57.03125 352.128906 57.757813 352.464844 58.796875 352.449219 C 62.960938 352.398438 67.121094 352.472656 71.28125 352.417969 C 76.671875 352.347656 81.402344 350.507813 85.453125 346.933594 C 88.347656 344.371094 90.582031 341.277344 92.527344 337.984375 C 94.738281 334.253906 97.441406 330.957031 100.652344 328.054688 C 102.167969 326.683594 103.621094 325.238281 105.199219 323.9375 C 107.410156 322.117188 108.589844 319.746094 109.335938 317.054688 C 110.398438 313.207031 110.707031 309.253906 110.75 305.3125 C 110.882813 292.765625 110.859375 280.21875 110.878906 267.667969 C 110.882813 267.03125 110.722656 266.390625 110.640625 265.789063 C 109.265625 265.410156 108.386719 266.027344 107.609375 266.632813 C 106.375 267.59375 105.183594 268.632813 104.097656 269.753906 C 102.339844 271.5625 100.289063 272.878906 97.871094 273.5 C 95.902344 274.007813 93.882813 274.367188 91.863281 274.640625 C 89.441406 274.96875 86.878906 274.75 84.578125 275.441406 C 76.71875 277.800781 69.570313 281.523438 63.78125 287.511719 C 62.996094 288.320313 62.191406 289.050781 60.941406 288.664063 C 59.738281 288.289063 59.351563 287.253906 59.046875 286.1875 C 58.933594 285.800781 58.933594 285.378906 58.914063 284.972656 C 58.757813 281.015625 62.476563 270.03125 65.003906 266.992188 C 67.679688 263.773438 71.144531 261.648438 74.863281 259.871094 C 75.628906 259.503906 76.363281 259.082031 77.109375 258.6875 C 77.0625 258.589844 77.019531 258.496094 76.972656 258.398438 C 55.605469 258.398438 34.238281 258.398438 12.75 258.398438 Z M 172.03125 241.433594 C 170.605469 241.496094 169.546875 241.628906 168.496094 241.574219 C 162.835938 241.273438 157.476563 239.898438 152.546875 236.996094 C 150.722656 235.925781 148.867188 236.140625 147.15625 237.328125 C 145.804688 238.265625 145.417969 239.660156 146.234375 241.046875 C 146.992188 242.324219 147.835938 243.601563 148.859375 244.667969 C 151.964844 247.890625 155.894531 249.433594 160.273438 250.089844 C 162.277344 250.390625 164.3125 250.828125 166.1875 251.574219 C 168.828125 252.628906 169.503906 254.75 168.191406 257.242188 C 167.660156 258.253906 166.914063 259.175781 166.152344 260.03125 C 164.253906 262.160156 164.160156 264.085938 166.082031 266.179688 C 166.710938 266.863281 167.550781 267.375 168.34375 267.894531 C 169.882813 268.898438 171.503906 269.78125 172.996094 270.851563 C 175.296875 272.492188 177.421875 274.425781 178.417969 277.109375 C 180.027344 281.445313 181.433594 285.863281 182.75 290.296875 C 183.144531 291.628906 183.097656 293.140625 183.003906 294.554688 C 182.902344 296.148438 181.867188 296.878906 180.316406 296.464844 C 179.082031 296.132813 177.855469 295.625 176.761719 294.96875 C 174.191406 293.425781 171.757813 291.652344 169.171875 290.144531 C 165.941406 288.257813 162.6875 286.386719 159.304688 284.800781 C 156.441406 283.457031 153.332031 283.042969 150.121094 283.484375 C 148.371094 283.726563 146.585938 283.675781 144.816406 283.777344 C 141.253906 283.980469 138.101563 282.945313 135.308594 280.730469 C 134.363281 279.984375 133.34375 278.957031 132.054688 279.496094 C 130.582031 280.113281 130.871094 281.648438 130.867188 282.914063 C 130.851563 291.234375 130.847656 299.554688 130.867188 307.878906 C 130.871094 310.875 130.78125 313.886719 131.015625 316.871094 C 131.722656 325.789063 135.359375 332.960938 143.585938 337.296875 C 147.066406 339.128906 149.996094 341.652344 152.550781 344.640625 C 153.296875 345.511719 154.160156 346.339844 155.121094 346.949219 C 160.089844 350.117188 165.496094 352.117188 171.414063 352.402344 C 175.359375 352.589844 179.320313 352.457031 183.273438 352.539063 C 184.339844 352.5625 185.039063 352.128906 185.765625 351.425781 C 190.457031 346.863281 195.179688 342.335938 199.898438 337.800781 C 209.332031 328.726563 218.761719 319.648438 228.222656 310.605469 C 229.132813 309.738281 229.511719 308.851563 229.507813 307.574219 C 229.476563 269.246094 229.476563 230.914063 229.507813 192.582031 C 229.511719 191.308594 229.113281 190.433594 228.222656 189.554688 C 216.273438 177.679688 204.347656 165.78125 192.449219 153.859375 C 191.609375 153.015625 190.777344 152.664063 189.59375 152.671875 C 182.636719 152.722656 175.679688 152.695313 168.722656 152.699219 C 168.191406 152.699219 167.660156 152.746094 166.984375 152.78125 C 167.207031 153.324219 167.355469 153.765625 167.554688 154.179688 C 169.433594 158.035156 170.238281 162.179688 170.753906 166.382813 C 171.03125 168.664063 169.851563 169.792969 167.597656 169.328125 C 166.15625 169.03125 164.785156 168.363281 163.40625 167.800781 C 162.335938 167.367188 161.332031 166.765625 160.25 166.371094 C 155.332031 164.566406 150.398438 162.808594 145.46875 161.035156 C 144.636719 160.734375 143.820313 160.363281 142.964844 160.15625 C 141.582031 159.824219 140.425781 160.347656 139.445313 161.320313 C 138.472656 162.28125 138.863281 163.34375 139.273438 164.359375 C 140.578125 167.625 142.609375 170.296875 145.757813 171.988281 C 147.253906 172.789063 148.78125 173.550781 150.335938 174.242188 C 154.101563 175.910156 157.644531 177.925781 160.648438 180.769531 C 161.382813 181.464844 162.089844 182.25 162.578125 183.125 C 163.484375 184.753906 162.628906 185.945313 160.753906 185.828125 C 160.484375 185.8125 160.191406 185.789063 159.953125 185.679688 C 157.648438 184.601563 155.296875 184.886719 152.945313 185.445313 C 149.5625 186.253906 146.328125 185.863281 143.175781 184.421875 C 141.878906 183.828125 140.53125 183.328125 139.175781 182.890625 C 138.585938 182.699219 137.910156 182.761719 137.308594 182.714844 C 136.777344 183.953125 137.230469 184.816406 137.675781 185.652344 C 138.851563 187.851563 140.457031 189.664063 142.5 191.121094 C 147.054688 194.367188 151.722656 197.421875 156.734375 199.941406 C 164.527344 203.855469 168.496094 210.597656 170.34375 218.820313 C 170.503906 219.53125 170.3125 220.320313 170.265625 221.527344 C 168.789063 220.925781 167.566406 220.71875 166.746094 220.035156 C 164.597656 218.246094 162.183594 217.707031 159.503906 217.875 C 155.089844 218.152344 151.332031 216.757813 148.269531 213.511719 C 147.871094 213.089844 147.207031 212.910156 146.679688 212.625 C 144.632813 216.027344 145.734375 220.753906 148.84375 222.5625 C 149.777344 223.105469 150.824219 223.457031 151.816406 223.90625 C 155.414063 225.53125 159.050781 227.085938 162.59375 228.832031 C 164.160156 229.609375 165.648438 230.652344 166.972656 231.804688 C 169.734375 234.207031 171.183594 237.375 172.03125 241.433594 Z M 95.757813 205.304688 C 93.78125 205.304688 92.03125 205.417969 90.300781 205.269531 C 88.816406 205.140625 87.359375 204.703125 85.886719 204.417969 C 82.757813 203.808594 79.675781 203.613281 76.707031 205.183594 C 76.097656 205.503906 75.308594 205.476563 74.683594 205.59375 C 73.894531 204.425781 74.425781 203.554688 74.8125 202.707031 C 77.011719 197.871094 80.933594 194.742188 85.480469 192.378906 C 90.523438 189.761719 95.242188 186.667969 99.816406 183.328125 C 101.625 182.007813 103.039063 180.332031 103.933594 178.332031 C 104.5 177.070313 104.796875 175.597656 104.839844 174.207031 C 104.902344 172.167969 103.5 171.414063 101.707031 172.335938 C 101.40625 172.488281 101.109375 172.667969 100.835938 172.867188 C 94.964844 177.140625 88.488281 177.3125 81.738281 175.683594 C 81.507813 174.40625 81.484375 174.195313 82.246094 173.335938 C 83.832031 171.546875 85.433594 169.769531 87.660156 168.730469 C 89.453125 167.894531 91.273438 167.113281 93.011719 166.183594 C 94.804688 165.222656 96.640625 164.261719 98.238281 163.023438 C 100.507813 161.269531 101.964844 158.886719 102.511719 156.019531 C 102.679688 155.144531 102.847656 154.238281 101.539063 153.535156 C 100.746094 153.921875 99.679688 154.242188 98.863281 154.878906 C 95.441406 157.53125 91.484375 158.292969 87.316406 158.269531 C 82.019531 158.234375 77.566406 159.871094 74.308594 164.265625 C 73.644531 165.164063 72.835938 166.082031 71.472656 166.101563 C 70.191406 165.113281 70.3125 163.683594 70.476563 162.367188 C 70.835938 159.460938 71.285156 156.5625 71.820313 153.683594 C 73.140625 146.550781 76.871094 141.175781 83.363281 137.710938 C 86.488281 136.046875 89.445313 134.066406 92.433594 132.164063 C 95.582031 130.164063 98.128906 127.492188 100.335938 124.53125 C 101.257813 123.292969 102.03125 121.863281 102.511719 120.402344 C 103.140625 118.5 103.152344 116.527344 101.441406 114.648438 C 100.640625 115.214844 99.890625 115.742188 99.148438 116.277344 C 97.996094 117.117188 96.964844 118.3125 95.679688 118.738281 C 91.734375 120.050781 87.699219 121.105469 83.449219 120.410156 C 80.894531 119.996094 78.421875 120.257813 76.085938 121.441406 C 75.839844 121.566406 75.589844 121.679688 75.335938 121.769531 C 73.550781 122.382813 72.113281 121.296875 72.382813 119.410156 C 72.503906 118.570313 72.875 117.683594 73.378906 117 C 74.140625 115.964844 75.050781 115.019531 76.007813 114.15625 C 80.847656 109.800781 86.300781 106.296875 91.925781 103.078125 C 96.242188 100.609375 100.738281 98.464844 105.046875 95.988281 C 106.480469 95.164063 107.773438 93.914063 108.796875 92.601563 C 110.34375 90.613281 109.386719 88.445313 106.878906 88.140625 C 105.78125 88.007813 104.605469 88.339844 103.492188 88.585938 C 102.171875 88.878906 100.894531 89.53125 99.570313 89.621094 C 97.261719 89.777344 94.933594 89.671875 92.621094 89.570313 C 91.863281 89.535156 91.121094 89.167969 89.996094 88.84375 C 90.585938 87.824219 90.898438 87.003906 91.445313 86.394531 C 93 84.644531 94.863281 83.277344 97.023438 82.328125 C 99.207031 81.371094 101.394531 80.421875 103.554688 79.417969 C 105.476563 78.53125 106.699219 77.035156 107.039063 74.925781 C 107.40625 72.660156 106.378906 71.558594 104.121094 71.730469 C 103.105469 71.808594 102.085938 71.996094 101.070313 71.984375 C 100.15625 71.972656 99.25 71.757813 98.054688 71.589844 C 98.320313 70.585938 98.359375 69.8125 98.71875 69.238281 C 99.292969 68.324219 100.011719 67.476563 100.789063 66.722656 C 103.664063 63.929688 106.925781 61.761719 110.84375 60.671875 C 112.089844 60.324219 113.316406 59.867188 113.65625 58.261719 C 112.875 57.246094 111.746094 57.019531 110.59375 56.898438 C 109.171875 56.746094 107.726563 56.738281 106.328125 56.472656 C 105.667969 56.347656 104.746094 55.882813 104.582031 55.367188 C 104.425781 54.878906 104.945313 53.9375 105.441406 53.519531 C 106.839844 52.335938 108.417969 51.363281 109.855469 50.21875 C 111.71875 48.738281 113.601563 47.265625 115.308594 45.617188 C 116.519531 44.445313 116.363281 43.636719 115.085938 42.519531 C 114.160156 41.714844 113.144531 41.011719 112.222656 40.203125 C 111.570313 39.636719 110.820313 39.0625 111.085938 37.746094 C 111.613281 37.605469 112.230469 37.300781 112.855469 37.296875 C 114.582031 37.285156 115.714844 36.394531 116.371094 34.933594 C 116.980469 33.574219 117.488281 32.152344 117.882813 30.714844 C 118.5 28.480469 118.964844 26.210938 119.535156 23.964844 C 119.722656 23.21875 119.757813 22.285156 121.035156 22.195313 C 121.210938 22.925781 121.382813 23.644531 121.550781 24.363281 C 122.089844 26.6875 122.535156 29.03125 123.183594 31.324219 C 123.8125 33.53125 124.90625 35.339844 127.660156 35.3125 C 128.226563 35.308594 128.804688 35.777344 129.363281 36.023438 C 128.964844 37.851563 127.558594 38.503906 126.589844 39.507813 C 124.914063 41.25 125.261719 43.148438 127.515625 43.992188 C 128.460938 44.34375 129.503906 44.433594 130.507813 44.597656 C 132.433594 44.914063 132.867188 45.851563 131.613281 47.363281 C 130.839844 48.296875 129.851563 49.058594 128.910156 49.839844 C 127.152344 51.296875 126.9375 52.183594 128.390625 53.9375 C 129.425781 55.1875 130.6875 56.257813 131.933594 57.304688 C 133.132813 58.3125 134.511719 59.101563 135.683594 60.136719 C 138.261719 62.417969 138.078125 63.71875 135.089844 65.28125 C 134.789063 65.441406 134.488281 65.605469 134.210938 65.800781 C 133.445313 66.339844 132.515625 66.753906 132.546875 68.1875 C 133.074219 68.484375 133.699219 68.84375 134.324219 69.195313 C 137.695313 71.070313 140.769531 73.320313 142.949219 76.5625 C 144.042969 78.183594 143.53125 79.15625 141.574219 79.246094 C 140.222656 79.304688 138.847656 79.179688 137.5 78.996094 C 135.007813 78.660156 134.472656 80.128906 134.652344 81.835938 C 134.742188 82.6875 135.035156 83.558594 135.425781 84.328125 C 136.105469 85.660156 137.335938 86.410156 138.675781 87.003906 C 141.601563 88.300781 144.597656 89.472656 147.410156 90.988281 C 149.234375 91.96875 150.976563 93.277344 152.414063 94.769531 C 153.910156 96.328125 153.269531 98.144531 151.160156 98.628906 C 149.800781 98.9375 148.332031 98.890625 146.921875 98.816406 C 144.820313 98.703125 142.730469 98.265625 140.632813 98.261719 C 138.828125 98.257813 137.011719 98.625 135.554688 99.796875 C 135.585938 101.222656 136.3125 102.042969 137.285156 102.570313 C 138.714844 103.347656 140.167969 104.175781 141.714844 104.636719 C 146.890625 106.179688 151.464844 108.835938 155.75 112.027344 C 156.804688 112.8125 157.855469 113.105469 159.140625 113.097656 C 166.027344 113.058594 172.917969 113.089844 179.808594 113.078125 C 195.632813 113.054688 211.457031 113.019531 227.28125 112.988281 C 227.945313 112.984375 228.605469 112.929688 229.480469 112.890625 C 229.480469 111.953125 229.480469 111.152344 229.480469 110.351563 C 229.480469 92.960938 229.453125 75.5625 229.527344 58.171875 C 229.535156 56.347656 228.933594 55.144531 227.667969 53.9375 C 220.550781 47.175781 213.5 40.34375 206.421875 33.539063 C 199.640625 27.019531 192.820313 20.535156 186.09375 13.960938 C 185.007813 12.898438 183.9375 12.550781 182.484375 12.550781 C 141.488281 12.578125 100.492188 12.574219 59.496094 12.574219 C 59.222656 12.574219 58.949219 12.597656 58.675781 12.570313 C 57.714844 12.464844 57.035156 12.875 56.34375 13.539063 C 42.207031 27.167969 28.054688 40.78125 13.867188 54.355469 C 12.949219 55.238281 12.546875 56.085938 12.550781 57.355469 C 12.578125 97.605469 12.578125 137.851563 12.546875 178.097656 C 12.546875 179.367188 12.941406 180.246094 13.828125 181.132813 C 25.699219 192.992188 37.550781 204.871094 49.359375 216.792969 C 50.367188 217.804688 51.371094 218.164063 52.769531 218.15625 C 62.25 218.101563 71.734375 218.015625 81.210938 218.183594 C 84.789063 218.246094 88 217.4375 91.269531 216.117188 C 96 214.210938 96.300781 210.089844 95.9375 205.519531 C 95.925781 205.363281 95.683594 205.222656 95.757813 205.304688 Z M 235.886719 119.484375 C 211.996094 119.484375 188.476563 119.484375 164.660156 119.484375 C 165.925781 121.144531 167.070313 122.539063 168.085938 124.027344 C 168.609375 124.796875 169.085938 125.695313 169.25 126.59375 C 169.601563 128.535156 168.035156 129.785156 166.242188 128.980469 C 164.191406 128.058594 162.050781 127.847656 159.871094 127.726563 C 153.035156 127.347656 146.277344 126.621094 140.050781 123.429688 C 139.660156 123.234375 139.15625 123.265625 138.632813 123.179688 C 137.503906 125.199219 138.125 127.007813 139.085938 128.667969 C 141.082031 132.121094 143.5625 135.273438 146.800781 137.585938 C 150.949219 140.546875 155.351563 143.167969 159.699219 145.84375 C 160.328125 146.230469 161.265625 146.214844 162.0625 146.21875 C 172.019531 146.242188 181.980469 146.261719 191.9375 146.203125 C 193.417969 146.195313 194.46875 146.609375 195.523438 147.671875 C 208.464844 160.679688 221.4375 173.652344 234.445313 186.59375 C 235.5 187.640625 235.921875 188.683594 235.917969 190.167969 C 235.878906 230.140625 235.878906 270.109375 235.925781 310.082031 C 235.929688 311.679688 235.394531 312.738281 234.292969 313.792969 C 225.566406 322.132813 216.886719 330.511719 208.1875 338.878906 C 201.703125 345.117188 195.199219 351.339844 188.742188 357.605469 C 187.746094 358.570313 186.71875 358.960938 185.3125 358.960938 C 142.476563 358.921875 99.640625 358.917969 56.800781 358.96875 C 55.214844 358.96875 54.113281 358.449219 53.039063 357.40625 C 47.175781 351.699219 41.289063 346.019531 35.398438 340.34375 C 26.117188 331.402344 16.839844 322.457031 7.527344 313.554688 C 6.515625 312.585938 6.074219 311.609375 6.082031 310.183594 C 6.144531 291.496094 6.144531 272.804688 6.164063 254.117188 C 6.164063 253.449219 6.164063 252.78125 6.164063 251.910156 C 29.804688 251.910156 53.242188 251.910156 76.679688 251.910156 C 76.753906 251.761719 76.828125 251.609375 76.902344 251.460938 C 76.183594 250.84375 75.394531 250.289063 74.765625 249.589844 C 74.152344 248.90625 73.503906 248.140625 73.230469 247.292969 C 72.875 246.195313 73.582031 244.992188 75.074219 244.484375 C 77.316406 243.722656 79.636719 243.136719 81.96875 242.726563 C 86.703125 241.890625 90.800781 239.984375 93.875 236.195313 C 94.429688 235.511719 94.910156 234.746094 95.316406 233.96875 C 96.222656 232.242188 95.808594 230.753906 94.125 229.796875 C 92.546875 228.898438 90.832031 228.726563 89.242188 229.652344 C 84.304688 232.523438 78.976563 233.992188 73.308594 234.300781 C 72.199219 234.359375 71.082031 234.234375 69.59375 234.179688 C 70.460938 230.371094 71.742188 227.257813 74.644531 224.539063 C 73.621094 224.488281 73.042969 224.433594 72.464844 224.433594 C 64.890625 224.425781 57.320313 224.398438 49.75 224.457031 C 48.410156 224.464844 47.472656 224.050781 46.535156 223.109375 C 33.492188 210.011719 20.417969 196.941406 7.324219 183.894531 C 6.496094 183.066406 6.085938 182.261719 6.085938 181.054688 C 6.117188 138.695313 6.113281 96.339844 6.113281 53.980469 C 6.113281 53.640625 6.113281 53.300781 6.113281 52.855469 C 9.71875 49.378906 13.335938 45.871094 16.96875 42.382813 C 25.324219 34.347656 33.683594 26.320313 42.039063 18.289063 C 45.773438 14.699219 49.527344 11.125 53.21875 7.492188 C 54.261719 6.46875 55.355469 6.078125 56.835938 6.078125 C 99.605469 6.117188 142.371094 6.121094 185.140625 6.078125 C 186.710938 6.074219 187.800781 6.566406 188.898438 7.625 C 204.058594 22.257813 219.242188 36.867188 234.449219 51.449219 C 235.460938 52.414063 235.921875 53.394531 235.917969 54.820313 C 235.875 75.621094 235.886719 96.425781 235.886719 117.230469 C 235.886719 117.898438 235.886719 118.5625 235.886719 119.484375 "/>
<path style=" stroke:none;fill-rule:nonzero;fill:rgb(60.398865%,10.598755%,11.799622%);fill-opacity:1;" d="M 95.757813 205.304688 C 95.683594 205.222656 95.925781 205.363281 95.9375 205.519531 C 96.300781 210.089844 96 214.210938 91.269531 216.117188 C 88 217.4375 84.789063 218.246094 81.210938 218.183594 C 71.734375 218.015625 62.25 218.101563 52.769531 218.15625 C 51.371094 218.164063 50.367188 217.804688 49.359375 216.792969 C 37.550781 204.871094 25.699219 192.992188 13.828125 181.132813 C 12.941406 180.246094 12.546875 179.367188 12.546875 178.097656 C 12.578125 137.851563 12.578125 97.605469 12.550781 57.355469 C 12.546875 56.085938 12.949219 55.238281 13.867188 54.355469 C 28.054688 40.78125 42.207031 27.167969 56.34375 13.539063 C 57.035156 12.875 57.714844 12.464844 58.675781 12.570313 C 58.949219 12.597656 59.222656 12.574219 59.496094 12.574219 C 100.492188 12.574219 141.488281 12.578125 182.484375 12.550781 C 183.9375 12.550781 185.007813 12.898438 186.09375 13.960938 C 192.820313 20.535156 199.640625 27.019531 206.421875 33.539063 C 213.5 40.34375 220.550781 47.175781 227.667969 53.9375 C 228.933594 55.144531 229.535156 56.347656 229.527344 58.171875 C 229.453125 75.5625 229.480469 92.960938 229.480469 110.351563 C 229.480469 111.152344 229.480469 111.953125 229.480469 112.890625 C 228.605469 112.929688 227.945313 112.984375 227.28125 112.988281 C 211.457031 113.019531 195.632813 113.054688 179.808594 113.078125 C 172.917969 113.089844 166.027344 113.058594 159.140625 113.097656 C 157.855469 113.105469 156.804688 112.8125 155.75 112.027344 C 151.464844 108.835938 146.890625 106.179688 141.714844 104.636719 C 140.167969 104.175781 138.714844 103.347656 137.285156 102.570313 C 136.3125 102.042969 135.585938 101.222656 135.554688 99.796875 C 137.011719 98.625 138.828125 98.257813 140.632813 98.261719 C 142.730469 98.265625 144.820313 98.703125 146.921875 98.816406 C 148.332031 98.890625 149.800781 98.9375 151.160156 98.628906 C 153.269531 98.144531 153.910156 96.328125 152.414063 94.769531 C 150.976563 93.277344 149.234375 91.96875 147.410156 90.988281 C 144.597656 89.472656 141.601563 88.300781 138.675781 87.003906 C 137.335938 86.410156 136.105469 85.660156 135.425781 84.328125 C 135.035156 83.558594 134.742188 82.6875 134.652344 81.835938 C 134.472656 80.128906 135.007813 78.660156 137.5 78.996094 C 138.847656 79.179688 140.222656 79.304688 141.574219 79.246094 C 143.53125 79.15625 144.042969 78.183594 142.949219 76.5625 C 140.769531 73.320313 137.695313 71.070313 134.324219 69.195313 C 133.699219 68.84375 133.074219 68.484375 132.546875 68.1875 C 132.515625 66.753906 133.445313 66.339844 134.210938 65.800781 C 134.488281 65.605469 134.789063 65.441406 135.089844 65.28125 C 138.078125 63.71875 138.261719 62.417969 135.683594 60.136719 C 134.511719 59.101563 133.132813 58.3125 131.933594 57.304688 C 130.6875 56.257813 129.425781 55.1875 128.390625 53.9375 C 126.9375 52.183594 127.152344 51.296875 128.910156 49.839844 C 129.851563 49.058594 130.839844 48.296875 131.613281 47.363281 C 132.867188 45.851563 132.433594 44.914063 130.507813 44.597656 C 129.503906 44.433594 128.460938 44.34375 127.515625 43.992188 C 125.261719 43.148438 124.914063 41.25 126.589844 39.507813 C 127.558594 38.503906 128.964844 37.851563 129.363281 36.023438 C 128.804688 35.777344 128.226563 35.308594 127.660156 35.3125 C 124.90625 35.339844 123.8125 33.53125 123.183594 31.324219 C 122.535156 29.03125 122.089844 26.6875 121.550781 24.363281 C 121.382813 23.644531 121.210938 22.925781 121.035156 22.195313 C 119.757813 22.285156 119.722656 23.21875 119.535156 23.964844 C 118.964844 26.210938 118.5 28.480469 117.882813 30.714844 C 117.488281 32.152344 116.980469 33.574219 116.371094 34.933594 C 115.714844 36.394531 114.582031 37.285156 112.855469 37.296875 C 112.230469 37.300781 111.613281 37.605469 111.085938 37.746094 C 110.820313 39.0625 111.570313 39.636719 112.222656 40.203125 C 113.144531 41.011719 114.160156 41.714844 115.085938 42.519531 C 116.363281 43.636719 116.519531 44.445313 115.308594 45.617188 C 113.601563 47.265625 111.71875 48.738281 109.855469 50.21875 C 108.417969 51.363281 106.839844 52.335938 105.441406 53.519531 C 104.945313 53.9375 104.425781 54.878906 104.582031 55.367188 C 104.746094 55.882813 105.667969 56.347656 106.328125 56.472656 C 107.726563 56.738281 109.171875 56.746094 110.59375 56.898438 C 111.746094 57.019531 112.875 57.246094 113.65625 58.261719 C 113.316406 59.867188 112.089844 60.324219 110.84375 60.671875 C 106.925781 61.761719 103.664063 63.929688 100.789063 66.722656 C 100.011719 67.476563 99.292969 68.324219 98.71875 69.238281 C 98.359375 69.8125 98.320313 70.585938 98.054688 71.589844 C 99.25 71.757813 100.15625 71.972656 101.070313 71.984375 C 102.085938 71.996094 103.105469 71.808594 104.121094 71.730469 C 106.378906 71.558594 107.40625 72.660156 107.039063 74.925781 C 106.699219 77.035156 105.476563 78.53125 103.554688 79.417969 C 101.394531 80.421875 99.207031 81.371094 97.023438 82.328125 C 94.863281 83.277344 93 84.644531 91.445313 86.394531 C 90.898438 87.003906 90.585938 87.824219 89.996094 88.84375 C 91.121094 89.167969 91.863281 89.535156 92.621094 89.570313 C 94.933594 89.671875 97.261719 89.777344 99.570313 89.621094 C 100.894531 89.53125 102.171875 88.878906 103.492188 88.585938 C 104.605469 88.339844 105.78125 88.007813 106.878906 88.140625 C 109.386719 88.445313 110.34375 90.613281 108.796875 92.601563 C 107.773438 93.914063 106.480469 95.164063 105.046875 95.988281 C 100.738281 98.464844 96.242188 100.609375 91.925781 103.078125 C 86.300781 106.296875 80.847656 109.800781 76.007813 114.15625 C 75.050781 115.019531 74.140625 115.964844 73.378906 117 C 72.875 117.683594 72.503906 118.570313 72.382813 119.410156 C 72.113281 121.296875 73.550781 122.382813 75.335938 121.769531 C 75.589844 121.679688 75.839844 121.566406 76.085938 121.441406 C 78.421875 120.257813 80.894531 119.996094 83.449219 120.410156 C 87.699219 121.105469 91.734375 120.050781 95.679688 118.738281 C 96.964844 118.3125 97.996094 117.117188 99.148438 116.277344 C 99.890625 115.742188 100.640625 115.214844 101.441406 114.648438 C 103.152344 116.527344 103.140625 118.5 102.511719 120.402344 C 102.03125 121.863281 101.257813 123.292969 100.335938 124.53125 C 98.128906 127.492188 95.582031 130.164063 92.433594 132.164063 C 89.445313 134.066406 86.488281 136.046875 83.363281 137.710938 C 76.871094 141.175781 73.140625 146.550781 71.820313 153.683594 C 71.285156 156.5625 70.835938 159.460938 70.476563 162.367188 C 70.3125 163.683594 70.191406 165.113281 71.472656 166.101563 C 72.835938 166.082031 73.644531 165.164063 74.308594 164.265625 C 77.566406 159.871094 82.019531 158.234375 87.316406 158.269531 C 91.484375 158.292969 95.441406 157.53125 98.863281 154.878906 C 99.679688 154.242188 100.746094 153.921875 101.539063 153.535156 C 102.847656 154.238281 102.679688 155.144531 102.511719 156.019531 C 101.964844 158.886719 100.507813 161.269531 98.238281 163.023438 C 96.640625 164.261719 94.804688 165.222656 93.011719 166.183594 C 91.273438 167.113281 89.453125 167.894531 87.660156 168.730469 C 85.433594 169.769531 83.832031 171.546875 82.246094 173.335938 C 81.484375 174.195313 81.507813 174.40625 81.738281 175.683594 C 88.488281 177.3125 94.964844 177.140625 100.835938 172.867188 C 101.109375 172.667969 101.40625 172.488281 101.707031 172.335938 C 103.5 171.414063 104.902344 172.167969 104.839844 174.207031 C 104.796875 175.597656 104.5 177.070313 103.933594 178.332031 C 103.039063 180.332031 101.625 182.007813 99.816406 183.328125 C 95.242188 186.667969 90.523438 189.761719 85.480469 192.378906 C 80.933594 194.742188 77.011719 197.871094 74.8125 202.707031 C 74.425781 203.554688 73.894531 204.425781 74.683594 205.59375 C 75.308594 205.476563 76.097656 205.503906 76.707031 205.183594 C 79.675781 203.613281 82.757813 203.808594 85.886719 204.417969 C 87.359375 204.703125 88.816406 205.140625 90.300781 205.269531 C 92.03125 205.417969 93.78125 205.304688 95.757813 205.304688 "/>
<path style=" stroke:none;fill-rule:nonzero;fill:rgb(60.398865%,10.598755%,11.799622%);fill-opacity:1;" d="M 172.03125 241.433594 C 171.183594 237.375 169.734375 234.207031 166.972656 231.804688 C 165.648438 230.652344 164.160156 229.609375 162.59375 228.832031 C 159.050781 227.085938 155.414063 225.53125 151.816406 223.90625 C 150.824219 223.457031 149.777344 223.105469 148.84375 222.5625 C 145.734375 220.753906 144.632813 216.027344 146.679688 212.625 C 147.207031 212.910156 147.871094 213.089844 148.269531 213.511719 C 151.332031 216.757813 155.089844 218.152344 159.503906 217.875 C 162.183594 217.707031 164.597656 218.246094 166.746094 220.035156 C 167.566406 220.71875 168.789063 220.925781 170.265625 221.527344 C 170.3125 220.320313 170.503906 219.53125 170.34375 218.820313 C 168.496094 210.597656 164.527344 203.855469 156.734375 199.941406 C 151.722656 197.421875 147.054688 194.367188 142.5 191.121094 C 140.457031 189.664063 138.851563 187.851563 137.675781 185.652344 C 137.230469 184.816406 136.777344 183.953125 137.308594 182.714844 C 137.910156 182.761719 138.585938 182.699219 139.175781 182.890625 C 140.53125 183.328125 141.878906 183.828125 143.175781 184.421875 C 146.328125 185.863281 149.5625 186.253906 152.945313 185.445313 C 155.296875 184.886719 157.648438 184.601563 159.953125 185.679688 C 160.191406 185.789063 160.484375 185.8125 160.753906 185.828125 C 162.628906 185.945313 163.484375 184.753906 162.578125 183.125 C 162.089844 182.25 161.382813 181.464844 160.648438 180.769531 C 157.644531 177.925781 154.101563 175.910156 150.335938 174.242188 C 148.78125 173.550781 147.253906 172.789063 145.757813 171.988281 C 142.609375 170.296875 140.578125 167.625 139.273438 164.359375 C 138.863281 163.34375 138.472656 162.28125 139.445313 161.320313 C 140.425781 160.347656 141.582031 159.824219 142.964844 160.15625 C 143.820313 160.363281 144.636719 160.734375 145.46875 161.035156 C 150.398438 162.808594 155.332031 164.566406 160.25 166.371094 C 161.332031 166.765625 162.335938 167.367188 163.40625 167.800781 C 164.785156 168.363281 166.15625 169.03125 167.597656 169.328125 C 169.851563 169.792969 171.03125 168.664063 170.753906 166.382813 C 170.238281 162.179688 169.433594 158.035156 167.554688 154.179688 C 167.355469 153.765625 167.207031 153.324219 166.984375 152.78125 C 167.660156 152.746094 168.191406 152.699219 168.722656 152.699219 C 175.679688 152.695313 182.636719 152.722656 189.59375 152.671875 C 190.777344 152.664063 191.609375 153.015625 192.449219 153.859375 C 204.347656 165.78125 216.273438 177.679688 228.222656 189.554688 C 229.113281 190.433594 229.511719 191.308594 229.507813 192.582031 C 229.476563 230.914063 229.476563 269.246094 229.507813 307.574219 C 229.511719 308.851563 229.132813 309.738281 228.222656 310.605469 C 218.761719 319.648438 209.332031 328.726563 199.898438 337.800781 C 195.179688 342.335938 190.457031 346.863281 185.765625 351.425781 C 185.039063 352.128906 184.339844 352.5625 183.273438 352.539063 C 179.320313 352.457031 175.359375 352.589844 171.414063 352.402344 C 165.496094 352.117188 160.089844 350.117188 155.121094 346.949219 C 154.160156 346.339844 153.296875 345.511719 152.550781 344.640625 C 149.996094 341.652344 147.066406 339.128906 143.585938 337.296875 C 135.359375 332.960938 131.722656 325.789063 131.015625 316.871094 C 130.78125 313.886719 130.871094 310.875 130.867188 307.878906 C 130.847656 299.554688 130.851563 291.234375 130.867188 282.914063 C 130.871094 281.648438 130.582031 280.113281 132.054688 279.496094 C 133.34375 278.957031 134.363281 279.984375 135.308594 280.730469 C 138.101563 282.945313 141.253906 283.980469 144.816406 283.777344 C 146.585938 283.675781 148.371094 283.726563 150.121094 283.484375 C 153.332031 283.042969 156.441406 283.457031 159.304688 284.800781 C 162.6875 286.386719 165.941406 288.257813 169.171875 290.144531 C 171.757813 291.652344 174.191406 293.425781 176.761719 294.96875 C 177.855469 295.625 179.082031 296.132813 180.316406 296.464844 C 181.867188 296.878906 182.902344 296.148438 183.003906 294.554688 C 183.097656 293.140625 183.144531 291.628906 182.75 290.296875 C 181.433594 285.863281 180.027344 281.445313 178.417969 277.109375 C 177.421875 274.425781 175.296875 272.492188 172.996094 270.851563 C 171.503906 269.78125 169.882813 268.898438 168.34375 267.894531 C 167.550781 267.375 166.710938 266.863281 166.082031 266.179688 C 164.160156 264.085938 164.253906 262.160156 166.152344 260.03125 C 166.914063 259.175781 167.660156 258.253906 168.191406 257.242188 C 169.503906 254.75 168.828125 252.628906 166.1875 251.574219 C 164.3125 250.828125 162.277344 250.390625 160.273438 250.089844 C 155.894531 249.433594 151.964844 247.890625 148.859375 244.667969 C 147.835938 243.601563 146.992188 242.324219 146.234375 241.046875 C 145.417969 239.660156 145.804688 238.265625 147.15625 237.328125 C 148.867188 236.140625 150.722656 235.925781 152.546875 236.996094 C 157.476563 239.898438 162.835938 241.273438 168.496094 241.574219 C 169.546875 241.628906 170.605469 241.496094 172.03125 241.433594 "/>
<path style=" stroke:none;fill-rule:nonzero;fill:rgb(60.398865%,10.598755%,11.799622%);fill-opacity:1;" d="M 12.75 258.398438 C 34.238281 258.398438 55.605469 258.398438 76.972656 258.398438 C 77.019531 258.496094 77.0625 258.589844 77.109375 258.6875 C 76.363281 259.082031 75.628906 259.503906 74.863281 259.871094 C 71.144531 261.648438 67.679688 263.773438 65.003906 266.992188 C 62.476563 270.03125 58.757813 281.015625 58.914063 284.972656 C 58.933594 285.378906 58.933594 285.800781 59.046875 286.1875 C 59.351563 287.253906 59.738281 288.289063 60.941406 288.664063 C 62.191406 289.050781 62.996094 288.320313 63.78125 287.511719 C 69.570313 281.523438 76.71875 277.800781 84.578125 275.441406 C 86.878906 274.75 89.441406 274.96875 91.863281 274.640625 C 93.882813 274.367188 95.902344 274.007813 97.871094 273.5 C 100.289063 272.878906 102.339844 271.5625 104.097656 269.753906 C 105.183594 268.632813 106.375 267.59375 107.609375 266.632813 C 108.386719 266.027344 109.265625 265.410156 110.640625 265.789063 C 110.722656 266.390625 110.882813 267.03125 110.878906 267.667969 C 110.859375 280.21875 110.882813 292.765625 110.75 305.3125 C 110.707031 309.253906 110.398438 313.207031 109.335938 317.054688 C 108.589844 319.746094 107.410156 322.117188 105.199219 323.9375 C 103.621094 325.238281 102.167969 326.683594 100.652344 328.054688 C 97.441406 330.957031 94.738281 334.253906 92.527344 337.984375 C 90.582031 341.277344 88.347656 344.371094 85.453125 346.933594 C 81.402344 350.507813 76.671875 352.347656 71.28125 352.417969 C 67.121094 352.472656 62.960938 352.398438 58.796875 352.449219 C 57.757813 352.464844 57.03125 352.128906 56.285156 351.40625 C 47.375 342.777344 38.429688 334.175781 29.488281 325.574219 C 24.476563 320.757813 19.472656 315.925781 14.410156 311.164063 C 13.140625 309.972656 12.515625 308.765625 12.527344 306.933594 C 12.636719 291.386719 12.632813 275.835938 12.667969 260.285156 C 12.667969 259.6875 12.71875 259.09375 12.75 258.398438 "/>
</g>
</svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Torch Choice
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              API Reference Torch-Choice
            
          </span>
        </div>
      </div>
    </div>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="Torch Choice" class="md-nav__button md-logo" aria-label="Torch Choice" data-md-component="logo">
      
  
  <?xml version="1.0" encoding="UTF-8"?>
<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="241.9pt" height="365pt" viewBox="0 0 241.9 365" version="1.1">
<defs>
<clipPath id="clip1">
  <path d="M 0 0 L 241.898438 0 L 241.898438 365 L 0 365 Z M 0 0 "/>
</clipPath>
</defs>
<g id="surface1">
<g clip-path="url(#clip1)" clip-rule="nonzero">
<path style=" stroke:none;fill-rule:nonzero;fill:rgb(60.398865%,10.598755%,11.799622%);fill-opacity:1;" d="M 235.886719 119.484375 C 235.886719 118.5625 235.886719 117.898438 235.886719 117.230469 C 235.886719 96.425781 235.875 75.621094 235.917969 54.820313 C 235.921875 53.394531 235.460938 52.414063 234.449219 51.449219 C 219.242188 36.867188 204.058594 22.257813 188.898438 7.625 C 187.800781 6.566406 186.710938 6.074219 185.140625 6.078125 C 142.371094 6.121094 99.605469 6.117188 56.835938 6.078125 C 55.355469 6.078125 54.261719 6.46875 53.21875 7.492188 C 49.527344 11.125 45.773438 14.699219 42.039063 18.289063 C 33.683594 26.320313 25.324219 34.347656 16.96875 42.382813 C 13.335938 45.871094 9.71875 49.378906 6.113281 52.855469 C 6.113281 53.300781 6.113281 53.640625 6.113281 53.980469 C 6.113281 96.339844 6.117188 138.695313 6.085938 181.054688 C 6.085938 182.261719 6.496094 183.066406 7.324219 183.894531 C 20.417969 196.941406 33.492188 210.011719 46.535156 223.109375 C 47.472656 224.050781 48.410156 224.464844 49.75 224.457031 C 57.320313 224.398438 64.890625 224.425781 72.464844 224.433594 C 73.042969 224.433594 73.621094 224.488281 74.644531 224.539063 C 71.742188 227.257813 70.460938 230.371094 69.59375 234.179688 C 71.082031 234.234375 72.199219 234.359375 73.308594 234.300781 C 78.976563 233.992188 84.304688 232.523438 89.242188 229.652344 C 90.832031 228.726563 92.546875 228.898438 94.125 229.796875 C 95.808594 230.753906 96.222656 232.242188 95.316406 233.96875 C 94.910156 234.746094 94.429688 235.511719 93.875 236.195313 C 90.800781 239.984375 86.703125 241.890625 81.96875 242.726563 C 79.636719 243.136719 77.316406 243.722656 75.074219 244.484375 C 73.582031 244.992188 72.875 246.195313 73.230469 247.292969 C 73.503906 248.140625 74.152344 248.90625 74.765625 249.589844 C 75.394531 250.289063 76.183594 250.84375 76.902344 251.460938 C 76.828125 251.609375 76.753906 251.761719 76.679688 251.910156 C 53.242188 251.910156 29.804688 251.910156 6.164063 251.910156 C 6.164063 252.78125 6.164063 253.449219 6.164063 254.117188 C 6.144531 272.804688 6.144531 291.496094 6.082031 310.183594 C 6.074219 311.609375 6.515625 312.585938 7.527344 313.554688 C 16.839844 322.457031 26.117188 331.402344 35.398438 340.34375 C 41.289063 346.019531 47.175781 351.699219 53.039063 357.40625 C 54.113281 358.449219 55.214844 358.96875 56.800781 358.96875 C 99.640625 358.917969 142.476563 358.921875 185.3125 358.960938 C 186.71875 358.960938 187.746094 358.570313 188.742188 357.605469 C 195.199219 351.339844 201.703125 345.117188 208.1875 338.878906 C 216.886719 330.511719 225.566406 322.132813 234.292969 313.792969 C 235.394531 312.738281 235.929688 311.679688 235.925781 310.082031 C 235.878906 270.109375 235.878906 230.140625 235.917969 190.167969 C 235.921875 188.683594 235.5 187.640625 234.445313 186.59375 C 221.4375 173.652344 208.464844 160.679688 195.523438 147.671875 C 194.46875 146.609375 193.417969 146.195313 191.9375 146.203125 C 181.980469 146.261719 172.019531 146.242188 162.0625 146.21875 C 161.265625 146.214844 160.328125 146.230469 159.699219 145.84375 C 155.351563 143.167969 150.949219 140.546875 146.800781 137.585938 C 143.5625 135.273438 141.082031 132.121094 139.085938 128.667969 C 138.125 127.007813 137.503906 125.199219 138.632813 123.179688 C 139.15625 123.265625 139.660156 123.234375 140.050781 123.429688 C 146.277344 126.621094 153.035156 127.347656 159.871094 127.726563 C 162.050781 127.847656 164.191406 128.058594 166.242188 128.980469 C 168.035156 129.785156 169.601563 128.535156 169.25 126.59375 C 169.085938 125.695313 168.609375 124.796875 168.085938 124.027344 C 167.070313 122.539063 165.925781 121.144531 164.660156 119.484375 C 188.476563 119.484375 211.996094 119.484375 235.886719 119.484375 Z M 0 315.160156 C 0 291.964844 0 268.773438 0 245.578125 C 0.609375 245.621094 1.21875 245.703125 1.828125 245.707031 C 23.648438 245.710938 45.472656 245.710938 67.296875 245.707031 C 67.894531 245.707031 68.496094 245.648438 69.097656 245.617188 C 69.898438 243.046875 71.621094 241.488281 73.90625 240.480469 C 74.777344 240.097656 75.699219 239.824219 76.550781 239.402344 C 76.941406 239.207031 77.21875 238.773438 77.542969 238.449219 C 77.46875 238.320313 77.394531 238.191406 77.320313 238.058594 C 76.046875 238.160156 74.773438 238.320313 73.5 238.347656 C 72.214844 238.371094 70.894531 238.429688 69.648438 238.179688 C 66.917969 237.628906 65.417969 235.339844 65.773438 232.585938 C 65.847656 231.992188 65.910156 231.398438 66.003906 230.550781 C 65.113281 230.550781 64.382813 230.550781 63.648438 230.550781 C 58.261719 230.550781 52.875 230.503906 47.488281 230.578125 C 46.007813 230.601563 44.960938 230.179688 43.90625 229.117188 C 29.859375 215.003906 15.769531 200.929688 1.679688 186.855469 C 1.160156 186.335938 0.5625 185.890625 0 185.410156 C 0 140.253906 0 95.09375 0 49.933594 C 0.332031 49.714844 0.710938 49.539063 0.992188 49.265625 C 4.589844 45.828125 8.171875 42.375 11.757813 38.929688 C 22.8125 28.300781 33.875 17.683594 44.917969 7.042969 C 47.3125 4.738281 49.628906 2.351563 51.980469 0 C 97.957031 0 143.9375 0 189.914063 0 C 190.371094 0.496094 190.804688 1.023438 191.292969 1.492188 C 195.417969 5.460938 199.558594 9.414063 203.6875 13.382813 C 211.546875 20.941406 219.402344 28.507813 227.257813 36.074219 C 232.113281 40.753906 236.964844 45.441406 241.703125 50.015625 C 241.703125 75.300781 241.703125 100.425781 241.703125 125.695313 C 218.851563 125.695313 196.160156 125.695313 173.40625 125.695313 C 173.40625 126.246094 173.421875 126.648438 173.402344 127.050781 C 173.167969 131.855469 169.175781 134.410156 164.660156 132.78125 C 163.15625 132.238281 161.507813 132.0625 159.910156 131.832031 C 158.632813 131.648438 157.320313 131.703125 156.039063 131.535156 C 152.410156 131.058594 148.785156 130.523438 145.085938 130.003906 C 145.410156 130.421875 145.71875 130.84375 146.050781 131.246094 C 148.84375 134.617188 152.519531 136.839844 156.195313 139.074219 C 157.402344 139.808594 158.613281 140.144531 160.042969 140.136719 C 171.5 140.09375 182.957031 140.140625 194.414063 140.078125 C 195.976563 140.070313 197.0625 140.550781 198.15625 141.648438 C 212.15625 155.714844 226.191406 169.75 240.261719 183.746094 C 241.410156 184.890625 241.902344 186.011719 241.902344 187.652344 C 241.855469 229.324219 241.867188 270.992188 241.867188 312.664063 C 241.867188 313.410156 241.867188 314.15625 241.867188 314.941406 C 224.503906 331.652344 207.171875 348.335938 189.855469 365 C 143.90625 365 98.019531 365 52.15625 365 C 49.609375 362.539063 47.113281 360.121094 44.609375 357.707031 C 30.621094 344.226563 16.636719 330.742188 2.636719 317.273438 C 1.828125 316.496094 0.882813 315.859375 0 315.160156 "/>
</g>
<path style=" stroke:none;fill-rule:nonzero;fill:rgb(100%,100%,100%);fill-opacity:1;" d="M 12.75 258.398438 C 12.71875 259.09375 12.667969 259.6875 12.667969 260.285156 C 12.632813 275.835938 12.636719 291.386719 12.527344 306.933594 C 12.515625 308.765625 13.140625 309.972656 14.410156 311.164063 C 19.472656 315.925781 24.476563 320.757813 29.488281 325.574219 C 38.429688 334.175781 47.375 342.777344 56.285156 351.40625 C 57.03125 352.128906 57.757813 352.464844 58.796875 352.449219 C 62.960938 352.398438 67.121094 352.472656 71.28125 352.417969 C 76.671875 352.347656 81.402344 350.507813 85.453125 346.933594 C 88.347656 344.371094 90.582031 341.277344 92.527344 337.984375 C 94.738281 334.253906 97.441406 330.957031 100.652344 328.054688 C 102.167969 326.683594 103.621094 325.238281 105.199219 323.9375 C 107.410156 322.117188 108.589844 319.746094 109.335938 317.054688 C 110.398438 313.207031 110.707031 309.253906 110.75 305.3125 C 110.882813 292.765625 110.859375 280.21875 110.878906 267.667969 C 110.882813 267.03125 110.722656 266.390625 110.640625 265.789063 C 109.265625 265.410156 108.386719 266.027344 107.609375 266.632813 C 106.375 267.59375 105.183594 268.632813 104.097656 269.753906 C 102.339844 271.5625 100.289063 272.878906 97.871094 273.5 C 95.902344 274.007813 93.882813 274.367188 91.863281 274.640625 C 89.441406 274.96875 86.878906 274.75 84.578125 275.441406 C 76.71875 277.800781 69.570313 281.523438 63.78125 287.511719 C 62.996094 288.320313 62.191406 289.050781 60.941406 288.664063 C 59.738281 288.289063 59.351563 287.253906 59.046875 286.1875 C 58.933594 285.800781 58.933594 285.378906 58.914063 284.972656 C 58.757813 281.015625 62.476563 270.03125 65.003906 266.992188 C 67.679688 263.773438 71.144531 261.648438 74.863281 259.871094 C 75.628906 259.503906 76.363281 259.082031 77.109375 258.6875 C 77.0625 258.589844 77.019531 258.496094 76.972656 258.398438 C 55.605469 258.398438 34.238281 258.398438 12.75 258.398438 Z M 172.03125 241.433594 C 170.605469 241.496094 169.546875 241.628906 168.496094 241.574219 C 162.835938 241.273438 157.476563 239.898438 152.546875 236.996094 C 150.722656 235.925781 148.867188 236.140625 147.15625 237.328125 C 145.804688 238.265625 145.417969 239.660156 146.234375 241.046875 C 146.992188 242.324219 147.835938 243.601563 148.859375 244.667969 C 151.964844 247.890625 155.894531 249.433594 160.273438 250.089844 C 162.277344 250.390625 164.3125 250.828125 166.1875 251.574219 C 168.828125 252.628906 169.503906 254.75 168.191406 257.242188 C 167.660156 258.253906 166.914063 259.175781 166.152344 260.03125 C 164.253906 262.160156 164.160156 264.085938 166.082031 266.179688 C 166.710938 266.863281 167.550781 267.375 168.34375 267.894531 C 169.882813 268.898438 171.503906 269.78125 172.996094 270.851563 C 175.296875 272.492188 177.421875 274.425781 178.417969 277.109375 C 180.027344 281.445313 181.433594 285.863281 182.75 290.296875 C 183.144531 291.628906 183.097656 293.140625 183.003906 294.554688 C 182.902344 296.148438 181.867188 296.878906 180.316406 296.464844 C 179.082031 296.132813 177.855469 295.625 176.761719 294.96875 C 174.191406 293.425781 171.757813 291.652344 169.171875 290.144531 C 165.941406 288.257813 162.6875 286.386719 159.304688 284.800781 C 156.441406 283.457031 153.332031 283.042969 150.121094 283.484375 C 148.371094 283.726563 146.585938 283.675781 144.816406 283.777344 C 141.253906 283.980469 138.101563 282.945313 135.308594 280.730469 C 134.363281 279.984375 133.34375 278.957031 132.054688 279.496094 C 130.582031 280.113281 130.871094 281.648438 130.867188 282.914063 C 130.851563 291.234375 130.847656 299.554688 130.867188 307.878906 C 130.871094 310.875 130.78125 313.886719 131.015625 316.871094 C 131.722656 325.789063 135.359375 332.960938 143.585938 337.296875 C 147.066406 339.128906 149.996094 341.652344 152.550781 344.640625 C 153.296875 345.511719 154.160156 346.339844 155.121094 346.949219 C 160.089844 350.117188 165.496094 352.117188 171.414063 352.402344 C 175.359375 352.589844 179.320313 352.457031 183.273438 352.539063 C 184.339844 352.5625 185.039063 352.128906 185.765625 351.425781 C 190.457031 346.863281 195.179688 342.335938 199.898438 337.800781 C 209.332031 328.726563 218.761719 319.648438 228.222656 310.605469 C 229.132813 309.738281 229.511719 308.851563 229.507813 307.574219 C 229.476563 269.246094 229.476563 230.914063 229.507813 192.582031 C 229.511719 191.308594 229.113281 190.433594 228.222656 189.554688 C 216.273438 177.679688 204.347656 165.78125 192.449219 153.859375 C 191.609375 153.015625 190.777344 152.664063 189.59375 152.671875 C 182.636719 152.722656 175.679688 152.695313 168.722656 152.699219 C 168.191406 152.699219 167.660156 152.746094 166.984375 152.78125 C 167.207031 153.324219 167.355469 153.765625 167.554688 154.179688 C 169.433594 158.035156 170.238281 162.179688 170.753906 166.382813 C 171.03125 168.664063 169.851563 169.792969 167.597656 169.328125 C 166.15625 169.03125 164.785156 168.363281 163.40625 167.800781 C 162.335938 167.367188 161.332031 166.765625 160.25 166.371094 C 155.332031 164.566406 150.398438 162.808594 145.46875 161.035156 C 144.636719 160.734375 143.820313 160.363281 142.964844 160.15625 C 141.582031 159.824219 140.425781 160.347656 139.445313 161.320313 C 138.472656 162.28125 138.863281 163.34375 139.273438 164.359375 C 140.578125 167.625 142.609375 170.296875 145.757813 171.988281 C 147.253906 172.789063 148.78125 173.550781 150.335938 174.242188 C 154.101563 175.910156 157.644531 177.925781 160.648438 180.769531 C 161.382813 181.464844 162.089844 182.25 162.578125 183.125 C 163.484375 184.753906 162.628906 185.945313 160.753906 185.828125 C 160.484375 185.8125 160.191406 185.789063 159.953125 185.679688 C 157.648438 184.601563 155.296875 184.886719 152.945313 185.445313 C 149.5625 186.253906 146.328125 185.863281 143.175781 184.421875 C 141.878906 183.828125 140.53125 183.328125 139.175781 182.890625 C 138.585938 182.699219 137.910156 182.761719 137.308594 182.714844 C 136.777344 183.953125 137.230469 184.816406 137.675781 185.652344 C 138.851563 187.851563 140.457031 189.664063 142.5 191.121094 C 147.054688 194.367188 151.722656 197.421875 156.734375 199.941406 C 164.527344 203.855469 168.496094 210.597656 170.34375 218.820313 C 170.503906 219.53125 170.3125 220.320313 170.265625 221.527344 C 168.789063 220.925781 167.566406 220.71875 166.746094 220.035156 C 164.597656 218.246094 162.183594 217.707031 159.503906 217.875 C 155.089844 218.152344 151.332031 216.757813 148.269531 213.511719 C 147.871094 213.089844 147.207031 212.910156 146.679688 212.625 C 144.632813 216.027344 145.734375 220.753906 148.84375 222.5625 C 149.777344 223.105469 150.824219 223.457031 151.816406 223.90625 C 155.414063 225.53125 159.050781 227.085938 162.59375 228.832031 C 164.160156 229.609375 165.648438 230.652344 166.972656 231.804688 C 169.734375 234.207031 171.183594 237.375 172.03125 241.433594 Z M 95.757813 205.304688 C 93.78125 205.304688 92.03125 205.417969 90.300781 205.269531 C 88.816406 205.140625 87.359375 204.703125 85.886719 204.417969 C 82.757813 203.808594 79.675781 203.613281 76.707031 205.183594 C 76.097656 205.503906 75.308594 205.476563 74.683594 205.59375 C 73.894531 204.425781 74.425781 203.554688 74.8125 202.707031 C 77.011719 197.871094 80.933594 194.742188 85.480469 192.378906 C 90.523438 189.761719 95.242188 186.667969 99.816406 183.328125 C 101.625 182.007813 103.039063 180.332031 103.933594 178.332031 C 104.5 177.070313 104.796875 175.597656 104.839844 174.207031 C 104.902344 172.167969 103.5 171.414063 101.707031 172.335938 C 101.40625 172.488281 101.109375 172.667969 100.835938 172.867188 C 94.964844 177.140625 88.488281 177.3125 81.738281 175.683594 C 81.507813 174.40625 81.484375 174.195313 82.246094 173.335938 C 83.832031 171.546875 85.433594 169.769531 87.660156 168.730469 C 89.453125 167.894531 91.273438 167.113281 93.011719 166.183594 C 94.804688 165.222656 96.640625 164.261719 98.238281 163.023438 C 100.507813 161.269531 101.964844 158.886719 102.511719 156.019531 C 102.679688 155.144531 102.847656 154.238281 101.539063 153.535156 C 100.746094 153.921875 99.679688 154.242188 98.863281 154.878906 C 95.441406 157.53125 91.484375 158.292969 87.316406 158.269531 C 82.019531 158.234375 77.566406 159.871094 74.308594 164.265625 C 73.644531 165.164063 72.835938 166.082031 71.472656 166.101563 C 70.191406 165.113281 70.3125 163.683594 70.476563 162.367188 C 70.835938 159.460938 71.285156 156.5625 71.820313 153.683594 C 73.140625 146.550781 76.871094 141.175781 83.363281 137.710938 C 86.488281 136.046875 89.445313 134.066406 92.433594 132.164063 C 95.582031 130.164063 98.128906 127.492188 100.335938 124.53125 C 101.257813 123.292969 102.03125 121.863281 102.511719 120.402344 C 103.140625 118.5 103.152344 116.527344 101.441406 114.648438 C 100.640625 115.214844 99.890625 115.742188 99.148438 116.277344 C 97.996094 117.117188 96.964844 118.3125 95.679688 118.738281 C 91.734375 120.050781 87.699219 121.105469 83.449219 120.410156 C 80.894531 119.996094 78.421875 120.257813 76.085938 121.441406 C 75.839844 121.566406 75.589844 121.679688 75.335938 121.769531 C 73.550781 122.382813 72.113281 121.296875 72.382813 119.410156 C 72.503906 118.570313 72.875 117.683594 73.378906 117 C 74.140625 115.964844 75.050781 115.019531 76.007813 114.15625 C 80.847656 109.800781 86.300781 106.296875 91.925781 103.078125 C 96.242188 100.609375 100.738281 98.464844 105.046875 95.988281 C 106.480469 95.164063 107.773438 93.914063 108.796875 92.601563 C 110.34375 90.613281 109.386719 88.445313 106.878906 88.140625 C 105.78125 88.007813 104.605469 88.339844 103.492188 88.585938 C 102.171875 88.878906 100.894531 89.53125 99.570313 89.621094 C 97.261719 89.777344 94.933594 89.671875 92.621094 89.570313 C 91.863281 89.535156 91.121094 89.167969 89.996094 88.84375 C 90.585938 87.824219 90.898438 87.003906 91.445313 86.394531 C 93 84.644531 94.863281 83.277344 97.023438 82.328125 C 99.207031 81.371094 101.394531 80.421875 103.554688 79.417969 C 105.476563 78.53125 106.699219 77.035156 107.039063 74.925781 C 107.40625 72.660156 106.378906 71.558594 104.121094 71.730469 C 103.105469 71.808594 102.085938 71.996094 101.070313 71.984375 C 100.15625 71.972656 99.25 71.757813 98.054688 71.589844 C 98.320313 70.585938 98.359375 69.8125 98.71875 69.238281 C 99.292969 68.324219 100.011719 67.476563 100.789063 66.722656 C 103.664063 63.929688 106.925781 61.761719 110.84375 60.671875 C 112.089844 60.324219 113.316406 59.867188 113.65625 58.261719 C 112.875 57.246094 111.746094 57.019531 110.59375 56.898438 C 109.171875 56.746094 107.726563 56.738281 106.328125 56.472656 C 105.667969 56.347656 104.746094 55.882813 104.582031 55.367188 C 104.425781 54.878906 104.945313 53.9375 105.441406 53.519531 C 106.839844 52.335938 108.417969 51.363281 109.855469 50.21875 C 111.71875 48.738281 113.601563 47.265625 115.308594 45.617188 C 116.519531 44.445313 116.363281 43.636719 115.085938 42.519531 C 114.160156 41.714844 113.144531 41.011719 112.222656 40.203125 C 111.570313 39.636719 110.820313 39.0625 111.085938 37.746094 C 111.613281 37.605469 112.230469 37.300781 112.855469 37.296875 C 114.582031 37.285156 115.714844 36.394531 116.371094 34.933594 C 116.980469 33.574219 117.488281 32.152344 117.882813 30.714844 C 118.5 28.480469 118.964844 26.210938 119.535156 23.964844 C 119.722656 23.21875 119.757813 22.285156 121.035156 22.195313 C 121.210938 22.925781 121.382813 23.644531 121.550781 24.363281 C 122.089844 26.6875 122.535156 29.03125 123.183594 31.324219 C 123.8125 33.53125 124.90625 35.339844 127.660156 35.3125 C 128.226563 35.308594 128.804688 35.777344 129.363281 36.023438 C 128.964844 37.851563 127.558594 38.503906 126.589844 39.507813 C 124.914063 41.25 125.261719 43.148438 127.515625 43.992188 C 128.460938 44.34375 129.503906 44.433594 130.507813 44.597656 C 132.433594 44.914063 132.867188 45.851563 131.613281 47.363281 C 130.839844 48.296875 129.851563 49.058594 128.910156 49.839844 C 127.152344 51.296875 126.9375 52.183594 128.390625 53.9375 C 129.425781 55.1875 130.6875 56.257813 131.933594 57.304688 C 133.132813 58.3125 134.511719 59.101563 135.683594 60.136719 C 138.261719 62.417969 138.078125 63.71875 135.089844 65.28125 C 134.789063 65.441406 134.488281 65.605469 134.210938 65.800781 C 133.445313 66.339844 132.515625 66.753906 132.546875 68.1875 C 133.074219 68.484375 133.699219 68.84375 134.324219 69.195313 C 137.695313 71.070313 140.769531 73.320313 142.949219 76.5625 C 144.042969 78.183594 143.53125 79.15625 141.574219 79.246094 C 140.222656 79.304688 138.847656 79.179688 137.5 78.996094 C 135.007813 78.660156 134.472656 80.128906 134.652344 81.835938 C 134.742188 82.6875 135.035156 83.558594 135.425781 84.328125 C 136.105469 85.660156 137.335938 86.410156 138.675781 87.003906 C 141.601563 88.300781 144.597656 89.472656 147.410156 90.988281 C 149.234375 91.96875 150.976563 93.277344 152.414063 94.769531 C 153.910156 96.328125 153.269531 98.144531 151.160156 98.628906 C 149.800781 98.9375 148.332031 98.890625 146.921875 98.816406 C 144.820313 98.703125 142.730469 98.265625 140.632813 98.261719 C 138.828125 98.257813 137.011719 98.625 135.554688 99.796875 C 135.585938 101.222656 136.3125 102.042969 137.285156 102.570313 C 138.714844 103.347656 140.167969 104.175781 141.714844 104.636719 C 146.890625 106.179688 151.464844 108.835938 155.75 112.027344 C 156.804688 112.8125 157.855469 113.105469 159.140625 113.097656 C 166.027344 113.058594 172.917969 113.089844 179.808594 113.078125 C 195.632813 113.054688 211.457031 113.019531 227.28125 112.988281 C 227.945313 112.984375 228.605469 112.929688 229.480469 112.890625 C 229.480469 111.953125 229.480469 111.152344 229.480469 110.351563 C 229.480469 92.960938 229.453125 75.5625 229.527344 58.171875 C 229.535156 56.347656 228.933594 55.144531 227.667969 53.9375 C 220.550781 47.175781 213.5 40.34375 206.421875 33.539063 C 199.640625 27.019531 192.820313 20.535156 186.09375 13.960938 C 185.007813 12.898438 183.9375 12.550781 182.484375 12.550781 C 141.488281 12.578125 100.492188 12.574219 59.496094 12.574219 C 59.222656 12.574219 58.949219 12.597656 58.675781 12.570313 C 57.714844 12.464844 57.035156 12.875 56.34375 13.539063 C 42.207031 27.167969 28.054688 40.78125 13.867188 54.355469 C 12.949219 55.238281 12.546875 56.085938 12.550781 57.355469 C 12.578125 97.605469 12.578125 137.851563 12.546875 178.097656 C 12.546875 179.367188 12.941406 180.246094 13.828125 181.132813 C 25.699219 192.992188 37.550781 204.871094 49.359375 216.792969 C 50.367188 217.804688 51.371094 218.164063 52.769531 218.15625 C 62.25 218.101563 71.734375 218.015625 81.210938 218.183594 C 84.789063 218.246094 88 217.4375 91.269531 216.117188 C 96 214.210938 96.300781 210.089844 95.9375 205.519531 C 95.925781 205.363281 95.683594 205.222656 95.757813 205.304688 Z M 235.886719 119.484375 C 211.996094 119.484375 188.476563 119.484375 164.660156 119.484375 C 165.925781 121.144531 167.070313 122.539063 168.085938 124.027344 C 168.609375 124.796875 169.085938 125.695313 169.25 126.59375 C 169.601563 128.535156 168.035156 129.785156 166.242188 128.980469 C 164.191406 128.058594 162.050781 127.847656 159.871094 127.726563 C 153.035156 127.347656 146.277344 126.621094 140.050781 123.429688 C 139.660156 123.234375 139.15625 123.265625 138.632813 123.179688 C 137.503906 125.199219 138.125 127.007813 139.085938 128.667969 C 141.082031 132.121094 143.5625 135.273438 146.800781 137.585938 C 150.949219 140.546875 155.351563 143.167969 159.699219 145.84375 C 160.328125 146.230469 161.265625 146.214844 162.0625 146.21875 C 172.019531 146.242188 181.980469 146.261719 191.9375 146.203125 C 193.417969 146.195313 194.46875 146.609375 195.523438 147.671875 C 208.464844 160.679688 221.4375 173.652344 234.445313 186.59375 C 235.5 187.640625 235.921875 188.683594 235.917969 190.167969 C 235.878906 230.140625 235.878906 270.109375 235.925781 310.082031 C 235.929688 311.679688 235.394531 312.738281 234.292969 313.792969 C 225.566406 322.132813 216.886719 330.511719 208.1875 338.878906 C 201.703125 345.117188 195.199219 351.339844 188.742188 357.605469 C 187.746094 358.570313 186.71875 358.960938 185.3125 358.960938 C 142.476563 358.921875 99.640625 358.917969 56.800781 358.96875 C 55.214844 358.96875 54.113281 358.449219 53.039063 357.40625 C 47.175781 351.699219 41.289063 346.019531 35.398438 340.34375 C 26.117188 331.402344 16.839844 322.457031 7.527344 313.554688 C 6.515625 312.585938 6.074219 311.609375 6.082031 310.183594 C 6.144531 291.496094 6.144531 272.804688 6.164063 254.117188 C 6.164063 253.449219 6.164063 252.78125 6.164063 251.910156 C 29.804688 251.910156 53.242188 251.910156 76.679688 251.910156 C 76.753906 251.761719 76.828125 251.609375 76.902344 251.460938 C 76.183594 250.84375 75.394531 250.289063 74.765625 249.589844 C 74.152344 248.90625 73.503906 248.140625 73.230469 247.292969 C 72.875 246.195313 73.582031 244.992188 75.074219 244.484375 C 77.316406 243.722656 79.636719 243.136719 81.96875 242.726563 C 86.703125 241.890625 90.800781 239.984375 93.875 236.195313 C 94.429688 235.511719 94.910156 234.746094 95.316406 233.96875 C 96.222656 232.242188 95.808594 230.753906 94.125 229.796875 C 92.546875 228.898438 90.832031 228.726563 89.242188 229.652344 C 84.304688 232.523438 78.976563 233.992188 73.308594 234.300781 C 72.199219 234.359375 71.082031 234.234375 69.59375 234.179688 C 70.460938 230.371094 71.742188 227.257813 74.644531 224.539063 C 73.621094 224.488281 73.042969 224.433594 72.464844 224.433594 C 64.890625 224.425781 57.320313 224.398438 49.75 224.457031 C 48.410156 224.464844 47.472656 224.050781 46.535156 223.109375 C 33.492188 210.011719 20.417969 196.941406 7.324219 183.894531 C 6.496094 183.066406 6.085938 182.261719 6.085938 181.054688 C 6.117188 138.695313 6.113281 96.339844 6.113281 53.980469 C 6.113281 53.640625 6.113281 53.300781 6.113281 52.855469 C 9.71875 49.378906 13.335938 45.871094 16.96875 42.382813 C 25.324219 34.347656 33.683594 26.320313 42.039063 18.289063 C 45.773438 14.699219 49.527344 11.125 53.21875 7.492188 C 54.261719 6.46875 55.355469 6.078125 56.835938 6.078125 C 99.605469 6.117188 142.371094 6.121094 185.140625 6.078125 C 186.710938 6.074219 187.800781 6.566406 188.898438 7.625 C 204.058594 22.257813 219.242188 36.867188 234.449219 51.449219 C 235.460938 52.414063 235.921875 53.394531 235.917969 54.820313 C 235.875 75.621094 235.886719 96.425781 235.886719 117.230469 C 235.886719 117.898438 235.886719 118.5625 235.886719 119.484375 "/>
<path style=" stroke:none;fill-rule:nonzero;fill:rgb(60.398865%,10.598755%,11.799622%);fill-opacity:1;" d="M 95.757813 205.304688 C 95.683594 205.222656 95.925781 205.363281 95.9375 205.519531 C 96.300781 210.089844 96 214.210938 91.269531 216.117188 C 88 217.4375 84.789063 218.246094 81.210938 218.183594 C 71.734375 218.015625 62.25 218.101563 52.769531 218.15625 C 51.371094 218.164063 50.367188 217.804688 49.359375 216.792969 C 37.550781 204.871094 25.699219 192.992188 13.828125 181.132813 C 12.941406 180.246094 12.546875 179.367188 12.546875 178.097656 C 12.578125 137.851563 12.578125 97.605469 12.550781 57.355469 C 12.546875 56.085938 12.949219 55.238281 13.867188 54.355469 C 28.054688 40.78125 42.207031 27.167969 56.34375 13.539063 C 57.035156 12.875 57.714844 12.464844 58.675781 12.570313 C 58.949219 12.597656 59.222656 12.574219 59.496094 12.574219 C 100.492188 12.574219 141.488281 12.578125 182.484375 12.550781 C 183.9375 12.550781 185.007813 12.898438 186.09375 13.960938 C 192.820313 20.535156 199.640625 27.019531 206.421875 33.539063 C 213.5 40.34375 220.550781 47.175781 227.667969 53.9375 C 228.933594 55.144531 229.535156 56.347656 229.527344 58.171875 C 229.453125 75.5625 229.480469 92.960938 229.480469 110.351563 C 229.480469 111.152344 229.480469 111.953125 229.480469 112.890625 C 228.605469 112.929688 227.945313 112.984375 227.28125 112.988281 C 211.457031 113.019531 195.632813 113.054688 179.808594 113.078125 C 172.917969 113.089844 166.027344 113.058594 159.140625 113.097656 C 157.855469 113.105469 156.804688 112.8125 155.75 112.027344 C 151.464844 108.835938 146.890625 106.179688 141.714844 104.636719 C 140.167969 104.175781 138.714844 103.347656 137.285156 102.570313 C 136.3125 102.042969 135.585938 101.222656 135.554688 99.796875 C 137.011719 98.625 138.828125 98.257813 140.632813 98.261719 C 142.730469 98.265625 144.820313 98.703125 146.921875 98.816406 C 148.332031 98.890625 149.800781 98.9375 151.160156 98.628906 C 153.269531 98.144531 153.910156 96.328125 152.414063 94.769531 C 150.976563 93.277344 149.234375 91.96875 147.410156 90.988281 C 144.597656 89.472656 141.601563 88.300781 138.675781 87.003906 C 137.335938 86.410156 136.105469 85.660156 135.425781 84.328125 C 135.035156 83.558594 134.742188 82.6875 134.652344 81.835938 C 134.472656 80.128906 135.007813 78.660156 137.5 78.996094 C 138.847656 79.179688 140.222656 79.304688 141.574219 79.246094 C 143.53125 79.15625 144.042969 78.183594 142.949219 76.5625 C 140.769531 73.320313 137.695313 71.070313 134.324219 69.195313 C 133.699219 68.84375 133.074219 68.484375 132.546875 68.1875 C 132.515625 66.753906 133.445313 66.339844 134.210938 65.800781 C 134.488281 65.605469 134.789063 65.441406 135.089844 65.28125 C 138.078125 63.71875 138.261719 62.417969 135.683594 60.136719 C 134.511719 59.101563 133.132813 58.3125 131.933594 57.304688 C 130.6875 56.257813 129.425781 55.1875 128.390625 53.9375 C 126.9375 52.183594 127.152344 51.296875 128.910156 49.839844 C 129.851563 49.058594 130.839844 48.296875 131.613281 47.363281 C 132.867188 45.851563 132.433594 44.914063 130.507813 44.597656 C 129.503906 44.433594 128.460938 44.34375 127.515625 43.992188 C 125.261719 43.148438 124.914063 41.25 126.589844 39.507813 C 127.558594 38.503906 128.964844 37.851563 129.363281 36.023438 C 128.804688 35.777344 128.226563 35.308594 127.660156 35.3125 C 124.90625 35.339844 123.8125 33.53125 123.183594 31.324219 C 122.535156 29.03125 122.089844 26.6875 121.550781 24.363281 C 121.382813 23.644531 121.210938 22.925781 121.035156 22.195313 C 119.757813 22.285156 119.722656 23.21875 119.535156 23.964844 C 118.964844 26.210938 118.5 28.480469 117.882813 30.714844 C 117.488281 32.152344 116.980469 33.574219 116.371094 34.933594 C 115.714844 36.394531 114.582031 37.285156 112.855469 37.296875 C 112.230469 37.300781 111.613281 37.605469 111.085938 37.746094 C 110.820313 39.0625 111.570313 39.636719 112.222656 40.203125 C 113.144531 41.011719 114.160156 41.714844 115.085938 42.519531 C 116.363281 43.636719 116.519531 44.445313 115.308594 45.617188 C 113.601563 47.265625 111.71875 48.738281 109.855469 50.21875 C 108.417969 51.363281 106.839844 52.335938 105.441406 53.519531 C 104.945313 53.9375 104.425781 54.878906 104.582031 55.367188 C 104.746094 55.882813 105.667969 56.347656 106.328125 56.472656 C 107.726563 56.738281 109.171875 56.746094 110.59375 56.898438 C 111.746094 57.019531 112.875 57.246094 113.65625 58.261719 C 113.316406 59.867188 112.089844 60.324219 110.84375 60.671875 C 106.925781 61.761719 103.664063 63.929688 100.789063 66.722656 C 100.011719 67.476563 99.292969 68.324219 98.71875 69.238281 C 98.359375 69.8125 98.320313 70.585938 98.054688 71.589844 C 99.25 71.757813 100.15625 71.972656 101.070313 71.984375 C 102.085938 71.996094 103.105469 71.808594 104.121094 71.730469 C 106.378906 71.558594 107.40625 72.660156 107.039063 74.925781 C 106.699219 77.035156 105.476563 78.53125 103.554688 79.417969 C 101.394531 80.421875 99.207031 81.371094 97.023438 82.328125 C 94.863281 83.277344 93 84.644531 91.445313 86.394531 C 90.898438 87.003906 90.585938 87.824219 89.996094 88.84375 C 91.121094 89.167969 91.863281 89.535156 92.621094 89.570313 C 94.933594 89.671875 97.261719 89.777344 99.570313 89.621094 C 100.894531 89.53125 102.171875 88.878906 103.492188 88.585938 C 104.605469 88.339844 105.78125 88.007813 106.878906 88.140625 C 109.386719 88.445313 110.34375 90.613281 108.796875 92.601563 C 107.773438 93.914063 106.480469 95.164063 105.046875 95.988281 C 100.738281 98.464844 96.242188 100.609375 91.925781 103.078125 C 86.300781 106.296875 80.847656 109.800781 76.007813 114.15625 C 75.050781 115.019531 74.140625 115.964844 73.378906 117 C 72.875 117.683594 72.503906 118.570313 72.382813 119.410156 C 72.113281 121.296875 73.550781 122.382813 75.335938 121.769531 C 75.589844 121.679688 75.839844 121.566406 76.085938 121.441406 C 78.421875 120.257813 80.894531 119.996094 83.449219 120.410156 C 87.699219 121.105469 91.734375 120.050781 95.679688 118.738281 C 96.964844 118.3125 97.996094 117.117188 99.148438 116.277344 C 99.890625 115.742188 100.640625 115.214844 101.441406 114.648438 C 103.152344 116.527344 103.140625 118.5 102.511719 120.402344 C 102.03125 121.863281 101.257813 123.292969 100.335938 124.53125 C 98.128906 127.492188 95.582031 130.164063 92.433594 132.164063 C 89.445313 134.066406 86.488281 136.046875 83.363281 137.710938 C 76.871094 141.175781 73.140625 146.550781 71.820313 153.683594 C 71.285156 156.5625 70.835938 159.460938 70.476563 162.367188 C 70.3125 163.683594 70.191406 165.113281 71.472656 166.101563 C 72.835938 166.082031 73.644531 165.164063 74.308594 164.265625 C 77.566406 159.871094 82.019531 158.234375 87.316406 158.269531 C 91.484375 158.292969 95.441406 157.53125 98.863281 154.878906 C 99.679688 154.242188 100.746094 153.921875 101.539063 153.535156 C 102.847656 154.238281 102.679688 155.144531 102.511719 156.019531 C 101.964844 158.886719 100.507813 161.269531 98.238281 163.023438 C 96.640625 164.261719 94.804688 165.222656 93.011719 166.183594 C 91.273438 167.113281 89.453125 167.894531 87.660156 168.730469 C 85.433594 169.769531 83.832031 171.546875 82.246094 173.335938 C 81.484375 174.195313 81.507813 174.40625 81.738281 175.683594 C 88.488281 177.3125 94.964844 177.140625 100.835938 172.867188 C 101.109375 172.667969 101.40625 172.488281 101.707031 172.335938 C 103.5 171.414063 104.902344 172.167969 104.839844 174.207031 C 104.796875 175.597656 104.5 177.070313 103.933594 178.332031 C 103.039063 180.332031 101.625 182.007813 99.816406 183.328125 C 95.242188 186.667969 90.523438 189.761719 85.480469 192.378906 C 80.933594 194.742188 77.011719 197.871094 74.8125 202.707031 C 74.425781 203.554688 73.894531 204.425781 74.683594 205.59375 C 75.308594 205.476563 76.097656 205.503906 76.707031 205.183594 C 79.675781 203.613281 82.757813 203.808594 85.886719 204.417969 C 87.359375 204.703125 88.816406 205.140625 90.300781 205.269531 C 92.03125 205.417969 93.78125 205.304688 95.757813 205.304688 "/>
<path style=" stroke:none;fill-rule:nonzero;fill:rgb(60.398865%,10.598755%,11.799622%);fill-opacity:1;" d="M 172.03125 241.433594 C 171.183594 237.375 169.734375 234.207031 166.972656 231.804688 C 165.648438 230.652344 164.160156 229.609375 162.59375 228.832031 C 159.050781 227.085938 155.414063 225.53125 151.816406 223.90625 C 150.824219 223.457031 149.777344 223.105469 148.84375 222.5625 C 145.734375 220.753906 144.632813 216.027344 146.679688 212.625 C 147.207031 212.910156 147.871094 213.089844 148.269531 213.511719 C 151.332031 216.757813 155.089844 218.152344 159.503906 217.875 C 162.183594 217.707031 164.597656 218.246094 166.746094 220.035156 C 167.566406 220.71875 168.789063 220.925781 170.265625 221.527344 C 170.3125 220.320313 170.503906 219.53125 170.34375 218.820313 C 168.496094 210.597656 164.527344 203.855469 156.734375 199.941406 C 151.722656 197.421875 147.054688 194.367188 142.5 191.121094 C 140.457031 189.664063 138.851563 187.851563 137.675781 185.652344 C 137.230469 184.816406 136.777344 183.953125 137.308594 182.714844 C 137.910156 182.761719 138.585938 182.699219 139.175781 182.890625 C 140.53125 183.328125 141.878906 183.828125 143.175781 184.421875 C 146.328125 185.863281 149.5625 186.253906 152.945313 185.445313 C 155.296875 184.886719 157.648438 184.601563 159.953125 185.679688 C 160.191406 185.789063 160.484375 185.8125 160.753906 185.828125 C 162.628906 185.945313 163.484375 184.753906 162.578125 183.125 C 162.089844 182.25 161.382813 181.464844 160.648438 180.769531 C 157.644531 177.925781 154.101563 175.910156 150.335938 174.242188 C 148.78125 173.550781 147.253906 172.789063 145.757813 171.988281 C 142.609375 170.296875 140.578125 167.625 139.273438 164.359375 C 138.863281 163.34375 138.472656 162.28125 139.445313 161.320313 C 140.425781 160.347656 141.582031 159.824219 142.964844 160.15625 C 143.820313 160.363281 144.636719 160.734375 145.46875 161.035156 C 150.398438 162.808594 155.332031 164.566406 160.25 166.371094 C 161.332031 166.765625 162.335938 167.367188 163.40625 167.800781 C 164.785156 168.363281 166.15625 169.03125 167.597656 169.328125 C 169.851563 169.792969 171.03125 168.664063 170.753906 166.382813 C 170.238281 162.179688 169.433594 158.035156 167.554688 154.179688 C 167.355469 153.765625 167.207031 153.324219 166.984375 152.78125 C 167.660156 152.746094 168.191406 152.699219 168.722656 152.699219 C 175.679688 152.695313 182.636719 152.722656 189.59375 152.671875 C 190.777344 152.664063 191.609375 153.015625 192.449219 153.859375 C 204.347656 165.78125 216.273438 177.679688 228.222656 189.554688 C 229.113281 190.433594 229.511719 191.308594 229.507813 192.582031 C 229.476563 230.914063 229.476563 269.246094 229.507813 307.574219 C 229.511719 308.851563 229.132813 309.738281 228.222656 310.605469 C 218.761719 319.648438 209.332031 328.726563 199.898438 337.800781 C 195.179688 342.335938 190.457031 346.863281 185.765625 351.425781 C 185.039063 352.128906 184.339844 352.5625 183.273438 352.539063 C 179.320313 352.457031 175.359375 352.589844 171.414063 352.402344 C 165.496094 352.117188 160.089844 350.117188 155.121094 346.949219 C 154.160156 346.339844 153.296875 345.511719 152.550781 344.640625 C 149.996094 341.652344 147.066406 339.128906 143.585938 337.296875 C 135.359375 332.960938 131.722656 325.789063 131.015625 316.871094 C 130.78125 313.886719 130.871094 310.875 130.867188 307.878906 C 130.847656 299.554688 130.851563 291.234375 130.867188 282.914063 C 130.871094 281.648438 130.582031 280.113281 132.054688 279.496094 C 133.34375 278.957031 134.363281 279.984375 135.308594 280.730469 C 138.101563 282.945313 141.253906 283.980469 144.816406 283.777344 C 146.585938 283.675781 148.371094 283.726563 150.121094 283.484375 C 153.332031 283.042969 156.441406 283.457031 159.304688 284.800781 C 162.6875 286.386719 165.941406 288.257813 169.171875 290.144531 C 171.757813 291.652344 174.191406 293.425781 176.761719 294.96875 C 177.855469 295.625 179.082031 296.132813 180.316406 296.464844 C 181.867188 296.878906 182.902344 296.148438 183.003906 294.554688 C 183.097656 293.140625 183.144531 291.628906 182.75 290.296875 C 181.433594 285.863281 180.027344 281.445313 178.417969 277.109375 C 177.421875 274.425781 175.296875 272.492188 172.996094 270.851563 C 171.503906 269.78125 169.882813 268.898438 168.34375 267.894531 C 167.550781 267.375 166.710938 266.863281 166.082031 266.179688 C 164.160156 264.085938 164.253906 262.160156 166.152344 260.03125 C 166.914063 259.175781 167.660156 258.253906 168.191406 257.242188 C 169.503906 254.75 168.828125 252.628906 166.1875 251.574219 C 164.3125 250.828125 162.277344 250.390625 160.273438 250.089844 C 155.894531 249.433594 151.964844 247.890625 148.859375 244.667969 C 147.835938 243.601563 146.992188 242.324219 146.234375 241.046875 C 145.417969 239.660156 145.804688 238.265625 147.15625 237.328125 C 148.867188 236.140625 150.722656 235.925781 152.546875 236.996094 C 157.476563 239.898438 162.835938 241.273438 168.496094 241.574219 C 169.546875 241.628906 170.605469 241.496094 172.03125 241.433594 "/>
<path style=" stroke:none;fill-rule:nonzero;fill:rgb(60.398865%,10.598755%,11.799622%);fill-opacity:1;" d="M 12.75 258.398438 C 34.238281 258.398438 55.605469 258.398438 76.972656 258.398438 C 77.019531 258.496094 77.0625 258.589844 77.109375 258.6875 C 76.363281 259.082031 75.628906 259.503906 74.863281 259.871094 C 71.144531 261.648438 67.679688 263.773438 65.003906 266.992188 C 62.476563 270.03125 58.757813 281.015625 58.914063 284.972656 C 58.933594 285.378906 58.933594 285.800781 59.046875 286.1875 C 59.351563 287.253906 59.738281 288.289063 60.941406 288.664063 C 62.191406 289.050781 62.996094 288.320313 63.78125 287.511719 C 69.570313 281.523438 76.71875 277.800781 84.578125 275.441406 C 86.878906 274.75 89.441406 274.96875 91.863281 274.640625 C 93.882813 274.367188 95.902344 274.007813 97.871094 273.5 C 100.289063 272.878906 102.339844 271.5625 104.097656 269.753906 C 105.183594 268.632813 106.375 267.59375 107.609375 266.632813 C 108.386719 266.027344 109.265625 265.410156 110.640625 265.789063 C 110.722656 266.390625 110.882813 267.03125 110.878906 267.667969 C 110.859375 280.21875 110.882813 292.765625 110.75 305.3125 C 110.707031 309.253906 110.398438 313.207031 109.335938 317.054688 C 108.589844 319.746094 107.410156 322.117188 105.199219 323.9375 C 103.621094 325.238281 102.167969 326.683594 100.652344 328.054688 C 97.441406 330.957031 94.738281 334.253906 92.527344 337.984375 C 90.582031 341.277344 88.347656 344.371094 85.453125 346.933594 C 81.402344 350.507813 76.671875 352.347656 71.28125 352.417969 C 67.121094 352.472656 62.960938 352.398438 58.796875 352.449219 C 57.757813 352.464844 57.03125 352.128906 56.285156 351.40625 C 47.375 342.777344 38.429688 334.175781 29.488281 325.574219 C 24.476563 320.757813 19.472656 315.925781 14.410156 311.164063 C 13.140625 309.972656 12.515625 308.765625 12.527344 306.933594 C 12.636719 291.386719 12.632813 275.835938 12.667969 260.285156 C 12.667969 259.6875 12.71875 259.09375 12.75 258.398438 "/>
</g>
</svg>

    </a>
    Torch Choice
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        Home
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../install/" class="md-nav__link">
        Installation
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../intro/" class="md-nav__link">
        Introduction
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../data_management/" class="md-nav__link">
        Data Management
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../easy_data_management/" class="md-nav__link">
        Easy Data Management and Stata Users
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../conditional_logit_model_mode_canada/" class="md-nav__link">
        Conditional Logit Model
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../nested_logit_model_house_cooling/" class="md-nav__link">
        Nested Logit Model
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../post_estimation_demos/" class="md-nav__link">
        Post Estimation
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../projects/" class="md-nav__link">
        Related Projects
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../test/" class="md-nav__link">
        Compatibility Tests
      </a>
    </li>
  

    
      
      
      

  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          API Reference Torch-Choice
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        API Reference Torch-Choice
      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#torch_choice.data.ChoiceDataset" class="md-nav__link">
    torch_choice.data.ChoiceDataset
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#torch_choice.data.choice_dataset.ChoiceDataset.device" class="md-nav__link">
    device
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#torch_choice.data.choice_dataset.ChoiceDataset.num_items" class="md-nav__link">
    num_items
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#torch_choice.data.choice_dataset.ChoiceDataset.num_sessions" class="md-nav__link">
    num_sessions
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#torch_choice.data.choice_dataset.ChoiceDataset.num_users" class="md-nav__link">
    num_users
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#torch_choice.data.choice_dataset.ChoiceDataset.x_dict" class="md-nav__link">
    x_dict
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#torch_choice.data.choice_dataset.ChoiceDataset.__eq__" class="md-nav__link">
    __eq__()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#torch_choice.data.choice_dataset.ChoiceDataset.__getitem__" class="md-nav__link">
    __getitem__()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#torch_choice.data.choice_dataset.ChoiceDataset.__init__" class="md-nav__link">
    __init__()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#torch_choice.data.choice_dataset.ChoiceDataset.__len__" class="md-nav__link">
    __len__()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#torch_choice.data.choice_dataset.ChoiceDataset.__repr__" class="md-nav__link">
    __repr__()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#torch_choice.data.choice_dataset.ChoiceDataset.apply_tensor" class="md-nav__link">
    apply_tensor()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#torch_choice.data.choice_dataset.ChoiceDataset.clone" class="md-nav__link">
    clone()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#torch_choice.data.choice_dataset.ChoiceDataset.summary" class="md-nav__link">
    summary()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#torch_choice.data.choice_dataset.ChoiceDataset.to" class="md-nav__link">
    to()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#torch_choice.data.JointDataset" class="md-nav__link">
    torch_choice.data.JointDataset
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#torch_choice.data.joint_dataset.JointDataset.device" class="md-nav__link">
    device
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#torch_choice.data.joint_dataset.JointDataset.__getitem__" class="md-nav__link">
    __getitem__()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#torch_choice.data.joint_dataset.JointDataset.__init__" class="md-nav__link">
    __init__()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#torch_choice.data.joint_dataset.JointDataset.__len__" class="md-nav__link">
    __len__()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#torch_choice.data.joint_dataset.JointDataset.__repr__" class="md-nav__link">
    __repr__()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#torch_choice.data.joint_dataset.JointDataset.to" class="md-nav__link">
    to()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#torch_choice.model.ConditionalLogitModel" class="md-nav__link">
    torch_choice.model.ConditionalLogitModel
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#torch_choice.model.conditional_logit_model.ConditionalLogitModel.device" class="md-nav__link">
    device
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#torch_choice.model.conditional_logit_model.ConditionalLogitModel.num_params" class="md-nav__link">
    num_params
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#torch_choice.model.conditional_logit_model.ConditionalLogitModel.__init__" class="md-nav__link">
    __init__()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#torch_choice.model.conditional_logit_model.ConditionalLogitModel.__repr__" class="md-nav__link">
    __repr__()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#torch_choice.model.conditional_logit_model.ConditionalLogitModel.forward" class="md-nav__link">
    forward()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#torch_choice.model.conditional_logit_model.ConditionalLogitModel.get_coefficient" class="md-nav__link">
    get_coefficient()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#torch_choice.model.conditional_logit_model.ConditionalLogitModel.loss" class="md-nav__link">
    loss()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#torch_choice.model.conditional_logit_model.ConditionalLogitModel.negative_log_likelihood" class="md-nav__link">
    negative_log_likelihood()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#torch_choice.model.conditional_logit_model.ConditionalLogitModel.summary" class="md-nav__link">
    summary()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#torch_choice.model.NestedLogitModel" class="md-nav__link">
    torch_choice.model.NestedLogitModel
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#torch_choice.model.nested_logit_model.NestedLogitModel.device" class="md-nav__link">
    device
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#torch_choice.model.nested_logit_model.NestedLogitModel.num_params" class="md-nav__link">
    num_params
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#torch_choice.model.nested_logit_model.NestedLogitModel.__init__" class="md-nav__link">
    __init__()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#torch_choice.model.nested_logit_model.NestedLogitModel.forward" class="md-nav__link">
    forward()
  </a>
  
    <nav class="md-nav" aria-label="forward()">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#torch_choice.model.nested_logit_model.NestedLogitModel.forward--todo-the-conditionalogitmodel-returns-predicted-utility-the-nestedlogitmodel-behaves-the-same" class="md-nav__link">
    TODO: the ConditionaLogitModel returns predicted utility, the NestedLogitModel behaves the same?
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#torch_choice.model.nested_logit_model.NestedLogitModel.get_coefficient" class="md-nav__link">
    get_coefficient()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#torch_choice.model.nested_logit_model.NestedLogitModel.log_likelihood" class="md-nav__link">
    log_likelihood()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#torch_choice.model.nested_logit_model.NestedLogitModel.loss" class="md-nav__link">
    loss()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#torch_choice.model.nested_logit_model.NestedLogitModel.negative_log_likelihood" class="md-nav__link">
    negative_log_likelihood()
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#torch_choice.data.ChoiceDataset" class="md-nav__link">
    torch_choice.data.ChoiceDataset
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#torch_choice.data.choice_dataset.ChoiceDataset.device" class="md-nav__link">
    device
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#torch_choice.data.choice_dataset.ChoiceDataset.num_items" class="md-nav__link">
    num_items
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#torch_choice.data.choice_dataset.ChoiceDataset.num_sessions" class="md-nav__link">
    num_sessions
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#torch_choice.data.choice_dataset.ChoiceDataset.num_users" class="md-nav__link">
    num_users
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#torch_choice.data.choice_dataset.ChoiceDataset.x_dict" class="md-nav__link">
    x_dict
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#torch_choice.data.choice_dataset.ChoiceDataset.__eq__" class="md-nav__link">
    __eq__()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#torch_choice.data.choice_dataset.ChoiceDataset.__getitem__" class="md-nav__link">
    __getitem__()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#torch_choice.data.choice_dataset.ChoiceDataset.__init__" class="md-nav__link">
    __init__()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#torch_choice.data.choice_dataset.ChoiceDataset.__len__" class="md-nav__link">
    __len__()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#torch_choice.data.choice_dataset.ChoiceDataset.__repr__" class="md-nav__link">
    __repr__()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#torch_choice.data.choice_dataset.ChoiceDataset.apply_tensor" class="md-nav__link">
    apply_tensor()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#torch_choice.data.choice_dataset.ChoiceDataset.clone" class="md-nav__link">
    clone()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#torch_choice.data.choice_dataset.ChoiceDataset.summary" class="md-nav__link">
    summary()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#torch_choice.data.choice_dataset.ChoiceDataset.to" class="md-nav__link">
    to()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#torch_choice.data.JointDataset" class="md-nav__link">
    torch_choice.data.JointDataset
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#torch_choice.data.joint_dataset.JointDataset.device" class="md-nav__link">
    device
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#torch_choice.data.joint_dataset.JointDataset.__getitem__" class="md-nav__link">
    __getitem__()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#torch_choice.data.joint_dataset.JointDataset.__init__" class="md-nav__link">
    __init__()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#torch_choice.data.joint_dataset.JointDataset.__len__" class="md-nav__link">
    __len__()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#torch_choice.data.joint_dataset.JointDataset.__repr__" class="md-nav__link">
    __repr__()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#torch_choice.data.joint_dataset.JointDataset.to" class="md-nav__link">
    to()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#torch_choice.model.ConditionalLogitModel" class="md-nav__link">
    torch_choice.model.ConditionalLogitModel
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#torch_choice.model.conditional_logit_model.ConditionalLogitModel.device" class="md-nav__link">
    device
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#torch_choice.model.conditional_logit_model.ConditionalLogitModel.num_params" class="md-nav__link">
    num_params
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#torch_choice.model.conditional_logit_model.ConditionalLogitModel.__init__" class="md-nav__link">
    __init__()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#torch_choice.model.conditional_logit_model.ConditionalLogitModel.__repr__" class="md-nav__link">
    __repr__()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#torch_choice.model.conditional_logit_model.ConditionalLogitModel.forward" class="md-nav__link">
    forward()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#torch_choice.model.conditional_logit_model.ConditionalLogitModel.get_coefficient" class="md-nav__link">
    get_coefficient()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#torch_choice.model.conditional_logit_model.ConditionalLogitModel.loss" class="md-nav__link">
    loss()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#torch_choice.model.conditional_logit_model.ConditionalLogitModel.negative_log_likelihood" class="md-nav__link">
    negative_log_likelihood()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#torch_choice.model.conditional_logit_model.ConditionalLogitModel.summary" class="md-nav__link">
    summary()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#torch_choice.model.NestedLogitModel" class="md-nav__link">
    torch_choice.model.NestedLogitModel
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#torch_choice.model.nested_logit_model.NestedLogitModel.device" class="md-nav__link">
    device
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#torch_choice.model.nested_logit_model.NestedLogitModel.num_params" class="md-nav__link">
    num_params
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#torch_choice.model.nested_logit_model.NestedLogitModel.__init__" class="md-nav__link">
    __init__()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#torch_choice.model.nested_logit_model.NestedLogitModel.forward" class="md-nav__link">
    forward()
  </a>
  
    <nav class="md-nav" aria-label="forward()">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#torch_choice.model.nested_logit_model.NestedLogitModel.forward--todo-the-conditionalogitmodel-returns-predicted-utility-the-nestedlogitmodel-behaves-the-same" class="md-nav__link">
    TODO: the ConditionaLogitModel returns predicted utility, the NestedLogitModel behaves the same?
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#torch_choice.model.nested_logit_model.NestedLogitModel.get_coefficient" class="md-nav__link">
    get_coefficient()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#torch_choice.model.nested_logit_model.NestedLogitModel.log_likelihood" class="md-nav__link">
    log_likelihood()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#torch_choice.model.nested_logit_model.NestedLogitModel.loss" class="md-nav__link">
    loss()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#torch_choice.model.nested_logit_model.NestedLogitModel.negative_log_likelihood" class="md-nav__link">
    negative_log_likelihood()
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content" data-md-component="content">
            <article class="md-content__inner md-typeset">
              
                


<h1 id="api-reference-torch-choice">API Reference: Torch Choice</h1>


<div class="doc doc-object doc-class">


<a id="torch_choice.data.ChoiceDataset"></a>
  <div class="doc doc-contents first">
      <p class="doc doc-class-bases">
        Bases: <code>torch.<span title="torch.utils">utils</span>.<span title="torch.utils.data">data</span>.<span title="torch.utils.data.Dataset">Dataset</span></code></p>



        <details class="quote">
          <summary>Source code in <code>torch_choice/data/choice_dataset.py</code></summary>
          <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-16"> 16</a></span>
<span class="normal"><a href="#__codelineno-0-17"> 17</a></span>
<span class="normal"><a href="#__codelineno-0-18"> 18</a></span>
<span class="normal"><a href="#__codelineno-0-19"> 19</a></span>
<span class="normal"><a href="#__codelineno-0-20"> 20</a></span>
<span class="normal"><a href="#__codelineno-0-21"> 21</a></span>
<span class="normal"><a href="#__codelineno-0-22"> 22</a></span>
<span class="normal"><a href="#__codelineno-0-23"> 23</a></span>
<span class="normal"><a href="#__codelineno-0-24"> 24</a></span>
<span class="normal"><a href="#__codelineno-0-25"> 25</a></span>
<span class="normal"><a href="#__codelineno-0-26"> 26</a></span>
<span class="normal"><a href="#__codelineno-0-27"> 27</a></span>
<span class="normal"><a href="#__codelineno-0-28"> 28</a></span>
<span class="normal"><a href="#__codelineno-0-29"> 29</a></span>
<span class="normal"><a href="#__codelineno-0-30"> 30</a></span>
<span class="normal"><a href="#__codelineno-0-31"> 31</a></span>
<span class="normal"><a href="#__codelineno-0-32"> 32</a></span>
<span class="normal"><a href="#__codelineno-0-33"> 33</a></span>
<span class="normal"><a href="#__codelineno-0-34"> 34</a></span>
<span class="normal"><a href="#__codelineno-0-35"> 35</a></span>
<span class="normal"><a href="#__codelineno-0-36"> 36</a></span>
<span class="normal"><a href="#__codelineno-0-37"> 37</a></span>
<span class="normal"><a href="#__codelineno-0-38"> 38</a></span>
<span class="normal"><a href="#__codelineno-0-39"> 39</a></span>
<span class="normal"><a href="#__codelineno-0-40"> 40</a></span>
<span class="normal"><a href="#__codelineno-0-41"> 41</a></span>
<span class="normal"><a href="#__codelineno-0-42"> 42</a></span>
<span class="normal"><a href="#__codelineno-0-43"> 43</a></span>
<span class="normal"><a href="#__codelineno-0-44"> 44</a></span>
<span class="normal"><a href="#__codelineno-0-45"> 45</a></span>
<span class="normal"><a href="#__codelineno-0-46"> 46</a></span>
<span class="normal"><a href="#__codelineno-0-47"> 47</a></span>
<span class="normal"><a href="#__codelineno-0-48"> 48</a></span>
<span class="normal"><a href="#__codelineno-0-49"> 49</a></span>
<span class="normal"><a href="#__codelineno-0-50"> 50</a></span>
<span class="normal"><a href="#__codelineno-0-51"> 51</a></span>
<span class="normal"><a href="#__codelineno-0-52"> 52</a></span>
<span class="normal"><a href="#__codelineno-0-53"> 53</a></span>
<span class="normal"><a href="#__codelineno-0-54"> 54</a></span>
<span class="normal"><a href="#__codelineno-0-55"> 55</a></span>
<span class="normal"><a href="#__codelineno-0-56"> 56</a></span>
<span class="normal"><a href="#__codelineno-0-57"> 57</a></span>
<span class="normal"><a href="#__codelineno-0-58"> 58</a></span>
<span class="normal"><a href="#__codelineno-0-59"> 59</a></span>
<span class="normal"><a href="#__codelineno-0-60"> 60</a></span>
<span class="normal"><a href="#__codelineno-0-61"> 61</a></span>
<span class="normal"><a href="#__codelineno-0-62"> 62</a></span>
<span class="normal"><a href="#__codelineno-0-63"> 63</a></span>
<span class="normal"><a href="#__codelineno-0-64"> 64</a></span>
<span class="normal"><a href="#__codelineno-0-65"> 65</a></span>
<span class="normal"><a href="#__codelineno-0-66"> 66</a></span>
<span class="normal"><a href="#__codelineno-0-67"> 67</a></span>
<span class="normal"><a href="#__codelineno-0-68"> 68</a></span>
<span class="normal"><a href="#__codelineno-0-69"> 69</a></span>
<span class="normal"><a href="#__codelineno-0-70"> 70</a></span>
<span class="normal"><a href="#__codelineno-0-71"> 71</a></span>
<span class="normal"><a href="#__codelineno-0-72"> 72</a></span>
<span class="normal"><a href="#__codelineno-0-73"> 73</a></span>
<span class="normal"><a href="#__codelineno-0-74"> 74</a></span>
<span class="normal"><a href="#__codelineno-0-75"> 75</a></span>
<span class="normal"><a href="#__codelineno-0-76"> 76</a></span>
<span class="normal"><a href="#__codelineno-0-77"> 77</a></span>
<span class="normal"><a href="#__codelineno-0-78"> 78</a></span>
<span class="normal"><a href="#__codelineno-0-79"> 79</a></span>
<span class="normal"><a href="#__codelineno-0-80"> 80</a></span>
<span class="normal"><a href="#__codelineno-0-81"> 81</a></span>
<span class="normal"><a href="#__codelineno-0-82"> 82</a></span>
<span class="normal"><a href="#__codelineno-0-83"> 83</a></span>
<span class="normal"><a href="#__codelineno-0-84"> 84</a></span>
<span class="normal"><a href="#__codelineno-0-85"> 85</a></span>
<span class="normal"><a href="#__codelineno-0-86"> 86</a></span>
<span class="normal"><a href="#__codelineno-0-87"> 87</a></span>
<span class="normal"><a href="#__codelineno-0-88"> 88</a></span>
<span class="normal"><a href="#__codelineno-0-89"> 89</a></span>
<span class="normal"><a href="#__codelineno-0-90"> 90</a></span>
<span class="normal"><a href="#__codelineno-0-91"> 91</a></span>
<span class="normal"><a href="#__codelineno-0-92"> 92</a></span>
<span class="normal"><a href="#__codelineno-0-93"> 93</a></span>
<span class="normal"><a href="#__codelineno-0-94"> 94</a></span>
<span class="normal"><a href="#__codelineno-0-95"> 95</a></span>
<span class="normal"><a href="#__codelineno-0-96"> 96</a></span>
<span class="normal"><a href="#__codelineno-0-97"> 97</a></span>
<span class="normal"><a href="#__codelineno-0-98"> 98</a></span>
<span class="normal"><a href="#__codelineno-0-99"> 99</a></span>
<span class="normal"><a href="#__codelineno-0-100">100</a></span>
<span class="normal"><a href="#__codelineno-0-101">101</a></span>
<span class="normal"><a href="#__codelineno-0-102">102</a></span>
<span class="normal"><a href="#__codelineno-0-103">103</a></span>
<span class="normal"><a href="#__codelineno-0-104">104</a></span>
<span class="normal"><a href="#__codelineno-0-105">105</a></span>
<span class="normal"><a href="#__codelineno-0-106">106</a></span>
<span class="normal"><a href="#__codelineno-0-107">107</a></span>
<span class="normal"><a href="#__codelineno-0-108">108</a></span>
<span class="normal"><a href="#__codelineno-0-109">109</a></span>
<span class="normal"><a href="#__codelineno-0-110">110</a></span>
<span class="normal"><a href="#__codelineno-0-111">111</a></span>
<span class="normal"><a href="#__codelineno-0-112">112</a></span>
<span class="normal"><a href="#__codelineno-0-113">113</a></span>
<span class="normal"><a href="#__codelineno-0-114">114</a></span>
<span class="normal"><a href="#__codelineno-0-115">115</a></span>
<span class="normal"><a href="#__codelineno-0-116">116</a></span>
<span class="normal"><a href="#__codelineno-0-117">117</a></span>
<span class="normal"><a href="#__codelineno-0-118">118</a></span>
<span class="normal"><a href="#__codelineno-0-119">119</a></span>
<span class="normal"><a href="#__codelineno-0-120">120</a></span>
<span class="normal"><a href="#__codelineno-0-121">121</a></span>
<span class="normal"><a href="#__codelineno-0-122">122</a></span>
<span class="normal"><a href="#__codelineno-0-123">123</a></span>
<span class="normal"><a href="#__codelineno-0-124">124</a></span>
<span class="normal"><a href="#__codelineno-0-125">125</a></span>
<span class="normal"><a href="#__codelineno-0-126">126</a></span>
<span class="normal"><a href="#__codelineno-0-127">127</a></span>
<span class="normal"><a href="#__codelineno-0-128">128</a></span>
<span class="normal"><a href="#__codelineno-0-129">129</a></span>
<span class="normal"><a href="#__codelineno-0-130">130</a></span>
<span class="normal"><a href="#__codelineno-0-131">131</a></span>
<span class="normal"><a href="#__codelineno-0-132">132</a></span>
<span class="normal"><a href="#__codelineno-0-133">133</a></span>
<span class="normal"><a href="#__codelineno-0-134">134</a></span>
<span class="normal"><a href="#__codelineno-0-135">135</a></span>
<span class="normal"><a href="#__codelineno-0-136">136</a></span>
<span class="normal"><a href="#__codelineno-0-137">137</a></span>
<span class="normal"><a href="#__codelineno-0-138">138</a></span>
<span class="normal"><a href="#__codelineno-0-139">139</a></span>
<span class="normal"><a href="#__codelineno-0-140">140</a></span>
<span class="normal"><a href="#__codelineno-0-141">141</a></span>
<span class="normal"><a href="#__codelineno-0-142">142</a></span>
<span class="normal"><a href="#__codelineno-0-143">143</a></span>
<span class="normal"><a href="#__codelineno-0-144">144</a></span>
<span class="normal"><a href="#__codelineno-0-145">145</a></span>
<span class="normal"><a href="#__codelineno-0-146">146</a></span>
<span class="normal"><a href="#__codelineno-0-147">147</a></span>
<span class="normal"><a href="#__codelineno-0-148">148</a></span>
<span class="normal"><a href="#__codelineno-0-149">149</a></span>
<span class="normal"><a href="#__codelineno-0-150">150</a></span>
<span class="normal"><a href="#__codelineno-0-151">151</a></span>
<span class="normal"><a href="#__codelineno-0-152">152</a></span>
<span class="normal"><a href="#__codelineno-0-153">153</a></span>
<span class="normal"><a href="#__codelineno-0-154">154</a></span>
<span class="normal"><a href="#__codelineno-0-155">155</a></span>
<span class="normal"><a href="#__codelineno-0-156">156</a></span>
<span class="normal"><a href="#__codelineno-0-157">157</a></span>
<span class="normal"><a href="#__codelineno-0-158">158</a></span>
<span class="normal"><a href="#__codelineno-0-159">159</a></span>
<span class="normal"><a href="#__codelineno-0-160">160</a></span>
<span class="normal"><a href="#__codelineno-0-161">161</a></span>
<span class="normal"><a href="#__codelineno-0-162">162</a></span>
<span class="normal"><a href="#__codelineno-0-163">163</a></span>
<span class="normal"><a href="#__codelineno-0-164">164</a></span>
<span class="normal"><a href="#__codelineno-0-165">165</a></span>
<span class="normal"><a href="#__codelineno-0-166">166</a></span>
<span class="normal"><a href="#__codelineno-0-167">167</a></span>
<span class="normal"><a href="#__codelineno-0-168">168</a></span>
<span class="normal"><a href="#__codelineno-0-169">169</a></span>
<span class="normal"><a href="#__codelineno-0-170">170</a></span>
<span class="normal"><a href="#__codelineno-0-171">171</a></span>
<span class="normal"><a href="#__codelineno-0-172">172</a></span>
<span class="normal"><a href="#__codelineno-0-173">173</a></span>
<span class="normal"><a href="#__codelineno-0-174">174</a></span>
<span class="normal"><a href="#__codelineno-0-175">175</a></span>
<span class="normal"><a href="#__codelineno-0-176">176</a></span>
<span class="normal"><a href="#__codelineno-0-177">177</a></span>
<span class="normal"><a href="#__codelineno-0-178">178</a></span>
<span class="normal"><a href="#__codelineno-0-179">179</a></span>
<span class="normal"><a href="#__codelineno-0-180">180</a></span>
<span class="normal"><a href="#__codelineno-0-181">181</a></span>
<span class="normal"><a href="#__codelineno-0-182">182</a></span>
<span class="normal"><a href="#__codelineno-0-183">183</a></span>
<span class="normal"><a href="#__codelineno-0-184">184</a></span>
<span class="normal"><a href="#__codelineno-0-185">185</a></span>
<span class="normal"><a href="#__codelineno-0-186">186</a></span>
<span class="normal"><a href="#__codelineno-0-187">187</a></span>
<span class="normal"><a href="#__codelineno-0-188">188</a></span>
<span class="normal"><a href="#__codelineno-0-189">189</a></span>
<span class="normal"><a href="#__codelineno-0-190">190</a></span>
<span class="normal"><a href="#__codelineno-0-191">191</a></span>
<span class="normal"><a href="#__codelineno-0-192">192</a></span>
<span class="normal"><a href="#__codelineno-0-193">193</a></span>
<span class="normal"><a href="#__codelineno-0-194">194</a></span>
<span class="normal"><a href="#__codelineno-0-195">195</a></span>
<span class="normal"><a href="#__codelineno-0-196">196</a></span>
<span class="normal"><a href="#__codelineno-0-197">197</a></span>
<span class="normal"><a href="#__codelineno-0-198">198</a></span>
<span class="normal"><a href="#__codelineno-0-199">199</a></span>
<span class="normal"><a href="#__codelineno-0-200">200</a></span>
<span class="normal"><a href="#__codelineno-0-201">201</a></span>
<span class="normal"><a href="#__codelineno-0-202">202</a></span>
<span class="normal"><a href="#__codelineno-0-203">203</a></span>
<span class="normal"><a href="#__codelineno-0-204">204</a></span>
<span class="normal"><a href="#__codelineno-0-205">205</a></span>
<span class="normal"><a href="#__codelineno-0-206">206</a></span>
<span class="normal"><a href="#__codelineno-0-207">207</a></span>
<span class="normal"><a href="#__codelineno-0-208">208</a></span>
<span class="normal"><a href="#__codelineno-0-209">209</a></span>
<span class="normal"><a href="#__codelineno-0-210">210</a></span>
<span class="normal"><a href="#__codelineno-0-211">211</a></span>
<span class="normal"><a href="#__codelineno-0-212">212</a></span>
<span class="normal"><a href="#__codelineno-0-213">213</a></span>
<span class="normal"><a href="#__codelineno-0-214">214</a></span>
<span class="normal"><a href="#__codelineno-0-215">215</a></span>
<span class="normal"><a href="#__codelineno-0-216">216</a></span>
<span class="normal"><a href="#__codelineno-0-217">217</a></span>
<span class="normal"><a href="#__codelineno-0-218">218</a></span>
<span class="normal"><a href="#__codelineno-0-219">219</a></span>
<span class="normal"><a href="#__codelineno-0-220">220</a></span>
<span class="normal"><a href="#__codelineno-0-221">221</a></span>
<span class="normal"><a href="#__codelineno-0-222">222</a></span>
<span class="normal"><a href="#__codelineno-0-223">223</a></span>
<span class="normal"><a href="#__codelineno-0-224">224</a></span>
<span class="normal"><a href="#__codelineno-0-225">225</a></span>
<span class="normal"><a href="#__codelineno-0-226">226</a></span>
<span class="normal"><a href="#__codelineno-0-227">227</a></span>
<span class="normal"><a href="#__codelineno-0-228">228</a></span>
<span class="normal"><a href="#__codelineno-0-229">229</a></span>
<span class="normal"><a href="#__codelineno-0-230">230</a></span>
<span class="normal"><a href="#__codelineno-0-231">231</a></span>
<span class="normal"><a href="#__codelineno-0-232">232</a></span>
<span class="normal"><a href="#__codelineno-0-233">233</a></span>
<span class="normal"><a href="#__codelineno-0-234">234</a></span>
<span class="normal"><a href="#__codelineno-0-235">235</a></span>
<span class="normal"><a href="#__codelineno-0-236">236</a></span>
<span class="normal"><a href="#__codelineno-0-237">237</a></span>
<span class="normal"><a href="#__codelineno-0-238">238</a></span>
<span class="normal"><a href="#__codelineno-0-239">239</a></span>
<span class="normal"><a href="#__codelineno-0-240">240</a></span>
<span class="normal"><a href="#__codelineno-0-241">241</a></span>
<span class="normal"><a href="#__codelineno-0-242">242</a></span>
<span class="normal"><a href="#__codelineno-0-243">243</a></span>
<span class="normal"><a href="#__codelineno-0-244">244</a></span>
<span class="normal"><a href="#__codelineno-0-245">245</a></span>
<span class="normal"><a href="#__codelineno-0-246">246</a></span>
<span class="normal"><a href="#__codelineno-0-247">247</a></span>
<span class="normal"><a href="#__codelineno-0-248">248</a></span>
<span class="normal"><a href="#__codelineno-0-249">249</a></span>
<span class="normal"><a href="#__codelineno-0-250">250</a></span>
<span class="normal"><a href="#__codelineno-0-251">251</a></span>
<span class="normal"><a href="#__codelineno-0-252">252</a></span>
<span class="normal"><a href="#__codelineno-0-253">253</a></span>
<span class="normal"><a href="#__codelineno-0-254">254</a></span>
<span class="normal"><a href="#__codelineno-0-255">255</a></span>
<span class="normal"><a href="#__codelineno-0-256">256</a></span>
<span class="normal"><a href="#__codelineno-0-257">257</a></span>
<span class="normal"><a href="#__codelineno-0-258">258</a></span>
<span class="normal"><a href="#__codelineno-0-259">259</a></span>
<span class="normal"><a href="#__codelineno-0-260">260</a></span>
<span class="normal"><a href="#__codelineno-0-261">261</a></span>
<span class="normal"><a href="#__codelineno-0-262">262</a></span>
<span class="normal"><a href="#__codelineno-0-263">263</a></span>
<span class="normal"><a href="#__codelineno-0-264">264</a></span>
<span class="normal"><a href="#__codelineno-0-265">265</a></span>
<span class="normal"><a href="#__codelineno-0-266">266</a></span>
<span class="normal"><a href="#__codelineno-0-267">267</a></span>
<span class="normal"><a href="#__codelineno-0-268">268</a></span>
<span class="normal"><a href="#__codelineno-0-269">269</a></span>
<span class="normal"><a href="#__codelineno-0-270">270</a></span>
<span class="normal"><a href="#__codelineno-0-271">271</a></span>
<span class="normal"><a href="#__codelineno-0-272">272</a></span>
<span class="normal"><a href="#__codelineno-0-273">273</a></span>
<span class="normal"><a href="#__codelineno-0-274">274</a></span>
<span class="normal"><a href="#__codelineno-0-275">275</a></span>
<span class="normal"><a href="#__codelineno-0-276">276</a></span>
<span class="normal"><a href="#__codelineno-0-277">277</a></span>
<span class="normal"><a href="#__codelineno-0-278">278</a></span>
<span class="normal"><a href="#__codelineno-0-279">279</a></span>
<span class="normal"><a href="#__codelineno-0-280">280</a></span>
<span class="normal"><a href="#__codelineno-0-281">281</a></span>
<span class="normal"><a href="#__codelineno-0-282">282</a></span>
<span class="normal"><a href="#__codelineno-0-283">283</a></span>
<span class="normal"><a href="#__codelineno-0-284">284</a></span>
<span class="normal"><a href="#__codelineno-0-285">285</a></span>
<span class="normal"><a href="#__codelineno-0-286">286</a></span>
<span class="normal"><a href="#__codelineno-0-287">287</a></span>
<span class="normal"><a href="#__codelineno-0-288">288</a></span>
<span class="normal"><a href="#__codelineno-0-289">289</a></span>
<span class="normal"><a href="#__codelineno-0-290">290</a></span>
<span class="normal"><a href="#__codelineno-0-291">291</a></span>
<span class="normal"><a href="#__codelineno-0-292">292</a></span>
<span class="normal"><a href="#__codelineno-0-293">293</a></span>
<span class="normal"><a href="#__codelineno-0-294">294</a></span>
<span class="normal"><a href="#__codelineno-0-295">295</a></span>
<span class="normal"><a href="#__codelineno-0-296">296</a></span>
<span class="normal"><a href="#__codelineno-0-297">297</a></span>
<span class="normal"><a href="#__codelineno-0-298">298</a></span>
<span class="normal"><a href="#__codelineno-0-299">299</a></span>
<span class="normal"><a href="#__codelineno-0-300">300</a></span>
<span class="normal"><a href="#__codelineno-0-301">301</a></span>
<span class="normal"><a href="#__codelineno-0-302">302</a></span>
<span class="normal"><a href="#__codelineno-0-303">303</a></span>
<span class="normal"><a href="#__codelineno-0-304">304</a></span>
<span class="normal"><a href="#__codelineno-0-305">305</a></span>
<span class="normal"><a href="#__codelineno-0-306">306</a></span>
<span class="normal"><a href="#__codelineno-0-307">307</a></span>
<span class="normal"><a href="#__codelineno-0-308">308</a></span>
<span class="normal"><a href="#__codelineno-0-309">309</a></span>
<span class="normal"><a href="#__codelineno-0-310">310</a></span>
<span class="normal"><a href="#__codelineno-0-311">311</a></span>
<span class="normal"><a href="#__codelineno-0-312">312</a></span>
<span class="normal"><a href="#__codelineno-0-313">313</a></span>
<span class="normal"><a href="#__codelineno-0-314">314</a></span>
<span class="normal"><a href="#__codelineno-0-315">315</a></span>
<span class="normal"><a href="#__codelineno-0-316">316</a></span>
<span class="normal"><a href="#__codelineno-0-317">317</a></span>
<span class="normal"><a href="#__codelineno-0-318">318</a></span>
<span class="normal"><a href="#__codelineno-0-319">319</a></span>
<span class="normal"><a href="#__codelineno-0-320">320</a></span>
<span class="normal"><a href="#__codelineno-0-321">321</a></span>
<span class="normal"><a href="#__codelineno-0-322">322</a></span>
<span class="normal"><a href="#__codelineno-0-323">323</a></span>
<span class="normal"><a href="#__codelineno-0-324">324</a></span>
<span class="normal"><a href="#__codelineno-0-325">325</a></span>
<span class="normal"><a href="#__codelineno-0-326">326</a></span>
<span class="normal"><a href="#__codelineno-0-327">327</a></span>
<span class="normal"><a href="#__codelineno-0-328">328</a></span>
<span class="normal"><a href="#__codelineno-0-329">329</a></span>
<span class="normal"><a href="#__codelineno-0-330">330</a></span>
<span class="normal"><a href="#__codelineno-0-331">331</a></span>
<span class="normal"><a href="#__codelineno-0-332">332</a></span>
<span class="normal"><a href="#__codelineno-0-333">333</a></span>
<span class="normal"><a href="#__codelineno-0-334">334</a></span>
<span class="normal"><a href="#__codelineno-0-335">335</a></span>
<span class="normal"><a href="#__codelineno-0-336">336</a></span>
<span class="normal"><a href="#__codelineno-0-337">337</a></span>
<span class="normal"><a href="#__codelineno-0-338">338</a></span>
<span class="normal"><a href="#__codelineno-0-339">339</a></span>
<span class="normal"><a href="#__codelineno-0-340">340</a></span>
<span class="normal"><a href="#__codelineno-0-341">341</a></span>
<span class="normal"><a href="#__codelineno-0-342">342</a></span>
<span class="normal"><a href="#__codelineno-0-343">343</a></span>
<span class="normal"><a href="#__codelineno-0-344">344</a></span>
<span class="normal"><a href="#__codelineno-0-345">345</a></span>
<span class="normal"><a href="#__codelineno-0-346">346</a></span>
<span class="normal"><a href="#__codelineno-0-347">347</a></span>
<span class="normal"><a href="#__codelineno-0-348">348</a></span>
<span class="normal"><a href="#__codelineno-0-349">349</a></span>
<span class="normal"><a href="#__codelineno-0-350">350</a></span>
<span class="normal"><a href="#__codelineno-0-351">351</a></span>
<span class="normal"><a href="#__codelineno-0-352">352</a></span>
<span class="normal"><a href="#__codelineno-0-353">353</a></span>
<span class="normal"><a href="#__codelineno-0-354">354</a></span>
<span class="normal"><a href="#__codelineno-0-355">355</a></span>
<span class="normal"><a href="#__codelineno-0-356">356</a></span>
<span class="normal"><a href="#__codelineno-0-357">357</a></span>
<span class="normal"><a href="#__codelineno-0-358">358</a></span>
<span class="normal"><a href="#__codelineno-0-359">359</a></span>
<span class="normal"><a href="#__codelineno-0-360">360</a></span>
<span class="normal"><a href="#__codelineno-0-361">361</a></span>
<span class="normal"><a href="#__codelineno-0-362">362</a></span>
<span class="normal"><a href="#__codelineno-0-363">363</a></span>
<span class="normal"><a href="#__codelineno-0-364">364</a></span>
<span class="normal"><a href="#__codelineno-0-365">365</a></span>
<span class="normal"><a href="#__codelineno-0-366">366</a></span>
<span class="normal"><a href="#__codelineno-0-367">367</a></span>
<span class="normal"><a href="#__codelineno-0-368">368</a></span>
<span class="normal"><a href="#__codelineno-0-369">369</a></span>
<span class="normal"><a href="#__codelineno-0-370">370</a></span>
<span class="normal"><a href="#__codelineno-0-371">371</a></span>
<span class="normal"><a href="#__codelineno-0-372">372</a></span>
<span class="normal"><a href="#__codelineno-0-373">373</a></span>
<span class="normal"><a href="#__codelineno-0-374">374</a></span>
<span class="normal"><a href="#__codelineno-0-375">375</a></span>
<span class="normal"><a href="#__codelineno-0-376">376</a></span>
<span class="normal"><a href="#__codelineno-0-377">377</a></span>
<span class="normal"><a href="#__codelineno-0-378">378</a></span>
<span class="normal"><a href="#__codelineno-0-379">379</a></span>
<span class="normal"><a href="#__codelineno-0-380">380</a></span>
<span class="normal"><a href="#__codelineno-0-381">381</a></span>
<span class="normal"><a href="#__codelineno-0-382">382</a></span>
<span class="normal"><a href="#__codelineno-0-383">383</a></span>
<span class="normal"><a href="#__codelineno-0-384">384</a></span>
<span class="normal"><a href="#__codelineno-0-385">385</a></span>
<span class="normal"><a href="#__codelineno-0-386">386</a></span>
<span class="normal"><a href="#__codelineno-0-387">387</a></span>
<span class="normal"><a href="#__codelineno-0-388">388</a></span>
<span class="normal"><a href="#__codelineno-0-389">389</a></span>
<span class="normal"><a href="#__codelineno-0-390">390</a></span>
<span class="normal"><a href="#__codelineno-0-391">391</a></span>
<span class="normal"><a href="#__codelineno-0-392">392</a></span>
<span class="normal"><a href="#__codelineno-0-393">393</a></span>
<span class="normal"><a href="#__codelineno-0-394">394</a></span>
<span class="normal"><a href="#__codelineno-0-395">395</a></span>
<span class="normal"><a href="#__codelineno-0-396">396</a></span>
<span class="normal"><a href="#__codelineno-0-397">397</a></span>
<span class="normal"><a href="#__codelineno-0-398">398</a></span>
<span class="normal"><a href="#__codelineno-0-399">399</a></span>
<span class="normal"><a href="#__codelineno-0-400">400</a></span>
<span class="normal"><a href="#__codelineno-0-401">401</a></span>
<span class="normal"><a href="#__codelineno-0-402">402</a></span>
<span class="normal"><a href="#__codelineno-0-403">403</a></span>
<span class="normal"><a href="#__codelineno-0-404">404</a></span>
<span class="normal"><a href="#__codelineno-0-405">405</a></span>
<span class="normal"><a href="#__codelineno-0-406">406</a></span>
<span class="normal"><a href="#__codelineno-0-407">407</a></span>
<span class="normal"><a href="#__codelineno-0-408">408</a></span>
<span class="normal"><a href="#__codelineno-0-409">409</a></span>
<span class="normal"><a href="#__codelineno-0-410">410</a></span>
<span class="normal"><a href="#__codelineno-0-411">411</a></span>
<span class="normal"><a href="#__codelineno-0-412">412</a></span>
<span class="normal"><a href="#__codelineno-0-413">413</a></span>
<span class="normal"><a href="#__codelineno-0-414">414</a></span>
<span class="normal"><a href="#__codelineno-0-415">415</a></span>
<span class="normal"><a href="#__codelineno-0-416">416</a></span>
<span class="normal"><a href="#__codelineno-0-417">417</a></span>
<span class="normal"><a href="#__codelineno-0-418">418</a></span>
<span class="normal"><a href="#__codelineno-0-419">419</a></span>
<span class="normal"><a href="#__codelineno-0-420">420</a></span>
<span class="normal"><a href="#__codelineno-0-421">421</a></span>
<span class="normal"><a href="#__codelineno-0-422">422</a></span>
<span class="normal"><a href="#__codelineno-0-423">423</a></span>
<span class="normal"><a href="#__codelineno-0-424">424</a></span>
<span class="normal"><a href="#__codelineno-0-425">425</a></span>
<span class="normal"><a href="#__codelineno-0-426">426</a></span>
<span class="normal"><a href="#__codelineno-0-427">427</a></span>
<span class="normal"><a href="#__codelineno-0-428">428</a></span>
<span class="normal"><a href="#__codelineno-0-429">429</a></span>
<span class="normal"><a href="#__codelineno-0-430">430</a></span>
<span class="normal"><a href="#__codelineno-0-431">431</a></span>
<span class="normal"><a href="#__codelineno-0-432">432</a></span>
<span class="normal"><a href="#__codelineno-0-433">433</a></span>
<span class="normal"><a href="#__codelineno-0-434">434</a></span>
<span class="normal"><a href="#__codelineno-0-435">435</a></span>
<span class="normal"><a href="#__codelineno-0-436">436</a></span>
<span class="normal"><a href="#__codelineno-0-437">437</a></span>
<span class="normal"><a href="#__codelineno-0-438">438</a></span>
<span class="normal"><a href="#__codelineno-0-439">439</a></span>
<span class="normal"><a href="#__codelineno-0-440">440</a></span>
<span class="normal"><a href="#__codelineno-0-441">441</a></span>
<span class="normal"><a href="#__codelineno-0-442">442</a></span>
<span class="normal"><a href="#__codelineno-0-443">443</a></span>
<span class="normal"><a href="#__codelineno-0-444">444</a></span>
<span class="normal"><a href="#__codelineno-0-445">445</a></span>
<span class="normal"><a href="#__codelineno-0-446">446</a></span>
<span class="normal"><a href="#__codelineno-0-447">447</a></span>
<span class="normal"><a href="#__codelineno-0-448">448</a></span>
<span class="normal"><a href="#__codelineno-0-449">449</a></span>
<span class="normal"><a href="#__codelineno-0-450">450</a></span>
<span class="normal"><a href="#__codelineno-0-451">451</a></span>
<span class="normal"><a href="#__codelineno-0-452">452</a></span>
<span class="normal"><a href="#__codelineno-0-453">453</a></span>
<span class="normal"><a href="#__codelineno-0-454">454</a></span>
<span class="normal"><a href="#__codelineno-0-455">455</a></span>
<span class="normal"><a href="#__codelineno-0-456">456</a></span>
<span class="normal"><a href="#__codelineno-0-457">457</a></span>
<span class="normal"><a href="#__codelineno-0-458">458</a></span>
<span class="normal"><a href="#__codelineno-0-459">459</a></span>
<span class="normal"><a href="#__codelineno-0-460">460</a></span>
<span class="normal"><a href="#__codelineno-0-461">461</a></span>
<span class="normal"><a href="#__codelineno-0-462">462</a></span>
<span class="normal"><a href="#__codelineno-0-463">463</a></span>
<span class="normal"><a href="#__codelineno-0-464">464</a></span>
<span class="normal"><a href="#__codelineno-0-465">465</a></span>
<span class="normal"><a href="#__codelineno-0-466">466</a></span>
<span class="normal"><a href="#__codelineno-0-467">467</a></span>
<span class="normal"><a href="#__codelineno-0-468">468</a></span>
<span class="normal"><a href="#__codelineno-0-469">469</a></span>
<span class="normal"><a href="#__codelineno-0-470">470</a></span>
<span class="normal"><a href="#__codelineno-0-471">471</a></span>
<span class="normal"><a href="#__codelineno-0-472">472</a></span>
<span class="normal"><a href="#__codelineno-0-473">473</a></span>
<span class="normal"><a href="#__codelineno-0-474">474</a></span>
<span class="normal"><a href="#__codelineno-0-475">475</a></span>
<span class="normal"><a href="#__codelineno-0-476">476</a></span>
<span class="normal"><a href="#__codelineno-0-477">477</a></span>
<span class="normal"><a href="#__codelineno-0-478">478</a></span>
<span class="normal"><a href="#__codelineno-0-479">479</a></span>
<span class="normal"><a href="#__codelineno-0-480">480</a></span>
<span class="normal"><a href="#__codelineno-0-481">481</a></span>
<span class="normal"><a href="#__codelineno-0-482">482</a></span>
<span class="normal"><a href="#__codelineno-0-483">483</a></span>
<span class="normal"><a href="#__codelineno-0-484">484</a></span>
<span class="normal"><a href="#__codelineno-0-485">485</a></span>
<span class="normal"><a href="#__codelineno-0-486">486</a></span>
<span class="normal"><a href="#__codelineno-0-487">487</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-16" name="__codelineno-0-16"></a><span class="k">class</span> <span class="nc">ChoiceDataset</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">Dataset</span><span class="p">):</span>
<a id="__codelineno-0-17" name="__codelineno-0-17"></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-18" name="__codelineno-0-18"></a>                 <span class="n">item_index</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">LongTensor</span><span class="p">,</span>
<a id="__codelineno-0-19" name="__codelineno-0-19"></a>                 <span class="n">num_items</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-20" name="__codelineno-0-20"></a>                 <span class="n">num_users</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-21" name="__codelineno-0-21"></a>                 <span class="n">label</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">torch</span><span class="o">.</span><span class="n">LongTensor</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-22" name="__codelineno-0-22"></a>                 <span class="n">user_index</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">torch</span><span class="o">.</span><span class="n">LongTensor</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-23" name="__codelineno-0-23"></a>                 <span class="n">session_index</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">torch</span><span class="o">.</span><span class="n">LongTensor</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-24" name="__codelineno-0-24"></a>                 <span class="n">item_availability</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">torch</span><span class="o">.</span><span class="n">BoolTensor</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-25" name="__codelineno-0-25"></a>                 <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-26" name="__codelineno-0-26"></a>        <span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-27" name="__codelineno-0-27"></a><span class="sd">        Initialization methods for the dataset object, researchers should supply all information about the dataset</span>
<a id="__codelineno-0-28" name="__codelineno-0-28"></a><span class="sd">        using this initialization method.</span>
<a id="__codelineno-0-29" name="__codelineno-0-29"></a>
<a id="__codelineno-0-30" name="__codelineno-0-30"></a><span class="sd">        The number of choice instances are called `batch_size` in the documentation. The `batch_size` corresponds to the</span>
<a id="__codelineno-0-31" name="__codelineno-0-31"></a><span class="sd">        file length in wide-format dataset, and often denoted using `N`. We call it `batch_size` to follow the convention</span>
<a id="__codelineno-0-32" name="__codelineno-0-32"></a><span class="sd">        in machine learning literature.</span>
<a id="__codelineno-0-33" name="__codelineno-0-33"></a><span class="sd">        A `choice instance` is a row of the dataset, so there are `batch_size` choice instances in each `ChoiceDataset`.</span>
<a id="__codelineno-0-34" name="__codelineno-0-34"></a>
<a id="__codelineno-0-35" name="__codelineno-0-35"></a><span class="sd">        The dataset consists of:</span>
<a id="__codelineno-0-36" name="__codelineno-0-36"></a><span class="sd">        (1) a collection of `batch_size` tuples (item_id, user_id, session_id, label), where each tuple is a choice instance.</span>
<a id="__codelineno-0-37" name="__codelineno-0-37"></a><span class="sd">        (2) a collection of `observables` associated with item, user, session, etc.</span>
<a id="__codelineno-0-38" name="__codelineno-0-38"></a>
<a id="__codelineno-0-39" name="__codelineno-0-39"></a><span class="sd">        Args:</span>
<a id="__codelineno-0-40" name="__codelineno-0-40"></a><span class="sd">            item_index (torch.LongTensor): a tensor of shape (batch_size) indicating the relevant item in each row</span>
<a id="__codelineno-0-41" name="__codelineno-0-41"></a><span class="sd">                of the dataset, the relevant item can be:</span>
<a id="__codelineno-0-42" name="__codelineno-0-42"></a><span class="sd">                (1) the item bought in this choice instance,</span>
<a id="__codelineno-0-43" name="__codelineno-0-43"></a><span class="sd">                (2) or the item reviewed by the user. In the later case, we need the `label` tensor to specify the rating score.</span>
<a id="__codelineno-0-44" name="__codelineno-0-44"></a><span class="sd">                NOTE: The support for second case is under-development, currently, we are only supporting binary label.</span>
<a id="__codelineno-0-45" name="__codelineno-0-45"></a>
<a id="__codelineno-0-46" name="__codelineno-0-46"></a><span class="sd">            num_items (Optional[int]): the number of items in the dataset. If `None` is provided (default), the number of items will be inferred from the number of unique numbers in `item_index`.</span>
<a id="__codelineno-0-47" name="__codelineno-0-47"></a>
<a id="__codelineno-0-48" name="__codelineno-0-48"></a><span class="sd">            num_users (Optional[int]): the number of users in the dataset. If `None` is provided (default), the number of users will be inferred from the number of unique numbers in `user_index`.</span>
<a id="__codelineno-0-49" name="__codelineno-0-49"></a>
<a id="__codelineno-0-50" name="__codelineno-0-50"></a><span class="sd">            label (Optional[torch.LongTensor], optional): a tensor of shape (batch_size) indicating the label for prediction in</span>
<a id="__codelineno-0-51" name="__codelineno-0-51"></a><span class="sd">                each choice instance. While you want to predict the item bought, you can leave the `label` argument</span>
<a id="__codelineno-0-52" name="__codelineno-0-52"></a><span class="sd">                as `None` in the initialization method, and the model will use `item_index` as the object to be predicted.</span>
<a id="__codelineno-0-53" name="__codelineno-0-53"></a><span class="sd">                But if you are, for example, predicting the rating an user gave an item, label must be provided.</span>
<a id="__codelineno-0-54" name="__codelineno-0-54"></a><span class="sd">                Defaults to None.</span>
<a id="__codelineno-0-55" name="__codelineno-0-55"></a>
<a id="__codelineno-0-56" name="__codelineno-0-56"></a><span class="sd">            user_index (Optional[torch.LongTensor], optional): a tensor of shape num_purchases (batch_size) indicating</span>
<a id="__codelineno-0-57" name="__codelineno-0-57"></a><span class="sd">                the ID of the user who was involved in each choice instance. If `None` user index is provided, it&#39;s assumed</span>
<a id="__codelineno-0-58" name="__codelineno-0-58"></a><span class="sd">                that the choice instances are from the same user.</span>
<a id="__codelineno-0-59" name="__codelineno-0-59"></a><span class="sd">                `user_index` is required if and only if there are multiple users in the dataset, for example:</span>
<a id="__codelineno-0-60" name="__codelineno-0-60"></a><span class="sd">                    (1) user-observables is involved in the utility form,</span>
<a id="__codelineno-0-61" name="__codelineno-0-61"></a><span class="sd">                    (2) and/or the coefficient is user-specific.</span>
<a id="__codelineno-0-62" name="__codelineno-0-62"></a><span class="sd">                This tensor is used to select the corresponding user observables and coefficients assigned to the</span>
<a id="__codelineno-0-63" name="__codelineno-0-63"></a><span class="sd">                user (like theta_user) for making prediction for that purchase.</span>
<a id="__codelineno-0-64" name="__codelineno-0-64"></a><span class="sd">                Defaults to None.</span>
<a id="__codelineno-0-65" name="__codelineno-0-65"></a>
<a id="__codelineno-0-66" name="__codelineno-0-66"></a><span class="sd">            session_index (Optional[torch.LongTensor], optional): a tensor of shape num_purchases (batch_size) indicating</span>
<a id="__codelineno-0-67" name="__codelineno-0-67"></a><span class="sd">                the ID of the session when that choice instance occurred. This tensor is used to select the correct</span>
<a id="__codelineno-0-68" name="__codelineno-0-68"></a><span class="sd">                session observables or price observables for making prediction for that choice instance. Therefore, if</span>
<a id="__codelineno-0-69" name="__codelineno-0-69"></a><span class="sd">                there is no session/price observables, you can leave this argument as `None`. In this case, the `ChoiceDataset`</span>
<a id="__codelineno-0-70" name="__codelineno-0-70"></a><span class="sd">                object will assume each choice instance to be in its own session.</span>
<a id="__codelineno-0-71" name="__codelineno-0-71"></a><span class="sd">                Defaults to None.</span>
<a id="__codelineno-0-72" name="__codelineno-0-72"></a>
<a id="__codelineno-0-73" name="__codelineno-0-73"></a><span class="sd">            item_availability (Optional[torch.BoolTensor], optional): A boolean tensor of shape (num_sessions, num_items)</span>
<a id="__codelineno-0-74" name="__codelineno-0-74"></a><span class="sd">                indicating the availability of each item in each session. Utilities of unavailable items would be set to -infinite,</span>
<a id="__codelineno-0-75" name="__codelineno-0-75"></a><span class="sd">                and hence these unavailable items will be set to 0 while making prediction.</span>
<a id="__codelineno-0-76" name="__codelineno-0-76"></a><span class="sd">                We assume all items are available if set to None.</span>
<a id="__codelineno-0-77" name="__codelineno-0-77"></a><span class="sd">                Defaults to None.</span>
<a id="__codelineno-0-78" name="__codelineno-0-78"></a>
<a id="__codelineno-0-79" name="__codelineno-0-79"></a><span class="sd">        Other Kwargs (Observables):</span>
<a id="__codelineno-0-80" name="__codelineno-0-80"></a><span class="sd">            One can specify the following types of observables, where * in shape denotes any positive</span>
<a id="__codelineno-0-81" name="__codelineno-0-81"></a><span class="sd">                integer. Typically * represents the number of observables.</span>
<a id="__codelineno-0-82" name="__codelineno-0-82"></a><span class="sd">            Please refer to the documentation for a detailed guide to use observables.</span>
<a id="__codelineno-0-83" name="__codelineno-0-83"></a><span class="sd">            1. user observables must start with &#39;user_&#39; and have shape (num_users, *)</span>
<a id="__codelineno-0-84" name="__codelineno-0-84"></a><span class="sd">            2. item observables must start with &#39;item_&#39; and have shape (num_items, *)</span>
<a id="__codelineno-0-85" name="__codelineno-0-85"></a><span class="sd">            3. session observables must start with &#39;session_&#39; and have shape (num_sessions, *)</span>
<a id="__codelineno-0-86" name="__codelineno-0-86"></a><span class="sd">            4. taste observables (those vary by user and item) must start with `taste_` and have shape</span>
<a id="__codelineno-0-87" name="__codelineno-0-87"></a><span class="sd">                (num_users, num_items, *).</span>
<a id="__codelineno-0-88" name="__codelineno-0-88"></a><span class="sd">            NOTE: we don&#39;t recommend using taste observables, because num_users * num_items is potentially large.</span>
<a id="__codelineno-0-89" name="__codelineno-0-89"></a><span class="sd">            5. price observables (those vary by session and item) must start with `price_` and have</span>
<a id="__codelineno-0-90" name="__codelineno-0-90"></a><span class="sd">                shape (num_sessions, num_items, *)</span>
<a id="__codelineno-0-91" name="__codelineno-0-91"></a><span class="sd">            6. itemsession observables starting with `itemsession_`, this is a more intuitive alias to the price</span>
<a id="__codelineno-0-92" name="__codelineno-0-92"></a><span class="sd">                observable.</span>
<a id="__codelineno-0-93" name="__codelineno-0-93"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-94" name="__codelineno-0-94"></a>        <span class="c1"># ENHANCEMENT(Tianyu): add item_names for summary.</span>
<a id="__codelineno-0-95" name="__codelineno-0-95"></a>        <span class="nb">super</span><span class="p">(</span><span class="n">ChoiceDataset</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
<a id="__codelineno-0-96" name="__codelineno-0-96"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">label</span> <span class="o">=</span> <span class="n">label</span>
<a id="__codelineno-0-97" name="__codelineno-0-97"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">item_index</span> <span class="o">=</span> <span class="n">item_index</span>
<a id="__codelineno-0-98" name="__codelineno-0-98"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_num_items</span> <span class="o">=</span> <span class="n">num_items</span>
<a id="__codelineno-0-99" name="__codelineno-0-99"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_num_users</span> <span class="o">=</span> <span class="n">num_users</span>
<a id="__codelineno-0-100" name="__codelineno-0-100"></a>
<a id="__codelineno-0-101" name="__codelineno-0-101"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">user_index</span> <span class="o">=</span> <span class="n">user_index</span>
<a id="__codelineno-0-102" name="__codelineno-0-102"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">session_index</span> <span class="o">=</span> <span class="n">session_index</span>
<a id="__codelineno-0-103" name="__codelineno-0-103"></a>
<a id="__codelineno-0-104" name="__codelineno-0-104"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">session_index</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-105" name="__codelineno-0-105"></a>            <span class="c1"># if any([x.startswith(&#39;session_&#39;) or x.startswith(&#39;price_&#39;) for x in kwargs.keys()]):</span>
<a id="__codelineno-0-106" name="__codelineno-0-106"></a>            <span class="c1"># if any session sensitive observable is provided, but session index is not,</span>
<a id="__codelineno-0-107" name="__codelineno-0-107"></a>            <span class="c1"># infer each row in the dataset to be a session.</span>
<a id="__codelineno-0-108" name="__codelineno-0-108"></a>            <span class="c1"># TODO: (design choice) should we assign unique session index to each choice instance or the same session index.</span>
<a id="__codelineno-0-109" name="__codelineno-0-109"></a>            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;No `session_index` is provided, assume each choice instance is in its own session.&#39;</span><span class="p">)</span>
<a id="__codelineno-0-110" name="__codelineno-0-110"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">session_index</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">item_index</span><span class="p">))</span><span class="o">.</span><span class="n">long</span><span class="p">()</span>
<a id="__codelineno-0-111" name="__codelineno-0-111"></a>
<a id="__codelineno-0-112" name="__codelineno-0-112"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">item_availability</span> <span class="o">=</span> <span class="n">item_availability</span>
<a id="__codelineno-0-113" name="__codelineno-0-113"></a>
<a id="__codelineno-0-114" name="__codelineno-0-114"></a>        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
<a id="__codelineno-0-115" name="__codelineno-0-115"></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_is_attribute</span><span class="p">(</span><span class="n">key</span><span class="p">):</span>
<a id="__codelineno-0-116" name="__codelineno-0-116"></a>                <span class="c1"># all observable should be float.</span>
<a id="__codelineno-0-117" name="__codelineno-0-117"></a>                <span class="n">item</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">float</span><span class="p">()</span>
<a id="__codelineno-0-118" name="__codelineno-0-118"></a>            <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">item</span><span class="p">)</span>
<a id="__codelineno-0-119" name="__codelineno-0-119"></a>
<a id="__codelineno-0-120" name="__codelineno-0-120"></a>        <span class="c1"># TODO: add a validation procedure to check the consistency of the dataset.</span>
<a id="__codelineno-0-121" name="__codelineno-0-121"></a>
<a id="__codelineno-0-122" name="__codelineno-0-122"></a>    <span class="k">def</span> <span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">indices</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n">torch</span><span class="o">.</span><span class="n">LongTensor</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="s2">&quot;ChoiceDataset&quot;</span><span class="p">:</span>
<a id="__codelineno-0-123" name="__codelineno-0-123"></a>        <span class="sd">&quot;&quot;&quot;Retrieves samples corresponding to the provided index or list of indices.</span>
<a id="__codelineno-0-124" name="__codelineno-0-124"></a>
<a id="__codelineno-0-125" name="__codelineno-0-125"></a><span class="sd">        Args:</span>
<a id="__codelineno-0-126" name="__codelineno-0-126"></a><span class="sd">            indices (Union[int, torch.LongTensor]): a single integer index or a tensor of indices.</span>
<a id="__codelineno-0-127" name="__codelineno-0-127"></a>
<a id="__codelineno-0-128" name="__codelineno-0-128"></a><span class="sd">        Returns:</span>
<a id="__codelineno-0-129" name="__codelineno-0-129"></a><span class="sd">            ChoiceDataset: a subset of the dataset.</span>
<a id="__codelineno-0-130" name="__codelineno-0-130"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-131" name="__codelineno-0-131"></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">indices</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
<a id="__codelineno-0-132" name="__codelineno-0-132"></a>            <span class="c1"># convert single integer index to an array of indices.</span>
<a id="__codelineno-0-133" name="__codelineno-0-133"></a>            <span class="n">indices</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">LongTensor</span><span class="p">([</span><span class="n">indices</span><span class="p">])</span>
<a id="__codelineno-0-134" name="__codelineno-0-134"></a>        <span class="n">new_dict</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
<a id="__codelineno-0-135" name="__codelineno-0-135"></a>        <span class="n">new_dict</span><span class="p">[</span><span class="s1">&#39;item_index&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">item_index</span><span class="p">[</span><span class="n">indices</span><span class="p">]</span><span class="o">.</span><span class="n">clone</span><span class="p">()</span>
<a id="__codelineno-0-136" name="__codelineno-0-136"></a>
<a id="__codelineno-0-137" name="__codelineno-0-137"></a>        <span class="c1"># copy optional attributes.</span>
<a id="__codelineno-0-138" name="__codelineno-0-138"></a>        <span class="n">new_dict</span><span class="p">[</span><span class="s1">&#39;label&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">label</span><span class="p">[</span><span class="n">indices</span><span class="p">]</span><span class="o">.</span><span class="n">clone</span><span class="p">()</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">label</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="kc">None</span>
<a id="__codelineno-0-139" name="__codelineno-0-139"></a>        <span class="n">new_dict</span><span class="p">[</span><span class="s1">&#39;user_index&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">user_index</span><span class="p">[</span><span class="n">indices</span><span class="p">]</span><span class="o">.</span><span class="n">clone</span><span class="p">()</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">user_index</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="kc">None</span>
<a id="__codelineno-0-140" name="__codelineno-0-140"></a>        <span class="n">new_dict</span><span class="p">[</span><span class="s1">&#39;session_index&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">session_index</span><span class="p">[</span><span class="n">indices</span><span class="p">]</span><span class="o">.</span><span class="n">clone</span><span class="p">()</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">session_index</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="kc">None</span>
<a id="__codelineno-0-141" name="__codelineno-0-141"></a>        <span class="c1"># item_availability has shape (num_sessions, num_items), no need to re-index it.</span>
<a id="__codelineno-0-142" name="__codelineno-0-142"></a>        <span class="n">new_dict</span><span class="p">[</span><span class="s1">&#39;item_availability&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">item_availability</span>
<a id="__codelineno-0-143" name="__codelineno-0-143"></a>
<a id="__codelineno-0-144" name="__codelineno-0-144"></a>        <span class="c1"># copy other attributes.</span>
<a id="__codelineno-0-145" name="__codelineno-0-145"></a>        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
<a id="__codelineno-0-146" name="__codelineno-0-146"></a>            <span class="k">if</span> <span class="n">key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">new_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
<a id="__codelineno-0-147" name="__codelineno-0-147"></a>                <span class="k">if</span> <span class="n">torch</span><span class="o">.</span><span class="n">is_tensor</span><span class="p">(</span><span class="n">val</span><span class="p">):</span>
<a id="__codelineno-0-148" name="__codelineno-0-148"></a>                    <span class="n">new_dict</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">val</span><span class="o">.</span><span class="n">clone</span><span class="p">()</span>
<a id="__codelineno-0-149" name="__codelineno-0-149"></a>                <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-150" name="__codelineno-0-150"></a>                    <span class="n">new_dict</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>
<a id="__codelineno-0-151" name="__codelineno-0-151"></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_from_dict</span><span class="p">(</span><span class="n">new_dict</span><span class="p">)</span>
<a id="__codelineno-0-152" name="__codelineno-0-152"></a>
<a id="__codelineno-0-153" name="__codelineno-0-153"></a>    <span class="k">def</span> <span class="fm">__len__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<a id="__codelineno-0-154" name="__codelineno-0-154"></a>        <span class="sd">&quot;&quot;&quot;Returns number of samples in this dataset.</span>
<a id="__codelineno-0-155" name="__codelineno-0-155"></a>
<a id="__codelineno-0-156" name="__codelineno-0-156"></a><span class="sd">        Returns:</span>
<a id="__codelineno-0-157" name="__codelineno-0-157"></a><span class="sd">            int: length of the dataset.</span>
<a id="__codelineno-0-158" name="__codelineno-0-158"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-159" name="__codelineno-0-159"></a>        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">item_index</span><span class="p">)</span>
<a id="__codelineno-0-160" name="__codelineno-0-160"></a>
<a id="__codelineno-0-161" name="__codelineno-0-161"></a>    <span class="k">def</span> <span class="fm">__contains__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<a id="__codelineno-0-162" name="__codelineno-0-162"></a>        <span class="k">return</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">keys</span>
<a id="__codelineno-0-163" name="__codelineno-0-163"></a>
<a id="__codelineno-0-164" name="__codelineno-0-164"></a>    <span class="k">def</span> <span class="fm">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">:</span> <span class="s2">&quot;ChoiceDataset&quot;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<a id="__codelineno-0-165" name="__codelineno-0-165"></a>        <span class="sd">&quot;&quot;&quot;Returns whether all tensor attributes of both ChoiceDatasets are equal.&quot;&quot;&quot;</span>
<a id="__codelineno-0-166" name="__codelineno-0-166"></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">ChoiceDataset</span><span class="p">):</span>
<a id="__codelineno-0-167" name="__codelineno-0-167"></a>            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;You can only compare with ChoiceDataset objects.&#39;</span><span class="p">)</span>
<a id="__codelineno-0-168" name="__codelineno-0-168"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-169" name="__codelineno-0-169"></a>            <span class="n">flag</span> <span class="o">=</span> <span class="kc">True</span>
<a id="__codelineno-0-170" name="__codelineno-0-170"></a>            <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
<a id="__codelineno-0-171" name="__codelineno-0-171"></a>                <span class="k">if</span> <span class="n">torch</span><span class="o">.</span><span class="n">is_tensor</span><span class="p">(</span><span class="n">val</span><span class="p">):</span>
<a id="__codelineno-0-172" name="__codelineno-0-172"></a>                    <span class="c1"># ignore NaNs while comparing.</span>
<a id="__codelineno-0-173" name="__codelineno-0-173"></a>                    <span class="k">if</span> <span class="ow">not</span> <span class="n">torch</span><span class="o">.</span><span class="n">equal</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">nan_to_num</span><span class="p">(</span><span class="n">val</span><span class="p">),</span> <span class="n">torch</span><span class="o">.</span><span class="n">nan_to_num</span><span class="p">(</span><span class="n">other</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">[</span><span class="n">key</span><span class="p">])):</span>
<a id="__codelineno-0-174" name="__codelineno-0-174"></a>                        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Attribute </span><span class="si">{}</span><span class="s1"> is not equal.&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">key</span><span class="p">))</span>
<a id="__codelineno-0-175" name="__codelineno-0-175"></a>                        <span class="n">flag</span> <span class="o">=</span> <span class="kc">False</span>
<a id="__codelineno-0-176" name="__codelineno-0-176"></a>            <span class="k">return</span> <span class="n">flag</span>
<a id="__codelineno-0-177" name="__codelineno-0-177"></a>
<a id="__codelineno-0-178" name="__codelineno-0-178"></a>    <span class="nd">@property</span>
<a id="__codelineno-0-179" name="__codelineno-0-179"></a>    <span class="k">def</span> <span class="nf">device</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<a id="__codelineno-0-180" name="__codelineno-0-180"></a>        <span class="sd">&quot;&quot;&quot;Returns the device of the dataset.</span>
<a id="__codelineno-0-181" name="__codelineno-0-181"></a>
<a id="__codelineno-0-182" name="__codelineno-0-182"></a><span class="sd">        Returns:</span>
<a id="__codelineno-0-183" name="__codelineno-0-183"></a><span class="sd">            str: the device of the dataset.</span>
<a id="__codelineno-0-184" name="__codelineno-0-184"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-185" name="__codelineno-0-185"></a>        <span class="k">for</span> <span class="n">attr</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
<a id="__codelineno-0-186" name="__codelineno-0-186"></a>            <span class="k">if</span> <span class="n">torch</span><span class="o">.</span><span class="n">is_tensor</span><span class="p">(</span><span class="n">attr</span><span class="p">):</span>
<a id="__codelineno-0-187" name="__codelineno-0-187"></a>                <span class="k">return</span> <span class="n">attr</span><span class="o">.</span><span class="n">device</span>
<a id="__codelineno-0-188" name="__codelineno-0-188"></a>
<a id="__codelineno-0-189" name="__codelineno-0-189"></a>    <span class="nd">@property</span>
<a id="__codelineno-0-190" name="__codelineno-0-190"></a>    <span class="k">def</span> <span class="nf">num_users</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<a id="__codelineno-0-191" name="__codelineno-0-191"></a>        <span class="sd">&quot;&quot;&quot;Returns number of users involved in this dataset, returns 1 if there is no user identity.</span>
<a id="__codelineno-0-192" name="__codelineno-0-192"></a>
<a id="__codelineno-0-193" name="__codelineno-0-193"></a><span class="sd">        Returns:</span>
<a id="__codelineno-0-194" name="__codelineno-0-194"></a><span class="sd">            int: the number of users involved in this dataset.</span>
<a id="__codelineno-0-195" name="__codelineno-0-195"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-196" name="__codelineno-0-196"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_num_users</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-197" name="__codelineno-0-197"></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_num_users</span>
<a id="__codelineno-0-198" name="__codelineno-0-198"></a>        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">user_index</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-199" name="__codelineno-0-199"></a>            <span class="c1"># infer from the number of unique items in  user_index.</span>
<a id="__codelineno-0-200" name="__codelineno-0-200"></a>            <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">user_index</span><span class="p">))</span>
<a id="__codelineno-0-201" name="__codelineno-0-201"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-202" name="__codelineno-0-202"></a>            <span class="k">return</span> <span class="mi">1</span>
<a id="__codelineno-0-203" name="__codelineno-0-203"></a>
<a id="__codelineno-0-204" name="__codelineno-0-204"></a>        <span class="c1"># for key, val in self.__dict__.items():</span>
<a id="__codelineno-0-205" name="__codelineno-0-205"></a>        <span class="c1">#     if torch.is_tensor(val):</span>
<a id="__codelineno-0-206" name="__codelineno-0-206"></a>        <span class="c1">#         if self._is_user_attribute(key) or self._is_taste_attribute(key):</span>
<a id="__codelineno-0-207" name="__codelineno-0-207"></a>        <span class="c1">#             return val.shape[0]</span>
<a id="__codelineno-0-208" name="__codelineno-0-208"></a>        <span class="c1"># return 1</span>
<a id="__codelineno-0-209" name="__codelineno-0-209"></a>
<a id="__codelineno-0-210" name="__codelineno-0-210"></a>    <span class="nd">@property</span>
<a id="__codelineno-0-211" name="__codelineno-0-211"></a>    <span class="k">def</span> <span class="nf">num_items</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<a id="__codelineno-0-212" name="__codelineno-0-212"></a>        <span class="sd">&quot;&quot;&quot;Returns the number of items involved in this dataset.</span>
<a id="__codelineno-0-213" name="__codelineno-0-213"></a>
<a id="__codelineno-0-214" name="__codelineno-0-214"></a><span class="sd">        Returns:</span>
<a id="__codelineno-0-215" name="__codelineno-0-215"></a><span class="sd">            int: the number of items involved in this dataset.</span>
<a id="__codelineno-0-216" name="__codelineno-0-216"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-217" name="__codelineno-0-217"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_num_items</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-218" name="__codelineno-0-218"></a>            <span class="c1"># return the _num_items provided in the constructor.</span>
<a id="__codelineno-0-219" name="__codelineno-0-219"></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_num_items</span>
<a id="__codelineno-0-220" name="__codelineno-0-220"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-221" name="__codelineno-0-221"></a>            <span class="c1"># infer the number of items from item_index.</span>
<a id="__codelineno-0-222" name="__codelineno-0-222"></a>            <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">item_index</span><span class="p">))</span>
<a id="__codelineno-0-223" name="__codelineno-0-223"></a>
<a id="__codelineno-0-224" name="__codelineno-0-224"></a>        <span class="c1"># for key, val in self.__dict__.items():</span>
<a id="__codelineno-0-225" name="__codelineno-0-225"></a>        <span class="c1">#     if torch.is_tensor(val):</span>
<a id="__codelineno-0-226" name="__codelineno-0-226"></a>        <span class="c1">#         if self._is_item_attribute(key):</span>
<a id="__codelineno-0-227" name="__codelineno-0-227"></a>        <span class="c1">#             return val.shape[0]</span>
<a id="__codelineno-0-228" name="__codelineno-0-228"></a>        <span class="c1">#         elif self._is_taste_attribute(key) or self._is_price_attribute(key):</span>
<a id="__codelineno-0-229" name="__codelineno-0-229"></a>        <span class="c1">#             return val.shape[1]</span>
<a id="__codelineno-0-230" name="__codelineno-0-230"></a>        <span class="c1"># return 1</span>
<a id="__codelineno-0-231" name="__codelineno-0-231"></a>
<a id="__codelineno-0-232" name="__codelineno-0-232"></a>    <span class="nd">@property</span>
<a id="__codelineno-0-233" name="__codelineno-0-233"></a>    <span class="k">def</span> <span class="nf">num_sessions</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<a id="__codelineno-0-234" name="__codelineno-0-234"></a>        <span class="sd">&quot;&quot;&quot;Returns the number of sessions involved in this dataset.</span>
<a id="__codelineno-0-235" name="__codelineno-0-235"></a>
<a id="__codelineno-0-236" name="__codelineno-0-236"></a><span class="sd">        Returns:</span>
<a id="__codelineno-0-237" name="__codelineno-0-237"></a><span class="sd">            int: the number of sessions involved in this dataset.</span>
<a id="__codelineno-0-238" name="__codelineno-0-238"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-239" name="__codelineno-0-239"></a>        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">session_index</span><span class="p">))</span>
<a id="__codelineno-0-240" name="__codelineno-0-240"></a>
<a id="__codelineno-0-241" name="__codelineno-0-241"></a>        <span class="c1"># if self.session_index is None:</span>
<a id="__codelineno-0-242" name="__codelineno-0-242"></a>        <span class="c1">#     return 1</span>
<a id="__codelineno-0-243" name="__codelineno-0-243"></a>
<a id="__codelineno-0-244" name="__codelineno-0-244"></a>        <span class="c1"># for key, val in self.__dict__.items():</span>
<a id="__codelineno-0-245" name="__codelineno-0-245"></a>        <span class="c1">#     if torch.is_tensor(val):</span>
<a id="__codelineno-0-246" name="__codelineno-0-246"></a>        <span class="c1">#         if self._is_session_attribute(key) or self._is_price_attribute(key):</span>
<a id="__codelineno-0-247" name="__codelineno-0-247"></a>        <span class="c1">#             return val.shape[0]</span>
<a id="__codelineno-0-248" name="__codelineno-0-248"></a>        <span class="c1"># return 1</span>
<a id="__codelineno-0-249" name="__codelineno-0-249"></a>
<a id="__codelineno-0-250" name="__codelineno-0-250"></a>    <span class="nd">@property</span>
<a id="__codelineno-0-251" name="__codelineno-0-251"></a>    <span class="k">def</span> <span class="nf">x_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">object</span><span class="p">,</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">]:</span>
<a id="__codelineno-0-252" name="__codelineno-0-252"></a>        <span class="sd">&quot;&quot;&quot;Formats attributes of in this dataset into shape (num_sessions, num_items, num_params) and returns in a dictionary format.</span>
<a id="__codelineno-0-253" name="__codelineno-0-253"></a><span class="sd">        Models in this package are expecting this dictionary based data format.</span>
<a id="__codelineno-0-254" name="__codelineno-0-254"></a>
<a id="__codelineno-0-255" name="__codelineno-0-255"></a><span class="sd">        Returns:</span>
<a id="__codelineno-0-256" name="__codelineno-0-256"></a><span class="sd">            Dict[object, torch.Tensor]: a dictionary with attribute names in the dataset as keys, and reshaped attribute</span>
<a id="__codelineno-0-257" name="__codelineno-0-257"></a><span class="sd">                tensors as values.</span>
<a id="__codelineno-0-258" name="__codelineno-0-258"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-259" name="__codelineno-0-259"></a>        <span class="n">out</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
<a id="__codelineno-0-260" name="__codelineno-0-260"></a>        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
<a id="__codelineno-0-261" name="__codelineno-0-261"></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_is_attribute</span><span class="p">(</span><span class="n">key</span><span class="p">):</span>  <span class="c1"># only include attributes.</span>
<a id="__codelineno-0-262" name="__codelineno-0-262"></a>                <span class="n">out</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_expand_tensor</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">val</span><span class="p">)</span>  <span class="c1"># reshape to (num_sessions, num_items, num_params).</span>
<a id="__codelineno-0-263" name="__codelineno-0-263"></a>        <span class="k">return</span> <span class="n">out</span>
<a id="__codelineno-0-264" name="__codelineno-0-264"></a>
<a id="__codelineno-0-265" name="__codelineno-0-265"></a>    <span class="nd">@classmethod</span>
<a id="__codelineno-0-266" name="__codelineno-0-266"></a>    <span class="k">def</span> <span class="nf">_from_dict</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">dictionary</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="s2">&quot;ChoiceDataset&quot;</span><span class="p">:</span>
<a id="__codelineno-0-267" name="__codelineno-0-267"></a>        <span class="sd">&quot;&quot;&quot;Creates an instance of ChoiceDataset from a dictionary of arguments.</span>
<a id="__codelineno-0-268" name="__codelineno-0-268"></a>
<a id="__codelineno-0-269" name="__codelineno-0-269"></a><span class="sd">        Args:</span>
<a id="__codelineno-0-270" name="__codelineno-0-270"></a><span class="sd">            dictionary (Dict[str, torch.tensor]): a dictionary with keys as argument names and values as arguments.</span>
<a id="__codelineno-0-271" name="__codelineno-0-271"></a>
<a id="__codelineno-0-272" name="__codelineno-0-272"></a><span class="sd">        Returns:</span>
<a id="__codelineno-0-273" name="__codelineno-0-273"></a><span class="sd">            ChoiceDataset: the created copy of dataset.</span>
<a id="__codelineno-0-274" name="__codelineno-0-274"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-275" name="__codelineno-0-275"></a>        <span class="n">dataset</span> <span class="o">=</span> <span class="bp">cls</span><span class="p">(</span><span class="o">**</span><span class="n">dictionary</span><span class="p">)</span>
<a id="__codelineno-0-276" name="__codelineno-0-276"></a>        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">dictionary</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
<a id="__codelineno-0-277" name="__codelineno-0-277"></a>            <span class="nb">setattr</span><span class="p">(</span><span class="n">dataset</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">item</span><span class="p">)</span>
<a id="__codelineno-0-278" name="__codelineno-0-278"></a>        <span class="k">return</span> <span class="n">dataset</span>
<a id="__codelineno-0-279" name="__codelineno-0-279"></a>
<a id="__codelineno-0-280" name="__codelineno-0-280"></a>    <span class="k">def</span> <span class="nf">apply_tensor</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">func</span><span class="p">:</span> <span class="n">callable</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;ChoiceDataset&quot;</span><span class="p">:</span>
<a id="__codelineno-0-281" name="__codelineno-0-281"></a>        <span class="sd">&quot;&quot;&quot;This s a helper method to apply the provided function to all tensors and tensor values of all dictionaries.</span>
<a id="__codelineno-0-282" name="__codelineno-0-282"></a>
<a id="__codelineno-0-283" name="__codelineno-0-283"></a><span class="sd">        Args:</span>
<a id="__codelineno-0-284" name="__codelineno-0-284"></a><span class="sd">            func (callable): a callable function to be applied on tensors and tensor-values of dictionaries.</span>
<a id="__codelineno-0-285" name="__codelineno-0-285"></a>
<a id="__codelineno-0-286" name="__codelineno-0-286"></a><span class="sd">        Returns:</span>
<a id="__codelineno-0-287" name="__codelineno-0-287"></a><span class="sd">            ChoiceDataset: the modified dataset.</span>
<a id="__codelineno-0-288" name="__codelineno-0-288"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-289" name="__codelineno-0-289"></a>        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">item</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
<a id="__codelineno-0-290" name="__codelineno-0-290"></a>            <span class="k">if</span> <span class="n">torch</span><span class="o">.</span><span class="n">is_tensor</span><span class="p">(</span><span class="n">item</span><span class="p">):</span>
<a id="__codelineno-0-291" name="__codelineno-0-291"></a>                <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">func</span><span class="p">(</span><span class="n">item</span><span class="p">))</span>
<a id="__codelineno-0-292" name="__codelineno-0-292"></a>            <span class="c1"># boardcast func to dictionary of tensors as well.</span>
<a id="__codelineno-0-293" name="__codelineno-0-293"></a>            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">),</span> <span class="nb">dict</span><span class="p">):</span>
<a id="__codelineno-0-294" name="__codelineno-0-294"></a>                <span class="k">for</span> <span class="n">obj_key</span><span class="p">,</span> <span class="n">obj_item</span> <span class="ow">in</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">)</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
<a id="__codelineno-0-295" name="__codelineno-0-295"></a>                    <span class="k">if</span> <span class="n">torch</span><span class="o">.</span><span class="n">is_tensor</span><span class="p">(</span><span class="n">obj_item</span><span class="p">):</span>
<a id="__codelineno-0-296" name="__codelineno-0-296"></a>                        <span class="nb">setattr</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">),</span> <span class="n">obj_key</span><span class="p">,</span> <span class="n">func</span><span class="p">(</span><span class="n">obj_item</span><span class="p">))</span>
<a id="__codelineno-0-297" name="__codelineno-0-297"></a>        <span class="k">return</span> <span class="bp">self</span>
<a id="__codelineno-0-298" name="__codelineno-0-298"></a>
<a id="__codelineno-0-299" name="__codelineno-0-299"></a>    <span class="k">def</span> <span class="nf">to</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">device</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">torch</span><span class="o">.</span><span class="n">device</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="s2">&quot;ChoiceDataset&quot;</span><span class="p">:</span>
<a id="__codelineno-0-300" name="__codelineno-0-300"></a>        <span class="sd">&quot;&quot;&quot;Moves all tensors in this dataset to the specified PyTorch device.</span>
<a id="__codelineno-0-301" name="__codelineno-0-301"></a>
<a id="__codelineno-0-302" name="__codelineno-0-302"></a><span class="sd">        Args:</span>
<a id="__codelineno-0-303" name="__codelineno-0-303"></a><span class="sd">            device (Union[str, torch.device]): the destination device.</span>
<a id="__codelineno-0-304" name="__codelineno-0-304"></a>
<a id="__codelineno-0-305" name="__codelineno-0-305"></a><span class="sd">        Returns:</span>
<a id="__codelineno-0-306" name="__codelineno-0-306"></a><span class="sd">            ChoiceDataset: the modified dataset on the new device.</span>
<a id="__codelineno-0-307" name="__codelineno-0-307"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-308" name="__codelineno-0-308"></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">apply_tensor</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">device</span><span class="p">))</span>
<a id="__codelineno-0-309" name="__codelineno-0-309"></a>
<a id="__codelineno-0-310" name="__codelineno-0-310"></a>    <span class="k">def</span> <span class="nf">clone</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;ChoiceDataset&quot;</span><span class="p">:</span>
<a id="__codelineno-0-311" name="__codelineno-0-311"></a>        <span class="sd">&quot;&quot;&quot;Creates a copy of self.</span>
<a id="__codelineno-0-312" name="__codelineno-0-312"></a>
<a id="__codelineno-0-313" name="__codelineno-0-313"></a><span class="sd">        Returns:</span>
<a id="__codelineno-0-314" name="__codelineno-0-314"></a><span class="sd">            ChoiceDataset: a copy of self.</span>
<a id="__codelineno-0-315" name="__codelineno-0-315"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-316" name="__codelineno-0-316"></a>        <span class="n">dictionary</span> <span class="o">=</span> <span class="p">{}</span>
<a id="__codelineno-0-317" name="__codelineno-0-317"></a>        <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
<a id="__codelineno-0-318" name="__codelineno-0-318"></a>            <span class="k">if</span> <span class="n">torch</span><span class="o">.</span><span class="n">is_tensor</span><span class="p">(</span><span class="n">v</span><span class="p">):</span>
<a id="__codelineno-0-319" name="__codelineno-0-319"></a>                <span class="n">dictionary</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span><span class="o">.</span><span class="n">clone</span><span class="p">()</span>
<a id="__codelineno-0-320" name="__codelineno-0-320"></a>            <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-321" name="__codelineno-0-321"></a>                <span class="n">dictionary</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
<a id="__codelineno-0-322" name="__codelineno-0-322"></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="n">_from_dict</span><span class="p">(</span><span class="n">dictionary</span><span class="p">)</span>
<a id="__codelineno-0-323" name="__codelineno-0-323"></a>
<a id="__codelineno-0-324" name="__codelineno-0-324"></a>    <span class="k">def</span> <span class="nf">_check_device_consistency</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-325" name="__codelineno-0-325"></a>        <span class="sd">&quot;&quot;&quot;Checks if all tensors in this dataset are on the same device.</span>
<a id="__codelineno-0-326" name="__codelineno-0-326"></a>
<a id="__codelineno-0-327" name="__codelineno-0-327"></a><span class="sd">        Raises:</span>
<a id="__codelineno-0-328" name="__codelineno-0-328"></a><span class="sd">            Exception: an exception is raised if not all tensors are on the same device.</span>
<a id="__codelineno-0-329" name="__codelineno-0-329"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-330" name="__codelineno-0-330"></a>        <span class="c1"># assert all tensors are on the same device.</span>
<a id="__codelineno-0-331" name="__codelineno-0-331"></a>        <span class="n">devices</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
<a id="__codelineno-0-332" name="__codelineno-0-332"></a>        <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
<a id="__codelineno-0-333" name="__codelineno-0-333"></a>            <span class="k">if</span> <span class="n">torch</span><span class="o">.</span><span class="n">is_tensor</span><span class="p">(</span><span class="n">val</span><span class="p">):</span>
<a id="__codelineno-0-334" name="__codelineno-0-334"></a>                <span class="n">devices</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">val</span><span class="o">.</span><span class="n">device</span><span class="p">)</span>
<a id="__codelineno-0-335" name="__codelineno-0-335"></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">devices</span><span class="p">))</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
<a id="__codelineno-0-336" name="__codelineno-0-336"></a>            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Found tensors on different devices: </span><span class="si">{</span><span class="nb">set</span><span class="p">(</span><span class="n">devices</span><span class="p">)</span><span class="si">}</span><span class="s1">.&#39;</span><span class="p">,</span>
<a id="__codelineno-0-337" name="__codelineno-0-337"></a>                            <span class="s1">&#39;Use dataset.to() method to align devices.&#39;</span><span class="p">)</span>
<a id="__codelineno-0-338" name="__codelineno-0-338"></a>
<a id="__codelineno-0-339" name="__codelineno-0-339"></a>    <span class="k">def</span> <span class="nf">_size_repr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="nb">object</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">]:</span>
<a id="__codelineno-0-340" name="__codelineno-0-340"></a>        <span class="sd">&quot;&quot;&quot;A helper method to get the string-representation of object sizes, this is helpful while constructing the</span>
<a id="__codelineno-0-341" name="__codelineno-0-341"></a><span class="sd">        string representation of the dataset.</span>
<a id="__codelineno-0-342" name="__codelineno-0-342"></a>
<a id="__codelineno-0-343" name="__codelineno-0-343"></a><span class="sd">        Args:</span>
<a id="__codelineno-0-344" name="__codelineno-0-344"></a><span class="sd">            value (object): an object to examine its size.</span>
<a id="__codelineno-0-345" name="__codelineno-0-345"></a>
<a id="__codelineno-0-346" name="__codelineno-0-346"></a><span class="sd">        Returns:</span>
<a id="__codelineno-0-347" name="__codelineno-0-347"></a><span class="sd">            List[int]: list of integers representing the size of the object, length of the list is equal to dimension of `value`.</span>
<a id="__codelineno-0-348" name="__codelineno-0-348"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-349" name="__codelineno-0-349"></a>        <span class="k">if</span> <span class="n">torch</span><span class="o">.</span><span class="n">is_tensor</span><span class="p">(</span><span class="n">value</span><span class="p">):</span>
<a id="__codelineno-0-350" name="__codelineno-0-350"></a>            <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="n">value</span><span class="o">.</span><span class="n">size</span><span class="p">())</span>
<a id="__codelineno-0-351" name="__codelineno-0-351"></a>        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">int</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">float</span><span class="p">):</span>
<a id="__codelineno-0-352" name="__codelineno-0-352"></a>            <span class="k">return</span> <span class="p">[</span><span class="mi">1</span><span class="p">]</span>
<a id="__codelineno-0-353" name="__codelineno-0-353"></a>        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">):</span>
<a id="__codelineno-0-354" name="__codelineno-0-354"></a>            <span class="k">return</span> <span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">value</span><span class="p">)]</span>
<a id="__codelineno-0-355" name="__codelineno-0-355"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-356" name="__codelineno-0-356"></a>            <span class="k">return</span> <span class="p">[]</span>
<a id="__codelineno-0-357" name="__codelineno-0-357"></a>
<a id="__codelineno-0-358" name="__codelineno-0-358"></a>    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<a id="__codelineno-0-359" name="__codelineno-0-359"></a>        <span class="sd">&quot;&quot;&quot;A method to get a string representation of the dataset.</span>
<a id="__codelineno-0-360" name="__codelineno-0-360"></a>
<a id="__codelineno-0-361" name="__codelineno-0-361"></a><span class="sd">        Returns:</span>
<a id="__codelineno-0-362" name="__codelineno-0-362"></a><span class="sd">            str: the string representation of the dataset.</span>
<a id="__codelineno-0-363" name="__codelineno-0-363"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-364" name="__codelineno-0-364"></a>        <span class="c1"># don&#39;t print shapes of internal attributes like _num_users and _num_items.</span>
<a id="__codelineno-0-365" name="__codelineno-0-365"></a>        <span class="n">info</span> <span class="o">=</span> <span class="p">[</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s1">=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_size_repr</span><span class="p">(</span><span class="n">item</span><span class="p">)</span><span class="si">}</span><span class="s1">&#39;</span> <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">item</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">key</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">)]</span>
<a id="__codelineno-0-366" name="__codelineno-0-366"></a>        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">(</span><span class="si">{</span><span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">info</span><span class="p">)</span><span class="si">}</span><span class="s2">, device=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="si">}</span><span class="s2">)&quot;</span>
<a id="__codelineno-0-367" name="__codelineno-0-367"></a>
<a id="__codelineno-0-368" name="__codelineno-0-368"></a>    <span class="c1"># ==================================================================================================================</span>
<a id="__codelineno-0-369" name="__codelineno-0-369"></a>    <span class="c1"># methods for checking attribute categories.</span>
<a id="__codelineno-0-370" name="__codelineno-0-370"></a>    <span class="c1"># ==================================================================================================================</span>
<a id="__codelineno-0-371" name="__codelineno-0-371"></a>    <span class="nd">@staticmethod</span>
<a id="__codelineno-0-372" name="__codelineno-0-372"></a>    <span class="k">def</span> <span class="nf">_is_item_attribute</span><span class="p">(</span><span class="n">key</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<a id="__codelineno-0-373" name="__codelineno-0-373"></a>        <span class="k">return</span> <span class="n">key</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;item_&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">key</span> <span class="o">!=</span> <span class="s1">&#39;item_availability&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">key</span> <span class="o">!=</span> <span class="s1">&#39;item_index&#39;</span><span class="p">)</span>
<a id="__codelineno-0-374" name="__codelineno-0-374"></a>
<a id="__codelineno-0-375" name="__codelineno-0-375"></a>    <span class="nd">@staticmethod</span>
<a id="__codelineno-0-376" name="__codelineno-0-376"></a>    <span class="k">def</span> <span class="nf">_is_user_attribute</span><span class="p">(</span><span class="n">key</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<a id="__codelineno-0-377" name="__codelineno-0-377"></a>        <span class="k">return</span> <span class="n">key</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;user_&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">key</span> <span class="o">!=</span> <span class="s1">&#39;user_index&#39;</span><span class="p">)</span>
<a id="__codelineno-0-378" name="__codelineno-0-378"></a>
<a id="__codelineno-0-379" name="__codelineno-0-379"></a>    <span class="nd">@staticmethod</span>
<a id="__codelineno-0-380" name="__codelineno-0-380"></a>    <span class="k">def</span> <span class="nf">_is_session_attribute</span><span class="p">(</span><span class="n">key</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<a id="__codelineno-0-381" name="__codelineno-0-381"></a>        <span class="k">return</span> <span class="n">key</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;session_&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">key</span> <span class="o">!=</span> <span class="s1">&#39;session_index&#39;</span><span class="p">)</span>
<a id="__codelineno-0-382" name="__codelineno-0-382"></a>
<a id="__codelineno-0-383" name="__codelineno-0-383"></a>    <span class="nd">@staticmethod</span>
<a id="__codelineno-0-384" name="__codelineno-0-384"></a>    <span class="k">def</span> <span class="nf">_is_taste_attribute</span><span class="p">(</span><span class="n">key</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<a id="__codelineno-0-385" name="__codelineno-0-385"></a>        <span class="k">return</span> <span class="n">key</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;taste_&#39;</span><span class="p">)</span>
<a id="__codelineno-0-386" name="__codelineno-0-386"></a>
<a id="__codelineno-0-387" name="__codelineno-0-387"></a>    <span class="nd">@staticmethod</span>
<a id="__codelineno-0-388" name="__codelineno-0-388"></a>    <span class="k">def</span> <span class="nf">_is_price_attribute</span><span class="p">(</span><span class="n">key</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<a id="__codelineno-0-389" name="__codelineno-0-389"></a>        <span class="k">return</span> <span class="n">key</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;price_&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">key</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;itemsession_&#39;</span><span class="p">)</span>
<a id="__codelineno-0-390" name="__codelineno-0-390"></a>
<a id="__codelineno-0-391" name="__codelineno-0-391"></a>    <span class="k">def</span> <span class="nf">_is_attribute</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<a id="__codelineno-0-392" name="__codelineno-0-392"></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_is_item_attribute</span><span class="p">(</span><span class="n">key</span><span class="p">)</span> \
<a id="__codelineno-0-393" name="__codelineno-0-393"></a>            <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">_is_user_attribute</span><span class="p">(</span><span class="n">key</span><span class="p">)</span> \
<a id="__codelineno-0-394" name="__codelineno-0-394"></a>            <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">_is_session_attribute</span><span class="p">(</span><span class="n">key</span><span class="p">)</span> \
<a id="__codelineno-0-395" name="__codelineno-0-395"></a>            <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">_is_taste_attribute</span><span class="p">(</span><span class="n">key</span><span class="p">)</span> \
<a id="__codelineno-0-396" name="__codelineno-0-396"></a>            <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">_is_price_attribute</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
<a id="__codelineno-0-397" name="__codelineno-0-397"></a>
<a id="__codelineno-0-398" name="__codelineno-0-398"></a>    <span class="k">def</span> <span class="nf">_expand_tensor</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">val</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">:</span>
<a id="__codelineno-0-399" name="__codelineno-0-399"></a>        <span class="sd">&quot;&quot;&quot;Expands attribute tensor to (num_sessions, num_items, num_params) shape for prediction tasks, this method</span>
<a id="__codelineno-0-400" name="__codelineno-0-400"></a><span class="sd">        won&#39;t reshape the tensor at all if the `key` (i.e., name of the tensor) suggests its not an attribute of any kind.</span>
<a id="__codelineno-0-401" name="__codelineno-0-401"></a>
<a id="__codelineno-0-402" name="__codelineno-0-402"></a><span class="sd">        Args:</span>
<a id="__codelineno-0-403" name="__codelineno-0-403"></a><span class="sd">            key (str): name of the attribute used to determine the raw shape of the tensor. For example, &#39;item_obs&#39; means</span>
<a id="__codelineno-0-404" name="__codelineno-0-404"></a><span class="sd">                the raw tensor is in shape (num_items, num_params).</span>
<a id="__codelineno-0-405" name="__codelineno-0-405"></a><span class="sd">            val (torch.Tensor): the attribute tensor to be reshaped.</span>
<a id="__codelineno-0-406" name="__codelineno-0-406"></a>
<a id="__codelineno-0-407" name="__codelineno-0-407"></a><span class="sd">        Returns:</span>
<a id="__codelineno-0-408" name="__codelineno-0-408"></a><span class="sd">            torch.Tensor: the reshaped tensor with shape (num_sessions, num_items, num_params).</span>
<a id="__codelineno-0-409" name="__codelineno-0-409"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-410" name="__codelineno-0-410"></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_is_attribute</span><span class="p">(</span><span class="n">key</span><span class="p">):</span>
<a id="__codelineno-0-411" name="__codelineno-0-411"></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Warning: the input key </span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s1"> is not an attribute of the dataset, will NOT modify the provided tensor.&#39;</span><span class="p">)</span>
<a id="__codelineno-0-412" name="__codelineno-0-412"></a>            <span class="c1"># don&#39;t expand non-attribute tensors, if any.</span>
<a id="__codelineno-0-413" name="__codelineno-0-413"></a>            <span class="k">return</span> <span class="n">val</span>
<a id="__codelineno-0-414" name="__codelineno-0-414"></a>
<a id="__codelineno-0-415" name="__codelineno-0-415"></a>        <span class="n">num_params</span> <span class="o">=</span> <span class="n">val</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
<a id="__codelineno-0-416" name="__codelineno-0-416"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_is_user_attribute</span><span class="p">(</span><span class="n">key</span><span class="p">):</span>
<a id="__codelineno-0-417" name="__codelineno-0-417"></a>            <span class="c1"># user_attribute (num_users, *)</span>
<a id="__codelineno-0-418" name="__codelineno-0-418"></a>            <span class="n">out</span> <span class="o">=</span> <span class="n">val</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">user_index</span><span class="p">,</span> <span class="p">:]</span><span class="o">.</span><span class="n">view</span><span class="p">(</span>
<a id="__codelineno-0-419" name="__codelineno-0-419"></a>                <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">),</span> <span class="mi">1</span><span class="p">,</span> <span class="n">num_params</span><span class="p">)</span><span class="o">.</span><span class="n">expand</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_items</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-0-420" name="__codelineno-0-420"></a>        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">_is_item_attribute</span><span class="p">(</span><span class="n">key</span><span class="p">):</span>
<a id="__codelineno-0-421" name="__codelineno-0-421"></a>            <span class="c1"># item_attribute (num_items, *)</span>
<a id="__codelineno-0-422" name="__codelineno-0-422"></a>            <span class="n">out</span> <span class="o">=</span> <span class="n">val</span><span class="o">.</span><span class="n">view</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_items</span><span class="p">,</span> <span class="n">num_params</span><span class="p">)</span><span class="o">.</span><span class="n">expand</span><span class="p">(</span>
<a id="__codelineno-0-423" name="__codelineno-0-423"></a>                <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">),</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-0-424" name="__codelineno-0-424"></a>        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">_is_session_attribute</span><span class="p">(</span><span class="n">key</span><span class="p">):</span>
<a id="__codelineno-0-425" name="__codelineno-0-425"></a>            <span class="c1"># session_attribute (num_sessions, *)</span>
<a id="__codelineno-0-426" name="__codelineno-0-426"></a>            <span class="n">out</span> <span class="o">=</span> <span class="n">val</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">session_index</span><span class="p">,</span> <span class="p">:]</span><span class="o">.</span><span class="n">view</span><span class="p">(</span>
<a id="__codelineno-0-427" name="__codelineno-0-427"></a>                <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">),</span> <span class="mi">1</span><span class="p">,</span> <span class="n">num_params</span><span class="p">)</span><span class="o">.</span><span class="n">expand</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_items</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-0-428" name="__codelineno-0-428"></a>        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">_is_taste_attribute</span><span class="p">(</span><span class="n">key</span><span class="p">):</span>
<a id="__codelineno-0-429" name="__codelineno-0-429"></a>            <span class="c1"># taste_attribute (num_users, num_items, *)</span>
<a id="__codelineno-0-430" name="__codelineno-0-430"></a>            <span class="n">out</span> <span class="o">=</span> <span class="n">val</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">user_index</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:]</span>
<a id="__codelineno-0-431" name="__codelineno-0-431"></a>        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">_is_price_attribute</span><span class="p">(</span><span class="n">key</span><span class="p">):</span>
<a id="__codelineno-0-432" name="__codelineno-0-432"></a>            <span class="c1"># price_attribute (num_sessions, num_items, *)</span>
<a id="__codelineno-0-433" name="__codelineno-0-433"></a>            <span class="n">out</span> <span class="o">=</span> <span class="n">val</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">session_index</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:]</span>
<a id="__codelineno-0-434" name="__codelineno-0-434"></a>
<a id="__codelineno-0-435" name="__codelineno-0-435"></a>        <span class="k">assert</span> <span class="n">out</span><span class="o">.</span><span class="n">shape</span> <span class="o">==</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_items</span><span class="p">,</span> <span class="n">num_params</span><span class="p">)</span>
<a id="__codelineno-0-436" name="__codelineno-0-436"></a>        <span class="k">return</span> <span class="n">out</span>
<a id="__codelineno-0-437" name="__codelineno-0-437"></a>
<a id="__codelineno-0-438" name="__codelineno-0-438"></a>    <span class="nd">@staticmethod</span>
<a id="__codelineno-0-439" name="__codelineno-0-439"></a>    <span class="k">def</span> <span class="nf">unique</span><span class="p">(</span><span class="n">tensor</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]:</span>
<a id="__codelineno-0-440" name="__codelineno-0-440"></a>        <span class="n">arr</span> <span class="o">=</span> <span class="n">tensor</span><span class="o">.</span><span class="n">cpu</span><span class="p">()</span><span class="o">.</span><span class="n">numpy</span><span class="p">()</span>
<a id="__codelineno-0-441" name="__codelineno-0-441"></a>        <span class="n">unique</span><span class="p">,</span> <span class="n">counts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">arr</span><span class="p">,</span> <span class="n">return_counts</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<a id="__codelineno-0-442" name="__codelineno-0-442"></a>        <span class="n">count_sort_ind</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="o">-</span><span class="n">counts</span><span class="p">)</span>
<a id="__codelineno-0-443" name="__codelineno-0-443"></a>        <span class="n">unique</span> <span class="o">=</span> <span class="n">unique</span><span class="p">[</span><span class="n">count_sort_ind</span><span class="p">]</span>
<a id="__codelineno-0-444" name="__codelineno-0-444"></a>        <span class="n">counts</span> <span class="o">=</span> <span class="n">counts</span><span class="p">[</span><span class="n">count_sort_ind</span><span class="p">]</span>
<a id="__codelineno-0-445" name="__codelineno-0-445"></a>        <span class="k">return</span> <span class="n">unique</span><span class="p">,</span> <span class="n">counts</span>
<a id="__codelineno-0-446" name="__codelineno-0-446"></a>
<a id="__codelineno-0-447" name="__codelineno-0-447"></a>    <span class="k">def</span> <span class="nf">summary</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-448" name="__codelineno-0-448"></a>        <span class="sd">&quot;&quot;&quot;A method to summarize the dataset.</span>
<a id="__codelineno-0-449" name="__codelineno-0-449"></a>
<a id="__codelineno-0-450" name="__codelineno-0-450"></a><span class="sd">        Returns:</span>
<a id="__codelineno-0-451" name="__codelineno-0-451"></a><span class="sd">            str: the string representation of the dataset.</span>
<a id="__codelineno-0-452" name="__codelineno-0-452"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-453" name="__codelineno-0-453"></a>        <span class="n">summary</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;ChoiceDataset with </span><span class="si">{}</span><span class="s1"> sessions, </span><span class="si">{}</span><span class="s1"> items, </span><span class="si">{}</span><span class="s1"> users, </span><span class="si">{}</span><span class="s1"> purchase records (observations) .&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
<a id="__codelineno-0-454" name="__codelineno-0-454"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">num_sessions</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_items</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_users</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">user_index</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="s1">&#39;single&#39;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">))]</span>
<a id="__codelineno-0-455" name="__codelineno-0-455"></a>
<a id="__codelineno-0-456" name="__codelineno-0-456"></a>        <span class="c1"># summarize users.</span>
<a id="__codelineno-0-457" name="__codelineno-0-457"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">user_index</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-458" name="__codelineno-0-458"></a>            <span class="n">unique</span><span class="p">,</span> <span class="n">counts</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">user_index</span><span class="p">)</span>
<a id="__codelineno-0-459" name="__codelineno-0-459"></a>            <span class="n">summary</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;The most frequent user is </span><span class="si">{</span><span class="n">unique</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2"> with </span><span class="si">{</span><span class="n">counts</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2"> observations; the least frequent user is </span><span class="si">{</span><span class="n">unique</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s2"> with </span><span class="si">{</span><span class="n">counts</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s2"> observations; on average, there are </span><span class="si">{</span><span class="n">counts</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> observations per user.&quot;</span><span class="p">)</span>
<a id="__codelineno-0-460" name="__codelineno-0-460"></a>
<a id="__codelineno-0-461" name="__codelineno-0-461"></a>            <span class="n">N</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">unique</span><span class="p">)</span>
<a id="__codelineno-0-462" name="__codelineno-0-462"></a>            <span class="n">K</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="n">N</span><span class="p">)</span>
<a id="__codelineno-0-463" name="__codelineno-0-463"></a>            <span class="n">string</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">K</span><span class="si">}</span><span class="s1"> most frequent users are: &#39;</span> <span class="o">+</span> <span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">unique</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="si">}</span><span class="s1">(</span><span class="si">{</span><span class="n">counts</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="si">}</span><span class="s1"> times)&#39;</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">K</span><span class="p">)])</span> <span class="o">+</span> <span class="s1">&#39;.&#39;</span>
<a id="__codelineno-0-464" name="__codelineno-0-464"></a>            <span class="n">summary</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">string</span><span class="p">)</span>
<a id="__codelineno-0-465" name="__codelineno-0-465"></a>            <span class="n">string</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">K</span><span class="si">}</span><span class="s1"> least frequent users are: &#39;</span> <span class="o">+</span> <span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">unique</span><span class="p">[</span><span class="n">N</span><span class="o">-</span><span class="n">i</span><span class="p">]</span><span class="si">}</span><span class="s1">(</span><span class="si">{</span><span class="n">counts</span><span class="p">[</span><span class="n">N</span><span class="o">-</span><span class="n">i</span><span class="p">]</span><span class="si">}</span><span class="s1"> times)&#39;</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">K</span><span class="o">+</span><span class="mi">1</span><span class="p">)])</span> <span class="o">+</span> <span class="s1">&#39;.&#39;</span>
<a id="__codelineno-0-466" name="__codelineno-0-466"></a>            <span class="n">summary</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">string</span><span class="p">)</span>
<a id="__codelineno-0-467" name="__codelineno-0-467"></a>
<a id="__codelineno-0-468" name="__codelineno-0-468"></a>        <span class="c1"># summarize items.</span>
<a id="__codelineno-0-469" name="__codelineno-0-469"></a>        <span class="n">unique</span><span class="p">,</span> <span class="n">counts</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">item_index</span><span class="p">)</span>
<a id="__codelineno-0-470" name="__codelineno-0-470"></a>        <span class="n">N</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">unique</span><span class="p">)</span>
<a id="__codelineno-0-471" name="__codelineno-0-471"></a>        <span class="n">K</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="n">N</span><span class="p">)</span>
<a id="__codelineno-0-472" name="__codelineno-0-472"></a>        <span class="n">summary</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;The most frequent item is </span><span class="si">{</span><span class="n">unique</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2">, it was chosen </span><span class="si">{</span><span class="n">counts</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2"> times; the least frequent item is </span><span class="si">{</span><span class="n">unique</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s2"> it was </span><span class="si">{</span><span class="n">counts</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s2"> times; on average, each item was purchased </span><span class="si">{</span><span class="n">counts</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> times.&quot;</span><span class="p">)</span>
<a id="__codelineno-0-473" name="__codelineno-0-473"></a>
<a id="__codelineno-0-474" name="__codelineno-0-474"></a>        <span class="n">string</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">K</span><span class="si">}</span><span class="s1"> most frequent items are: &#39;</span> <span class="o">+</span> <span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">unique</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="si">}</span><span class="s1">(</span><span class="si">{</span><span class="n">counts</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="si">}</span><span class="s1"> times)&#39;</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">K</span><span class="p">)])</span> <span class="o">+</span> <span class="s1">&#39;.&#39;</span>
<a id="__codelineno-0-475" name="__codelineno-0-475"></a>        <span class="n">summary</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">string</span><span class="p">)</span>
<a id="__codelineno-0-476" name="__codelineno-0-476"></a>        <span class="n">string</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">K</span><span class="si">}</span><span class="s1"> least frequent items are: &#39;</span> <span class="o">+</span> <span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">unique</span><span class="p">[</span><span class="n">N</span><span class="o">-</span><span class="n">i</span><span class="p">]</span><span class="si">}</span><span class="s1">(</span><span class="si">{</span><span class="n">counts</span><span class="p">[</span><span class="n">N</span><span class="o">-</span><span class="n">i</span><span class="p">]</span><span class="si">}</span><span class="s1"> times)&#39;</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">K</span><span class="o">+</span><span class="mi">1</span><span class="p">)])</span> <span class="o">+</span> <span class="s1">&#39;.&#39;</span>
<a id="__codelineno-0-477" name="__codelineno-0-477"></a>        <span class="n">summary</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">string</span><span class="p">)</span>
<a id="__codelineno-0-478" name="__codelineno-0-478"></a>
<a id="__codelineno-0-479" name="__codelineno-0-479"></a>        <span class="n">summary</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;Attribute Summaries:&#39;</span><span class="p">)</span>
<a id="__codelineno-0-480" name="__codelineno-0-480"></a>        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">item</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
<a id="__codelineno-0-481" name="__codelineno-0-481"></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_is_attribute</span><span class="p">(</span><span class="n">key</span><span class="p">)</span> <span class="ow">and</span> <span class="n">torch</span><span class="o">.</span><span class="n">is_tensor</span><span class="p">(</span><span class="n">item</span><span class="p">):</span>
<a id="__codelineno-0-482" name="__codelineno-0-482"></a>                <span class="n">summary</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;Observable Tensor &#39;</span><span class="si">{}</span><span class="s2">&#39; with shape </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">item</span><span class="o">.</span><span class="n">shape</span><span class="p">))</span>
<a id="__codelineno-0-483" name="__codelineno-0-483"></a>                <span class="c1"># price attributes are 3-dimensional tensors, ignore  for cleanness here.</span>
<a id="__codelineno-0-484" name="__codelineno-0-484"></a>                <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_is_price_attribute</span><span class="p">(</span><span class="n">key</span><span class="p">):</span>
<a id="__codelineno-0-485" name="__codelineno-0-485"></a>                    <span class="n">summary</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">item</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="s1">&#39;cpu&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">float</span><span class="p">()</span><span class="o">.</span><span class="n">numpy</span><span class="p">())</span><span class="o">.</span><span class="n">describe</span><span class="p">()))</span>
<a id="__codelineno-0-486" name="__codelineno-0-486"></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">summary</span><span class="p">)</span> <span class="o">+</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">device=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-487" name="__codelineno-0-487"></a>        <span class="k">return</span> <span class="kc">None</span>
</code></pre></div></td></tr></table></div>
        </details>

  

  <div class="doc doc-children">







<div class="doc doc-object doc-attribute">



<h2 id="torch_choice.data.choice_dataset.ChoiceDataset.device" class="doc doc-heading">
<code class="highlight language-python"><span class="n">device</span><span class="p">:</span> <span class="nb">str</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h2>


  <div class="doc doc-contents ">
  
      <p>Returns the device of the dataset.</p>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
<th>Name</th>        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
<td><code>str</code></td>          <td>
                <code>str</code>
          </td>
          <td><p>the device of the dataset.</p></td>
        </tr>
    </tbody>
  </table>
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h2 id="torch_choice.data.choice_dataset.ChoiceDataset.num_items" class="doc doc-heading">
<code class="highlight language-python"><span class="n">num_items</span><span class="p">:</span> <span class="nb">int</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h2>


  <div class="doc doc-contents ">
  
      <p>Returns the number of items involved in this dataset.</p>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
<th>Name</th>        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
<td><code>int</code></td>          <td>
                <code>int</code>
          </td>
          <td><p>the number of items involved in this dataset.</p></td>
        </tr>
    </tbody>
  </table>
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h2 id="torch_choice.data.choice_dataset.ChoiceDataset.num_sessions" class="doc doc-heading">
<code class="highlight language-python"><span class="n">num_sessions</span><span class="p">:</span> <span class="nb">int</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h2>


  <div class="doc doc-contents ">
  
      <p>Returns the number of sessions involved in this dataset.</p>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
<th>Name</th>        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
<td><code>int</code></td>          <td>
                <code>int</code>
          </td>
          <td><p>the number of sessions involved in this dataset.</p></td>
        </tr>
    </tbody>
  </table>
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h2 id="torch_choice.data.choice_dataset.ChoiceDataset.num_users" class="doc doc-heading">
<code class="highlight language-python"><span class="n">num_users</span><span class="p">:</span> <span class="nb">int</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h2>


  <div class="doc doc-contents ">
  
      <p>Returns number of users involved in this dataset, returns 1 if there is no user identity.</p>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
<th>Name</th>        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
<td><code>int</code></td>          <td>
                <code>int</code>
          </td>
          <td><p>the number of users involved in this dataset.</p></td>
        </tr>
    </tbody>
  </table>
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h2 id="torch_choice.data.choice_dataset.ChoiceDataset.x_dict" class="doc doc-heading">
<code class="highlight language-python"><span class="n">x_dict</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">object</span><span class="p">,</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">]</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h2>


  <div class="doc doc-contents ">
  
      <p>Formats attributes of in this dataset into shape (num_sessions, num_items, num_params) and returns in a dictionary format.
Models in this package are expecting this dictionary based data format.</p>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code><span title="typing.Dict">Dict</span>[object, torch.<span title="torch.Tensor">Tensor</span>]</code>
          </td>
          <td><p>Dict[object, torch.Tensor]: a dictionary with attribute names in the dataset as keys, and reshaped attribute
tensors as values.</p></td>
        </tr>
    </tbody>
  </table>
  </div>

</div>



<div class="doc doc-object doc-function">



<h2 id="torch_choice.data.choice_dataset.ChoiceDataset.__eq__" class="doc doc-heading">
<code class="highlight language-python"><span class="fm">__eq__</span><span class="p">(</span><span class="n">other</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Returns whether all tensor attributes of both ChoiceDatasets are equal.</p>

      <details class="quote">
        <summary>Source code in <code>torch_choice/data/choice_dataset.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-164">164</a></span>
<span class="normal"><a href="#__codelineno-0-165">165</a></span>
<span class="normal"><a href="#__codelineno-0-166">166</a></span>
<span class="normal"><a href="#__codelineno-0-167">167</a></span>
<span class="normal"><a href="#__codelineno-0-168">168</a></span>
<span class="normal"><a href="#__codelineno-0-169">169</a></span>
<span class="normal"><a href="#__codelineno-0-170">170</a></span>
<span class="normal"><a href="#__codelineno-0-171">171</a></span>
<span class="normal"><a href="#__codelineno-0-172">172</a></span>
<span class="normal"><a href="#__codelineno-0-173">173</a></span>
<span class="normal"><a href="#__codelineno-0-174">174</a></span>
<span class="normal"><a href="#__codelineno-0-175">175</a></span>
<span class="normal"><a href="#__codelineno-0-176">176</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-164" name="__codelineno-0-164"></a><span class="k">def</span> <span class="fm">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">:</span> <span class="s2">&quot;ChoiceDataset&quot;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<a id="__codelineno-0-165" name="__codelineno-0-165"></a>    <span class="sd">&quot;&quot;&quot;Returns whether all tensor attributes of both ChoiceDatasets are equal.&quot;&quot;&quot;</span>
<a id="__codelineno-0-166" name="__codelineno-0-166"></a>    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">ChoiceDataset</span><span class="p">):</span>
<a id="__codelineno-0-167" name="__codelineno-0-167"></a>        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;You can only compare with ChoiceDataset objects.&#39;</span><span class="p">)</span>
<a id="__codelineno-0-168" name="__codelineno-0-168"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-169" name="__codelineno-0-169"></a>        <span class="n">flag</span> <span class="o">=</span> <span class="kc">True</span>
<a id="__codelineno-0-170" name="__codelineno-0-170"></a>        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
<a id="__codelineno-0-171" name="__codelineno-0-171"></a>            <span class="k">if</span> <span class="n">torch</span><span class="o">.</span><span class="n">is_tensor</span><span class="p">(</span><span class="n">val</span><span class="p">):</span>
<a id="__codelineno-0-172" name="__codelineno-0-172"></a>                <span class="c1"># ignore NaNs while comparing.</span>
<a id="__codelineno-0-173" name="__codelineno-0-173"></a>                <span class="k">if</span> <span class="ow">not</span> <span class="n">torch</span><span class="o">.</span><span class="n">equal</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">nan_to_num</span><span class="p">(</span><span class="n">val</span><span class="p">),</span> <span class="n">torch</span><span class="o">.</span><span class="n">nan_to_num</span><span class="p">(</span><span class="n">other</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">[</span><span class="n">key</span><span class="p">])):</span>
<a id="__codelineno-0-174" name="__codelineno-0-174"></a>                    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Attribute </span><span class="si">{}</span><span class="s1"> is not equal.&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">key</span><span class="p">))</span>
<a id="__codelineno-0-175" name="__codelineno-0-175"></a>                    <span class="n">flag</span> <span class="o">=</span> <span class="kc">False</span>
<a id="__codelineno-0-176" name="__codelineno-0-176"></a>        <span class="k">return</span> <span class="n">flag</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h2 id="torch_choice.data.choice_dataset.ChoiceDataset.__getitem__" class="doc doc-heading">
<code class="highlight language-python"><span class="fm">__getitem__</span><span class="p">(</span><span class="n">indices</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Retrieves samples corresponding to the provided index or list of indices.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>indices</code></td>
          <td>
                <code><span title="typing.Union">Union</span>[int, torch.<span title="torch.LongTensor">LongTensor</span>]</code>
          </td>
          <td><p>a single integer index or a tensor of indices.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
<th>Name</th>        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
<td><code>ChoiceDataset</code></td>          <td>
                <code><a class="autorefs autorefs-internal" title="torch_choice.data.choice_dataset.ChoiceDataset" href="#torch_choice.data.ChoiceDataset">ChoiceDataset</a></code>
          </td>
          <td><p>a subset of the dataset.</p></td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>torch_choice/data/choice_dataset.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-122">122</a></span>
<span class="normal"><a href="#__codelineno-0-123">123</a></span>
<span class="normal"><a href="#__codelineno-0-124">124</a></span>
<span class="normal"><a href="#__codelineno-0-125">125</a></span>
<span class="normal"><a href="#__codelineno-0-126">126</a></span>
<span class="normal"><a href="#__codelineno-0-127">127</a></span>
<span class="normal"><a href="#__codelineno-0-128">128</a></span>
<span class="normal"><a href="#__codelineno-0-129">129</a></span>
<span class="normal"><a href="#__codelineno-0-130">130</a></span>
<span class="normal"><a href="#__codelineno-0-131">131</a></span>
<span class="normal"><a href="#__codelineno-0-132">132</a></span>
<span class="normal"><a href="#__codelineno-0-133">133</a></span>
<span class="normal"><a href="#__codelineno-0-134">134</a></span>
<span class="normal"><a href="#__codelineno-0-135">135</a></span>
<span class="normal"><a href="#__codelineno-0-136">136</a></span>
<span class="normal"><a href="#__codelineno-0-137">137</a></span>
<span class="normal"><a href="#__codelineno-0-138">138</a></span>
<span class="normal"><a href="#__codelineno-0-139">139</a></span>
<span class="normal"><a href="#__codelineno-0-140">140</a></span>
<span class="normal"><a href="#__codelineno-0-141">141</a></span>
<span class="normal"><a href="#__codelineno-0-142">142</a></span>
<span class="normal"><a href="#__codelineno-0-143">143</a></span>
<span class="normal"><a href="#__codelineno-0-144">144</a></span>
<span class="normal"><a href="#__codelineno-0-145">145</a></span>
<span class="normal"><a href="#__codelineno-0-146">146</a></span>
<span class="normal"><a href="#__codelineno-0-147">147</a></span>
<span class="normal"><a href="#__codelineno-0-148">148</a></span>
<span class="normal"><a href="#__codelineno-0-149">149</a></span>
<span class="normal"><a href="#__codelineno-0-150">150</a></span>
<span class="normal"><a href="#__codelineno-0-151">151</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-122" name="__codelineno-0-122"></a><span class="k">def</span> <span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">indices</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n">torch</span><span class="o">.</span><span class="n">LongTensor</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="s2">&quot;ChoiceDataset&quot;</span><span class="p">:</span>
<a id="__codelineno-0-123" name="__codelineno-0-123"></a>    <span class="sd">&quot;&quot;&quot;Retrieves samples corresponding to the provided index or list of indices.</span>
<a id="__codelineno-0-124" name="__codelineno-0-124"></a>
<a id="__codelineno-0-125" name="__codelineno-0-125"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-126" name="__codelineno-0-126"></a><span class="sd">        indices (Union[int, torch.LongTensor]): a single integer index or a tensor of indices.</span>
<a id="__codelineno-0-127" name="__codelineno-0-127"></a>
<a id="__codelineno-0-128" name="__codelineno-0-128"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-129" name="__codelineno-0-129"></a><span class="sd">        ChoiceDataset: a subset of the dataset.</span>
<a id="__codelineno-0-130" name="__codelineno-0-130"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-131" name="__codelineno-0-131"></a>    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">indices</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
<a id="__codelineno-0-132" name="__codelineno-0-132"></a>        <span class="c1"># convert single integer index to an array of indices.</span>
<a id="__codelineno-0-133" name="__codelineno-0-133"></a>        <span class="n">indices</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">LongTensor</span><span class="p">([</span><span class="n">indices</span><span class="p">])</span>
<a id="__codelineno-0-134" name="__codelineno-0-134"></a>    <span class="n">new_dict</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
<a id="__codelineno-0-135" name="__codelineno-0-135"></a>    <span class="n">new_dict</span><span class="p">[</span><span class="s1">&#39;item_index&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">item_index</span><span class="p">[</span><span class="n">indices</span><span class="p">]</span><span class="o">.</span><span class="n">clone</span><span class="p">()</span>
<a id="__codelineno-0-136" name="__codelineno-0-136"></a>
<a id="__codelineno-0-137" name="__codelineno-0-137"></a>    <span class="c1"># copy optional attributes.</span>
<a id="__codelineno-0-138" name="__codelineno-0-138"></a>    <span class="n">new_dict</span><span class="p">[</span><span class="s1">&#39;label&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">label</span><span class="p">[</span><span class="n">indices</span><span class="p">]</span><span class="o">.</span><span class="n">clone</span><span class="p">()</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">label</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="kc">None</span>
<a id="__codelineno-0-139" name="__codelineno-0-139"></a>    <span class="n">new_dict</span><span class="p">[</span><span class="s1">&#39;user_index&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">user_index</span><span class="p">[</span><span class="n">indices</span><span class="p">]</span><span class="o">.</span><span class="n">clone</span><span class="p">()</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">user_index</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="kc">None</span>
<a id="__codelineno-0-140" name="__codelineno-0-140"></a>    <span class="n">new_dict</span><span class="p">[</span><span class="s1">&#39;session_index&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">session_index</span><span class="p">[</span><span class="n">indices</span><span class="p">]</span><span class="o">.</span><span class="n">clone</span><span class="p">()</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">session_index</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="kc">None</span>
<a id="__codelineno-0-141" name="__codelineno-0-141"></a>    <span class="c1"># item_availability has shape (num_sessions, num_items), no need to re-index it.</span>
<a id="__codelineno-0-142" name="__codelineno-0-142"></a>    <span class="n">new_dict</span><span class="p">[</span><span class="s1">&#39;item_availability&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">item_availability</span>
<a id="__codelineno-0-143" name="__codelineno-0-143"></a>
<a id="__codelineno-0-144" name="__codelineno-0-144"></a>    <span class="c1"># copy other attributes.</span>
<a id="__codelineno-0-145" name="__codelineno-0-145"></a>    <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
<a id="__codelineno-0-146" name="__codelineno-0-146"></a>        <span class="k">if</span> <span class="n">key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">new_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
<a id="__codelineno-0-147" name="__codelineno-0-147"></a>            <span class="k">if</span> <span class="n">torch</span><span class="o">.</span><span class="n">is_tensor</span><span class="p">(</span><span class="n">val</span><span class="p">):</span>
<a id="__codelineno-0-148" name="__codelineno-0-148"></a>                <span class="n">new_dict</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">val</span><span class="o">.</span><span class="n">clone</span><span class="p">()</span>
<a id="__codelineno-0-149" name="__codelineno-0-149"></a>            <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-150" name="__codelineno-0-150"></a>                <span class="n">new_dict</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>
<a id="__codelineno-0-151" name="__codelineno-0-151"></a>    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_from_dict</span><span class="p">(</span><span class="n">new_dict</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h2 id="torch_choice.data.choice_dataset.ChoiceDataset.__init__" class="doc doc-heading">
<code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">item_index</span><span class="p">,</span> <span class="n">num_items</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">num_users</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">user_index</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">session_index</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">item_availability</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Initialization methods for the dataset object, researchers should supply all information about the dataset
using this initialization method.</p>
<p>The number of choice instances are called <code>batch_size</code> in the documentation. The <code>batch_size</code> corresponds to the
file length in wide-format dataset, and often denoted using <code>N</code>. We call it <code>batch_size</code> to follow the convention
in machine learning literature.
A <code>choice instance</code> is a row of the dataset, so there are <code>batch_size</code> choice instances in each <code>ChoiceDataset</code>.</p>
<p>The dataset consists of:
(1) a collection of <code>batch_size</code> tuples (item_id, user_id, session_id, label), where each tuple is a choice instance.
(2) a collection of <code>observables</code> associated with item, user, session, etc.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>item_index</code></td>
          <td>
                <code>torch.<span title="torch.LongTensor">LongTensor</span></code>
          </td>
          <td><p>a tensor of shape (batch_size) indicating the relevant item in each row
of the dataset, the relevant item can be:
(1) the item bought in this choice instance,
(2) or the item reviewed by the user. In the later case, we need the <code>label</code> tensor to specify the rating score.
NOTE: The support for second case is under-development, currently, we are only supporting binary label.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>num_items</code></td>
          <td>
                <code><span title="typing.Optional">Optional</span>[int]</code>
          </td>
          <td><p>the number of items in the dataset. If <code>None</code> is provided (default), the number of items will be inferred from the number of unique numbers in <code>item_index</code>.</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>num_users</code></td>
          <td>
                <code><span title="typing.Optional">Optional</span>[int]</code>
          </td>
          <td><p>the number of users in the dataset. If <code>None</code> is provided (default), the number of users will be inferred from the number of unique numbers in <code>user_index</code>.</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>label</code></td>
          <td>
                <code><span title="typing.Optional">Optional</span>[torch.<span title="torch.LongTensor">LongTensor</span>]</code>
          </td>
          <td><p>a tensor of shape (batch_size) indicating the label for prediction in
each choice instance. While you want to predict the item bought, you can leave the <code>label</code> argument
as <code>None</code> in the initialization method, and the model will use <code>item_index</code> as the object to be predicted.
But if you are, for example, predicting the rating an user gave an item, label must be provided.
Defaults to None.</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>user_index</code></td>
          <td>
                <code><span title="typing.Optional">Optional</span>[torch.<span title="torch.LongTensor">LongTensor</span>]</code>
          </td>
          <td><p>a tensor of shape num_purchases (batch_size) indicating
the ID of the user who was involved in each choice instance. If <code>None</code> user index is provided, it's assumed
that the choice instances are from the same user.
<code>user_index</code> is required if and only if there are multiple users in the dataset, for example:
    (1) user-observables is involved in the utility form,
    (2) and/or the coefficient is user-specific.
This tensor is used to select the corresponding user observables and coefficients assigned to the
user (like theta_user) for making prediction for that purchase.
Defaults to None.</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>session_index</code></td>
          <td>
                <code><span title="typing.Optional">Optional</span>[torch.<span title="torch.LongTensor">LongTensor</span>]</code>
          </td>
          <td><p>a tensor of shape num_purchases (batch_size) indicating
the ID of the session when that choice instance occurred. This tensor is used to select the correct
session observables or price observables for making prediction for that choice instance. Therefore, if
there is no session/price observables, you can leave this argument as <code>None</code>. In this case, the <code>ChoiceDataset</code>
object will assume each choice instance to be in its own session.
Defaults to None.</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>item_availability</code></td>
          <td>
                <code><span title="typing.Optional">Optional</span>[torch.<span title="torch.BoolTensor">BoolTensor</span>]</code>
          </td>
          <td><p>A boolean tensor of shape (num_sessions, num_items)
indicating the availability of each item in each session. Utilities of unavailable items would be set to -infinite,
and hence these unavailable items will be set to 0 while making prediction.
We assume all items are available if set to None.
Defaults to None.</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
    </tbody>
  </table>
      <p>Other Kwargs (Observables):
    One can specify the following types of observables, where * in shape denotes any positive
        integer. Typically * represents the number of observables.
    Please refer to the documentation for a detailed guide to use observables.
    1. user observables must start with 'user_' and have shape (num_users, <em>)
    2. item observables must start with 'item_' and have shape (num_items, </em>)
    3. session observables must start with 'session_' and have shape (num_sessions, <em>)
    4. taste observables (those vary by user and item) must start with <code>taste_</code> and have shape
        (num_users, num_items, </em>).
    NOTE: we don't recommend using taste observables, because num_users * num_items is potentially large.
    5. price observables (those vary by session and item) must start with <code>price_</code> and have
        shape (num_sessions, num_items, *)
    6. itemsession observables starting with <code>itemsession_</code>, this is a more intuitive alias to the price
        observable.</p>

      <details class="quote">
        <summary>Source code in <code>torch_choice/data/choice_dataset.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-17"> 17</a></span>
<span class="normal"><a href="#__codelineno-0-18"> 18</a></span>
<span class="normal"><a href="#__codelineno-0-19"> 19</a></span>
<span class="normal"><a href="#__codelineno-0-20"> 20</a></span>
<span class="normal"><a href="#__codelineno-0-21"> 21</a></span>
<span class="normal"><a href="#__codelineno-0-22"> 22</a></span>
<span class="normal"><a href="#__codelineno-0-23"> 23</a></span>
<span class="normal"><a href="#__codelineno-0-24"> 24</a></span>
<span class="normal"><a href="#__codelineno-0-25"> 25</a></span>
<span class="normal"><a href="#__codelineno-0-26"> 26</a></span>
<span class="normal"><a href="#__codelineno-0-27"> 27</a></span>
<span class="normal"><a href="#__codelineno-0-28"> 28</a></span>
<span class="normal"><a href="#__codelineno-0-29"> 29</a></span>
<span class="normal"><a href="#__codelineno-0-30"> 30</a></span>
<span class="normal"><a href="#__codelineno-0-31"> 31</a></span>
<span class="normal"><a href="#__codelineno-0-32"> 32</a></span>
<span class="normal"><a href="#__codelineno-0-33"> 33</a></span>
<span class="normal"><a href="#__codelineno-0-34"> 34</a></span>
<span class="normal"><a href="#__codelineno-0-35"> 35</a></span>
<span class="normal"><a href="#__codelineno-0-36"> 36</a></span>
<span class="normal"><a href="#__codelineno-0-37"> 37</a></span>
<span class="normal"><a href="#__codelineno-0-38"> 38</a></span>
<span class="normal"><a href="#__codelineno-0-39"> 39</a></span>
<span class="normal"><a href="#__codelineno-0-40"> 40</a></span>
<span class="normal"><a href="#__codelineno-0-41"> 41</a></span>
<span class="normal"><a href="#__codelineno-0-42"> 42</a></span>
<span class="normal"><a href="#__codelineno-0-43"> 43</a></span>
<span class="normal"><a href="#__codelineno-0-44"> 44</a></span>
<span class="normal"><a href="#__codelineno-0-45"> 45</a></span>
<span class="normal"><a href="#__codelineno-0-46"> 46</a></span>
<span class="normal"><a href="#__codelineno-0-47"> 47</a></span>
<span class="normal"><a href="#__codelineno-0-48"> 48</a></span>
<span class="normal"><a href="#__codelineno-0-49"> 49</a></span>
<span class="normal"><a href="#__codelineno-0-50"> 50</a></span>
<span class="normal"><a href="#__codelineno-0-51"> 51</a></span>
<span class="normal"><a href="#__codelineno-0-52"> 52</a></span>
<span class="normal"><a href="#__codelineno-0-53"> 53</a></span>
<span class="normal"><a href="#__codelineno-0-54"> 54</a></span>
<span class="normal"><a href="#__codelineno-0-55"> 55</a></span>
<span class="normal"><a href="#__codelineno-0-56"> 56</a></span>
<span class="normal"><a href="#__codelineno-0-57"> 57</a></span>
<span class="normal"><a href="#__codelineno-0-58"> 58</a></span>
<span class="normal"><a href="#__codelineno-0-59"> 59</a></span>
<span class="normal"><a href="#__codelineno-0-60"> 60</a></span>
<span class="normal"><a href="#__codelineno-0-61"> 61</a></span>
<span class="normal"><a href="#__codelineno-0-62"> 62</a></span>
<span class="normal"><a href="#__codelineno-0-63"> 63</a></span>
<span class="normal"><a href="#__codelineno-0-64"> 64</a></span>
<span class="normal"><a href="#__codelineno-0-65"> 65</a></span>
<span class="normal"><a href="#__codelineno-0-66"> 66</a></span>
<span class="normal"><a href="#__codelineno-0-67"> 67</a></span>
<span class="normal"><a href="#__codelineno-0-68"> 68</a></span>
<span class="normal"><a href="#__codelineno-0-69"> 69</a></span>
<span class="normal"><a href="#__codelineno-0-70"> 70</a></span>
<span class="normal"><a href="#__codelineno-0-71"> 71</a></span>
<span class="normal"><a href="#__codelineno-0-72"> 72</a></span>
<span class="normal"><a href="#__codelineno-0-73"> 73</a></span>
<span class="normal"><a href="#__codelineno-0-74"> 74</a></span>
<span class="normal"><a href="#__codelineno-0-75"> 75</a></span>
<span class="normal"><a href="#__codelineno-0-76"> 76</a></span>
<span class="normal"><a href="#__codelineno-0-77"> 77</a></span>
<span class="normal"><a href="#__codelineno-0-78"> 78</a></span>
<span class="normal"><a href="#__codelineno-0-79"> 79</a></span>
<span class="normal"><a href="#__codelineno-0-80"> 80</a></span>
<span class="normal"><a href="#__codelineno-0-81"> 81</a></span>
<span class="normal"><a href="#__codelineno-0-82"> 82</a></span>
<span class="normal"><a href="#__codelineno-0-83"> 83</a></span>
<span class="normal"><a href="#__codelineno-0-84"> 84</a></span>
<span class="normal"><a href="#__codelineno-0-85"> 85</a></span>
<span class="normal"><a href="#__codelineno-0-86"> 86</a></span>
<span class="normal"><a href="#__codelineno-0-87"> 87</a></span>
<span class="normal"><a href="#__codelineno-0-88"> 88</a></span>
<span class="normal"><a href="#__codelineno-0-89"> 89</a></span>
<span class="normal"><a href="#__codelineno-0-90"> 90</a></span>
<span class="normal"><a href="#__codelineno-0-91"> 91</a></span>
<span class="normal"><a href="#__codelineno-0-92"> 92</a></span>
<span class="normal"><a href="#__codelineno-0-93"> 93</a></span>
<span class="normal"><a href="#__codelineno-0-94"> 94</a></span>
<span class="normal"><a href="#__codelineno-0-95"> 95</a></span>
<span class="normal"><a href="#__codelineno-0-96"> 96</a></span>
<span class="normal"><a href="#__codelineno-0-97"> 97</a></span>
<span class="normal"><a href="#__codelineno-0-98"> 98</a></span>
<span class="normal"><a href="#__codelineno-0-99"> 99</a></span>
<span class="normal"><a href="#__codelineno-0-100">100</a></span>
<span class="normal"><a href="#__codelineno-0-101">101</a></span>
<span class="normal"><a href="#__codelineno-0-102">102</a></span>
<span class="normal"><a href="#__codelineno-0-103">103</a></span>
<span class="normal"><a href="#__codelineno-0-104">104</a></span>
<span class="normal"><a href="#__codelineno-0-105">105</a></span>
<span class="normal"><a href="#__codelineno-0-106">106</a></span>
<span class="normal"><a href="#__codelineno-0-107">107</a></span>
<span class="normal"><a href="#__codelineno-0-108">108</a></span>
<span class="normal"><a href="#__codelineno-0-109">109</a></span>
<span class="normal"><a href="#__codelineno-0-110">110</a></span>
<span class="normal"><a href="#__codelineno-0-111">111</a></span>
<span class="normal"><a href="#__codelineno-0-112">112</a></span>
<span class="normal"><a href="#__codelineno-0-113">113</a></span>
<span class="normal"><a href="#__codelineno-0-114">114</a></span>
<span class="normal"><a href="#__codelineno-0-115">115</a></span>
<span class="normal"><a href="#__codelineno-0-116">116</a></span>
<span class="normal"><a href="#__codelineno-0-117">117</a></span>
<span class="normal"><a href="#__codelineno-0-118">118</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-17" name="__codelineno-0-17"></a><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-18" name="__codelineno-0-18"></a>             <span class="n">item_index</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">LongTensor</span><span class="p">,</span>
<a id="__codelineno-0-19" name="__codelineno-0-19"></a>             <span class="n">num_items</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-20" name="__codelineno-0-20"></a>             <span class="n">num_users</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-21" name="__codelineno-0-21"></a>             <span class="n">label</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">torch</span><span class="o">.</span><span class="n">LongTensor</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-22" name="__codelineno-0-22"></a>             <span class="n">user_index</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">torch</span><span class="o">.</span><span class="n">LongTensor</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-23" name="__codelineno-0-23"></a>             <span class="n">session_index</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">torch</span><span class="o">.</span><span class="n">LongTensor</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-24" name="__codelineno-0-24"></a>             <span class="n">item_availability</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">torch</span><span class="o">.</span><span class="n">BoolTensor</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-25" name="__codelineno-0-25"></a>             <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-26" name="__codelineno-0-26"></a>    <span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-27" name="__codelineno-0-27"></a><span class="sd">    Initialization methods for the dataset object, researchers should supply all information about the dataset</span>
<a id="__codelineno-0-28" name="__codelineno-0-28"></a><span class="sd">    using this initialization method.</span>
<a id="__codelineno-0-29" name="__codelineno-0-29"></a>
<a id="__codelineno-0-30" name="__codelineno-0-30"></a><span class="sd">    The number of choice instances are called `batch_size` in the documentation. The `batch_size` corresponds to the</span>
<a id="__codelineno-0-31" name="__codelineno-0-31"></a><span class="sd">    file length in wide-format dataset, and often denoted using `N`. We call it `batch_size` to follow the convention</span>
<a id="__codelineno-0-32" name="__codelineno-0-32"></a><span class="sd">    in machine learning literature.</span>
<a id="__codelineno-0-33" name="__codelineno-0-33"></a><span class="sd">    A `choice instance` is a row of the dataset, so there are `batch_size` choice instances in each `ChoiceDataset`.</span>
<a id="__codelineno-0-34" name="__codelineno-0-34"></a>
<a id="__codelineno-0-35" name="__codelineno-0-35"></a><span class="sd">    The dataset consists of:</span>
<a id="__codelineno-0-36" name="__codelineno-0-36"></a><span class="sd">    (1) a collection of `batch_size` tuples (item_id, user_id, session_id, label), where each tuple is a choice instance.</span>
<a id="__codelineno-0-37" name="__codelineno-0-37"></a><span class="sd">    (2) a collection of `observables` associated with item, user, session, etc.</span>
<a id="__codelineno-0-38" name="__codelineno-0-38"></a>
<a id="__codelineno-0-39" name="__codelineno-0-39"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-40" name="__codelineno-0-40"></a><span class="sd">        item_index (torch.LongTensor): a tensor of shape (batch_size) indicating the relevant item in each row</span>
<a id="__codelineno-0-41" name="__codelineno-0-41"></a><span class="sd">            of the dataset, the relevant item can be:</span>
<a id="__codelineno-0-42" name="__codelineno-0-42"></a><span class="sd">            (1) the item bought in this choice instance,</span>
<a id="__codelineno-0-43" name="__codelineno-0-43"></a><span class="sd">            (2) or the item reviewed by the user. In the later case, we need the `label` tensor to specify the rating score.</span>
<a id="__codelineno-0-44" name="__codelineno-0-44"></a><span class="sd">            NOTE: The support for second case is under-development, currently, we are only supporting binary label.</span>
<a id="__codelineno-0-45" name="__codelineno-0-45"></a>
<a id="__codelineno-0-46" name="__codelineno-0-46"></a><span class="sd">        num_items (Optional[int]): the number of items in the dataset. If `None` is provided (default), the number of items will be inferred from the number of unique numbers in `item_index`.</span>
<a id="__codelineno-0-47" name="__codelineno-0-47"></a>
<a id="__codelineno-0-48" name="__codelineno-0-48"></a><span class="sd">        num_users (Optional[int]): the number of users in the dataset. If `None` is provided (default), the number of users will be inferred from the number of unique numbers in `user_index`.</span>
<a id="__codelineno-0-49" name="__codelineno-0-49"></a>
<a id="__codelineno-0-50" name="__codelineno-0-50"></a><span class="sd">        label (Optional[torch.LongTensor], optional): a tensor of shape (batch_size) indicating the label for prediction in</span>
<a id="__codelineno-0-51" name="__codelineno-0-51"></a><span class="sd">            each choice instance. While you want to predict the item bought, you can leave the `label` argument</span>
<a id="__codelineno-0-52" name="__codelineno-0-52"></a><span class="sd">            as `None` in the initialization method, and the model will use `item_index` as the object to be predicted.</span>
<a id="__codelineno-0-53" name="__codelineno-0-53"></a><span class="sd">            But if you are, for example, predicting the rating an user gave an item, label must be provided.</span>
<a id="__codelineno-0-54" name="__codelineno-0-54"></a><span class="sd">            Defaults to None.</span>
<a id="__codelineno-0-55" name="__codelineno-0-55"></a>
<a id="__codelineno-0-56" name="__codelineno-0-56"></a><span class="sd">        user_index (Optional[torch.LongTensor], optional): a tensor of shape num_purchases (batch_size) indicating</span>
<a id="__codelineno-0-57" name="__codelineno-0-57"></a><span class="sd">            the ID of the user who was involved in each choice instance. If `None` user index is provided, it&#39;s assumed</span>
<a id="__codelineno-0-58" name="__codelineno-0-58"></a><span class="sd">            that the choice instances are from the same user.</span>
<a id="__codelineno-0-59" name="__codelineno-0-59"></a><span class="sd">            `user_index` is required if and only if there are multiple users in the dataset, for example:</span>
<a id="__codelineno-0-60" name="__codelineno-0-60"></a><span class="sd">                (1) user-observables is involved in the utility form,</span>
<a id="__codelineno-0-61" name="__codelineno-0-61"></a><span class="sd">                (2) and/or the coefficient is user-specific.</span>
<a id="__codelineno-0-62" name="__codelineno-0-62"></a><span class="sd">            This tensor is used to select the corresponding user observables and coefficients assigned to the</span>
<a id="__codelineno-0-63" name="__codelineno-0-63"></a><span class="sd">            user (like theta_user) for making prediction for that purchase.</span>
<a id="__codelineno-0-64" name="__codelineno-0-64"></a><span class="sd">            Defaults to None.</span>
<a id="__codelineno-0-65" name="__codelineno-0-65"></a>
<a id="__codelineno-0-66" name="__codelineno-0-66"></a><span class="sd">        session_index (Optional[torch.LongTensor], optional): a tensor of shape num_purchases (batch_size) indicating</span>
<a id="__codelineno-0-67" name="__codelineno-0-67"></a><span class="sd">            the ID of the session when that choice instance occurred. This tensor is used to select the correct</span>
<a id="__codelineno-0-68" name="__codelineno-0-68"></a><span class="sd">            session observables or price observables for making prediction for that choice instance. Therefore, if</span>
<a id="__codelineno-0-69" name="__codelineno-0-69"></a><span class="sd">            there is no session/price observables, you can leave this argument as `None`. In this case, the `ChoiceDataset`</span>
<a id="__codelineno-0-70" name="__codelineno-0-70"></a><span class="sd">            object will assume each choice instance to be in its own session.</span>
<a id="__codelineno-0-71" name="__codelineno-0-71"></a><span class="sd">            Defaults to None.</span>
<a id="__codelineno-0-72" name="__codelineno-0-72"></a>
<a id="__codelineno-0-73" name="__codelineno-0-73"></a><span class="sd">        item_availability (Optional[torch.BoolTensor], optional): A boolean tensor of shape (num_sessions, num_items)</span>
<a id="__codelineno-0-74" name="__codelineno-0-74"></a><span class="sd">            indicating the availability of each item in each session. Utilities of unavailable items would be set to -infinite,</span>
<a id="__codelineno-0-75" name="__codelineno-0-75"></a><span class="sd">            and hence these unavailable items will be set to 0 while making prediction.</span>
<a id="__codelineno-0-76" name="__codelineno-0-76"></a><span class="sd">            We assume all items are available if set to None.</span>
<a id="__codelineno-0-77" name="__codelineno-0-77"></a><span class="sd">            Defaults to None.</span>
<a id="__codelineno-0-78" name="__codelineno-0-78"></a>
<a id="__codelineno-0-79" name="__codelineno-0-79"></a><span class="sd">    Other Kwargs (Observables):</span>
<a id="__codelineno-0-80" name="__codelineno-0-80"></a><span class="sd">        One can specify the following types of observables, where * in shape denotes any positive</span>
<a id="__codelineno-0-81" name="__codelineno-0-81"></a><span class="sd">            integer. Typically * represents the number of observables.</span>
<a id="__codelineno-0-82" name="__codelineno-0-82"></a><span class="sd">        Please refer to the documentation for a detailed guide to use observables.</span>
<a id="__codelineno-0-83" name="__codelineno-0-83"></a><span class="sd">        1. user observables must start with &#39;user_&#39; and have shape (num_users, *)</span>
<a id="__codelineno-0-84" name="__codelineno-0-84"></a><span class="sd">        2. item observables must start with &#39;item_&#39; and have shape (num_items, *)</span>
<a id="__codelineno-0-85" name="__codelineno-0-85"></a><span class="sd">        3. session observables must start with &#39;session_&#39; and have shape (num_sessions, *)</span>
<a id="__codelineno-0-86" name="__codelineno-0-86"></a><span class="sd">        4. taste observables (those vary by user and item) must start with `taste_` and have shape</span>
<a id="__codelineno-0-87" name="__codelineno-0-87"></a><span class="sd">            (num_users, num_items, *).</span>
<a id="__codelineno-0-88" name="__codelineno-0-88"></a><span class="sd">        NOTE: we don&#39;t recommend using taste observables, because num_users * num_items is potentially large.</span>
<a id="__codelineno-0-89" name="__codelineno-0-89"></a><span class="sd">        5. price observables (those vary by session and item) must start with `price_` and have</span>
<a id="__codelineno-0-90" name="__codelineno-0-90"></a><span class="sd">            shape (num_sessions, num_items, *)</span>
<a id="__codelineno-0-91" name="__codelineno-0-91"></a><span class="sd">        6. itemsession observables starting with `itemsession_`, this is a more intuitive alias to the price</span>
<a id="__codelineno-0-92" name="__codelineno-0-92"></a><span class="sd">            observable.</span>
<a id="__codelineno-0-93" name="__codelineno-0-93"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-94" name="__codelineno-0-94"></a>    <span class="c1"># ENHANCEMENT(Tianyu): add item_names for summary.</span>
<a id="__codelineno-0-95" name="__codelineno-0-95"></a>    <span class="nb">super</span><span class="p">(</span><span class="n">ChoiceDataset</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
<a id="__codelineno-0-96" name="__codelineno-0-96"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">label</span> <span class="o">=</span> <span class="n">label</span>
<a id="__codelineno-0-97" name="__codelineno-0-97"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">item_index</span> <span class="o">=</span> <span class="n">item_index</span>
<a id="__codelineno-0-98" name="__codelineno-0-98"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">_num_items</span> <span class="o">=</span> <span class="n">num_items</span>
<a id="__codelineno-0-99" name="__codelineno-0-99"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">_num_users</span> <span class="o">=</span> <span class="n">num_users</span>
<a id="__codelineno-0-100" name="__codelineno-0-100"></a>
<a id="__codelineno-0-101" name="__codelineno-0-101"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">user_index</span> <span class="o">=</span> <span class="n">user_index</span>
<a id="__codelineno-0-102" name="__codelineno-0-102"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">session_index</span> <span class="o">=</span> <span class="n">session_index</span>
<a id="__codelineno-0-103" name="__codelineno-0-103"></a>
<a id="__codelineno-0-104" name="__codelineno-0-104"></a>    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">session_index</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-105" name="__codelineno-0-105"></a>        <span class="c1"># if any([x.startswith(&#39;session_&#39;) or x.startswith(&#39;price_&#39;) for x in kwargs.keys()]):</span>
<a id="__codelineno-0-106" name="__codelineno-0-106"></a>        <span class="c1"># if any session sensitive observable is provided, but session index is not,</span>
<a id="__codelineno-0-107" name="__codelineno-0-107"></a>        <span class="c1"># infer each row in the dataset to be a session.</span>
<a id="__codelineno-0-108" name="__codelineno-0-108"></a>        <span class="c1"># TODO: (design choice) should we assign unique session index to each choice instance or the same session index.</span>
<a id="__codelineno-0-109" name="__codelineno-0-109"></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;No `session_index` is provided, assume each choice instance is in its own session.&#39;</span><span class="p">)</span>
<a id="__codelineno-0-110" name="__codelineno-0-110"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">session_index</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">item_index</span><span class="p">))</span><span class="o">.</span><span class="n">long</span><span class="p">()</span>
<a id="__codelineno-0-111" name="__codelineno-0-111"></a>
<a id="__codelineno-0-112" name="__codelineno-0-112"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">item_availability</span> <span class="o">=</span> <span class="n">item_availability</span>
<a id="__codelineno-0-113" name="__codelineno-0-113"></a>
<a id="__codelineno-0-114" name="__codelineno-0-114"></a>    <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
<a id="__codelineno-0-115" name="__codelineno-0-115"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_is_attribute</span><span class="p">(</span><span class="n">key</span><span class="p">):</span>
<a id="__codelineno-0-116" name="__codelineno-0-116"></a>            <span class="c1"># all observable should be float.</span>
<a id="__codelineno-0-117" name="__codelineno-0-117"></a>            <span class="n">item</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">float</span><span class="p">()</span>
<a id="__codelineno-0-118" name="__codelineno-0-118"></a>        <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">item</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h2 id="torch_choice.data.choice_dataset.ChoiceDataset.__len__" class="doc doc-heading">
<code class="highlight language-python"><span class="fm">__len__</span><span class="p">()</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Returns number of samples in this dataset.</p>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
<th>Name</th>        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
<td><code>int</code></td>          <td>
                <code>int</code>
          </td>
          <td><p>length of the dataset.</p></td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>torch_choice/data/choice_dataset.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-153">153</a></span>
<span class="normal"><a href="#__codelineno-0-154">154</a></span>
<span class="normal"><a href="#__codelineno-0-155">155</a></span>
<span class="normal"><a href="#__codelineno-0-156">156</a></span>
<span class="normal"><a href="#__codelineno-0-157">157</a></span>
<span class="normal"><a href="#__codelineno-0-158">158</a></span>
<span class="normal"><a href="#__codelineno-0-159">159</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-153" name="__codelineno-0-153"></a><span class="k">def</span> <span class="fm">__len__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<a id="__codelineno-0-154" name="__codelineno-0-154"></a>    <span class="sd">&quot;&quot;&quot;Returns number of samples in this dataset.</span>
<a id="__codelineno-0-155" name="__codelineno-0-155"></a>
<a id="__codelineno-0-156" name="__codelineno-0-156"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-157" name="__codelineno-0-157"></a><span class="sd">        int: length of the dataset.</span>
<a id="__codelineno-0-158" name="__codelineno-0-158"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-159" name="__codelineno-0-159"></a>    <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">item_index</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h2 id="torch_choice.data.choice_dataset.ChoiceDataset.__repr__" class="doc doc-heading">
<code class="highlight language-python"><span class="fm">__repr__</span><span class="p">()</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>A method to get a string representation of the dataset.</p>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
<th>Name</th>        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
<td><code>str</code></td>          <td>
                <code>str</code>
          </td>
          <td><p>the string representation of the dataset.</p></td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>torch_choice/data/choice_dataset.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-358">358</a></span>
<span class="normal"><a href="#__codelineno-0-359">359</a></span>
<span class="normal"><a href="#__codelineno-0-360">360</a></span>
<span class="normal"><a href="#__codelineno-0-361">361</a></span>
<span class="normal"><a href="#__codelineno-0-362">362</a></span>
<span class="normal"><a href="#__codelineno-0-363">363</a></span>
<span class="normal"><a href="#__codelineno-0-364">364</a></span>
<span class="normal"><a href="#__codelineno-0-365">365</a></span>
<span class="normal"><a href="#__codelineno-0-366">366</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-358" name="__codelineno-0-358"></a><span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<a id="__codelineno-0-359" name="__codelineno-0-359"></a>    <span class="sd">&quot;&quot;&quot;A method to get a string representation of the dataset.</span>
<a id="__codelineno-0-360" name="__codelineno-0-360"></a>
<a id="__codelineno-0-361" name="__codelineno-0-361"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-362" name="__codelineno-0-362"></a><span class="sd">        str: the string representation of the dataset.</span>
<a id="__codelineno-0-363" name="__codelineno-0-363"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-364" name="__codelineno-0-364"></a>    <span class="c1"># don&#39;t print shapes of internal attributes like _num_users and _num_items.</span>
<a id="__codelineno-0-365" name="__codelineno-0-365"></a>    <span class="n">info</span> <span class="o">=</span> <span class="p">[</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s1">=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_size_repr</span><span class="p">(</span><span class="n">item</span><span class="p">)</span><span class="si">}</span><span class="s1">&#39;</span> <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">item</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">key</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">)]</span>
<a id="__codelineno-0-366" name="__codelineno-0-366"></a>    <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">(</span><span class="si">{</span><span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">info</span><span class="p">)</span><span class="si">}</span><span class="s2">, device=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="si">}</span><span class="s2">)&quot;</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h2 id="torch_choice.data.choice_dataset.ChoiceDataset.apply_tensor" class="doc doc-heading">
<code class="highlight language-python"><span class="n">apply_tensor</span><span class="p">(</span><span class="n">func</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>This s a helper method to apply the provided function to all tensors and tensor values of all dictionaries.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>func</code></td>
          <td>
                <code>callable</code>
          </td>
          <td><p>a callable function to be applied on tensors and tensor-values of dictionaries.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
<th>Name</th>        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
<td><code>ChoiceDataset</code></td>          <td>
                <code><a class="autorefs autorefs-internal" title="torch_choice.data.choice_dataset.ChoiceDataset" href="#torch_choice.data.ChoiceDataset">ChoiceDataset</a></code>
          </td>
          <td><p>the modified dataset.</p></td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>torch_choice/data/choice_dataset.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-280">280</a></span>
<span class="normal"><a href="#__codelineno-0-281">281</a></span>
<span class="normal"><a href="#__codelineno-0-282">282</a></span>
<span class="normal"><a href="#__codelineno-0-283">283</a></span>
<span class="normal"><a href="#__codelineno-0-284">284</a></span>
<span class="normal"><a href="#__codelineno-0-285">285</a></span>
<span class="normal"><a href="#__codelineno-0-286">286</a></span>
<span class="normal"><a href="#__codelineno-0-287">287</a></span>
<span class="normal"><a href="#__codelineno-0-288">288</a></span>
<span class="normal"><a href="#__codelineno-0-289">289</a></span>
<span class="normal"><a href="#__codelineno-0-290">290</a></span>
<span class="normal"><a href="#__codelineno-0-291">291</a></span>
<span class="normal"><a href="#__codelineno-0-292">292</a></span>
<span class="normal"><a href="#__codelineno-0-293">293</a></span>
<span class="normal"><a href="#__codelineno-0-294">294</a></span>
<span class="normal"><a href="#__codelineno-0-295">295</a></span>
<span class="normal"><a href="#__codelineno-0-296">296</a></span>
<span class="normal"><a href="#__codelineno-0-297">297</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-280" name="__codelineno-0-280"></a><span class="k">def</span> <span class="nf">apply_tensor</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">func</span><span class="p">:</span> <span class="n">callable</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;ChoiceDataset&quot;</span><span class="p">:</span>
<a id="__codelineno-0-281" name="__codelineno-0-281"></a>    <span class="sd">&quot;&quot;&quot;This s a helper method to apply the provided function to all tensors and tensor values of all dictionaries.</span>
<a id="__codelineno-0-282" name="__codelineno-0-282"></a>
<a id="__codelineno-0-283" name="__codelineno-0-283"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-284" name="__codelineno-0-284"></a><span class="sd">        func (callable): a callable function to be applied on tensors and tensor-values of dictionaries.</span>
<a id="__codelineno-0-285" name="__codelineno-0-285"></a>
<a id="__codelineno-0-286" name="__codelineno-0-286"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-287" name="__codelineno-0-287"></a><span class="sd">        ChoiceDataset: the modified dataset.</span>
<a id="__codelineno-0-288" name="__codelineno-0-288"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-289" name="__codelineno-0-289"></a>    <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">item</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
<a id="__codelineno-0-290" name="__codelineno-0-290"></a>        <span class="k">if</span> <span class="n">torch</span><span class="o">.</span><span class="n">is_tensor</span><span class="p">(</span><span class="n">item</span><span class="p">):</span>
<a id="__codelineno-0-291" name="__codelineno-0-291"></a>            <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">func</span><span class="p">(</span><span class="n">item</span><span class="p">))</span>
<a id="__codelineno-0-292" name="__codelineno-0-292"></a>        <span class="c1"># boardcast func to dictionary of tensors as well.</span>
<a id="__codelineno-0-293" name="__codelineno-0-293"></a>        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">),</span> <span class="nb">dict</span><span class="p">):</span>
<a id="__codelineno-0-294" name="__codelineno-0-294"></a>            <span class="k">for</span> <span class="n">obj_key</span><span class="p">,</span> <span class="n">obj_item</span> <span class="ow">in</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">)</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
<a id="__codelineno-0-295" name="__codelineno-0-295"></a>                <span class="k">if</span> <span class="n">torch</span><span class="o">.</span><span class="n">is_tensor</span><span class="p">(</span><span class="n">obj_item</span><span class="p">):</span>
<a id="__codelineno-0-296" name="__codelineno-0-296"></a>                    <span class="nb">setattr</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">),</span> <span class="n">obj_key</span><span class="p">,</span> <span class="n">func</span><span class="p">(</span><span class="n">obj_item</span><span class="p">))</span>
<a id="__codelineno-0-297" name="__codelineno-0-297"></a>    <span class="k">return</span> <span class="bp">self</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h2 id="torch_choice.data.choice_dataset.ChoiceDataset.clone" class="doc doc-heading">
<code class="highlight language-python"><span class="n">clone</span><span class="p">()</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Creates a copy of self.</p>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
<th>Name</th>        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
<td><code>ChoiceDataset</code></td>          <td>
                <code><a class="autorefs autorefs-internal" title="torch_choice.data.choice_dataset.ChoiceDataset" href="#torch_choice.data.ChoiceDataset">ChoiceDataset</a></code>
          </td>
          <td><p>a copy of self.</p></td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>torch_choice/data/choice_dataset.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-310">310</a></span>
<span class="normal"><a href="#__codelineno-0-311">311</a></span>
<span class="normal"><a href="#__codelineno-0-312">312</a></span>
<span class="normal"><a href="#__codelineno-0-313">313</a></span>
<span class="normal"><a href="#__codelineno-0-314">314</a></span>
<span class="normal"><a href="#__codelineno-0-315">315</a></span>
<span class="normal"><a href="#__codelineno-0-316">316</a></span>
<span class="normal"><a href="#__codelineno-0-317">317</a></span>
<span class="normal"><a href="#__codelineno-0-318">318</a></span>
<span class="normal"><a href="#__codelineno-0-319">319</a></span>
<span class="normal"><a href="#__codelineno-0-320">320</a></span>
<span class="normal"><a href="#__codelineno-0-321">321</a></span>
<span class="normal"><a href="#__codelineno-0-322">322</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-310" name="__codelineno-0-310"></a><span class="k">def</span> <span class="nf">clone</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;ChoiceDataset&quot;</span><span class="p">:</span>
<a id="__codelineno-0-311" name="__codelineno-0-311"></a>    <span class="sd">&quot;&quot;&quot;Creates a copy of self.</span>
<a id="__codelineno-0-312" name="__codelineno-0-312"></a>
<a id="__codelineno-0-313" name="__codelineno-0-313"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-314" name="__codelineno-0-314"></a><span class="sd">        ChoiceDataset: a copy of self.</span>
<a id="__codelineno-0-315" name="__codelineno-0-315"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-316" name="__codelineno-0-316"></a>    <span class="n">dictionary</span> <span class="o">=</span> <span class="p">{}</span>
<a id="__codelineno-0-317" name="__codelineno-0-317"></a>    <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
<a id="__codelineno-0-318" name="__codelineno-0-318"></a>        <span class="k">if</span> <span class="n">torch</span><span class="o">.</span><span class="n">is_tensor</span><span class="p">(</span><span class="n">v</span><span class="p">):</span>
<a id="__codelineno-0-319" name="__codelineno-0-319"></a>            <span class="n">dictionary</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span><span class="o">.</span><span class="n">clone</span><span class="p">()</span>
<a id="__codelineno-0-320" name="__codelineno-0-320"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-321" name="__codelineno-0-321"></a>            <span class="n">dictionary</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
<a id="__codelineno-0-322" name="__codelineno-0-322"></a>    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="n">_from_dict</span><span class="p">(</span><span class="n">dictionary</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h2 id="torch_choice.data.choice_dataset.ChoiceDataset.summary" class="doc doc-heading">
<code class="highlight language-python"><span class="n">summary</span><span class="p">()</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>A method to summarize the dataset.</p>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
<th>Name</th>        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
<td><code>str</code></td>          <td>
                <code>None</code>
          </td>
          <td><p>the string representation of the dataset.</p></td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>torch_choice/data/choice_dataset.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-447">447</a></span>
<span class="normal"><a href="#__codelineno-0-448">448</a></span>
<span class="normal"><a href="#__codelineno-0-449">449</a></span>
<span class="normal"><a href="#__codelineno-0-450">450</a></span>
<span class="normal"><a href="#__codelineno-0-451">451</a></span>
<span class="normal"><a href="#__codelineno-0-452">452</a></span>
<span class="normal"><a href="#__codelineno-0-453">453</a></span>
<span class="normal"><a href="#__codelineno-0-454">454</a></span>
<span class="normal"><a href="#__codelineno-0-455">455</a></span>
<span class="normal"><a href="#__codelineno-0-456">456</a></span>
<span class="normal"><a href="#__codelineno-0-457">457</a></span>
<span class="normal"><a href="#__codelineno-0-458">458</a></span>
<span class="normal"><a href="#__codelineno-0-459">459</a></span>
<span class="normal"><a href="#__codelineno-0-460">460</a></span>
<span class="normal"><a href="#__codelineno-0-461">461</a></span>
<span class="normal"><a href="#__codelineno-0-462">462</a></span>
<span class="normal"><a href="#__codelineno-0-463">463</a></span>
<span class="normal"><a href="#__codelineno-0-464">464</a></span>
<span class="normal"><a href="#__codelineno-0-465">465</a></span>
<span class="normal"><a href="#__codelineno-0-466">466</a></span>
<span class="normal"><a href="#__codelineno-0-467">467</a></span>
<span class="normal"><a href="#__codelineno-0-468">468</a></span>
<span class="normal"><a href="#__codelineno-0-469">469</a></span>
<span class="normal"><a href="#__codelineno-0-470">470</a></span>
<span class="normal"><a href="#__codelineno-0-471">471</a></span>
<span class="normal"><a href="#__codelineno-0-472">472</a></span>
<span class="normal"><a href="#__codelineno-0-473">473</a></span>
<span class="normal"><a href="#__codelineno-0-474">474</a></span>
<span class="normal"><a href="#__codelineno-0-475">475</a></span>
<span class="normal"><a href="#__codelineno-0-476">476</a></span>
<span class="normal"><a href="#__codelineno-0-477">477</a></span>
<span class="normal"><a href="#__codelineno-0-478">478</a></span>
<span class="normal"><a href="#__codelineno-0-479">479</a></span>
<span class="normal"><a href="#__codelineno-0-480">480</a></span>
<span class="normal"><a href="#__codelineno-0-481">481</a></span>
<span class="normal"><a href="#__codelineno-0-482">482</a></span>
<span class="normal"><a href="#__codelineno-0-483">483</a></span>
<span class="normal"><a href="#__codelineno-0-484">484</a></span>
<span class="normal"><a href="#__codelineno-0-485">485</a></span>
<span class="normal"><a href="#__codelineno-0-486">486</a></span>
<span class="normal"><a href="#__codelineno-0-487">487</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-447" name="__codelineno-0-447"></a><span class="k">def</span> <span class="nf">summary</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-448" name="__codelineno-0-448"></a>    <span class="sd">&quot;&quot;&quot;A method to summarize the dataset.</span>
<a id="__codelineno-0-449" name="__codelineno-0-449"></a>
<a id="__codelineno-0-450" name="__codelineno-0-450"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-451" name="__codelineno-0-451"></a><span class="sd">        str: the string representation of the dataset.</span>
<a id="__codelineno-0-452" name="__codelineno-0-452"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-453" name="__codelineno-0-453"></a>    <span class="n">summary</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;ChoiceDataset with </span><span class="si">{}</span><span class="s1"> sessions, </span><span class="si">{}</span><span class="s1"> items, </span><span class="si">{}</span><span class="s1"> users, </span><span class="si">{}</span><span class="s1"> purchase records (observations) .&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
<a id="__codelineno-0-454" name="__codelineno-0-454"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">num_sessions</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_items</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_users</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">user_index</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="s1">&#39;single&#39;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">))]</span>
<a id="__codelineno-0-455" name="__codelineno-0-455"></a>
<a id="__codelineno-0-456" name="__codelineno-0-456"></a>    <span class="c1"># summarize users.</span>
<a id="__codelineno-0-457" name="__codelineno-0-457"></a>    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">user_index</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-458" name="__codelineno-0-458"></a>        <span class="n">unique</span><span class="p">,</span> <span class="n">counts</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">user_index</span><span class="p">)</span>
<a id="__codelineno-0-459" name="__codelineno-0-459"></a>        <span class="n">summary</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;The most frequent user is </span><span class="si">{</span><span class="n">unique</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2"> with </span><span class="si">{</span><span class="n">counts</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2"> observations; the least frequent user is </span><span class="si">{</span><span class="n">unique</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s2"> with </span><span class="si">{</span><span class="n">counts</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s2"> observations; on average, there are </span><span class="si">{</span><span class="n">counts</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> observations per user.&quot;</span><span class="p">)</span>
<a id="__codelineno-0-460" name="__codelineno-0-460"></a>
<a id="__codelineno-0-461" name="__codelineno-0-461"></a>        <span class="n">N</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">unique</span><span class="p">)</span>
<a id="__codelineno-0-462" name="__codelineno-0-462"></a>        <span class="n">K</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="n">N</span><span class="p">)</span>
<a id="__codelineno-0-463" name="__codelineno-0-463"></a>        <span class="n">string</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">K</span><span class="si">}</span><span class="s1"> most frequent users are: &#39;</span> <span class="o">+</span> <span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">unique</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="si">}</span><span class="s1">(</span><span class="si">{</span><span class="n">counts</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="si">}</span><span class="s1"> times)&#39;</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">K</span><span class="p">)])</span> <span class="o">+</span> <span class="s1">&#39;.&#39;</span>
<a id="__codelineno-0-464" name="__codelineno-0-464"></a>        <span class="n">summary</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">string</span><span class="p">)</span>
<a id="__codelineno-0-465" name="__codelineno-0-465"></a>        <span class="n">string</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">K</span><span class="si">}</span><span class="s1"> least frequent users are: &#39;</span> <span class="o">+</span> <span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">unique</span><span class="p">[</span><span class="n">N</span><span class="o">-</span><span class="n">i</span><span class="p">]</span><span class="si">}</span><span class="s1">(</span><span class="si">{</span><span class="n">counts</span><span class="p">[</span><span class="n">N</span><span class="o">-</span><span class="n">i</span><span class="p">]</span><span class="si">}</span><span class="s1"> times)&#39;</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">K</span><span class="o">+</span><span class="mi">1</span><span class="p">)])</span> <span class="o">+</span> <span class="s1">&#39;.&#39;</span>
<a id="__codelineno-0-466" name="__codelineno-0-466"></a>        <span class="n">summary</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">string</span><span class="p">)</span>
<a id="__codelineno-0-467" name="__codelineno-0-467"></a>
<a id="__codelineno-0-468" name="__codelineno-0-468"></a>    <span class="c1"># summarize items.</span>
<a id="__codelineno-0-469" name="__codelineno-0-469"></a>    <span class="n">unique</span><span class="p">,</span> <span class="n">counts</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">item_index</span><span class="p">)</span>
<a id="__codelineno-0-470" name="__codelineno-0-470"></a>    <span class="n">N</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">unique</span><span class="p">)</span>
<a id="__codelineno-0-471" name="__codelineno-0-471"></a>    <span class="n">K</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="n">N</span><span class="p">)</span>
<a id="__codelineno-0-472" name="__codelineno-0-472"></a>    <span class="n">summary</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;The most frequent item is </span><span class="si">{</span><span class="n">unique</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2">, it was chosen </span><span class="si">{</span><span class="n">counts</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2"> times; the least frequent item is </span><span class="si">{</span><span class="n">unique</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s2"> it was </span><span class="si">{</span><span class="n">counts</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s2"> times; on average, each item was purchased </span><span class="si">{</span><span class="n">counts</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> times.&quot;</span><span class="p">)</span>
<a id="__codelineno-0-473" name="__codelineno-0-473"></a>
<a id="__codelineno-0-474" name="__codelineno-0-474"></a>    <span class="n">string</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">K</span><span class="si">}</span><span class="s1"> most frequent items are: &#39;</span> <span class="o">+</span> <span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">unique</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="si">}</span><span class="s1">(</span><span class="si">{</span><span class="n">counts</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="si">}</span><span class="s1"> times)&#39;</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">K</span><span class="p">)])</span> <span class="o">+</span> <span class="s1">&#39;.&#39;</span>
<a id="__codelineno-0-475" name="__codelineno-0-475"></a>    <span class="n">summary</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">string</span><span class="p">)</span>
<a id="__codelineno-0-476" name="__codelineno-0-476"></a>    <span class="n">string</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">K</span><span class="si">}</span><span class="s1"> least frequent items are: &#39;</span> <span class="o">+</span> <span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">unique</span><span class="p">[</span><span class="n">N</span><span class="o">-</span><span class="n">i</span><span class="p">]</span><span class="si">}</span><span class="s1">(</span><span class="si">{</span><span class="n">counts</span><span class="p">[</span><span class="n">N</span><span class="o">-</span><span class="n">i</span><span class="p">]</span><span class="si">}</span><span class="s1"> times)&#39;</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">K</span><span class="o">+</span><span class="mi">1</span><span class="p">)])</span> <span class="o">+</span> <span class="s1">&#39;.&#39;</span>
<a id="__codelineno-0-477" name="__codelineno-0-477"></a>    <span class="n">summary</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">string</span><span class="p">)</span>
<a id="__codelineno-0-478" name="__codelineno-0-478"></a>
<a id="__codelineno-0-479" name="__codelineno-0-479"></a>    <span class="n">summary</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;Attribute Summaries:&#39;</span><span class="p">)</span>
<a id="__codelineno-0-480" name="__codelineno-0-480"></a>    <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">item</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
<a id="__codelineno-0-481" name="__codelineno-0-481"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_is_attribute</span><span class="p">(</span><span class="n">key</span><span class="p">)</span> <span class="ow">and</span> <span class="n">torch</span><span class="o">.</span><span class="n">is_tensor</span><span class="p">(</span><span class="n">item</span><span class="p">):</span>
<a id="__codelineno-0-482" name="__codelineno-0-482"></a>            <span class="n">summary</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;Observable Tensor &#39;</span><span class="si">{}</span><span class="s2">&#39; with shape </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">item</span><span class="o">.</span><span class="n">shape</span><span class="p">))</span>
<a id="__codelineno-0-483" name="__codelineno-0-483"></a>            <span class="c1"># price attributes are 3-dimensional tensors, ignore  for cleanness here.</span>
<a id="__codelineno-0-484" name="__codelineno-0-484"></a>            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_is_price_attribute</span><span class="p">(</span><span class="n">key</span><span class="p">):</span>
<a id="__codelineno-0-485" name="__codelineno-0-485"></a>                <span class="n">summary</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">item</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="s1">&#39;cpu&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">float</span><span class="p">()</span><span class="o">.</span><span class="n">numpy</span><span class="p">())</span><span class="o">.</span><span class="n">describe</span><span class="p">()))</span>
<a id="__codelineno-0-486" name="__codelineno-0-486"></a>    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">summary</span><span class="p">)</span> <span class="o">+</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">device=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-487" name="__codelineno-0-487"></a>    <span class="k">return</span> <span class="kc">None</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h2 id="torch_choice.data.choice_dataset.ChoiceDataset.to" class="doc doc-heading">
<code class="highlight language-python"><span class="n">to</span><span class="p">(</span><span class="n">device</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Moves all tensors in this dataset to the specified PyTorch device.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>device</code></td>
          <td>
                <code><span title="typing.Union">Union</span>[str, torch.<span title="torch.device">device</span>]</code>
          </td>
          <td><p>the destination device.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
<th>Name</th>        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
<td><code>ChoiceDataset</code></td>          <td>
                <code><a class="autorefs autorefs-internal" title="torch_choice.data.choice_dataset.ChoiceDataset" href="#torch_choice.data.ChoiceDataset">ChoiceDataset</a></code>
          </td>
          <td><p>the modified dataset on the new device.</p></td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>torch_choice/data/choice_dataset.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-299">299</a></span>
<span class="normal"><a href="#__codelineno-0-300">300</a></span>
<span class="normal"><a href="#__codelineno-0-301">301</a></span>
<span class="normal"><a href="#__codelineno-0-302">302</a></span>
<span class="normal"><a href="#__codelineno-0-303">303</a></span>
<span class="normal"><a href="#__codelineno-0-304">304</a></span>
<span class="normal"><a href="#__codelineno-0-305">305</a></span>
<span class="normal"><a href="#__codelineno-0-306">306</a></span>
<span class="normal"><a href="#__codelineno-0-307">307</a></span>
<span class="normal"><a href="#__codelineno-0-308">308</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-299" name="__codelineno-0-299"></a><span class="k">def</span> <span class="nf">to</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">device</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">torch</span><span class="o">.</span><span class="n">device</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="s2">&quot;ChoiceDataset&quot;</span><span class="p">:</span>
<a id="__codelineno-0-300" name="__codelineno-0-300"></a>    <span class="sd">&quot;&quot;&quot;Moves all tensors in this dataset to the specified PyTorch device.</span>
<a id="__codelineno-0-301" name="__codelineno-0-301"></a>
<a id="__codelineno-0-302" name="__codelineno-0-302"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-303" name="__codelineno-0-303"></a><span class="sd">        device (Union[str, torch.device]): the destination device.</span>
<a id="__codelineno-0-304" name="__codelineno-0-304"></a>
<a id="__codelineno-0-305" name="__codelineno-0-305"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-306" name="__codelineno-0-306"></a><span class="sd">        ChoiceDataset: the modified dataset on the new device.</span>
<a id="__codelineno-0-307" name="__codelineno-0-307"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-308" name="__codelineno-0-308"></a>    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">apply_tensor</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">device</span><span class="p">))</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>



  </div>

  </div>

</div>

<div class="doc doc-object doc-class">


<a id="torch_choice.data.JointDataset"></a>
  <div class="doc doc-contents first">
      <p class="doc doc-class-bases">
        Bases: <code>torch.<span title="torch.utils">utils</span>.<span title="torch.utils.data">data</span>.<span title="torch.utils.data.Dataset">Dataset</span></code></p>

  
      <p>A helper class for joining several pytorch datasets, using JointDataset
and pytorch data loader allows for sampling the same batch index from several
datasets.</p>
<p>The JointDataset class is a wrapper for the torch.utils.data.ChoiceDataset class, it is particularly useful when we
need to make prediction from multiple datasets. For example, you have data on consumer purchase records in a fast food
store, and suppose every customer will purchase exactly a single main food and a single drink. In this case, you have
two separate datasets: FoodDataset and DrinkDataset. You may want to use PyTorch sampler to sample them in a dependent
manner: you want to take the i-th sample from both datasets, so that you know what (food, drink) combo the i-th customer
purchased. You can do this by using the JointDataset class.</p>


        <details class="quote">
          <summary>Source code in <code>torch_choice/data/joint_dataset.py</code></summary>
          <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-18"> 18</a></span>
<span class="normal"><a href="#__codelineno-0-19"> 19</a></span>
<span class="normal"><a href="#__codelineno-0-20"> 20</a></span>
<span class="normal"><a href="#__codelineno-0-21"> 21</a></span>
<span class="normal"><a href="#__codelineno-0-22"> 22</a></span>
<span class="normal"><a href="#__codelineno-0-23"> 23</a></span>
<span class="normal"><a href="#__codelineno-0-24"> 24</a></span>
<span class="normal"><a href="#__codelineno-0-25"> 25</a></span>
<span class="normal"><a href="#__codelineno-0-26"> 26</a></span>
<span class="normal"><a href="#__codelineno-0-27"> 27</a></span>
<span class="normal"><a href="#__codelineno-0-28"> 28</a></span>
<span class="normal"><a href="#__codelineno-0-29"> 29</a></span>
<span class="normal"><a href="#__codelineno-0-30"> 30</a></span>
<span class="normal"><a href="#__codelineno-0-31"> 31</a></span>
<span class="normal"><a href="#__codelineno-0-32"> 32</a></span>
<span class="normal"><a href="#__codelineno-0-33"> 33</a></span>
<span class="normal"><a href="#__codelineno-0-34"> 34</a></span>
<span class="normal"><a href="#__codelineno-0-35"> 35</a></span>
<span class="normal"><a href="#__codelineno-0-36"> 36</a></span>
<span class="normal"><a href="#__codelineno-0-37"> 37</a></span>
<span class="normal"><a href="#__codelineno-0-38"> 38</a></span>
<span class="normal"><a href="#__codelineno-0-39"> 39</a></span>
<span class="normal"><a href="#__codelineno-0-40"> 40</a></span>
<span class="normal"><a href="#__codelineno-0-41"> 41</a></span>
<span class="normal"><a href="#__codelineno-0-42"> 42</a></span>
<span class="normal"><a href="#__codelineno-0-43"> 43</a></span>
<span class="normal"><a href="#__codelineno-0-44"> 44</a></span>
<span class="normal"><a href="#__codelineno-0-45"> 45</a></span>
<span class="normal"><a href="#__codelineno-0-46"> 46</a></span>
<span class="normal"><a href="#__codelineno-0-47"> 47</a></span>
<span class="normal"><a href="#__codelineno-0-48"> 48</a></span>
<span class="normal"><a href="#__codelineno-0-49"> 49</a></span>
<span class="normal"><a href="#__codelineno-0-50"> 50</a></span>
<span class="normal"><a href="#__codelineno-0-51"> 51</a></span>
<span class="normal"><a href="#__codelineno-0-52"> 52</a></span>
<span class="normal"><a href="#__codelineno-0-53"> 53</a></span>
<span class="normal"><a href="#__codelineno-0-54"> 54</a></span>
<span class="normal"><a href="#__codelineno-0-55"> 55</a></span>
<span class="normal"><a href="#__codelineno-0-56"> 56</a></span>
<span class="normal"><a href="#__codelineno-0-57"> 57</a></span>
<span class="normal"><a href="#__codelineno-0-58"> 58</a></span>
<span class="normal"><a href="#__codelineno-0-59"> 59</a></span>
<span class="normal"><a href="#__codelineno-0-60"> 60</a></span>
<span class="normal"><a href="#__codelineno-0-61"> 61</a></span>
<span class="normal"><a href="#__codelineno-0-62"> 62</a></span>
<span class="normal"><a href="#__codelineno-0-63"> 63</a></span>
<span class="normal"><a href="#__codelineno-0-64"> 64</a></span>
<span class="normal"><a href="#__codelineno-0-65"> 65</a></span>
<span class="normal"><a href="#__codelineno-0-66"> 66</a></span>
<span class="normal"><a href="#__codelineno-0-67"> 67</a></span>
<span class="normal"><a href="#__codelineno-0-68"> 68</a></span>
<span class="normal"><a href="#__codelineno-0-69"> 69</a></span>
<span class="normal"><a href="#__codelineno-0-70"> 70</a></span>
<span class="normal"><a href="#__codelineno-0-71"> 71</a></span>
<span class="normal"><a href="#__codelineno-0-72"> 72</a></span>
<span class="normal"><a href="#__codelineno-0-73"> 73</a></span>
<span class="normal"><a href="#__codelineno-0-74"> 74</a></span>
<span class="normal"><a href="#__codelineno-0-75"> 75</a></span>
<span class="normal"><a href="#__codelineno-0-76"> 76</a></span>
<span class="normal"><a href="#__codelineno-0-77"> 77</a></span>
<span class="normal"><a href="#__codelineno-0-78"> 78</a></span>
<span class="normal"><a href="#__codelineno-0-79"> 79</a></span>
<span class="normal"><a href="#__codelineno-0-80"> 80</a></span>
<span class="normal"><a href="#__codelineno-0-81"> 81</a></span>
<span class="normal"><a href="#__codelineno-0-82"> 82</a></span>
<span class="normal"><a href="#__codelineno-0-83"> 83</a></span>
<span class="normal"><a href="#__codelineno-0-84"> 84</a></span>
<span class="normal"><a href="#__codelineno-0-85"> 85</a></span>
<span class="normal"><a href="#__codelineno-0-86"> 86</a></span>
<span class="normal"><a href="#__codelineno-0-87"> 87</a></span>
<span class="normal"><a href="#__codelineno-0-88"> 88</a></span>
<span class="normal"><a href="#__codelineno-0-89"> 89</a></span>
<span class="normal"><a href="#__codelineno-0-90"> 90</a></span>
<span class="normal"><a href="#__codelineno-0-91"> 91</a></span>
<span class="normal"><a href="#__codelineno-0-92"> 92</a></span>
<span class="normal"><a href="#__codelineno-0-93"> 93</a></span>
<span class="normal"><a href="#__codelineno-0-94"> 94</a></span>
<span class="normal"><a href="#__codelineno-0-95"> 95</a></span>
<span class="normal"><a href="#__codelineno-0-96"> 96</a></span>
<span class="normal"><a href="#__codelineno-0-97"> 97</a></span>
<span class="normal"><a href="#__codelineno-0-98"> 98</a></span>
<span class="normal"><a href="#__codelineno-0-99"> 99</a></span>
<span class="normal"><a href="#__codelineno-0-100">100</a></span>
<span class="normal"><a href="#__codelineno-0-101">101</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-18" name="__codelineno-0-18"></a><span class="k">class</span> <span class="nc">JointDataset</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">Dataset</span><span class="p">):</span>
<a id="__codelineno-0-19" name="__codelineno-0-19"></a>    <span class="sd">&quot;&quot;&quot;A helper class for joining several pytorch datasets, using JointDataset</span>
<a id="__codelineno-0-20" name="__codelineno-0-20"></a><span class="sd">    and pytorch data loader allows for sampling the same batch index from several</span>
<a id="__codelineno-0-21" name="__codelineno-0-21"></a><span class="sd">    datasets.</span>
<a id="__codelineno-0-22" name="__codelineno-0-22"></a>
<a id="__codelineno-0-23" name="__codelineno-0-23"></a><span class="sd">    The JointDataset class is a wrapper for the torch.utils.data.ChoiceDataset class, it is particularly useful when we</span>
<a id="__codelineno-0-24" name="__codelineno-0-24"></a><span class="sd">    need to make prediction from multiple datasets. For example, you have data on consumer purchase records in a fast food</span>
<a id="__codelineno-0-25" name="__codelineno-0-25"></a><span class="sd">    store, and suppose every customer will purchase exactly a single main food and a single drink. In this case, you have</span>
<a id="__codelineno-0-26" name="__codelineno-0-26"></a><span class="sd">    two separate datasets: FoodDataset and DrinkDataset. You may want to use PyTorch sampler to sample them in a dependent</span>
<a id="__codelineno-0-27" name="__codelineno-0-27"></a><span class="sd">    manner: you want to take the i-th sample from both datasets, so that you know what (food, drink) combo the i-th customer</span>
<a id="__codelineno-0-28" name="__codelineno-0-28"></a><span class="sd">    purchased. You can do this by using the JointDataset class.</span>
<a id="__codelineno-0-29" name="__codelineno-0-29"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-30" name="__codelineno-0-30"></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">datasets</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-31" name="__codelineno-0-31"></a>        <span class="sd">&quot;&quot;&quot;The initialize methods.</span>
<a id="__codelineno-0-32" name="__codelineno-0-32"></a>
<a id="__codelineno-0-33" name="__codelineno-0-33"></a><span class="sd">        Args:</span>
<a id="__codelineno-0-34" name="__codelineno-0-34"></a><span class="sd">            Arbitrarily many datasets with arbitrary names as keys. In the example above, you can construct</span>
<a id="__codelineno-0-35" name="__codelineno-0-35"></a><span class="sd">            ```</span>
<a id="__codelineno-0-36" name="__codelineno-0-36"></a><span class="sd">            dataset = JointDataset(food=FoodDataset, drink=DrinkDataset)</span>
<a id="__codelineno-0-37" name="__codelineno-0-37"></a><span class="sd">            ```</span>
<a id="__codelineno-0-38" name="__codelineno-0-38"></a><span class="sd">            All datasets should have the same length.</span>
<a id="__codelineno-0-39" name="__codelineno-0-39"></a>
<a id="__codelineno-0-40" name="__codelineno-0-40"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-41" name="__codelineno-0-41"></a>        <span class="nb">super</span><span class="p">(</span><span class="n">JointDataset</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
<a id="__codelineno-0-42" name="__codelineno-0-42"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">datasets</span> <span class="o">=</span> <span class="n">datasets</span>
<a id="__codelineno-0-43" name="__codelineno-0-43"></a>        <span class="c1"># check the length of sub-datasets are the same.</span>
<a id="__codelineno-0-44" name="__codelineno-0-44"></a>        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="nb">set</span><span class="p">([</span><span class="nb">len</span><span class="p">(</span><span class="n">d</span><span class="p">)</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">datasets</span><span class="o">.</span><span class="n">values</span><span class="p">()]))</span> <span class="o">==</span> <span class="mi">1</span>
<a id="__codelineno-0-45" name="__codelineno-0-45"></a>
<a id="__codelineno-0-46" name="__codelineno-0-46"></a>    <span class="k">def</span> <span class="fm">__len__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<a id="__codelineno-0-47" name="__codelineno-0-47"></a>        <span class="sd">&quot;&quot;&quot;Get the number of samples in the joint dataset.</span>
<a id="__codelineno-0-48" name="__codelineno-0-48"></a>
<a id="__codelineno-0-49" name="__codelineno-0-49"></a><span class="sd">        Returns:</span>
<a id="__codelineno-0-50" name="__codelineno-0-50"></a><span class="sd">            int: the number of samples in the joint dataset, which is the same as the number of samples in each dataset contained.</span>
<a id="__codelineno-0-51" name="__codelineno-0-51"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-52" name="__codelineno-0-52"></a>        <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">datasets</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
<a id="__codelineno-0-53" name="__codelineno-0-53"></a>            <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>
<a id="__codelineno-0-54" name="__codelineno-0-54"></a>
<a id="__codelineno-0-55" name="__codelineno-0-55"></a>    <span class="k">def</span> <span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">indices</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n">torch</span><span class="o">.</span><span class="n">LongTensor</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">ChoiceDataset</span><span class="p">]:</span>
<a id="__codelineno-0-56" name="__codelineno-0-56"></a>        <span class="sd">&quot;&quot;&quot;Queries samples from the dataset by index.</span>
<a id="__codelineno-0-57" name="__codelineno-0-57"></a>
<a id="__codelineno-0-58" name="__codelineno-0-58"></a><span class="sd">        Args:</span>
<a id="__codelineno-0-59" name="__codelineno-0-59"></a><span class="sd">            indices (Union[int, torch.LongTensor]): an integer or a 1D tensor of multiple indices.</span>
<a id="__codelineno-0-60" name="__codelineno-0-60"></a>
<a id="__codelineno-0-61" name="__codelineno-0-61"></a><span class="sd">        Returns:</span>
<a id="__codelineno-0-62" name="__codelineno-0-62"></a><span class="sd">            Dict[str, ChoiceDataset]: the subset of the dataset. Keys of the dictionary will be names of each dataset</span>
<a id="__codelineno-0-63" name="__codelineno-0-63"></a><span class="sd">                contained (the same as the keys of the ``datasets`` argument in the constructor). Values will be subsets</span>
<a id="__codelineno-0-64" name="__codelineno-0-64"></a><span class="sd">                of contained datasets, sliced using the provided indices.</span>
<a id="__codelineno-0-65" name="__codelineno-0-65"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-66" name="__codelineno-0-66"></a>        <span class="k">return</span> <span class="nb">dict</span><span class="p">((</span><span class="n">name</span><span class="p">,</span> <span class="n">d</span><span class="p">[</span><span class="n">indices</span><span class="p">])</span> <span class="k">for</span> <span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">d</span><span class="p">)</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">datasets</span><span class="o">.</span><span class="n">items</span><span class="p">())</span>
<a id="__codelineno-0-67" name="__codelineno-0-67"></a>
<a id="__codelineno-0-68" name="__codelineno-0-68"></a>    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<a id="__codelineno-0-69" name="__codelineno-0-69"></a>        <span class="sd">&quot;&quot;&quot;A method to get a string representation of the dataset.</span>
<a id="__codelineno-0-70" name="__codelineno-0-70"></a>
<a id="__codelineno-0-71" name="__codelineno-0-71"></a><span class="sd">        Returns:</span>
<a id="__codelineno-0-72" name="__codelineno-0-72"></a><span class="sd">            str: the string representation of the dataset.</span>
<a id="__codelineno-0-73" name="__codelineno-0-73"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-74" name="__codelineno-0-74"></a>        <span class="n">out</span> <span class="o">=</span> <span class="p">[</span><span class="sa">f</span><span class="s1">&#39;JointDataset with </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">datasets</span><span class="p">)</span><span class="si">}</span><span class="s1"> sub-datasets: (&#39;</span><span class="p">]</span>
<a id="__codelineno-0-75" name="__codelineno-0-75"></a>        <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">dataset</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">datasets</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
<a id="__codelineno-0-76" name="__codelineno-0-76"></a>            <span class="n">out</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="se">\t</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s1">: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">dataset</span><span class="p">)</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
<a id="__codelineno-0-77" name="__codelineno-0-77"></a>        <span class="n">out</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;)&#39;</span><span class="p">)</span>
<a id="__codelineno-0-78" name="__codelineno-0-78"></a>        <span class="k">return</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">out</span><span class="p">)</span>
<a id="__codelineno-0-79" name="__codelineno-0-79"></a>
<a id="__codelineno-0-80" name="__codelineno-0-80"></a>    <span class="nd">@property</span>
<a id="__codelineno-0-81" name="__codelineno-0-81"></a>    <span class="k">def</span> <span class="nf">device</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<a id="__codelineno-0-82" name="__codelineno-0-82"></a>        <span class="sd">&quot;&quot;&quot;Returns the device of datasets contained in the joint dataset.</span>
<a id="__codelineno-0-83" name="__codelineno-0-83"></a>
<a id="__codelineno-0-84" name="__codelineno-0-84"></a><span class="sd">        Returns:</span>
<a id="__codelineno-0-85" name="__codelineno-0-85"></a><span class="sd">            str: the device of the dataset.</span>
<a id="__codelineno-0-86" name="__codelineno-0-86"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-87" name="__codelineno-0-87"></a>        <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">datasets</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
<a id="__codelineno-0-88" name="__codelineno-0-88"></a>            <span class="k">return</span> <span class="n">d</span><span class="o">.</span><span class="n">device</span>
<a id="__codelineno-0-89" name="__codelineno-0-89"></a>
<a id="__codelineno-0-90" name="__codelineno-0-90"></a>    <span class="k">def</span> <span class="nf">to</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">device</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">torch</span><span class="o">.</span><span class="n">device</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="s2">&quot;JointDataset&quot;</span><span class="p">:</span>
<a id="__codelineno-0-91" name="__codelineno-0-91"></a>        <span class="sd">&quot;&quot;&quot;Moves all datasets in this dataset to the specified PyTorch device.</span>
<a id="__codelineno-0-92" name="__codelineno-0-92"></a>
<a id="__codelineno-0-93" name="__codelineno-0-93"></a><span class="sd">        Args:</span>
<a id="__codelineno-0-94" name="__codelineno-0-94"></a><span class="sd">            device (Union[str, torch.device]): the destination device.</span>
<a id="__codelineno-0-95" name="__codelineno-0-95"></a>
<a id="__codelineno-0-96" name="__codelineno-0-96"></a><span class="sd">        Returns:</span>
<a id="__codelineno-0-97" name="__codelineno-0-97"></a><span class="sd">            ChoiceDataset: the modified dataset on the new device.</span>
<a id="__codelineno-0-98" name="__codelineno-0-98"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-99" name="__codelineno-0-99"></a>        <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">datasets</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
<a id="__codelineno-0-100" name="__codelineno-0-100"></a>            <span class="n">d</span> <span class="o">=</span> <span class="n">d</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">device</span><span class="p">)</span>
<a id="__codelineno-0-101" name="__codelineno-0-101"></a>        <span class="k">return</span> <span class="bp">self</span>
</code></pre></div></td></tr></table></div>
        </details>

  

  <div class="doc doc-children">







<div class="doc doc-object doc-attribute">



<h2 id="torch_choice.data.joint_dataset.JointDataset.device" class="doc doc-heading">
<code class="highlight language-python"><span class="n">device</span><span class="p">:</span> <span class="nb">str</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h2>


  <div class="doc doc-contents ">
  
      <p>Returns the device of datasets contained in the joint dataset.</p>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
<th>Name</th>        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
<td><code>str</code></td>          <td>
                <code>str</code>
          </td>
          <td><p>the device of the dataset.</p></td>
        </tr>
    </tbody>
  </table>
  </div>

</div>



<div class="doc doc-object doc-function">



<h2 id="torch_choice.data.joint_dataset.JointDataset.__getitem__" class="doc doc-heading">
<code class="highlight language-python"><span class="fm">__getitem__</span><span class="p">(</span><span class="n">indices</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Queries samples from the dataset by index.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>indices</code></td>
          <td>
                <code><span title="typing.Union">Union</span>[int, torch.<span title="torch.LongTensor">LongTensor</span>]</code>
          </td>
          <td><p>an integer or a 1D tensor of multiple indices.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code><span title="typing.Dict">Dict</span>[str, <a class="autorefs autorefs-internal" title="torch_choice.data.choice_dataset.ChoiceDataset" href="#torch_choice.data.ChoiceDataset">ChoiceDataset</a>]</code>
          </td>
          <td><p>Dict[str, ChoiceDataset]: the subset of the dataset. Keys of the dictionary will be names of each dataset
contained (the same as the keys of the <code>datasets</code> argument in the constructor). Values will be subsets
of contained datasets, sliced using the provided indices.</p></td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>torch_choice/data/joint_dataset.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-55">55</a></span>
<span class="normal"><a href="#__codelineno-0-56">56</a></span>
<span class="normal"><a href="#__codelineno-0-57">57</a></span>
<span class="normal"><a href="#__codelineno-0-58">58</a></span>
<span class="normal"><a href="#__codelineno-0-59">59</a></span>
<span class="normal"><a href="#__codelineno-0-60">60</a></span>
<span class="normal"><a href="#__codelineno-0-61">61</a></span>
<span class="normal"><a href="#__codelineno-0-62">62</a></span>
<span class="normal"><a href="#__codelineno-0-63">63</a></span>
<span class="normal"><a href="#__codelineno-0-64">64</a></span>
<span class="normal"><a href="#__codelineno-0-65">65</a></span>
<span class="normal"><a href="#__codelineno-0-66">66</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-55" name="__codelineno-0-55"></a><span class="k">def</span> <span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">indices</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n">torch</span><span class="o">.</span><span class="n">LongTensor</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">ChoiceDataset</span><span class="p">]:</span>
<a id="__codelineno-0-56" name="__codelineno-0-56"></a>    <span class="sd">&quot;&quot;&quot;Queries samples from the dataset by index.</span>
<a id="__codelineno-0-57" name="__codelineno-0-57"></a>
<a id="__codelineno-0-58" name="__codelineno-0-58"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-59" name="__codelineno-0-59"></a><span class="sd">        indices (Union[int, torch.LongTensor]): an integer or a 1D tensor of multiple indices.</span>
<a id="__codelineno-0-60" name="__codelineno-0-60"></a>
<a id="__codelineno-0-61" name="__codelineno-0-61"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-62" name="__codelineno-0-62"></a><span class="sd">        Dict[str, ChoiceDataset]: the subset of the dataset. Keys of the dictionary will be names of each dataset</span>
<a id="__codelineno-0-63" name="__codelineno-0-63"></a><span class="sd">            contained (the same as the keys of the ``datasets`` argument in the constructor). Values will be subsets</span>
<a id="__codelineno-0-64" name="__codelineno-0-64"></a><span class="sd">            of contained datasets, sliced using the provided indices.</span>
<a id="__codelineno-0-65" name="__codelineno-0-65"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-66" name="__codelineno-0-66"></a>    <span class="k">return</span> <span class="nb">dict</span><span class="p">((</span><span class="n">name</span><span class="p">,</span> <span class="n">d</span><span class="p">[</span><span class="n">indices</span><span class="p">])</span> <span class="k">for</span> <span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">d</span><span class="p">)</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">datasets</span><span class="o">.</span><span class="n">items</span><span class="p">())</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h2 id="torch_choice.data.joint_dataset.JointDataset.__init__" class="doc doc-heading">
<code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="o">**</span><span class="n">datasets</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>The initialize methods.</p>

      <details class="quote">
        <summary>Source code in <code>torch_choice/data/joint_dataset.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-30">30</a></span>
<span class="normal"><a href="#__codelineno-0-31">31</a></span>
<span class="normal"><a href="#__codelineno-0-32">32</a></span>
<span class="normal"><a href="#__codelineno-0-33">33</a></span>
<span class="normal"><a href="#__codelineno-0-34">34</a></span>
<span class="normal"><a href="#__codelineno-0-35">35</a></span>
<span class="normal"><a href="#__codelineno-0-36">36</a></span>
<span class="normal"><a href="#__codelineno-0-37">37</a></span>
<span class="normal"><a href="#__codelineno-0-38">38</a></span>
<span class="normal"><a href="#__codelineno-0-39">39</a></span>
<span class="normal"><a href="#__codelineno-0-40">40</a></span>
<span class="normal"><a href="#__codelineno-0-41">41</a></span>
<span class="normal"><a href="#__codelineno-0-42">42</a></span>
<span class="normal"><a href="#__codelineno-0-43">43</a></span>
<span class="normal"><a href="#__codelineno-0-44">44</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-30" name="__codelineno-0-30"></a><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">datasets</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-31" name="__codelineno-0-31"></a>    <span class="sd">&quot;&quot;&quot;The initialize methods.</span>
<a id="__codelineno-0-32" name="__codelineno-0-32"></a>
<a id="__codelineno-0-33" name="__codelineno-0-33"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-34" name="__codelineno-0-34"></a><span class="sd">        Arbitrarily many datasets with arbitrary names as keys. In the example above, you can construct</span>
<a id="__codelineno-0-35" name="__codelineno-0-35"></a><span class="sd">        ```</span>
<a id="__codelineno-0-36" name="__codelineno-0-36"></a><span class="sd">        dataset = JointDataset(food=FoodDataset, drink=DrinkDataset)</span>
<a id="__codelineno-0-37" name="__codelineno-0-37"></a><span class="sd">        ```</span>
<a id="__codelineno-0-38" name="__codelineno-0-38"></a><span class="sd">        All datasets should have the same length.</span>
<a id="__codelineno-0-39" name="__codelineno-0-39"></a>
<a id="__codelineno-0-40" name="__codelineno-0-40"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-41" name="__codelineno-0-41"></a>    <span class="nb">super</span><span class="p">(</span><span class="n">JointDataset</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
<a id="__codelineno-0-42" name="__codelineno-0-42"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">datasets</span> <span class="o">=</span> <span class="n">datasets</span>
<a id="__codelineno-0-43" name="__codelineno-0-43"></a>    <span class="c1"># check the length of sub-datasets are the same.</span>
<a id="__codelineno-0-44" name="__codelineno-0-44"></a>    <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="nb">set</span><span class="p">([</span><span class="nb">len</span><span class="p">(</span><span class="n">d</span><span class="p">)</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">datasets</span><span class="o">.</span><span class="n">values</span><span class="p">()]))</span> <span class="o">==</span> <span class="mi">1</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h2 id="torch_choice.data.joint_dataset.JointDataset.__len__" class="doc doc-heading">
<code class="highlight language-python"><span class="fm">__len__</span><span class="p">()</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Get the number of samples in the joint dataset.</p>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
<th>Name</th>        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
<td><code>int</code></td>          <td>
                <code>int</code>
          </td>
          <td><p>the number of samples in the joint dataset, which is the same as the number of samples in each dataset contained.</p></td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>torch_choice/data/joint_dataset.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-46">46</a></span>
<span class="normal"><a href="#__codelineno-0-47">47</a></span>
<span class="normal"><a href="#__codelineno-0-48">48</a></span>
<span class="normal"><a href="#__codelineno-0-49">49</a></span>
<span class="normal"><a href="#__codelineno-0-50">50</a></span>
<span class="normal"><a href="#__codelineno-0-51">51</a></span>
<span class="normal"><a href="#__codelineno-0-52">52</a></span>
<span class="normal"><a href="#__codelineno-0-53">53</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-46" name="__codelineno-0-46"></a><span class="k">def</span> <span class="fm">__len__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<a id="__codelineno-0-47" name="__codelineno-0-47"></a>    <span class="sd">&quot;&quot;&quot;Get the number of samples in the joint dataset.</span>
<a id="__codelineno-0-48" name="__codelineno-0-48"></a>
<a id="__codelineno-0-49" name="__codelineno-0-49"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-50" name="__codelineno-0-50"></a><span class="sd">        int: the number of samples in the joint dataset, which is the same as the number of samples in each dataset contained.</span>
<a id="__codelineno-0-51" name="__codelineno-0-51"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-52" name="__codelineno-0-52"></a>    <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">datasets</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
<a id="__codelineno-0-53" name="__codelineno-0-53"></a>        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h2 id="torch_choice.data.joint_dataset.JointDataset.__repr__" class="doc doc-heading">
<code class="highlight language-python"><span class="fm">__repr__</span><span class="p">()</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>A method to get a string representation of the dataset.</p>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
<th>Name</th>        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
<td><code>str</code></td>          <td>
                <code>str</code>
          </td>
          <td><p>the string representation of the dataset.</p></td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>torch_choice/data/joint_dataset.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-68">68</a></span>
<span class="normal"><a href="#__codelineno-0-69">69</a></span>
<span class="normal"><a href="#__codelineno-0-70">70</a></span>
<span class="normal"><a href="#__codelineno-0-71">71</a></span>
<span class="normal"><a href="#__codelineno-0-72">72</a></span>
<span class="normal"><a href="#__codelineno-0-73">73</a></span>
<span class="normal"><a href="#__codelineno-0-74">74</a></span>
<span class="normal"><a href="#__codelineno-0-75">75</a></span>
<span class="normal"><a href="#__codelineno-0-76">76</a></span>
<span class="normal"><a href="#__codelineno-0-77">77</a></span>
<span class="normal"><a href="#__codelineno-0-78">78</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-68" name="__codelineno-0-68"></a><span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<a id="__codelineno-0-69" name="__codelineno-0-69"></a>    <span class="sd">&quot;&quot;&quot;A method to get a string representation of the dataset.</span>
<a id="__codelineno-0-70" name="__codelineno-0-70"></a>
<a id="__codelineno-0-71" name="__codelineno-0-71"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-72" name="__codelineno-0-72"></a><span class="sd">        str: the string representation of the dataset.</span>
<a id="__codelineno-0-73" name="__codelineno-0-73"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-74" name="__codelineno-0-74"></a>    <span class="n">out</span> <span class="o">=</span> <span class="p">[</span><span class="sa">f</span><span class="s1">&#39;JointDataset with </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">datasets</span><span class="p">)</span><span class="si">}</span><span class="s1"> sub-datasets: (&#39;</span><span class="p">]</span>
<a id="__codelineno-0-75" name="__codelineno-0-75"></a>    <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">dataset</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">datasets</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
<a id="__codelineno-0-76" name="__codelineno-0-76"></a>        <span class="n">out</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="se">\t</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s1">: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">dataset</span><span class="p">)</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
<a id="__codelineno-0-77" name="__codelineno-0-77"></a>    <span class="n">out</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;)&#39;</span><span class="p">)</span>
<a id="__codelineno-0-78" name="__codelineno-0-78"></a>    <span class="k">return</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">out</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h2 id="torch_choice.data.joint_dataset.JointDataset.to" class="doc doc-heading">
<code class="highlight language-python"><span class="n">to</span><span class="p">(</span><span class="n">device</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Moves all datasets in this dataset to the specified PyTorch device.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>device</code></td>
          <td>
                <code><span title="typing.Union">Union</span>[str, torch.<span title="torch.device">device</span>]</code>
          </td>
          <td><p>the destination device.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
<th>Name</th>        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
<td><code>ChoiceDataset</code></td>          <td>
                <code><a class="autorefs autorefs-internal" title="torch_choice.data.joint_dataset.JointDataset" href="#torch_choice.data.JointDataset">JointDataset</a></code>
          </td>
          <td><p>the modified dataset on the new device.</p></td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>torch_choice/data/joint_dataset.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-90"> 90</a></span>
<span class="normal"><a href="#__codelineno-0-91"> 91</a></span>
<span class="normal"><a href="#__codelineno-0-92"> 92</a></span>
<span class="normal"><a href="#__codelineno-0-93"> 93</a></span>
<span class="normal"><a href="#__codelineno-0-94"> 94</a></span>
<span class="normal"><a href="#__codelineno-0-95"> 95</a></span>
<span class="normal"><a href="#__codelineno-0-96"> 96</a></span>
<span class="normal"><a href="#__codelineno-0-97"> 97</a></span>
<span class="normal"><a href="#__codelineno-0-98"> 98</a></span>
<span class="normal"><a href="#__codelineno-0-99"> 99</a></span>
<span class="normal"><a href="#__codelineno-0-100">100</a></span>
<span class="normal"><a href="#__codelineno-0-101">101</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-90" name="__codelineno-0-90"></a><span class="k">def</span> <span class="nf">to</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">device</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">torch</span><span class="o">.</span><span class="n">device</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="s2">&quot;JointDataset&quot;</span><span class="p">:</span>
<a id="__codelineno-0-91" name="__codelineno-0-91"></a>    <span class="sd">&quot;&quot;&quot;Moves all datasets in this dataset to the specified PyTorch device.</span>
<a id="__codelineno-0-92" name="__codelineno-0-92"></a>
<a id="__codelineno-0-93" name="__codelineno-0-93"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-94" name="__codelineno-0-94"></a><span class="sd">        device (Union[str, torch.device]): the destination device.</span>
<a id="__codelineno-0-95" name="__codelineno-0-95"></a>
<a id="__codelineno-0-96" name="__codelineno-0-96"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-97" name="__codelineno-0-97"></a><span class="sd">        ChoiceDataset: the modified dataset on the new device.</span>
<a id="__codelineno-0-98" name="__codelineno-0-98"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-99" name="__codelineno-0-99"></a>    <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">datasets</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
<a id="__codelineno-0-100" name="__codelineno-0-100"></a>        <span class="n">d</span> <span class="o">=</span> <span class="n">d</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">device</span><span class="p">)</span>
<a id="__codelineno-0-101" name="__codelineno-0-101"></a>    <span class="k">return</span> <span class="bp">self</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>



  </div>

  </div>

</div>

<div class="doc doc-object doc-class">


<a id="torch_choice.model.ConditionalLogitModel"></a>
  <div class="doc doc-contents first">
      <p class="doc doc-class-bases">
        Bases: <code><span title="torch.nn">nn</span>.<span title="torch.nn.Module">Module</span></code></p>

  
      <p>The more generalized version of conditional logit model, the model allows for research specific
variable types(groups) and different levels of variations for coefficient.</p>
<p>The model allows for the following levels for variable variations:</p>

<details class="note">
  <summary>unless the <code>-full</code> flag is specified (which means we want to explicitly model coefficients</summary>
  <p>for all items), for all variation levels related to item (item specific and user-item specific),
the model force coefficients for the first item to be zero. This design follows standard
econometric practice.</p>
</details>      <ul>
<li>
<p>constant: constant over all users and items,</p>
</li>
<li>
<p>user: user-specific parameters but constant across all items,</p>
</li>
<li>
<p>item: item-specific parameters but constant across all users, parameters for the first item are
    forced to be zero.</p>
</li>
<li>
<p>item-full: item-specific parameters but constant across all users, explicitly model for all items.</p>
</li>
<li>
<p>user-item: parameters that are specific to both user and item, parameter for the first item
    for all users are forced to be zero.</p>
</li>
<li>user-item-full: parameters that are specific to both user and item, explicitly model for all items.</li>
</ul>


        <details class="quote">
          <summary>Source code in <code>torch_choice/model/conditional_logit_model.py</code></summary>
          <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-19"> 19</a></span>
<span class="normal"><a href="#__codelineno-0-20"> 20</a></span>
<span class="normal"><a href="#__codelineno-0-21"> 21</a></span>
<span class="normal"><a href="#__codelineno-0-22"> 22</a></span>
<span class="normal"><a href="#__codelineno-0-23"> 23</a></span>
<span class="normal"><a href="#__codelineno-0-24"> 24</a></span>
<span class="normal"><a href="#__codelineno-0-25"> 25</a></span>
<span class="normal"><a href="#__codelineno-0-26"> 26</a></span>
<span class="normal"><a href="#__codelineno-0-27"> 27</a></span>
<span class="normal"><a href="#__codelineno-0-28"> 28</a></span>
<span class="normal"><a href="#__codelineno-0-29"> 29</a></span>
<span class="normal"><a href="#__codelineno-0-30"> 30</a></span>
<span class="normal"><a href="#__codelineno-0-31"> 31</a></span>
<span class="normal"><a href="#__codelineno-0-32"> 32</a></span>
<span class="normal"><a href="#__codelineno-0-33"> 33</a></span>
<span class="normal"><a href="#__codelineno-0-34"> 34</a></span>
<span class="normal"><a href="#__codelineno-0-35"> 35</a></span>
<span class="normal"><a href="#__codelineno-0-36"> 36</a></span>
<span class="normal"><a href="#__codelineno-0-37"> 37</a></span>
<span class="normal"><a href="#__codelineno-0-38"> 38</a></span>
<span class="normal"><a href="#__codelineno-0-39"> 39</a></span>
<span class="normal"><a href="#__codelineno-0-40"> 40</a></span>
<span class="normal"><a href="#__codelineno-0-41"> 41</a></span>
<span class="normal"><a href="#__codelineno-0-42"> 42</a></span>
<span class="normal"><a href="#__codelineno-0-43"> 43</a></span>
<span class="normal"><a href="#__codelineno-0-44"> 44</a></span>
<span class="normal"><a href="#__codelineno-0-45"> 45</a></span>
<span class="normal"><a href="#__codelineno-0-46"> 46</a></span>
<span class="normal"><a href="#__codelineno-0-47"> 47</a></span>
<span class="normal"><a href="#__codelineno-0-48"> 48</a></span>
<span class="normal"><a href="#__codelineno-0-49"> 49</a></span>
<span class="normal"><a href="#__codelineno-0-50"> 50</a></span>
<span class="normal"><a href="#__codelineno-0-51"> 51</a></span>
<span class="normal"><a href="#__codelineno-0-52"> 52</a></span>
<span class="normal"><a href="#__codelineno-0-53"> 53</a></span>
<span class="normal"><a href="#__codelineno-0-54"> 54</a></span>
<span class="normal"><a href="#__codelineno-0-55"> 55</a></span>
<span class="normal"><a href="#__codelineno-0-56"> 56</a></span>
<span class="normal"><a href="#__codelineno-0-57"> 57</a></span>
<span class="normal"><a href="#__codelineno-0-58"> 58</a></span>
<span class="normal"><a href="#__codelineno-0-59"> 59</a></span>
<span class="normal"><a href="#__codelineno-0-60"> 60</a></span>
<span class="normal"><a href="#__codelineno-0-61"> 61</a></span>
<span class="normal"><a href="#__codelineno-0-62"> 62</a></span>
<span class="normal"><a href="#__codelineno-0-63"> 63</a></span>
<span class="normal"><a href="#__codelineno-0-64"> 64</a></span>
<span class="normal"><a href="#__codelineno-0-65"> 65</a></span>
<span class="normal"><a href="#__codelineno-0-66"> 66</a></span>
<span class="normal"><a href="#__codelineno-0-67"> 67</a></span>
<span class="normal"><a href="#__codelineno-0-68"> 68</a></span>
<span class="normal"><a href="#__codelineno-0-69"> 69</a></span>
<span class="normal"><a href="#__codelineno-0-70"> 70</a></span>
<span class="normal"><a href="#__codelineno-0-71"> 71</a></span>
<span class="normal"><a href="#__codelineno-0-72"> 72</a></span>
<span class="normal"><a href="#__codelineno-0-73"> 73</a></span>
<span class="normal"><a href="#__codelineno-0-74"> 74</a></span>
<span class="normal"><a href="#__codelineno-0-75"> 75</a></span>
<span class="normal"><a href="#__codelineno-0-76"> 76</a></span>
<span class="normal"><a href="#__codelineno-0-77"> 77</a></span>
<span class="normal"><a href="#__codelineno-0-78"> 78</a></span>
<span class="normal"><a href="#__codelineno-0-79"> 79</a></span>
<span class="normal"><a href="#__codelineno-0-80"> 80</a></span>
<span class="normal"><a href="#__codelineno-0-81"> 81</a></span>
<span class="normal"><a href="#__codelineno-0-82"> 82</a></span>
<span class="normal"><a href="#__codelineno-0-83"> 83</a></span>
<span class="normal"><a href="#__codelineno-0-84"> 84</a></span>
<span class="normal"><a href="#__codelineno-0-85"> 85</a></span>
<span class="normal"><a href="#__codelineno-0-86"> 86</a></span>
<span class="normal"><a href="#__codelineno-0-87"> 87</a></span>
<span class="normal"><a href="#__codelineno-0-88"> 88</a></span>
<span class="normal"><a href="#__codelineno-0-89"> 89</a></span>
<span class="normal"><a href="#__codelineno-0-90"> 90</a></span>
<span class="normal"><a href="#__codelineno-0-91"> 91</a></span>
<span class="normal"><a href="#__codelineno-0-92"> 92</a></span>
<span class="normal"><a href="#__codelineno-0-93"> 93</a></span>
<span class="normal"><a href="#__codelineno-0-94"> 94</a></span>
<span class="normal"><a href="#__codelineno-0-95"> 95</a></span>
<span class="normal"><a href="#__codelineno-0-96"> 96</a></span>
<span class="normal"><a href="#__codelineno-0-97"> 97</a></span>
<span class="normal"><a href="#__codelineno-0-98"> 98</a></span>
<span class="normal"><a href="#__codelineno-0-99"> 99</a></span>
<span class="normal"><a href="#__codelineno-0-100">100</a></span>
<span class="normal"><a href="#__codelineno-0-101">101</a></span>
<span class="normal"><a href="#__codelineno-0-102">102</a></span>
<span class="normal"><a href="#__codelineno-0-103">103</a></span>
<span class="normal"><a href="#__codelineno-0-104">104</a></span>
<span class="normal"><a href="#__codelineno-0-105">105</a></span>
<span class="normal"><a href="#__codelineno-0-106">106</a></span>
<span class="normal"><a href="#__codelineno-0-107">107</a></span>
<span class="normal"><a href="#__codelineno-0-108">108</a></span>
<span class="normal"><a href="#__codelineno-0-109">109</a></span>
<span class="normal"><a href="#__codelineno-0-110">110</a></span>
<span class="normal"><a href="#__codelineno-0-111">111</a></span>
<span class="normal"><a href="#__codelineno-0-112">112</a></span>
<span class="normal"><a href="#__codelineno-0-113">113</a></span>
<span class="normal"><a href="#__codelineno-0-114">114</a></span>
<span class="normal"><a href="#__codelineno-0-115">115</a></span>
<span class="normal"><a href="#__codelineno-0-116">116</a></span>
<span class="normal"><a href="#__codelineno-0-117">117</a></span>
<span class="normal"><a href="#__codelineno-0-118">118</a></span>
<span class="normal"><a href="#__codelineno-0-119">119</a></span>
<span class="normal"><a href="#__codelineno-0-120">120</a></span>
<span class="normal"><a href="#__codelineno-0-121">121</a></span>
<span class="normal"><a href="#__codelineno-0-122">122</a></span>
<span class="normal"><a href="#__codelineno-0-123">123</a></span>
<span class="normal"><a href="#__codelineno-0-124">124</a></span>
<span class="normal"><a href="#__codelineno-0-125">125</a></span>
<span class="normal"><a href="#__codelineno-0-126">126</a></span>
<span class="normal"><a href="#__codelineno-0-127">127</a></span>
<span class="normal"><a href="#__codelineno-0-128">128</a></span>
<span class="normal"><a href="#__codelineno-0-129">129</a></span>
<span class="normal"><a href="#__codelineno-0-130">130</a></span>
<span class="normal"><a href="#__codelineno-0-131">131</a></span>
<span class="normal"><a href="#__codelineno-0-132">132</a></span>
<span class="normal"><a href="#__codelineno-0-133">133</a></span>
<span class="normal"><a href="#__codelineno-0-134">134</a></span>
<span class="normal"><a href="#__codelineno-0-135">135</a></span>
<span class="normal"><a href="#__codelineno-0-136">136</a></span>
<span class="normal"><a href="#__codelineno-0-137">137</a></span>
<span class="normal"><a href="#__codelineno-0-138">138</a></span>
<span class="normal"><a href="#__codelineno-0-139">139</a></span>
<span class="normal"><a href="#__codelineno-0-140">140</a></span>
<span class="normal"><a href="#__codelineno-0-141">141</a></span>
<span class="normal"><a href="#__codelineno-0-142">142</a></span>
<span class="normal"><a href="#__codelineno-0-143">143</a></span>
<span class="normal"><a href="#__codelineno-0-144">144</a></span>
<span class="normal"><a href="#__codelineno-0-145">145</a></span>
<span class="normal"><a href="#__codelineno-0-146">146</a></span>
<span class="normal"><a href="#__codelineno-0-147">147</a></span>
<span class="normal"><a href="#__codelineno-0-148">148</a></span>
<span class="normal"><a href="#__codelineno-0-149">149</a></span>
<span class="normal"><a href="#__codelineno-0-150">150</a></span>
<span class="normal"><a href="#__codelineno-0-151">151</a></span>
<span class="normal"><a href="#__codelineno-0-152">152</a></span>
<span class="normal"><a href="#__codelineno-0-153">153</a></span>
<span class="normal"><a href="#__codelineno-0-154">154</a></span>
<span class="normal"><a href="#__codelineno-0-155">155</a></span>
<span class="normal"><a href="#__codelineno-0-156">156</a></span>
<span class="normal"><a href="#__codelineno-0-157">157</a></span>
<span class="normal"><a href="#__codelineno-0-158">158</a></span>
<span class="normal"><a href="#__codelineno-0-159">159</a></span>
<span class="normal"><a href="#__codelineno-0-160">160</a></span>
<span class="normal"><a href="#__codelineno-0-161">161</a></span>
<span class="normal"><a href="#__codelineno-0-162">162</a></span>
<span class="normal"><a href="#__codelineno-0-163">163</a></span>
<span class="normal"><a href="#__codelineno-0-164">164</a></span>
<span class="normal"><a href="#__codelineno-0-165">165</a></span>
<span class="normal"><a href="#__codelineno-0-166">166</a></span>
<span class="normal"><a href="#__codelineno-0-167">167</a></span>
<span class="normal"><a href="#__codelineno-0-168">168</a></span>
<span class="normal"><a href="#__codelineno-0-169">169</a></span>
<span class="normal"><a href="#__codelineno-0-170">170</a></span>
<span class="normal"><a href="#__codelineno-0-171">171</a></span>
<span class="normal"><a href="#__codelineno-0-172">172</a></span>
<span class="normal"><a href="#__codelineno-0-173">173</a></span>
<span class="normal"><a href="#__codelineno-0-174">174</a></span>
<span class="normal"><a href="#__codelineno-0-175">175</a></span>
<span class="normal"><a href="#__codelineno-0-176">176</a></span>
<span class="normal"><a href="#__codelineno-0-177">177</a></span>
<span class="normal"><a href="#__codelineno-0-178">178</a></span>
<span class="normal"><a href="#__codelineno-0-179">179</a></span>
<span class="normal"><a href="#__codelineno-0-180">180</a></span>
<span class="normal"><a href="#__codelineno-0-181">181</a></span>
<span class="normal"><a href="#__codelineno-0-182">182</a></span>
<span class="normal"><a href="#__codelineno-0-183">183</a></span>
<span class="normal"><a href="#__codelineno-0-184">184</a></span>
<span class="normal"><a href="#__codelineno-0-185">185</a></span>
<span class="normal"><a href="#__codelineno-0-186">186</a></span>
<span class="normal"><a href="#__codelineno-0-187">187</a></span>
<span class="normal"><a href="#__codelineno-0-188">188</a></span>
<span class="normal"><a href="#__codelineno-0-189">189</a></span>
<span class="normal"><a href="#__codelineno-0-190">190</a></span>
<span class="normal"><a href="#__codelineno-0-191">191</a></span>
<span class="normal"><a href="#__codelineno-0-192">192</a></span>
<span class="normal"><a href="#__codelineno-0-193">193</a></span>
<span class="normal"><a href="#__codelineno-0-194">194</a></span>
<span class="normal"><a href="#__codelineno-0-195">195</a></span>
<span class="normal"><a href="#__codelineno-0-196">196</a></span>
<span class="normal"><a href="#__codelineno-0-197">197</a></span>
<span class="normal"><a href="#__codelineno-0-198">198</a></span>
<span class="normal"><a href="#__codelineno-0-199">199</a></span>
<span class="normal"><a href="#__codelineno-0-200">200</a></span>
<span class="normal"><a href="#__codelineno-0-201">201</a></span>
<span class="normal"><a href="#__codelineno-0-202">202</a></span>
<span class="normal"><a href="#__codelineno-0-203">203</a></span>
<span class="normal"><a href="#__codelineno-0-204">204</a></span>
<span class="normal"><a href="#__codelineno-0-205">205</a></span>
<span class="normal"><a href="#__codelineno-0-206">206</a></span>
<span class="normal"><a href="#__codelineno-0-207">207</a></span>
<span class="normal"><a href="#__codelineno-0-208">208</a></span>
<span class="normal"><a href="#__codelineno-0-209">209</a></span>
<span class="normal"><a href="#__codelineno-0-210">210</a></span>
<span class="normal"><a href="#__codelineno-0-211">211</a></span>
<span class="normal"><a href="#__codelineno-0-212">212</a></span>
<span class="normal"><a href="#__codelineno-0-213">213</a></span>
<span class="normal"><a href="#__codelineno-0-214">214</a></span>
<span class="normal"><a href="#__codelineno-0-215">215</a></span>
<span class="normal"><a href="#__codelineno-0-216">216</a></span>
<span class="normal"><a href="#__codelineno-0-217">217</a></span>
<span class="normal"><a href="#__codelineno-0-218">218</a></span>
<span class="normal"><a href="#__codelineno-0-219">219</a></span>
<span class="normal"><a href="#__codelineno-0-220">220</a></span>
<span class="normal"><a href="#__codelineno-0-221">221</a></span>
<span class="normal"><a href="#__codelineno-0-222">222</a></span>
<span class="normal"><a href="#__codelineno-0-223">223</a></span>
<span class="normal"><a href="#__codelineno-0-224">224</a></span>
<span class="normal"><a href="#__codelineno-0-225">225</a></span>
<span class="normal"><a href="#__codelineno-0-226">226</a></span>
<span class="normal"><a href="#__codelineno-0-227">227</a></span>
<span class="normal"><a href="#__codelineno-0-228">228</a></span>
<span class="normal"><a href="#__codelineno-0-229">229</a></span>
<span class="normal"><a href="#__codelineno-0-230">230</a></span>
<span class="normal"><a href="#__codelineno-0-231">231</a></span>
<span class="normal"><a href="#__codelineno-0-232">232</a></span>
<span class="normal"><a href="#__codelineno-0-233">233</a></span>
<span class="normal"><a href="#__codelineno-0-234">234</a></span>
<span class="normal"><a href="#__codelineno-0-235">235</a></span>
<span class="normal"><a href="#__codelineno-0-236">236</a></span>
<span class="normal"><a href="#__codelineno-0-237">237</a></span>
<span class="normal"><a href="#__codelineno-0-238">238</a></span>
<span class="normal"><a href="#__codelineno-0-239">239</a></span>
<span class="normal"><a href="#__codelineno-0-240">240</a></span>
<span class="normal"><a href="#__codelineno-0-241">241</a></span>
<span class="normal"><a href="#__codelineno-0-242">242</a></span>
<span class="normal"><a href="#__codelineno-0-243">243</a></span>
<span class="normal"><a href="#__codelineno-0-244">244</a></span>
<span class="normal"><a href="#__codelineno-0-245">245</a></span>
<span class="normal"><a href="#__codelineno-0-246">246</a></span>
<span class="normal"><a href="#__codelineno-0-247">247</a></span>
<span class="normal"><a href="#__codelineno-0-248">248</a></span>
<span class="normal"><a href="#__codelineno-0-249">249</a></span>
<span class="normal"><a href="#__codelineno-0-250">250</a></span>
<span class="normal"><a href="#__codelineno-0-251">251</a></span>
<span class="normal"><a href="#__codelineno-0-252">252</a></span>
<span class="normal"><a href="#__codelineno-0-253">253</a></span>
<span class="normal"><a href="#__codelineno-0-254">254</a></span>
<span class="normal"><a href="#__codelineno-0-255">255</a></span>
<span class="normal"><a href="#__codelineno-0-256">256</a></span>
<span class="normal"><a href="#__codelineno-0-257">257</a></span>
<span class="normal"><a href="#__codelineno-0-258">258</a></span>
<span class="normal"><a href="#__codelineno-0-259">259</a></span>
<span class="normal"><a href="#__codelineno-0-260">260</a></span>
<span class="normal"><a href="#__codelineno-0-261">261</a></span>
<span class="normal"><a href="#__codelineno-0-262">262</a></span>
<span class="normal"><a href="#__codelineno-0-263">263</a></span>
<span class="normal"><a href="#__codelineno-0-264">264</a></span>
<span class="normal"><a href="#__codelineno-0-265">265</a></span>
<span class="normal"><a href="#__codelineno-0-266">266</a></span>
<span class="normal"><a href="#__codelineno-0-267">267</a></span>
<span class="normal"><a href="#__codelineno-0-268">268</a></span>
<span class="normal"><a href="#__codelineno-0-269">269</a></span>
<span class="normal"><a href="#__codelineno-0-270">270</a></span>
<span class="normal"><a href="#__codelineno-0-271">271</a></span>
<span class="normal"><a href="#__codelineno-0-272">272</a></span>
<span class="normal"><a href="#__codelineno-0-273">273</a></span>
<span class="normal"><a href="#__codelineno-0-274">274</a></span>
<span class="normal"><a href="#__codelineno-0-275">275</a></span>
<span class="normal"><a href="#__codelineno-0-276">276</a></span>
<span class="normal"><a href="#__codelineno-0-277">277</a></span>
<span class="normal"><a href="#__codelineno-0-278">278</a></span>
<span class="normal"><a href="#__codelineno-0-279">279</a></span>
<span class="normal"><a href="#__codelineno-0-280">280</a></span>
<span class="normal"><a href="#__codelineno-0-281">281</a></span>
<span class="normal"><a href="#__codelineno-0-282">282</a></span>
<span class="normal"><a href="#__codelineno-0-283">283</a></span>
<span class="normal"><a href="#__codelineno-0-284">284</a></span>
<span class="normal"><a href="#__codelineno-0-285">285</a></span>
<span class="normal"><a href="#__codelineno-0-286">286</a></span>
<span class="normal"><a href="#__codelineno-0-287">287</a></span>
<span class="normal"><a href="#__codelineno-0-288">288</a></span>
<span class="normal"><a href="#__codelineno-0-289">289</a></span>
<span class="normal"><a href="#__codelineno-0-290">290</a></span>
<span class="normal"><a href="#__codelineno-0-291">291</a></span>
<span class="normal"><a href="#__codelineno-0-292">292</a></span>
<span class="normal"><a href="#__codelineno-0-293">293</a></span>
<span class="normal"><a href="#__codelineno-0-294">294</a></span>
<span class="normal"><a href="#__codelineno-0-295">295</a></span>
<span class="normal"><a href="#__codelineno-0-296">296</a></span>
<span class="normal"><a href="#__codelineno-0-297">297</a></span>
<span class="normal"><a href="#__codelineno-0-298">298</a></span>
<span class="normal"><a href="#__codelineno-0-299">299</a></span>
<span class="normal"><a href="#__codelineno-0-300">300</a></span>
<span class="normal"><a href="#__codelineno-0-301">301</a></span>
<span class="normal"><a href="#__codelineno-0-302">302</a></span>
<span class="normal"><a href="#__codelineno-0-303">303</a></span>
<span class="normal"><a href="#__codelineno-0-304">304</a></span>
<span class="normal"><a href="#__codelineno-0-305">305</a></span>
<span class="normal"><a href="#__codelineno-0-306">306</a></span>
<span class="normal"><a href="#__codelineno-0-307">307</a></span>
<span class="normal"><a href="#__codelineno-0-308">308</a></span>
<span class="normal"><a href="#__codelineno-0-309">309</a></span>
<span class="normal"><a href="#__codelineno-0-310">310</a></span>
<span class="normal"><a href="#__codelineno-0-311">311</a></span>
<span class="normal"><a href="#__codelineno-0-312">312</a></span>
<span class="normal"><a href="#__codelineno-0-313">313</a></span>
<span class="normal"><a href="#__codelineno-0-314">314</a></span>
<span class="normal"><a href="#__codelineno-0-315">315</a></span>
<span class="normal"><a href="#__codelineno-0-316">316</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-19" name="__codelineno-0-19"></a><span class="k">class</span> <span class="nc">ConditionalLogitModel</span><span class="p">(</span><span class="n">nn</span><span class="o">.</span><span class="n">Module</span><span class="p">):</span>
<a id="__codelineno-0-20" name="__codelineno-0-20"></a>    <span class="sd">&quot;&quot;&quot;The more generalized version of conditional logit model, the model allows for research specific</span>
<a id="__codelineno-0-21" name="__codelineno-0-21"></a><span class="sd">    variable types(groups) and different levels of variations for coefficient.</span>
<a id="__codelineno-0-22" name="__codelineno-0-22"></a>
<a id="__codelineno-0-23" name="__codelineno-0-23"></a><span class="sd">    The model allows for the following levels for variable variations:</span>
<a id="__codelineno-0-24" name="__codelineno-0-24"></a><span class="sd">    NOTE: unless the `-full` flag is specified (which means we want to explicitly model coefficients</span>
<a id="__codelineno-0-25" name="__codelineno-0-25"></a><span class="sd">        for all items), for all variation levels related to item (item specific and user-item specific),</span>
<a id="__codelineno-0-26" name="__codelineno-0-26"></a><span class="sd">        the model force coefficients for the first item to be zero. This design follows standard</span>
<a id="__codelineno-0-27" name="__codelineno-0-27"></a><span class="sd">        econometric practice.</span>
<a id="__codelineno-0-28" name="__codelineno-0-28"></a>
<a id="__codelineno-0-29" name="__codelineno-0-29"></a><span class="sd">    - constant: constant over all users and items,</span>
<a id="__codelineno-0-30" name="__codelineno-0-30"></a>
<a id="__codelineno-0-31" name="__codelineno-0-31"></a><span class="sd">    - user: user-specific parameters but constant across all items,</span>
<a id="__codelineno-0-32" name="__codelineno-0-32"></a>
<a id="__codelineno-0-33" name="__codelineno-0-33"></a><span class="sd">    - item: item-specific parameters but constant across all users, parameters for the first item are</span>
<a id="__codelineno-0-34" name="__codelineno-0-34"></a><span class="sd">        forced to be zero.</span>
<a id="__codelineno-0-35" name="__codelineno-0-35"></a><span class="sd">    - item-full: item-specific parameters but constant across all users, explicitly model for all items.</span>
<a id="__codelineno-0-36" name="__codelineno-0-36"></a>
<a id="__codelineno-0-37" name="__codelineno-0-37"></a><span class="sd">    - user-item: parameters that are specific to both user and item, parameter for the first item</span>
<a id="__codelineno-0-38" name="__codelineno-0-38"></a><span class="sd">        for all users are forced to be zero.</span>
<a id="__codelineno-0-39" name="__codelineno-0-39"></a><span class="sd">    - user-item-full: parameters that are specific to both user and item, explicitly model for all items.</span>
<a id="__codelineno-0-40" name="__codelineno-0-40"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-41" name="__codelineno-0-41"></a>
<a id="__codelineno-0-42" name="__codelineno-0-42"></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-43" name="__codelineno-0-43"></a>                 <span class="n">formula</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-44" name="__codelineno-0-44"></a>                 <span class="n">dataset</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">ChoiceDataset</span><span class="p">]</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-45" name="__codelineno-0-45"></a>                 <span class="n">coef_variation_dict</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-46" name="__codelineno-0-46"></a>                 <span class="n">num_param_dict</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">]]</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-47" name="__codelineno-0-47"></a>                 <span class="n">num_items</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-48" name="__codelineno-0-48"></a>                 <span class="n">num_users</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-49" name="__codelineno-0-49"></a>                 <span class="n">regularization</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-50" name="__codelineno-0-50"></a>                 <span class="n">regularization_weight</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span><span class="o">=</span><span class="kc">None</span>
<a id="__codelineno-0-51" name="__codelineno-0-51"></a>                 <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-52" name="__codelineno-0-52"></a>        <span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-53" name="__codelineno-0-53"></a><span class="sd">        Args:</span>
<a id="__codelineno-0-54" name="__codelineno-0-54"></a><span class="sd">            formula (str): a string representing the utility formula.</span>
<a id="__codelineno-0-55" name="__codelineno-0-55"></a><span class="sd">                The formula consists of &#39;(variable_name|variation)&#39;s separated by &#39;+&#39;, for example:</span>
<a id="__codelineno-0-56" name="__codelineno-0-56"></a><span class="sd">                &quot;(var1|item) + (var2|user) + (var3|constant)&quot;</span>
<a id="__codelineno-0-57" name="__codelineno-0-57"></a><span class="sd">                where the first part of each term is the name of the variable</span>
<a id="__codelineno-0-58" name="__codelineno-0-58"></a><span class="sd">                and the second part is the variation of the coefficient.</span>
<a id="__codelineno-0-59" name="__codelineno-0-59"></a><span class="sd">                The variation can be one of the following:</span>
<a id="__codelineno-0-60" name="__codelineno-0-60"></a><span class="sd">                &#39;constant&#39;, &#39;item&#39;, &#39;item-full&#39;, &#39;user&#39;, &#39;user-item&#39;, &#39;user-item-full&#39;.</span>
<a id="__codelineno-0-61" name="__codelineno-0-61"></a><span class="sd">                All spaces in the formula will be ignored, hence please do not use spaces in variable/observable names.</span>
<a id="__codelineno-0-62" name="__codelineno-0-62"></a><span class="sd">            data (ChoiceDataset): a ChoiceDataset object for training the model, the parser will infer dimensions of variables</span>
<a id="__codelineno-0-63" name="__codelineno-0-63"></a><span class="sd">                and sizes of coefficients from the ChoiceDataset.</span>
<a id="__codelineno-0-64" name="__codelineno-0-64"></a><span class="sd">            coef_variation_dict (Dict[str, str]): variable type to variation level dictionary. Keys of this dictionary</span>
<a id="__codelineno-0-65" name="__codelineno-0-65"></a><span class="sd">                should be variable names in the dataset (i.e., these starting with `itemsession_`, `price_`, `user_`, etc), or `intercept`</span>
<a id="__codelineno-0-66" name="__codelineno-0-66"></a><span class="sd">                if the researcher requires an intercept term.</span>
<a id="__codelineno-0-67" name="__codelineno-0-67"></a><span class="sd">                For each variable name X_var (e.g., `user_income`) or `intercept`, the corresponding dictionary key should</span>
<a id="__codelineno-0-68" name="__codelineno-0-68"></a><span class="sd">                be one of the following values, this value specifies the &quot;level of variation&quot; of the coefficient.</span>
<a id="__codelineno-0-69" name="__codelineno-0-69"></a>
<a id="__codelineno-0-70" name="__codelineno-0-70"></a><span class="sd">                - `constant`: the coefficient constant over all users and items: $X \beta$.</span>
<a id="__codelineno-0-71" name="__codelineno-0-71"></a>
<a id="__codelineno-0-72" name="__codelineno-0-72"></a><span class="sd">                - `user`: user-specific parameters but constant across all items: $X \beta_{u}$.</span>
<a id="__codelineno-0-73" name="__codelineno-0-73"></a>
<a id="__codelineno-0-74" name="__codelineno-0-74"></a><span class="sd">                - `item`: item-specific parameters but constant across all users, $X \beta_{i}$.</span>
<a id="__codelineno-0-75" name="__codelineno-0-75"></a><span class="sd">                    Note that the coefficients for the first item are forced to be zero following the standard practice</span>
<a id="__codelineno-0-76" name="__codelineno-0-76"></a><span class="sd">                    in econometrics.</span>
<a id="__codelineno-0-77" name="__codelineno-0-77"></a>
<a id="__codelineno-0-78" name="__codelineno-0-78"></a><span class="sd">                - `item-full`: the same configuration as `item`, but does not force the coefficients of the first item to</span>
<a id="__codelineno-0-79" name="__codelineno-0-79"></a><span class="sd">                    be zeros.</span>
<a id="__codelineno-0-80" name="__codelineno-0-80"></a>
<a id="__codelineno-0-81" name="__codelineno-0-81"></a><span class="sd">                The following configurations are supported by the package, but we don&#39;t recommend using them due to the</span>
<a id="__codelineno-0-82" name="__codelineno-0-82"></a><span class="sd">                    large number of parameters.</span>
<a id="__codelineno-0-83" name="__codelineno-0-83"></a><span class="sd">                - `user-item`: parameters that are specific to both user and item, parameter for the first item</span>
<a id="__codelineno-0-84" name="__codelineno-0-84"></a><span class="sd">                    for all users are forced to be zero.</span>
<a id="__codelineno-0-85" name="__codelineno-0-85"></a>
<a id="__codelineno-0-86" name="__codelineno-0-86"></a><span class="sd">                - `user-item-full`: parameters that are specific to both user and item, explicitly model for all items.</span>
<a id="__codelineno-0-87" name="__codelineno-0-87"></a><span class="sd">            num_param_dict (Optional[Dict[str, int]]): variable type to number of parameters dictionary with keys exactly the same</span>
<a id="__codelineno-0-88" name="__codelineno-0-88"></a><span class="sd">                as the `coef_variation_dict`. Values of `num_param_dict` records numbers of features in each kind of variable.</span>
<a id="__codelineno-0-89" name="__codelineno-0-89"></a><span class="sd">                If None is supplied, num_param_dict will be a dictionary with the same keys as the `coef_variation_dict` dictionary</span>
<a id="__codelineno-0-90" name="__codelineno-0-90"></a><span class="sd">                and values of all ones. Default to be None.</span>
<a id="__codelineno-0-91" name="__codelineno-0-91"></a><span class="sd">            num_items (int): number of items in the dataset.</span>
<a id="__codelineno-0-92" name="__codelineno-0-92"></a><span class="sd">            num_users (int): number of users in the dataset.</span>
<a id="__codelineno-0-93" name="__codelineno-0-93"></a><span class="sd">            regularization (Optional[str]): this argument takes values from {&#39;L1&#39;, &#39;L2&#39;, None}, which specifies the type of</span>
<a id="__codelineno-0-94" name="__codelineno-0-94"></a><span class="sd">                regularization added to the log-likelihood.</span>
<a id="__codelineno-0-95" name="__codelineno-0-95"></a><span class="sd">                - &#39;L1&#39; will subtract regularization_weight * 1-norm of parameters from the log-likelihood.</span>
<a id="__codelineno-0-96" name="__codelineno-0-96"></a><span class="sd">                - &#39;L2&#39; will subtract regularization_weight * 2-norm of parameters from the log-likelihood.</span>
<a id="__codelineno-0-97" name="__codelineno-0-97"></a><span class="sd">                - None does not modify the log-likelihood.</span>
<a id="__codelineno-0-98" name="__codelineno-0-98"></a><span class="sd">                Defaults to None.</span>
<a id="__codelineno-0-99" name="__codelineno-0-99"></a><span class="sd">            regularization_weight (Optional[float]): the weight of parameter norm subtracted from the log-likelihood.</span>
<a id="__codelineno-0-100" name="__codelineno-0-100"></a><span class="sd">                This term controls the strength of regularization. This argument is required if and only if regularization</span>
<a id="__codelineno-0-101" name="__codelineno-0-101"></a><span class="sd">                is not None.</span>
<a id="__codelineno-0-102" name="__codelineno-0-102"></a><span class="sd">                Defaults to None.</span>
<a id="__codelineno-0-103" name="__codelineno-0-103"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-104" name="__codelineno-0-104"></a>        <span class="c1"># ==============================================================================================================</span>
<a id="__codelineno-0-105" name="__codelineno-0-105"></a>        <span class="c1"># Check that the model received a valid combination of inputs so that it can be initialized.</span>
<a id="__codelineno-0-106" name="__codelineno-0-106"></a>        <span class="c1"># ==============================================================================================================</span>
<a id="__codelineno-0-107" name="__codelineno-0-107"></a>        <span class="k">if</span> <span class="n">coef_variation_dict</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">formula</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-108" name="__codelineno-0-108"></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Either coef_variation_dict or formula should be provided to specify the model.&quot;</span><span class="p">)</span>
<a id="__codelineno-0-109" name="__codelineno-0-109"></a>
<a id="__codelineno-0-110" name="__codelineno-0-110"></a>        <span class="k">if</span> <span class="p">(</span><span class="n">coef_variation_dict</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">formula</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">):</span>
<a id="__codelineno-0-111" name="__codelineno-0-111"></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Only one of coef_variation_dict or formula should be provided to specify the model.&quot;</span><span class="p">)</span>
<a id="__codelineno-0-112" name="__codelineno-0-112"></a>
<a id="__codelineno-0-113" name="__codelineno-0-113"></a>        <span class="k">if</span> <span class="p">(</span><span class="n">formula</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">dataset</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">):</span>
<a id="__codelineno-0-114" name="__codelineno-0-114"></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;If formula is provided, data should be provided to specify the model.&quot;</span><span class="p">)</span>
<a id="__codelineno-0-115" name="__codelineno-0-115"></a>
<a id="__codelineno-0-116" name="__codelineno-0-116"></a>
<a id="__codelineno-0-117" name="__codelineno-0-117"></a>        <span class="c1"># ==============================================================================================================</span>
<a id="__codelineno-0-118" name="__codelineno-0-118"></a>        <span class="c1"># Build necessary dictionaries for model initialization.</span>
<a id="__codelineno-0-119" name="__codelineno-0-119"></a>        <span class="c1"># ==============================================================================================================</span>
<a id="__codelineno-0-120" name="__codelineno-0-120"></a>        <span class="k">if</span> <span class="n">formula</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-121" name="__codelineno-0-121"></a>            <span class="c1"># Use dictionaries to initialize the model.</span>
<a id="__codelineno-0-122" name="__codelineno-0-122"></a>            <span class="k">if</span> <span class="n">num_param_dict</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-123" name="__codelineno-0-123"></a>                <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;`num_param_dict` is not provided, all variables will be treated as having one parameter.&quot;</span><span class="p">)</span>
<a id="__codelineno-0-124" name="__codelineno-0-124"></a>                <span class="n">num_param_dict</span> <span class="o">=</span> <span class="p">{</span><span class="n">key</span><span class="p">:</span><span class="mi">1</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">coef_variation_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">()}</span>
<a id="__codelineno-0-125" name="__codelineno-0-125"></a>
<a id="__codelineno-0-126" name="__codelineno-0-126"></a>            <span class="k">assert</span> <span class="n">coef_variation_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="o">==</span> <span class="n">num_param_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
<a id="__codelineno-0-127" name="__codelineno-0-127"></a>
<a id="__codelineno-0-128" name="__codelineno-0-128"></a>            <span class="c1"># variable `var` with variation `spec` to variable `var[spec]`.</span>
<a id="__codelineno-0-129" name="__codelineno-0-129"></a>            <span class="n">rename</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>  <span class="c1"># old variable name --&gt; new variable name.</span>
<a id="__codelineno-0-130" name="__codelineno-0-130"></a>            <span class="k">for</span> <span class="n">variable</span><span class="p">,</span> <span class="n">specificity</span> <span class="ow">in</span> <span class="n">coef_variation_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
<a id="__codelineno-0-131" name="__codelineno-0-131"></a>                <span class="n">rename</span><span class="p">[</span><span class="n">variable</span><span class="p">]</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">variable</span><span class="si">}</span><span class="s2">[</span><span class="si">{</span><span class="n">specificity</span><span class="si">}</span><span class="s2">]&quot;</span>
<a id="__codelineno-0-132" name="__codelineno-0-132"></a>
<a id="__codelineno-0-133" name="__codelineno-0-133"></a>            <span class="k">for</span> <span class="n">old_name</span><span class="p">,</span> <span class="n">new_name</span> <span class="ow">in</span> <span class="n">rename</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
<a id="__codelineno-0-134" name="__codelineno-0-134"></a>                <span class="n">coef_variation_dict</span><span class="p">[</span><span class="n">new_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">coef_variation_dict</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">old_name</span><span class="p">)</span>
<a id="__codelineno-0-135" name="__codelineno-0-135"></a>                <span class="n">num_param_dict</span><span class="p">[</span><span class="n">new_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">num_param_dict</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">old_name</span><span class="p">)</span>
<a id="__codelineno-0-136" name="__codelineno-0-136"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-137" name="__codelineno-0-137"></a>            <span class="c1"># Use the formula to infer model.</span>
<a id="__codelineno-0-138" name="__codelineno-0-138"></a>            <span class="n">coef_variation_dict</span><span class="p">,</span> <span class="n">num_param_dict</span> <span class="o">=</span> <span class="n">parse_formula</span><span class="p">(</span><span class="n">formula</span><span class="p">,</span> <span class="n">dataset</span><span class="p">)</span>
<a id="__codelineno-0-139" name="__codelineno-0-139"></a>
<a id="__codelineno-0-140" name="__codelineno-0-140"></a>        <span class="c1"># ==============================================================================================================</span>
<a id="__codelineno-0-141" name="__codelineno-0-141"></a>        <span class="c1"># Model Initialization.</span>
<a id="__codelineno-0-142" name="__codelineno-0-142"></a>        <span class="c1"># ==============================================================================================================</span>
<a id="__codelineno-0-143" name="__codelineno-0-143"></a>        <span class="nb">super</span><span class="p">(</span><span class="n">ConditionalLogitModel</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
<a id="__codelineno-0-144" name="__codelineno-0-144"></a>
<a id="__codelineno-0-145" name="__codelineno-0-145"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">coef_variation_dict</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="n">coef_variation_dict</span><span class="p">)</span>
<a id="__codelineno-0-146" name="__codelineno-0-146"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">num_param_dict</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="n">num_param_dict</span><span class="p">)</span>
<a id="__codelineno-0-147" name="__codelineno-0-147"></a>
<a id="__codelineno-0-148" name="__codelineno-0-148"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">num_items</span> <span class="o">=</span> <span class="n">num_items</span>
<a id="__codelineno-0-149" name="__codelineno-0-149"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">num_users</span> <span class="o">=</span> <span class="n">num_users</span>
<a id="__codelineno-0-150" name="__codelineno-0-150"></a>
<a id="__codelineno-0-151" name="__codelineno-0-151"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">regularization</span> <span class="o">=</span> <span class="n">regularization</span>
<a id="__codelineno-0-152" name="__codelineno-0-152"></a>        <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">regularization</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;L1&#39;</span><span class="p">,</span> <span class="s1">&#39;L2&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">],</span> <span class="sa">f</span><span class="s2">&quot;Provided regularization=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">regularization</span><span class="si">}</span><span class="s2"> is not allowed, allowed values are [&#39;L1&#39;, &#39;L2&#39;, None].&quot;</span>
<a id="__codelineno-0-153" name="__codelineno-0-153"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">regularization_weight</span> <span class="o">=</span> <span class="n">regularization_weight</span>
<a id="__codelineno-0-154" name="__codelineno-0-154"></a>        <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">regularization</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">regularization_weight</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">):</span>
<a id="__codelineno-0-155" name="__codelineno-0-155"></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;You specified regularization type </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">regularization</span><span class="si">}</span><span class="s1"> without providing regularization_weight.&#39;</span><span class="p">)</span>
<a id="__codelineno-0-156" name="__codelineno-0-156"></a>        <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">regularization</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">regularization_weight</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">):</span>
<a id="__codelineno-0-157" name="__codelineno-0-157"></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;You specified no regularization but you provide regularization_weight=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">regularization_weight</span><span class="si">}</span><span class="s1">, you should leave regularization_weight as None if you do not want to regularize the model.&#39;</span><span class="p">)</span>
<a id="__codelineno-0-158" name="__codelineno-0-158"></a>
<a id="__codelineno-0-159" name="__codelineno-0-159"></a>        <span class="c1"># check number of parameters specified are all positive.</span>
<a id="__codelineno-0-160" name="__codelineno-0-160"></a>        <span class="k">for</span> <span class="n">var_type</span><span class="p">,</span> <span class="n">num_params</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_param_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
<a id="__codelineno-0-161" name="__codelineno-0-161"></a>            <span class="k">assert</span> <span class="n">num_params</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;num_params needs to be positive, got: </span><span class="si">{</span><span class="n">num_params</span><span class="si">}</span><span class="s1">.&#39;</span>
<a id="__codelineno-0-162" name="__codelineno-0-162"></a>
<a id="__codelineno-0-163" name="__codelineno-0-163"></a>        <span class="c1"># infer the number of parameters for intercept if the researcher forgets.</span>
<a id="__codelineno-0-164" name="__codelineno-0-164"></a>        <span class="k">for</span> <span class="n">variable</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">coef_variation_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
<a id="__codelineno-0-165" name="__codelineno-0-165"></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_intercept_term</span><span class="p">(</span><span class="n">variable</span><span class="p">)</span> <span class="ow">and</span> <span class="n">variable</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_param_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
<a id="__codelineno-0-166" name="__codelineno-0-166"></a>                <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;`</span><span class="si">{</span><span class="n">variable</span><span class="si">}</span><span class="s2">` key found in coef_variation_dict but not in num_param_dict, num_param_dict[&#39;</span><span class="si">{</span><span class="n">variable</span><span class="si">}</span><span class="s2">&#39;] has been set to 1.&quot;</span><span class="p">)</span>
<a id="__codelineno-0-167" name="__codelineno-0-167"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">num_param_dict</span><span class="p">[</span><span class="n">variable</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
<a id="__codelineno-0-168" name="__codelineno-0-168"></a>
<a id="__codelineno-0-169" name="__codelineno-0-169"></a>        <span class="c1"># construct trainable parameters.</span>
<a id="__codelineno-0-170" name="__codelineno-0-170"></a>        <span class="n">coef_dict</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
<a id="__codelineno-0-171" name="__codelineno-0-171"></a>        <span class="k">for</span> <span class="n">var_type</span><span class="p">,</span> <span class="n">variation</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">coef_variation_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
<a id="__codelineno-0-172" name="__codelineno-0-172"></a>            <span class="n">coef_dict</span><span class="p">[</span><span class="n">var_type</span><span class="p">]</span> <span class="o">=</span> <span class="n">Coefficient</span><span class="p">(</span><span class="n">variation</span><span class="o">=</span><span class="n">variation</span><span class="p">,</span>
<a id="__codelineno-0-173" name="__codelineno-0-173"></a>                                              <span class="n">num_items</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">num_items</span><span class="p">,</span>
<a id="__codelineno-0-174" name="__codelineno-0-174"></a>                                              <span class="n">num_users</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">num_users</span><span class="p">,</span>
<a id="__codelineno-0-175" name="__codelineno-0-175"></a>                                              <span class="n">num_params</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">num_param_dict</span><span class="p">[</span><span class="n">var_type</span><span class="p">])</span>
<a id="__codelineno-0-176" name="__codelineno-0-176"></a>        <span class="c1"># A ModuleDict is required to properly register all trainable parameters.</span>
<a id="__codelineno-0-177" name="__codelineno-0-177"></a>        <span class="c1"># self.parameter() will fail if a python dictionary is used instead.</span>
<a id="__codelineno-0-178" name="__codelineno-0-178"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">coef_dict</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">ModuleDict</span><span class="p">(</span><span class="n">coef_dict</span><span class="p">)</span>
<a id="__codelineno-0-179" name="__codelineno-0-179"></a>
<a id="__codelineno-0-180" name="__codelineno-0-180"></a>    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<a id="__codelineno-0-181" name="__codelineno-0-181"></a>        <span class="sd">&quot;&quot;&quot;Return a string representation of the model.</span>
<a id="__codelineno-0-182" name="__codelineno-0-182"></a>
<a id="__codelineno-0-183" name="__codelineno-0-183"></a><span class="sd">        Returns:</span>
<a id="__codelineno-0-184" name="__codelineno-0-184"></a><span class="sd">            str: the string representation of the model.</span>
<a id="__codelineno-0-185" name="__codelineno-0-185"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-186" name="__codelineno-0-186"></a>        <span class="n">out_str_lst</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Conditional logistic discrete choice model, expects input features:</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">]</span>
<a id="__codelineno-0-187" name="__codelineno-0-187"></a>        <span class="k">for</span> <span class="n">var_type</span><span class="p">,</span> <span class="n">num_params</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_param_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
<a id="__codelineno-0-188" name="__codelineno-0-188"></a>            <span class="n">out_str_lst</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;X[</span><span class="si">{</span><span class="n">var_type</span><span class="si">}</span><span class="s1">] with </span><span class="si">{</span><span class="n">num_params</span><span class="si">}</span><span class="s1"> parameters, with </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">coef_variation_dict</span><span class="p">[</span><span class="n">var_type</span><span class="p">]</span><span class="si">}</span><span class="s1"> level variation.&#39;</span><span class="p">)</span>
<a id="__codelineno-0-189" name="__codelineno-0-189"></a>        <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__repr__</span><span class="p">()</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">out_str_lst</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">+</span> <span class="sa">f</span><span class="s1">&#39;device=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="si">}</span><span class="s1">&#39;</span>
<a id="__codelineno-0-190" name="__codelineno-0-190"></a>
<a id="__codelineno-0-191" name="__codelineno-0-191"></a>    <span class="nd">@property</span>
<a id="__codelineno-0-192" name="__codelineno-0-192"></a>    <span class="k">def</span> <span class="nf">num_params</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<a id="__codelineno-0-193" name="__codelineno-0-193"></a>        <span class="sd">&quot;&quot;&quot;Get the total number of parameters. For example, if there is only an user-specific coefficient to be multiplied</span>
<a id="__codelineno-0-194" name="__codelineno-0-194"></a><span class="sd">        with the K-dimensional observable, then the total number of parameters would be K x number of users, assuming no</span>
<a id="__codelineno-0-195" name="__codelineno-0-195"></a><span class="sd">        intercept is involved.</span>
<a id="__codelineno-0-196" name="__codelineno-0-196"></a>
<a id="__codelineno-0-197" name="__codelineno-0-197"></a><span class="sd">        Returns:</span>
<a id="__codelineno-0-198" name="__codelineno-0-198"></a><span class="sd">            int: the total number of learnable parameters.</span>
<a id="__codelineno-0-199" name="__codelineno-0-199"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-200" name="__codelineno-0-200"></a>        <span class="k">return</span> <span class="nb">sum</span><span class="p">(</span><span class="n">w</span><span class="o">.</span><span class="n">numel</span><span class="p">()</span> <span class="k">for</span> <span class="n">w</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">())</span>
<a id="__codelineno-0-201" name="__codelineno-0-201"></a>
<a id="__codelineno-0-202" name="__codelineno-0-202"></a>    <span class="k">def</span> <span class="nf">summary</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-0-203" name="__codelineno-0-203"></a>        <span class="sd">&quot;&quot;&quot;Print out the current model parameter.&quot;&quot;&quot;</span>
<a id="__codelineno-0-204" name="__codelineno-0-204"></a>        <span class="k">for</span> <span class="n">var_type</span><span class="p">,</span> <span class="n">coefficient</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">coef_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
<a id="__codelineno-0-205" name="__codelineno-0-205"></a>            <span class="k">if</span> <span class="n">coefficient</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-206" name="__codelineno-0-206"></a>                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Variable Type: &#39;</span><span class="p">,</span> <span class="n">var_type</span><span class="p">)</span>
<a id="__codelineno-0-207" name="__codelineno-0-207"></a>                <span class="nb">print</span><span class="p">(</span><span class="n">coefficient</span><span class="o">.</span><span class="n">coef</span><span class="p">)</span>
<a id="__codelineno-0-208" name="__codelineno-0-208"></a>
<a id="__codelineno-0-209" name="__codelineno-0-209"></a>    <span class="k">def</span> <span class="nf">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-210" name="__codelineno-0-210"></a>                <span class="n">batch</span><span class="p">:</span> <span class="n">ChoiceDataset</span><span class="p">,</span>
<a id="__codelineno-0-211" name="__codelineno-0-211"></a>                <span class="n">manual_coef_value_dict</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-212" name="__codelineno-0-212"></a>                <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">:</span>
<a id="__codelineno-0-213" name="__codelineno-0-213"></a>        <span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-214" name="__codelineno-0-214"></a><span class="sd">        Forward pass of the model.</span>
<a id="__codelineno-0-215" name="__codelineno-0-215"></a>
<a id="__codelineno-0-216" name="__codelineno-0-216"></a><span class="sd">        Args:</span>
<a id="__codelineno-0-217" name="__codelineno-0-217"></a><span class="sd">            batch: a `ChoiceDataset` object.</span>
<a id="__codelineno-0-218" name="__codelineno-0-218"></a>
<a id="__codelineno-0-219" name="__codelineno-0-219"></a><span class="sd">            manual_coef_value_dict (Optional[Dict[str, torch.Tensor]], optional): a dictionary with</span>
<a id="__codelineno-0-220" name="__codelineno-0-220"></a><span class="sd">                keys in {&#39;u&#39;, &#39;i&#39;} etc and tensors as values. If provided, the model will force</span>
<a id="__codelineno-0-221" name="__codelineno-0-221"></a><span class="sd">                coefficient to be the provided values and compute utility conditioned on the provided</span>
<a id="__codelineno-0-222" name="__codelineno-0-222"></a><span class="sd">                coefficient values. This feature is useful when the research wishes to plug in particular</span>
<a id="__codelineno-0-223" name="__codelineno-0-223"></a><span class="sd">                values of coefficients and examine the utility values. If not provided, the model will</span>
<a id="__codelineno-0-224" name="__codelineno-0-224"></a><span class="sd">                use the learned coefficient values in self.coef_dict.</span>
<a id="__codelineno-0-225" name="__codelineno-0-225"></a><span class="sd">                Defaults to None.</span>
<a id="__codelineno-0-226" name="__codelineno-0-226"></a>
<a id="__codelineno-0-227" name="__codelineno-0-227"></a><span class="sd">        Returns:</span>
<a id="__codelineno-0-228" name="__codelineno-0-228"></a><span class="sd">            torch.Tensor: a tensor of shape (num_trips, num_items) whose (t, i) entry represents</span>
<a id="__codelineno-0-229" name="__codelineno-0-229"></a><span class="sd">                the utility from item i in trip t for the user involved in that trip.</span>
<a id="__codelineno-0-230" name="__codelineno-0-230"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-231" name="__codelineno-0-231"></a>        <span class="n">x_dict</span> <span class="o">=</span> <span class="n">batch</span><span class="o">.</span><span class="n">x_dict</span>
<a id="__codelineno-0-232" name="__codelineno-0-232"></a>
<a id="__codelineno-0-233" name="__codelineno-0-233"></a>        <span class="k">for</span> <span class="n">variable</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">coef_variation_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
<a id="__codelineno-0-234" name="__codelineno-0-234"></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_intercept_term</span><span class="p">(</span><span class="n">variable</span><span class="p">):</span>
<a id="__codelineno-0-235" name="__codelineno-0-235"></a>                <span class="c1"># intercept term has no input tensor from the ChoiceDataset data structure.</span>
<a id="__codelineno-0-236" name="__codelineno-0-236"></a>                <span class="c1"># the tensor for intercept has only 1 feature, every entry is 1.</span>
<a id="__codelineno-0-237" name="__codelineno-0-237"></a>                <span class="n">x_dict</span><span class="p">[</span><span class="s1">&#39;intercept&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">batch</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_items</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">device</span><span class="o">=</span><span class="n">batch</span><span class="o">.</span><span class="n">device</span><span class="p">)</span>
<a id="__codelineno-0-238" name="__codelineno-0-238"></a>                <span class="k">break</span>
<a id="__codelineno-0-239" name="__codelineno-0-239"></a>
<a id="__codelineno-0-240" name="__codelineno-0-240"></a>        <span class="c1"># compute the utility from each item in each choice session.</span>
<a id="__codelineno-0-241" name="__codelineno-0-241"></a>        <span class="n">total_utility</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">batch</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_items</span><span class="p">),</span> <span class="n">device</span><span class="o">=</span><span class="n">batch</span><span class="o">.</span><span class="n">device</span><span class="p">)</span>
<a id="__codelineno-0-242" name="__codelineno-0-242"></a>        <span class="c1"># for each type of variables, apply the corresponding coefficient to input x.</span>
<a id="__codelineno-0-243" name="__codelineno-0-243"></a>
<a id="__codelineno-0-244" name="__codelineno-0-244"></a>        <span class="k">for</span> <span class="n">var_type</span><span class="p">,</span> <span class="n">coef</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">coef_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
<a id="__codelineno-0-245" name="__codelineno-0-245"></a>            <span class="c1"># variable type is named as &quot;observable_name[variation]&quot;, retrieve the corresponding observable name.</span>
<a id="__codelineno-0-246" name="__codelineno-0-246"></a>            <span class="n">corresponding_observable</span> <span class="o">=</span> <span class="n">var_type</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;[&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-0-247" name="__codelineno-0-247"></a>            <span class="n">total_utility</span> <span class="o">+=</span> <span class="n">coef</span><span class="p">(</span>
<a id="__codelineno-0-248" name="__codelineno-0-248"></a>                <span class="n">x_dict</span><span class="p">[</span><span class="n">corresponding_observable</span><span class="p">],</span>
<a id="__codelineno-0-249" name="__codelineno-0-249"></a>                <span class="n">batch</span><span class="o">.</span><span class="n">user_index</span><span class="p">,</span>
<a id="__codelineno-0-250" name="__codelineno-0-250"></a>                <span class="n">manual_coef_value</span><span class="o">=</span><span class="kc">None</span> <span class="k">if</span> <span class="n">manual_coef_value_dict</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">manual_coef_value_dict</span><span class="p">[</span><span class="n">var_type</span><span class="p">])</span>
<a id="__codelineno-0-251" name="__codelineno-0-251"></a>
<a id="__codelineno-0-252" name="__codelineno-0-252"></a>        <span class="k">assert</span> <span class="n">total_utility</span><span class="o">.</span><span class="n">shape</span> <span class="o">==</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">batch</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_items</span><span class="p">)</span>
<a id="__codelineno-0-253" name="__codelineno-0-253"></a>
<a id="__codelineno-0-254" name="__codelineno-0-254"></a>        <span class="k">if</span> <span class="n">batch</span><span class="o">.</span><span class="n">item_availability</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-255" name="__codelineno-0-255"></a>            <span class="c1"># mask out unavailable items.</span>
<a id="__codelineno-0-256" name="__codelineno-0-256"></a>            <span class="n">total_utility</span><span class="p">[</span><span class="o">~</span><span class="n">batch</span><span class="o">.</span><span class="n">item_availability</span><span class="p">[</span><span class="n">batch</span><span class="o">.</span><span class="n">session_index</span><span class="p">,</span> <span class="p">:]]</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">finfo</span><span class="p">(</span><span class="n">total_utility</span><span class="o">.</span><span class="n">dtype</span><span class="p">)</span><span class="o">.</span><span class="n">min</span> <span class="o">/</span> <span class="mi">2</span>
<a id="__codelineno-0-257" name="__codelineno-0-257"></a>        <span class="k">return</span> <span class="n">total_utility</span>
<a id="__codelineno-0-258" name="__codelineno-0-258"></a>
<a id="__codelineno-0-259" name="__codelineno-0-259"></a>
<a id="__codelineno-0-260" name="__codelineno-0-260"></a>    <span class="k">def</span> <span class="nf">negative_log_likelihood</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">batch</span><span class="p">:</span> <span class="n">ChoiceDataset</span><span class="p">,</span> <span class="n">y</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span> <span class="n">is_train</span><span class="p">:</span> <span class="nb">bool</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">:</span>
<a id="__codelineno-0-261" name="__codelineno-0-261"></a>        <span class="sd">&quot;&quot;&quot;Computes the log-likelihood for the batch and label.</span>
<a id="__codelineno-0-262" name="__codelineno-0-262"></a><span class="sd">        TODO: consider remove y, change to label.</span>
<a id="__codelineno-0-263" name="__codelineno-0-263"></a><span class="sd">        TODO: consider move this method outside the model, the role of the model is to compute the utility.</span>
<a id="__codelineno-0-264" name="__codelineno-0-264"></a>
<a id="__codelineno-0-265" name="__codelineno-0-265"></a><span class="sd">        Args:</span>
<a id="__codelineno-0-266" name="__codelineno-0-266"></a><span class="sd">            batch (ChoiceDataset): a ChoiceDataset object containing the data.</span>
<a id="__codelineno-0-267" name="__codelineno-0-267"></a><span class="sd">            y (torch.Tensor): the label.</span>
<a id="__codelineno-0-268" name="__codelineno-0-268"></a><span class="sd">            is_train (bool, optional): whether to trace the gradient. Defaults to True.</span>
<a id="__codelineno-0-269" name="__codelineno-0-269"></a>
<a id="__codelineno-0-270" name="__codelineno-0-270"></a><span class="sd">        Returns:</span>
<a id="__codelineno-0-271" name="__codelineno-0-271"></a><span class="sd">            torch.Tensor: the negative log-likelihood.</span>
<a id="__codelineno-0-272" name="__codelineno-0-272"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-273" name="__codelineno-0-273"></a>        <span class="k">if</span> <span class="n">is_train</span><span class="p">:</span>
<a id="__codelineno-0-274" name="__codelineno-0-274"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">train</span><span class="p">()</span>
<a id="__codelineno-0-275" name="__codelineno-0-275"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-276" name="__codelineno-0-276"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">eval</span><span class="p">()</span>
<a id="__codelineno-0-277" name="__codelineno-0-277"></a>        <span class="c1"># (num_trips, num_items)</span>
<a id="__codelineno-0-278" name="__codelineno-0-278"></a>        <span class="n">total_utility</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">forward</span><span class="p">(</span><span class="n">batch</span><span class="p">)</span>
<a id="__codelineno-0-279" name="__codelineno-0-279"></a>        <span class="n">logP</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">log_softmax</span><span class="p">(</span><span class="n">total_utility</span><span class="p">,</span> <span class="n">dim</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-0-280" name="__codelineno-0-280"></a>        <span class="n">nll</span> <span class="o">=</span> <span class="o">-</span> <span class="n">logP</span><span class="p">[</span><span class="n">torch</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">y</span><span class="p">)),</span> <span class="n">y</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
<a id="__codelineno-0-281" name="__codelineno-0-281"></a>        <span class="k">return</span> <span class="n">nll</span>
<a id="__codelineno-0-282" name="__codelineno-0-282"></a>
<a id="__codelineno-0-283" name="__codelineno-0-283"></a>    <span class="k">def</span> <span class="nf">loss</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<a id="__codelineno-0-284" name="__codelineno-0-284"></a>        <span class="sd">&quot;&quot;&quot;The loss function to be optimized. This is a wrapper of `negative_log_likelihood` + regularization loss if required.&quot;&quot;&quot;</span>
<a id="__codelineno-0-285" name="__codelineno-0-285"></a>        <span class="n">nll</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">negative_log_likelihood</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
<a id="__codelineno-0-286" name="__codelineno-0-286"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">regularization</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-287" name="__codelineno-0-287"></a>            <span class="n">L</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;L1&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;L2&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">}[</span><span class="bp">self</span><span class="o">.</span><span class="n">regularization</span><span class="p">]</span>
<a id="__codelineno-0-288" name="__codelineno-0-288"></a>            <span class="k">for</span> <span class="n">param</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">():</span>
<a id="__codelineno-0-289" name="__codelineno-0-289"></a>                <span class="n">nll</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">regularization_weight</span> <span class="o">*</span> <span class="n">torch</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">param</span><span class="p">,</span> <span class="n">p</span><span class="o">=</span><span class="n">L</span><span class="p">)</span>
<a id="__codelineno-0-290" name="__codelineno-0-290"></a>        <span class="k">return</span> <span class="n">nll</span>
<a id="__codelineno-0-291" name="__codelineno-0-291"></a>
<a id="__codelineno-0-292" name="__codelineno-0-292"></a>    <span class="nd">@property</span>
<a id="__codelineno-0-293" name="__codelineno-0-293"></a>    <span class="k">def</span> <span class="nf">device</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">torch</span><span class="o">.</span><span class="n">device</span><span class="p">:</span>
<a id="__codelineno-0-294" name="__codelineno-0-294"></a>        <span class="sd">&quot;&quot;&quot;Returns the device of the coefficient.</span>
<a id="__codelineno-0-295" name="__codelineno-0-295"></a>
<a id="__codelineno-0-296" name="__codelineno-0-296"></a><span class="sd">        Returns:</span>
<a id="__codelineno-0-297" name="__codelineno-0-297"></a><span class="sd">            torch.device: the device of the model.</span>
<a id="__codelineno-0-298" name="__codelineno-0-298"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-299" name="__codelineno-0-299"></a>        <span class="k">return</span> <span class="nb">next</span><span class="p">(</span><span class="nb">iter</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">coef_dict</span><span class="o">.</span><span class="n">values</span><span class="p">()))</span><span class="o">.</span><span class="n">device</span>
<a id="__codelineno-0-300" name="__codelineno-0-300"></a>
<a id="__codelineno-0-301" name="__codelineno-0-301"></a>    <span class="nd">@staticmethod</span>
<a id="__codelineno-0-302" name="__codelineno-0-302"></a>    <span class="k">def</span> <span class="nf">is_intercept_term</span><span class="p">(</span><span class="n">variable</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<a id="__codelineno-0-303" name="__codelineno-0-303"></a>        <span class="c1"># check if the given variable is an intercept (fixed effect) term.</span>
<a id="__codelineno-0-304" name="__codelineno-0-304"></a>        <span class="c1"># intercept (fixed effect) terms are defined as &#39;intercept[*]&#39; and looks like &#39;intercept[user]&#39;, &#39;intercept[item]&#39;, etc.</span>
<a id="__codelineno-0-305" name="__codelineno-0-305"></a>        <span class="k">return</span> <span class="p">(</span><span class="n">variable</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;intercept[&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">variable</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;]&#39;</span><span class="p">))</span>
<a id="__codelineno-0-306" name="__codelineno-0-306"></a>
<a id="__codelineno-0-307" name="__codelineno-0-307"></a>    <span class="k">def</span> <span class="nf">get_coefficient</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">variable</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">:</span>
<a id="__codelineno-0-308" name="__codelineno-0-308"></a>        <span class="sd">&quot;&quot;&quot;Retrieve the coefficient tensor for the given variable.</span>
<a id="__codelineno-0-309" name="__codelineno-0-309"></a>
<a id="__codelineno-0-310" name="__codelineno-0-310"></a><span class="sd">        Args:</span>
<a id="__codelineno-0-311" name="__codelineno-0-311"></a><span class="sd">            variable (str): the variable name.</span>
<a id="__codelineno-0-312" name="__codelineno-0-312"></a>
<a id="__codelineno-0-313" name="__codelineno-0-313"></a><span class="sd">        Returns:</span>
<a id="__codelineno-0-314" name="__codelineno-0-314"></a><span class="sd">            torch.Tensor: the corresponding coefficient tensor of the requested variable.</span>
<a id="__codelineno-0-315" name="__codelineno-0-315"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-316" name="__codelineno-0-316"></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">state_dict</span><span class="p">()[</span><span class="sa">f</span><span class="s2">&quot;coef_dict.</span><span class="si">{</span><span class="n">variable</span><span class="si">}</span><span class="s2">.coef&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">detach</span><span class="p">()</span><span class="o">.</span><span class="n">clone</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
        </details>

  

  <div class="doc doc-children">







<div class="doc doc-object doc-attribute">



<h2 id="torch_choice.model.conditional_logit_model.ConditionalLogitModel.device" class="doc doc-heading">
<code class="highlight language-python"><span class="n">device</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">device</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h2>


  <div class="doc doc-contents ">
  
      <p>Returns the device of the coefficient.</p>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code>torch.<span title="torch.device">device</span></code>
          </td>
          <td><p>torch.device: the device of the model.</p></td>
        </tr>
    </tbody>
  </table>
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h2 id="torch_choice.model.conditional_logit_model.ConditionalLogitModel.num_params" class="doc doc-heading">
<code class="highlight language-python"><span class="n">num_params</span><span class="p">:</span> <span class="nb">int</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h2>


  <div class="doc doc-contents ">
  
      <p>Get the total number of parameters. For example, if there is only an user-specific coefficient to be multiplied
with the K-dimensional observable, then the total number of parameters would be K x number of users, assuming no
intercept is involved.</p>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
<th>Name</th>        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
<td><code>int</code></td>          <td>
                <code>int</code>
          </td>
          <td><p>the total number of learnable parameters.</p></td>
        </tr>
    </tbody>
  </table>
  </div>

</div>



<div class="doc doc-object doc-function">



<h2 id="torch_choice.model.conditional_logit_model.ConditionalLogitModel.__init__" class="doc doc-heading">
<code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">formula</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">dataset</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">coef_variation_dict</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">num_param_dict</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">num_items</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">num_users</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">regularization</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">regularization_weight</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>formula</code></td>
          <td>
                <code>str</code>
          </td>
          <td><p>a string representing the utility formula.
The formula consists of '(variable_name|variation)'s separated by '+', for example:
"(var1|item) + (var2|user) + (var3|constant)"
where the first part of each term is the name of the variable
and the second part is the variation of the coefficient.
The variation can be one of the following:
'constant', 'item', 'item-full', 'user', 'user-item', 'user-item-full'.
All spaces in the formula will be ignored, hence please do not use spaces in variable/observable names.</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>data</code></td>
          <td>
                <code><a class="autorefs autorefs-internal" title="torch_choice.data.choice_dataset.ChoiceDataset" href="#torch_choice.data.ChoiceDataset">ChoiceDataset</a></code>
          </td>
          <td><p>a ChoiceDataset object for training the model, the parser will infer dimensions of variables
and sizes of coefficients from the ChoiceDataset.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>coef_variation_dict</code></td>
          <td>
                <code><span title="typing.Dict">Dict</span>[str, str]</code>
          </td>
          <td><p>variable type to variation level dictionary. Keys of this dictionary
should be variable names in the dataset (i.e., these starting with <code>itemsession_</code>, <code>price_</code>, <code>user_</code>, etc), or <code>intercept</code>
if the researcher requires an intercept term.
For each variable name X_var (e.g., <code>user_income</code>) or <code>intercept</code>, the corresponding dictionary key should
be one of the following values, this value specifies the "level of variation" of the coefficient.</p>
<ul>
<li>
<p><code>constant</code>: the coefficient constant over all users and items: <span class="arithmatex">\(X eta\)</span>.</p>
</li>
<li>
<p><code>user</code>: user-specific parameters but constant across all items: <span class="arithmatex">\(X eta_{u}\)</span>.</p>
</li>
<li>
<p><code>item</code>: item-specific parameters but constant across all users, <span class="arithmatex">\(X eta_{i}\)</span>.
    Note that the coefficients for the first item are forced to be zero following the standard practice
    in econometrics.</p>
</li>
<li>
<p><code>item-full</code>: the same configuration as <code>item</code>, but does not force the coefficients of the first item to
    be zeros.</p>
</li>
</ul>
<p>The following configurations are supported by the package, but we don't recommend using them due to the
    large number of parameters.
- <code>user-item</code>: parameters that are specific to both user and item, parameter for the first item
    for all users are forced to be zero.</p>
<ul>
<li><code>user-item-full</code>: parameters that are specific to both user and item, explicitly model for all items.</li>
</ul></td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>num_param_dict</code></td>
          <td>
                <code><span title="typing.Optional">Optional</span>[<span title="typing.Dict">Dict</span>[str, int]]</code>
          </td>
          <td><p>variable type to number of parameters dictionary with keys exactly the same
as the <code>coef_variation_dict</code>. Values of <code>num_param_dict</code> records numbers of features in each kind of variable.
If None is supplied, num_param_dict will be a dictionary with the same keys as the <code>coef_variation_dict</code> dictionary
and values of all ones. Default to be None.</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>num_items</code></td>
          <td>
                <code>int</code>
          </td>
          <td><p>number of items in the dataset.</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>num_users</code></td>
          <td>
                <code>int</code>
          </td>
          <td><p>number of users in the dataset.</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>regularization</code></td>
          <td>
                <code><span title="typing.Optional">Optional</span>[str]</code>
          </td>
          <td><p>this argument takes values from {'L1', 'L2', None}, which specifies the type of
regularization added to the log-likelihood.
- 'L1' will subtract regularization_weight * 1-norm of parameters from the log-likelihood.
- 'L2' will subtract regularization_weight * 2-norm of parameters from the log-likelihood.
- None does not modify the log-likelihood.
Defaults to None.</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>regularization_weight</code></td>
          <td>
                <code><span title="typing.Optional">Optional</span>[float]</code>
          </td>
          <td><p>the weight of parameter norm subtracted from the log-likelihood.
This term controls the strength of regularization. This argument is required if and only if regularization
is not None.
Defaults to None.</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>torch_choice/model/conditional_logit_model.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-42"> 42</a></span>
<span class="normal"><a href="#__codelineno-0-43"> 43</a></span>
<span class="normal"><a href="#__codelineno-0-44"> 44</a></span>
<span class="normal"><a href="#__codelineno-0-45"> 45</a></span>
<span class="normal"><a href="#__codelineno-0-46"> 46</a></span>
<span class="normal"><a href="#__codelineno-0-47"> 47</a></span>
<span class="normal"><a href="#__codelineno-0-48"> 48</a></span>
<span class="normal"><a href="#__codelineno-0-49"> 49</a></span>
<span class="normal"><a href="#__codelineno-0-50"> 50</a></span>
<span class="normal"><a href="#__codelineno-0-51"> 51</a></span>
<span class="normal"><a href="#__codelineno-0-52"> 52</a></span>
<span class="normal"><a href="#__codelineno-0-53"> 53</a></span>
<span class="normal"><a href="#__codelineno-0-54"> 54</a></span>
<span class="normal"><a href="#__codelineno-0-55"> 55</a></span>
<span class="normal"><a href="#__codelineno-0-56"> 56</a></span>
<span class="normal"><a href="#__codelineno-0-57"> 57</a></span>
<span class="normal"><a href="#__codelineno-0-58"> 58</a></span>
<span class="normal"><a href="#__codelineno-0-59"> 59</a></span>
<span class="normal"><a href="#__codelineno-0-60"> 60</a></span>
<span class="normal"><a href="#__codelineno-0-61"> 61</a></span>
<span class="normal"><a href="#__codelineno-0-62"> 62</a></span>
<span class="normal"><a href="#__codelineno-0-63"> 63</a></span>
<span class="normal"><a href="#__codelineno-0-64"> 64</a></span>
<span class="normal"><a href="#__codelineno-0-65"> 65</a></span>
<span class="normal"><a href="#__codelineno-0-66"> 66</a></span>
<span class="normal"><a href="#__codelineno-0-67"> 67</a></span>
<span class="normal"><a href="#__codelineno-0-68"> 68</a></span>
<span class="normal"><a href="#__codelineno-0-69"> 69</a></span>
<span class="normal"><a href="#__codelineno-0-70"> 70</a></span>
<span class="normal"><a href="#__codelineno-0-71"> 71</a></span>
<span class="normal"><a href="#__codelineno-0-72"> 72</a></span>
<span class="normal"><a href="#__codelineno-0-73"> 73</a></span>
<span class="normal"><a href="#__codelineno-0-74"> 74</a></span>
<span class="normal"><a href="#__codelineno-0-75"> 75</a></span>
<span class="normal"><a href="#__codelineno-0-76"> 76</a></span>
<span class="normal"><a href="#__codelineno-0-77"> 77</a></span>
<span class="normal"><a href="#__codelineno-0-78"> 78</a></span>
<span class="normal"><a href="#__codelineno-0-79"> 79</a></span>
<span class="normal"><a href="#__codelineno-0-80"> 80</a></span>
<span class="normal"><a href="#__codelineno-0-81"> 81</a></span>
<span class="normal"><a href="#__codelineno-0-82"> 82</a></span>
<span class="normal"><a href="#__codelineno-0-83"> 83</a></span>
<span class="normal"><a href="#__codelineno-0-84"> 84</a></span>
<span class="normal"><a href="#__codelineno-0-85"> 85</a></span>
<span class="normal"><a href="#__codelineno-0-86"> 86</a></span>
<span class="normal"><a href="#__codelineno-0-87"> 87</a></span>
<span class="normal"><a href="#__codelineno-0-88"> 88</a></span>
<span class="normal"><a href="#__codelineno-0-89"> 89</a></span>
<span class="normal"><a href="#__codelineno-0-90"> 90</a></span>
<span class="normal"><a href="#__codelineno-0-91"> 91</a></span>
<span class="normal"><a href="#__codelineno-0-92"> 92</a></span>
<span class="normal"><a href="#__codelineno-0-93"> 93</a></span>
<span class="normal"><a href="#__codelineno-0-94"> 94</a></span>
<span class="normal"><a href="#__codelineno-0-95"> 95</a></span>
<span class="normal"><a href="#__codelineno-0-96"> 96</a></span>
<span class="normal"><a href="#__codelineno-0-97"> 97</a></span>
<span class="normal"><a href="#__codelineno-0-98"> 98</a></span>
<span class="normal"><a href="#__codelineno-0-99"> 99</a></span>
<span class="normal"><a href="#__codelineno-0-100">100</a></span>
<span class="normal"><a href="#__codelineno-0-101">101</a></span>
<span class="normal"><a href="#__codelineno-0-102">102</a></span>
<span class="normal"><a href="#__codelineno-0-103">103</a></span>
<span class="normal"><a href="#__codelineno-0-104">104</a></span>
<span class="normal"><a href="#__codelineno-0-105">105</a></span>
<span class="normal"><a href="#__codelineno-0-106">106</a></span>
<span class="normal"><a href="#__codelineno-0-107">107</a></span>
<span class="normal"><a href="#__codelineno-0-108">108</a></span>
<span class="normal"><a href="#__codelineno-0-109">109</a></span>
<span class="normal"><a href="#__codelineno-0-110">110</a></span>
<span class="normal"><a href="#__codelineno-0-111">111</a></span>
<span class="normal"><a href="#__codelineno-0-112">112</a></span>
<span class="normal"><a href="#__codelineno-0-113">113</a></span>
<span class="normal"><a href="#__codelineno-0-114">114</a></span>
<span class="normal"><a href="#__codelineno-0-115">115</a></span>
<span class="normal"><a href="#__codelineno-0-116">116</a></span>
<span class="normal"><a href="#__codelineno-0-117">117</a></span>
<span class="normal"><a href="#__codelineno-0-118">118</a></span>
<span class="normal"><a href="#__codelineno-0-119">119</a></span>
<span class="normal"><a href="#__codelineno-0-120">120</a></span>
<span class="normal"><a href="#__codelineno-0-121">121</a></span>
<span class="normal"><a href="#__codelineno-0-122">122</a></span>
<span class="normal"><a href="#__codelineno-0-123">123</a></span>
<span class="normal"><a href="#__codelineno-0-124">124</a></span>
<span class="normal"><a href="#__codelineno-0-125">125</a></span>
<span class="normal"><a href="#__codelineno-0-126">126</a></span>
<span class="normal"><a href="#__codelineno-0-127">127</a></span>
<span class="normal"><a href="#__codelineno-0-128">128</a></span>
<span class="normal"><a href="#__codelineno-0-129">129</a></span>
<span class="normal"><a href="#__codelineno-0-130">130</a></span>
<span class="normal"><a href="#__codelineno-0-131">131</a></span>
<span class="normal"><a href="#__codelineno-0-132">132</a></span>
<span class="normal"><a href="#__codelineno-0-133">133</a></span>
<span class="normal"><a href="#__codelineno-0-134">134</a></span>
<span class="normal"><a href="#__codelineno-0-135">135</a></span>
<span class="normal"><a href="#__codelineno-0-136">136</a></span>
<span class="normal"><a href="#__codelineno-0-137">137</a></span>
<span class="normal"><a href="#__codelineno-0-138">138</a></span>
<span class="normal"><a href="#__codelineno-0-139">139</a></span>
<span class="normal"><a href="#__codelineno-0-140">140</a></span>
<span class="normal"><a href="#__codelineno-0-141">141</a></span>
<span class="normal"><a href="#__codelineno-0-142">142</a></span>
<span class="normal"><a href="#__codelineno-0-143">143</a></span>
<span class="normal"><a href="#__codelineno-0-144">144</a></span>
<span class="normal"><a href="#__codelineno-0-145">145</a></span>
<span class="normal"><a href="#__codelineno-0-146">146</a></span>
<span class="normal"><a href="#__codelineno-0-147">147</a></span>
<span class="normal"><a href="#__codelineno-0-148">148</a></span>
<span class="normal"><a href="#__codelineno-0-149">149</a></span>
<span class="normal"><a href="#__codelineno-0-150">150</a></span>
<span class="normal"><a href="#__codelineno-0-151">151</a></span>
<span class="normal"><a href="#__codelineno-0-152">152</a></span>
<span class="normal"><a href="#__codelineno-0-153">153</a></span>
<span class="normal"><a href="#__codelineno-0-154">154</a></span>
<span class="normal"><a href="#__codelineno-0-155">155</a></span>
<span class="normal"><a href="#__codelineno-0-156">156</a></span>
<span class="normal"><a href="#__codelineno-0-157">157</a></span>
<span class="normal"><a href="#__codelineno-0-158">158</a></span>
<span class="normal"><a href="#__codelineno-0-159">159</a></span>
<span class="normal"><a href="#__codelineno-0-160">160</a></span>
<span class="normal"><a href="#__codelineno-0-161">161</a></span>
<span class="normal"><a href="#__codelineno-0-162">162</a></span>
<span class="normal"><a href="#__codelineno-0-163">163</a></span>
<span class="normal"><a href="#__codelineno-0-164">164</a></span>
<span class="normal"><a href="#__codelineno-0-165">165</a></span>
<span class="normal"><a href="#__codelineno-0-166">166</a></span>
<span class="normal"><a href="#__codelineno-0-167">167</a></span>
<span class="normal"><a href="#__codelineno-0-168">168</a></span>
<span class="normal"><a href="#__codelineno-0-169">169</a></span>
<span class="normal"><a href="#__codelineno-0-170">170</a></span>
<span class="normal"><a href="#__codelineno-0-171">171</a></span>
<span class="normal"><a href="#__codelineno-0-172">172</a></span>
<span class="normal"><a href="#__codelineno-0-173">173</a></span>
<span class="normal"><a href="#__codelineno-0-174">174</a></span>
<span class="normal"><a href="#__codelineno-0-175">175</a></span>
<span class="normal"><a href="#__codelineno-0-176">176</a></span>
<span class="normal"><a href="#__codelineno-0-177">177</a></span>
<span class="normal"><a href="#__codelineno-0-178">178</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-42" name="__codelineno-0-42"></a><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-43" name="__codelineno-0-43"></a>             <span class="n">formula</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-44" name="__codelineno-0-44"></a>             <span class="n">dataset</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">ChoiceDataset</span><span class="p">]</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-45" name="__codelineno-0-45"></a>             <span class="n">coef_variation_dict</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-46" name="__codelineno-0-46"></a>             <span class="n">num_param_dict</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">]]</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-47" name="__codelineno-0-47"></a>             <span class="n">num_items</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-48" name="__codelineno-0-48"></a>             <span class="n">num_users</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-49" name="__codelineno-0-49"></a>             <span class="n">regularization</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-50" name="__codelineno-0-50"></a>             <span class="n">regularization_weight</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span><span class="o">=</span><span class="kc">None</span>
<a id="__codelineno-0-51" name="__codelineno-0-51"></a>             <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-52" name="__codelineno-0-52"></a>    <span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-53" name="__codelineno-0-53"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-54" name="__codelineno-0-54"></a><span class="sd">        formula (str): a string representing the utility formula.</span>
<a id="__codelineno-0-55" name="__codelineno-0-55"></a><span class="sd">            The formula consists of &#39;(variable_name|variation)&#39;s separated by &#39;+&#39;, for example:</span>
<a id="__codelineno-0-56" name="__codelineno-0-56"></a><span class="sd">            &quot;(var1|item) + (var2|user) + (var3|constant)&quot;</span>
<a id="__codelineno-0-57" name="__codelineno-0-57"></a><span class="sd">            where the first part of each term is the name of the variable</span>
<a id="__codelineno-0-58" name="__codelineno-0-58"></a><span class="sd">            and the second part is the variation of the coefficient.</span>
<a id="__codelineno-0-59" name="__codelineno-0-59"></a><span class="sd">            The variation can be one of the following:</span>
<a id="__codelineno-0-60" name="__codelineno-0-60"></a><span class="sd">            &#39;constant&#39;, &#39;item&#39;, &#39;item-full&#39;, &#39;user&#39;, &#39;user-item&#39;, &#39;user-item-full&#39;.</span>
<a id="__codelineno-0-61" name="__codelineno-0-61"></a><span class="sd">            All spaces in the formula will be ignored, hence please do not use spaces in variable/observable names.</span>
<a id="__codelineno-0-62" name="__codelineno-0-62"></a><span class="sd">        data (ChoiceDataset): a ChoiceDataset object for training the model, the parser will infer dimensions of variables</span>
<a id="__codelineno-0-63" name="__codelineno-0-63"></a><span class="sd">            and sizes of coefficients from the ChoiceDataset.</span>
<a id="__codelineno-0-64" name="__codelineno-0-64"></a><span class="sd">        coef_variation_dict (Dict[str, str]): variable type to variation level dictionary. Keys of this dictionary</span>
<a id="__codelineno-0-65" name="__codelineno-0-65"></a><span class="sd">            should be variable names in the dataset (i.e., these starting with `itemsession_`, `price_`, `user_`, etc), or `intercept`</span>
<a id="__codelineno-0-66" name="__codelineno-0-66"></a><span class="sd">            if the researcher requires an intercept term.</span>
<a id="__codelineno-0-67" name="__codelineno-0-67"></a><span class="sd">            For each variable name X_var (e.g., `user_income`) or `intercept`, the corresponding dictionary key should</span>
<a id="__codelineno-0-68" name="__codelineno-0-68"></a><span class="sd">            be one of the following values, this value specifies the &quot;level of variation&quot; of the coefficient.</span>
<a id="__codelineno-0-69" name="__codelineno-0-69"></a>
<a id="__codelineno-0-70" name="__codelineno-0-70"></a><span class="sd">            - `constant`: the coefficient constant over all users and items: $X \beta$.</span>
<a id="__codelineno-0-71" name="__codelineno-0-71"></a>
<a id="__codelineno-0-72" name="__codelineno-0-72"></a><span class="sd">            - `user`: user-specific parameters but constant across all items: $X \beta_{u}$.</span>
<a id="__codelineno-0-73" name="__codelineno-0-73"></a>
<a id="__codelineno-0-74" name="__codelineno-0-74"></a><span class="sd">            - `item`: item-specific parameters but constant across all users, $X \beta_{i}$.</span>
<a id="__codelineno-0-75" name="__codelineno-0-75"></a><span class="sd">                Note that the coefficients for the first item are forced to be zero following the standard practice</span>
<a id="__codelineno-0-76" name="__codelineno-0-76"></a><span class="sd">                in econometrics.</span>
<a id="__codelineno-0-77" name="__codelineno-0-77"></a>
<a id="__codelineno-0-78" name="__codelineno-0-78"></a><span class="sd">            - `item-full`: the same configuration as `item`, but does not force the coefficients of the first item to</span>
<a id="__codelineno-0-79" name="__codelineno-0-79"></a><span class="sd">                be zeros.</span>
<a id="__codelineno-0-80" name="__codelineno-0-80"></a>
<a id="__codelineno-0-81" name="__codelineno-0-81"></a><span class="sd">            The following configurations are supported by the package, but we don&#39;t recommend using them due to the</span>
<a id="__codelineno-0-82" name="__codelineno-0-82"></a><span class="sd">                large number of parameters.</span>
<a id="__codelineno-0-83" name="__codelineno-0-83"></a><span class="sd">            - `user-item`: parameters that are specific to both user and item, parameter for the first item</span>
<a id="__codelineno-0-84" name="__codelineno-0-84"></a><span class="sd">                for all users are forced to be zero.</span>
<a id="__codelineno-0-85" name="__codelineno-0-85"></a>
<a id="__codelineno-0-86" name="__codelineno-0-86"></a><span class="sd">            - `user-item-full`: parameters that are specific to both user and item, explicitly model for all items.</span>
<a id="__codelineno-0-87" name="__codelineno-0-87"></a><span class="sd">        num_param_dict (Optional[Dict[str, int]]): variable type to number of parameters dictionary with keys exactly the same</span>
<a id="__codelineno-0-88" name="__codelineno-0-88"></a><span class="sd">            as the `coef_variation_dict`. Values of `num_param_dict` records numbers of features in each kind of variable.</span>
<a id="__codelineno-0-89" name="__codelineno-0-89"></a><span class="sd">            If None is supplied, num_param_dict will be a dictionary with the same keys as the `coef_variation_dict` dictionary</span>
<a id="__codelineno-0-90" name="__codelineno-0-90"></a><span class="sd">            and values of all ones. Default to be None.</span>
<a id="__codelineno-0-91" name="__codelineno-0-91"></a><span class="sd">        num_items (int): number of items in the dataset.</span>
<a id="__codelineno-0-92" name="__codelineno-0-92"></a><span class="sd">        num_users (int): number of users in the dataset.</span>
<a id="__codelineno-0-93" name="__codelineno-0-93"></a><span class="sd">        regularization (Optional[str]): this argument takes values from {&#39;L1&#39;, &#39;L2&#39;, None}, which specifies the type of</span>
<a id="__codelineno-0-94" name="__codelineno-0-94"></a><span class="sd">            regularization added to the log-likelihood.</span>
<a id="__codelineno-0-95" name="__codelineno-0-95"></a><span class="sd">            - &#39;L1&#39; will subtract regularization_weight * 1-norm of parameters from the log-likelihood.</span>
<a id="__codelineno-0-96" name="__codelineno-0-96"></a><span class="sd">            - &#39;L2&#39; will subtract regularization_weight * 2-norm of parameters from the log-likelihood.</span>
<a id="__codelineno-0-97" name="__codelineno-0-97"></a><span class="sd">            - None does not modify the log-likelihood.</span>
<a id="__codelineno-0-98" name="__codelineno-0-98"></a><span class="sd">            Defaults to None.</span>
<a id="__codelineno-0-99" name="__codelineno-0-99"></a><span class="sd">        regularization_weight (Optional[float]): the weight of parameter norm subtracted from the log-likelihood.</span>
<a id="__codelineno-0-100" name="__codelineno-0-100"></a><span class="sd">            This term controls the strength of regularization. This argument is required if and only if regularization</span>
<a id="__codelineno-0-101" name="__codelineno-0-101"></a><span class="sd">            is not None.</span>
<a id="__codelineno-0-102" name="__codelineno-0-102"></a><span class="sd">            Defaults to None.</span>
<a id="__codelineno-0-103" name="__codelineno-0-103"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-104" name="__codelineno-0-104"></a>    <span class="c1"># ==============================================================================================================</span>
<a id="__codelineno-0-105" name="__codelineno-0-105"></a>    <span class="c1"># Check that the model received a valid combination of inputs so that it can be initialized.</span>
<a id="__codelineno-0-106" name="__codelineno-0-106"></a>    <span class="c1"># ==============================================================================================================</span>
<a id="__codelineno-0-107" name="__codelineno-0-107"></a>    <span class="k">if</span> <span class="n">coef_variation_dict</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">formula</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-108" name="__codelineno-0-108"></a>        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Either coef_variation_dict or formula should be provided to specify the model.&quot;</span><span class="p">)</span>
<a id="__codelineno-0-109" name="__codelineno-0-109"></a>
<a id="__codelineno-0-110" name="__codelineno-0-110"></a>    <span class="k">if</span> <span class="p">(</span><span class="n">coef_variation_dict</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">formula</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">):</span>
<a id="__codelineno-0-111" name="__codelineno-0-111"></a>        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Only one of coef_variation_dict or formula should be provided to specify the model.&quot;</span><span class="p">)</span>
<a id="__codelineno-0-112" name="__codelineno-0-112"></a>
<a id="__codelineno-0-113" name="__codelineno-0-113"></a>    <span class="k">if</span> <span class="p">(</span><span class="n">formula</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">dataset</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">):</span>
<a id="__codelineno-0-114" name="__codelineno-0-114"></a>        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;If formula is provided, data should be provided to specify the model.&quot;</span><span class="p">)</span>
<a id="__codelineno-0-115" name="__codelineno-0-115"></a>
<a id="__codelineno-0-116" name="__codelineno-0-116"></a>
<a id="__codelineno-0-117" name="__codelineno-0-117"></a>    <span class="c1"># ==============================================================================================================</span>
<a id="__codelineno-0-118" name="__codelineno-0-118"></a>    <span class="c1"># Build necessary dictionaries for model initialization.</span>
<a id="__codelineno-0-119" name="__codelineno-0-119"></a>    <span class="c1"># ==============================================================================================================</span>
<a id="__codelineno-0-120" name="__codelineno-0-120"></a>    <span class="k">if</span> <span class="n">formula</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-121" name="__codelineno-0-121"></a>        <span class="c1"># Use dictionaries to initialize the model.</span>
<a id="__codelineno-0-122" name="__codelineno-0-122"></a>        <span class="k">if</span> <span class="n">num_param_dict</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-123" name="__codelineno-0-123"></a>            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;`num_param_dict` is not provided, all variables will be treated as having one parameter.&quot;</span><span class="p">)</span>
<a id="__codelineno-0-124" name="__codelineno-0-124"></a>            <span class="n">num_param_dict</span> <span class="o">=</span> <span class="p">{</span><span class="n">key</span><span class="p">:</span><span class="mi">1</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">coef_variation_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">()}</span>
<a id="__codelineno-0-125" name="__codelineno-0-125"></a>
<a id="__codelineno-0-126" name="__codelineno-0-126"></a>        <span class="k">assert</span> <span class="n">coef_variation_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="o">==</span> <span class="n">num_param_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
<a id="__codelineno-0-127" name="__codelineno-0-127"></a>
<a id="__codelineno-0-128" name="__codelineno-0-128"></a>        <span class="c1"># variable `var` with variation `spec` to variable `var[spec]`.</span>
<a id="__codelineno-0-129" name="__codelineno-0-129"></a>        <span class="n">rename</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>  <span class="c1"># old variable name --&gt; new variable name.</span>
<a id="__codelineno-0-130" name="__codelineno-0-130"></a>        <span class="k">for</span> <span class="n">variable</span><span class="p">,</span> <span class="n">specificity</span> <span class="ow">in</span> <span class="n">coef_variation_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
<a id="__codelineno-0-131" name="__codelineno-0-131"></a>            <span class="n">rename</span><span class="p">[</span><span class="n">variable</span><span class="p">]</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">variable</span><span class="si">}</span><span class="s2">[</span><span class="si">{</span><span class="n">specificity</span><span class="si">}</span><span class="s2">]&quot;</span>
<a id="__codelineno-0-132" name="__codelineno-0-132"></a>
<a id="__codelineno-0-133" name="__codelineno-0-133"></a>        <span class="k">for</span> <span class="n">old_name</span><span class="p">,</span> <span class="n">new_name</span> <span class="ow">in</span> <span class="n">rename</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
<a id="__codelineno-0-134" name="__codelineno-0-134"></a>            <span class="n">coef_variation_dict</span><span class="p">[</span><span class="n">new_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">coef_variation_dict</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">old_name</span><span class="p">)</span>
<a id="__codelineno-0-135" name="__codelineno-0-135"></a>            <span class="n">num_param_dict</span><span class="p">[</span><span class="n">new_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">num_param_dict</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">old_name</span><span class="p">)</span>
<a id="__codelineno-0-136" name="__codelineno-0-136"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-137" name="__codelineno-0-137"></a>        <span class="c1"># Use the formula to infer model.</span>
<a id="__codelineno-0-138" name="__codelineno-0-138"></a>        <span class="n">coef_variation_dict</span><span class="p">,</span> <span class="n">num_param_dict</span> <span class="o">=</span> <span class="n">parse_formula</span><span class="p">(</span><span class="n">formula</span><span class="p">,</span> <span class="n">dataset</span><span class="p">)</span>
<a id="__codelineno-0-139" name="__codelineno-0-139"></a>
<a id="__codelineno-0-140" name="__codelineno-0-140"></a>    <span class="c1"># ==============================================================================================================</span>
<a id="__codelineno-0-141" name="__codelineno-0-141"></a>    <span class="c1"># Model Initialization.</span>
<a id="__codelineno-0-142" name="__codelineno-0-142"></a>    <span class="c1"># ==============================================================================================================</span>
<a id="__codelineno-0-143" name="__codelineno-0-143"></a>    <span class="nb">super</span><span class="p">(</span><span class="n">ConditionalLogitModel</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
<a id="__codelineno-0-144" name="__codelineno-0-144"></a>
<a id="__codelineno-0-145" name="__codelineno-0-145"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">coef_variation_dict</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="n">coef_variation_dict</span><span class="p">)</span>
<a id="__codelineno-0-146" name="__codelineno-0-146"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">num_param_dict</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="n">num_param_dict</span><span class="p">)</span>
<a id="__codelineno-0-147" name="__codelineno-0-147"></a>
<a id="__codelineno-0-148" name="__codelineno-0-148"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">num_items</span> <span class="o">=</span> <span class="n">num_items</span>
<a id="__codelineno-0-149" name="__codelineno-0-149"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">num_users</span> <span class="o">=</span> <span class="n">num_users</span>
<a id="__codelineno-0-150" name="__codelineno-0-150"></a>
<a id="__codelineno-0-151" name="__codelineno-0-151"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">regularization</span> <span class="o">=</span> <span class="n">regularization</span>
<a id="__codelineno-0-152" name="__codelineno-0-152"></a>    <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">regularization</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;L1&#39;</span><span class="p">,</span> <span class="s1">&#39;L2&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">],</span> <span class="sa">f</span><span class="s2">&quot;Provided regularization=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">regularization</span><span class="si">}</span><span class="s2"> is not allowed, allowed values are [&#39;L1&#39;, &#39;L2&#39;, None].&quot;</span>
<a id="__codelineno-0-153" name="__codelineno-0-153"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">regularization_weight</span> <span class="o">=</span> <span class="n">regularization_weight</span>
<a id="__codelineno-0-154" name="__codelineno-0-154"></a>    <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">regularization</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">regularization_weight</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">):</span>
<a id="__codelineno-0-155" name="__codelineno-0-155"></a>        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;You specified regularization type </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">regularization</span><span class="si">}</span><span class="s1"> without providing regularization_weight.&#39;</span><span class="p">)</span>
<a id="__codelineno-0-156" name="__codelineno-0-156"></a>    <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">regularization</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">regularization_weight</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">):</span>
<a id="__codelineno-0-157" name="__codelineno-0-157"></a>        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;You specified no regularization but you provide regularization_weight=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">regularization_weight</span><span class="si">}</span><span class="s1">, you should leave regularization_weight as None if you do not want to regularize the model.&#39;</span><span class="p">)</span>
<a id="__codelineno-0-158" name="__codelineno-0-158"></a>
<a id="__codelineno-0-159" name="__codelineno-0-159"></a>    <span class="c1"># check number of parameters specified are all positive.</span>
<a id="__codelineno-0-160" name="__codelineno-0-160"></a>    <span class="k">for</span> <span class="n">var_type</span><span class="p">,</span> <span class="n">num_params</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_param_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
<a id="__codelineno-0-161" name="__codelineno-0-161"></a>        <span class="k">assert</span> <span class="n">num_params</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;num_params needs to be positive, got: </span><span class="si">{</span><span class="n">num_params</span><span class="si">}</span><span class="s1">.&#39;</span>
<a id="__codelineno-0-162" name="__codelineno-0-162"></a>
<a id="__codelineno-0-163" name="__codelineno-0-163"></a>    <span class="c1"># infer the number of parameters for intercept if the researcher forgets.</span>
<a id="__codelineno-0-164" name="__codelineno-0-164"></a>    <span class="k">for</span> <span class="n">variable</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">coef_variation_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
<a id="__codelineno-0-165" name="__codelineno-0-165"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_intercept_term</span><span class="p">(</span><span class="n">variable</span><span class="p">)</span> <span class="ow">and</span> <span class="n">variable</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_param_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
<a id="__codelineno-0-166" name="__codelineno-0-166"></a>            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;`</span><span class="si">{</span><span class="n">variable</span><span class="si">}</span><span class="s2">` key found in coef_variation_dict but not in num_param_dict, num_param_dict[&#39;</span><span class="si">{</span><span class="n">variable</span><span class="si">}</span><span class="s2">&#39;] has been set to 1.&quot;</span><span class="p">)</span>
<a id="__codelineno-0-167" name="__codelineno-0-167"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">num_param_dict</span><span class="p">[</span><span class="n">variable</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
<a id="__codelineno-0-168" name="__codelineno-0-168"></a>
<a id="__codelineno-0-169" name="__codelineno-0-169"></a>    <span class="c1"># construct trainable parameters.</span>
<a id="__codelineno-0-170" name="__codelineno-0-170"></a>    <span class="n">coef_dict</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
<a id="__codelineno-0-171" name="__codelineno-0-171"></a>    <span class="k">for</span> <span class="n">var_type</span><span class="p">,</span> <span class="n">variation</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">coef_variation_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
<a id="__codelineno-0-172" name="__codelineno-0-172"></a>        <span class="n">coef_dict</span><span class="p">[</span><span class="n">var_type</span><span class="p">]</span> <span class="o">=</span> <span class="n">Coefficient</span><span class="p">(</span><span class="n">variation</span><span class="o">=</span><span class="n">variation</span><span class="p">,</span>
<a id="__codelineno-0-173" name="__codelineno-0-173"></a>                                          <span class="n">num_items</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">num_items</span><span class="p">,</span>
<a id="__codelineno-0-174" name="__codelineno-0-174"></a>                                          <span class="n">num_users</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">num_users</span><span class="p">,</span>
<a id="__codelineno-0-175" name="__codelineno-0-175"></a>                                          <span class="n">num_params</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">num_param_dict</span><span class="p">[</span><span class="n">var_type</span><span class="p">])</span>
<a id="__codelineno-0-176" name="__codelineno-0-176"></a>    <span class="c1"># A ModuleDict is required to properly register all trainable parameters.</span>
<a id="__codelineno-0-177" name="__codelineno-0-177"></a>    <span class="c1"># self.parameter() will fail if a python dictionary is used instead.</span>
<a id="__codelineno-0-178" name="__codelineno-0-178"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">coef_dict</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">ModuleDict</span><span class="p">(</span><span class="n">coef_dict</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h2 id="torch_choice.model.conditional_logit_model.ConditionalLogitModel.__repr__" class="doc doc-heading">
<code class="highlight language-python"><span class="fm">__repr__</span><span class="p">()</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Return a string representation of the model.</p>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
<th>Name</th>        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
<td><code>str</code></td>          <td>
                <code>str</code>
          </td>
          <td><p>the string representation of the model.</p></td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>torch_choice/model/conditional_logit_model.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-180">180</a></span>
<span class="normal"><a href="#__codelineno-0-181">181</a></span>
<span class="normal"><a href="#__codelineno-0-182">182</a></span>
<span class="normal"><a href="#__codelineno-0-183">183</a></span>
<span class="normal"><a href="#__codelineno-0-184">184</a></span>
<span class="normal"><a href="#__codelineno-0-185">185</a></span>
<span class="normal"><a href="#__codelineno-0-186">186</a></span>
<span class="normal"><a href="#__codelineno-0-187">187</a></span>
<span class="normal"><a href="#__codelineno-0-188">188</a></span>
<span class="normal"><a href="#__codelineno-0-189">189</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-180" name="__codelineno-0-180"></a><span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<a id="__codelineno-0-181" name="__codelineno-0-181"></a>    <span class="sd">&quot;&quot;&quot;Return a string representation of the model.</span>
<a id="__codelineno-0-182" name="__codelineno-0-182"></a>
<a id="__codelineno-0-183" name="__codelineno-0-183"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-184" name="__codelineno-0-184"></a><span class="sd">        str: the string representation of the model.</span>
<a id="__codelineno-0-185" name="__codelineno-0-185"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-186" name="__codelineno-0-186"></a>    <span class="n">out_str_lst</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Conditional logistic discrete choice model, expects input features:</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">]</span>
<a id="__codelineno-0-187" name="__codelineno-0-187"></a>    <span class="k">for</span> <span class="n">var_type</span><span class="p">,</span> <span class="n">num_params</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_param_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
<a id="__codelineno-0-188" name="__codelineno-0-188"></a>        <span class="n">out_str_lst</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;X[</span><span class="si">{</span><span class="n">var_type</span><span class="si">}</span><span class="s1">] with </span><span class="si">{</span><span class="n">num_params</span><span class="si">}</span><span class="s1"> parameters, with </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">coef_variation_dict</span><span class="p">[</span><span class="n">var_type</span><span class="p">]</span><span class="si">}</span><span class="s1"> level variation.&#39;</span><span class="p">)</span>
<a id="__codelineno-0-189" name="__codelineno-0-189"></a>    <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__repr__</span><span class="p">()</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">out_str_lst</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">+</span> <span class="sa">f</span><span class="s1">&#39;device=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="si">}</span><span class="s1">&#39;</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h2 id="torch_choice.model.conditional_logit_model.ConditionalLogitModel.forward" class="doc doc-heading">
<code class="highlight language-python"><span class="n">forward</span><span class="p">(</span><span class="n">batch</span><span class="p">,</span> <span class="n">manual_coef_value_dict</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Forward pass of the model.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>batch</code></td>
          <td>
                <code><a class="autorefs autorefs-internal" title="torch_choice.data.choice_dataset.ChoiceDataset" href="#torch_choice.data.ChoiceDataset">ChoiceDataset</a></code>
          </td>
          <td><p>a <code>ChoiceDataset</code> object.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>manual_coef_value_dict</code></td>
          <td>
                <code><span title="typing.Optional">Optional</span>[<span title="typing.Dict">Dict</span>[str, torch.<span title="torch.Tensor">Tensor</span>]]</code>
          </td>
          <td><p>a dictionary with
keys in {'u', 'i'} etc and tensors as values. If provided, the model will force
coefficient to be the provided values and compute utility conditioned on the provided
coefficient values. This feature is useful when the research wishes to plug in particular
values of coefficients and examine the utility values. If not provided, the model will
use the learned coefficient values in self.coef_dict.
Defaults to None.</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code>torch.<span title="torch.Tensor">Tensor</span></code>
          </td>
          <td><p>torch.Tensor: a tensor of shape (num_trips, num_items) whose (t, i) entry represents
the utility from item i in trip t for the user involved in that trip.</p></td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>torch_choice/model/conditional_logit_model.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-209">209</a></span>
<span class="normal"><a href="#__codelineno-0-210">210</a></span>
<span class="normal"><a href="#__codelineno-0-211">211</a></span>
<span class="normal"><a href="#__codelineno-0-212">212</a></span>
<span class="normal"><a href="#__codelineno-0-213">213</a></span>
<span class="normal"><a href="#__codelineno-0-214">214</a></span>
<span class="normal"><a href="#__codelineno-0-215">215</a></span>
<span class="normal"><a href="#__codelineno-0-216">216</a></span>
<span class="normal"><a href="#__codelineno-0-217">217</a></span>
<span class="normal"><a href="#__codelineno-0-218">218</a></span>
<span class="normal"><a href="#__codelineno-0-219">219</a></span>
<span class="normal"><a href="#__codelineno-0-220">220</a></span>
<span class="normal"><a href="#__codelineno-0-221">221</a></span>
<span class="normal"><a href="#__codelineno-0-222">222</a></span>
<span class="normal"><a href="#__codelineno-0-223">223</a></span>
<span class="normal"><a href="#__codelineno-0-224">224</a></span>
<span class="normal"><a href="#__codelineno-0-225">225</a></span>
<span class="normal"><a href="#__codelineno-0-226">226</a></span>
<span class="normal"><a href="#__codelineno-0-227">227</a></span>
<span class="normal"><a href="#__codelineno-0-228">228</a></span>
<span class="normal"><a href="#__codelineno-0-229">229</a></span>
<span class="normal"><a href="#__codelineno-0-230">230</a></span>
<span class="normal"><a href="#__codelineno-0-231">231</a></span>
<span class="normal"><a href="#__codelineno-0-232">232</a></span>
<span class="normal"><a href="#__codelineno-0-233">233</a></span>
<span class="normal"><a href="#__codelineno-0-234">234</a></span>
<span class="normal"><a href="#__codelineno-0-235">235</a></span>
<span class="normal"><a href="#__codelineno-0-236">236</a></span>
<span class="normal"><a href="#__codelineno-0-237">237</a></span>
<span class="normal"><a href="#__codelineno-0-238">238</a></span>
<span class="normal"><a href="#__codelineno-0-239">239</a></span>
<span class="normal"><a href="#__codelineno-0-240">240</a></span>
<span class="normal"><a href="#__codelineno-0-241">241</a></span>
<span class="normal"><a href="#__codelineno-0-242">242</a></span>
<span class="normal"><a href="#__codelineno-0-243">243</a></span>
<span class="normal"><a href="#__codelineno-0-244">244</a></span>
<span class="normal"><a href="#__codelineno-0-245">245</a></span>
<span class="normal"><a href="#__codelineno-0-246">246</a></span>
<span class="normal"><a href="#__codelineno-0-247">247</a></span>
<span class="normal"><a href="#__codelineno-0-248">248</a></span>
<span class="normal"><a href="#__codelineno-0-249">249</a></span>
<span class="normal"><a href="#__codelineno-0-250">250</a></span>
<span class="normal"><a href="#__codelineno-0-251">251</a></span>
<span class="normal"><a href="#__codelineno-0-252">252</a></span>
<span class="normal"><a href="#__codelineno-0-253">253</a></span>
<span class="normal"><a href="#__codelineno-0-254">254</a></span>
<span class="normal"><a href="#__codelineno-0-255">255</a></span>
<span class="normal"><a href="#__codelineno-0-256">256</a></span>
<span class="normal"><a href="#__codelineno-0-257">257</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-209" name="__codelineno-0-209"></a><span class="k">def</span> <span class="nf">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-210" name="__codelineno-0-210"></a>            <span class="n">batch</span><span class="p">:</span> <span class="n">ChoiceDataset</span><span class="p">,</span>
<a id="__codelineno-0-211" name="__codelineno-0-211"></a>            <span class="n">manual_coef_value_dict</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-212" name="__codelineno-0-212"></a>            <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">:</span>
<a id="__codelineno-0-213" name="__codelineno-0-213"></a>    <span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-214" name="__codelineno-0-214"></a><span class="sd">    Forward pass of the model.</span>
<a id="__codelineno-0-215" name="__codelineno-0-215"></a>
<a id="__codelineno-0-216" name="__codelineno-0-216"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-217" name="__codelineno-0-217"></a><span class="sd">        batch: a `ChoiceDataset` object.</span>
<a id="__codelineno-0-218" name="__codelineno-0-218"></a>
<a id="__codelineno-0-219" name="__codelineno-0-219"></a><span class="sd">        manual_coef_value_dict (Optional[Dict[str, torch.Tensor]], optional): a dictionary with</span>
<a id="__codelineno-0-220" name="__codelineno-0-220"></a><span class="sd">            keys in {&#39;u&#39;, &#39;i&#39;} etc and tensors as values. If provided, the model will force</span>
<a id="__codelineno-0-221" name="__codelineno-0-221"></a><span class="sd">            coefficient to be the provided values and compute utility conditioned on the provided</span>
<a id="__codelineno-0-222" name="__codelineno-0-222"></a><span class="sd">            coefficient values. This feature is useful when the research wishes to plug in particular</span>
<a id="__codelineno-0-223" name="__codelineno-0-223"></a><span class="sd">            values of coefficients and examine the utility values. If not provided, the model will</span>
<a id="__codelineno-0-224" name="__codelineno-0-224"></a><span class="sd">            use the learned coefficient values in self.coef_dict.</span>
<a id="__codelineno-0-225" name="__codelineno-0-225"></a><span class="sd">            Defaults to None.</span>
<a id="__codelineno-0-226" name="__codelineno-0-226"></a>
<a id="__codelineno-0-227" name="__codelineno-0-227"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-228" name="__codelineno-0-228"></a><span class="sd">        torch.Tensor: a tensor of shape (num_trips, num_items) whose (t, i) entry represents</span>
<a id="__codelineno-0-229" name="__codelineno-0-229"></a><span class="sd">            the utility from item i in trip t for the user involved in that trip.</span>
<a id="__codelineno-0-230" name="__codelineno-0-230"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-231" name="__codelineno-0-231"></a>    <span class="n">x_dict</span> <span class="o">=</span> <span class="n">batch</span><span class="o">.</span><span class="n">x_dict</span>
<a id="__codelineno-0-232" name="__codelineno-0-232"></a>
<a id="__codelineno-0-233" name="__codelineno-0-233"></a>    <span class="k">for</span> <span class="n">variable</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">coef_variation_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
<a id="__codelineno-0-234" name="__codelineno-0-234"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_intercept_term</span><span class="p">(</span><span class="n">variable</span><span class="p">):</span>
<a id="__codelineno-0-235" name="__codelineno-0-235"></a>            <span class="c1"># intercept term has no input tensor from the ChoiceDataset data structure.</span>
<a id="__codelineno-0-236" name="__codelineno-0-236"></a>            <span class="c1"># the tensor for intercept has only 1 feature, every entry is 1.</span>
<a id="__codelineno-0-237" name="__codelineno-0-237"></a>            <span class="n">x_dict</span><span class="p">[</span><span class="s1">&#39;intercept&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">batch</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_items</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">device</span><span class="o">=</span><span class="n">batch</span><span class="o">.</span><span class="n">device</span><span class="p">)</span>
<a id="__codelineno-0-238" name="__codelineno-0-238"></a>            <span class="k">break</span>
<a id="__codelineno-0-239" name="__codelineno-0-239"></a>
<a id="__codelineno-0-240" name="__codelineno-0-240"></a>    <span class="c1"># compute the utility from each item in each choice session.</span>
<a id="__codelineno-0-241" name="__codelineno-0-241"></a>    <span class="n">total_utility</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">batch</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_items</span><span class="p">),</span> <span class="n">device</span><span class="o">=</span><span class="n">batch</span><span class="o">.</span><span class="n">device</span><span class="p">)</span>
<a id="__codelineno-0-242" name="__codelineno-0-242"></a>    <span class="c1"># for each type of variables, apply the corresponding coefficient to input x.</span>
<a id="__codelineno-0-243" name="__codelineno-0-243"></a>
<a id="__codelineno-0-244" name="__codelineno-0-244"></a>    <span class="k">for</span> <span class="n">var_type</span><span class="p">,</span> <span class="n">coef</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">coef_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
<a id="__codelineno-0-245" name="__codelineno-0-245"></a>        <span class="c1"># variable type is named as &quot;observable_name[variation]&quot;, retrieve the corresponding observable name.</span>
<a id="__codelineno-0-246" name="__codelineno-0-246"></a>        <span class="n">corresponding_observable</span> <span class="o">=</span> <span class="n">var_type</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;[&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-0-247" name="__codelineno-0-247"></a>        <span class="n">total_utility</span> <span class="o">+=</span> <span class="n">coef</span><span class="p">(</span>
<a id="__codelineno-0-248" name="__codelineno-0-248"></a>            <span class="n">x_dict</span><span class="p">[</span><span class="n">corresponding_observable</span><span class="p">],</span>
<a id="__codelineno-0-249" name="__codelineno-0-249"></a>            <span class="n">batch</span><span class="o">.</span><span class="n">user_index</span><span class="p">,</span>
<a id="__codelineno-0-250" name="__codelineno-0-250"></a>            <span class="n">manual_coef_value</span><span class="o">=</span><span class="kc">None</span> <span class="k">if</span> <span class="n">manual_coef_value_dict</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">manual_coef_value_dict</span><span class="p">[</span><span class="n">var_type</span><span class="p">])</span>
<a id="__codelineno-0-251" name="__codelineno-0-251"></a>
<a id="__codelineno-0-252" name="__codelineno-0-252"></a>    <span class="k">assert</span> <span class="n">total_utility</span><span class="o">.</span><span class="n">shape</span> <span class="o">==</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">batch</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_items</span><span class="p">)</span>
<a id="__codelineno-0-253" name="__codelineno-0-253"></a>
<a id="__codelineno-0-254" name="__codelineno-0-254"></a>    <span class="k">if</span> <span class="n">batch</span><span class="o">.</span><span class="n">item_availability</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-255" name="__codelineno-0-255"></a>        <span class="c1"># mask out unavailable items.</span>
<a id="__codelineno-0-256" name="__codelineno-0-256"></a>        <span class="n">total_utility</span><span class="p">[</span><span class="o">~</span><span class="n">batch</span><span class="o">.</span><span class="n">item_availability</span><span class="p">[</span><span class="n">batch</span><span class="o">.</span><span class="n">session_index</span><span class="p">,</span> <span class="p">:]]</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">finfo</span><span class="p">(</span><span class="n">total_utility</span><span class="o">.</span><span class="n">dtype</span><span class="p">)</span><span class="o">.</span><span class="n">min</span> <span class="o">/</span> <span class="mi">2</span>
<a id="__codelineno-0-257" name="__codelineno-0-257"></a>    <span class="k">return</span> <span class="n">total_utility</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h2 id="torch_choice.model.conditional_logit_model.ConditionalLogitModel.get_coefficient" class="doc doc-heading">
<code class="highlight language-python"><span class="n">get_coefficient</span><span class="p">(</span><span class="n">variable</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Retrieve the coefficient tensor for the given variable.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>variable</code></td>
          <td>
                <code>str</code>
          </td>
          <td><p>the variable name.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code>torch.<span title="torch.Tensor">Tensor</span></code>
          </td>
          <td><p>torch.Tensor: the corresponding coefficient tensor of the requested variable.</p></td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>torch_choice/model/conditional_logit_model.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-307">307</a></span>
<span class="normal"><a href="#__codelineno-0-308">308</a></span>
<span class="normal"><a href="#__codelineno-0-309">309</a></span>
<span class="normal"><a href="#__codelineno-0-310">310</a></span>
<span class="normal"><a href="#__codelineno-0-311">311</a></span>
<span class="normal"><a href="#__codelineno-0-312">312</a></span>
<span class="normal"><a href="#__codelineno-0-313">313</a></span>
<span class="normal"><a href="#__codelineno-0-314">314</a></span>
<span class="normal"><a href="#__codelineno-0-315">315</a></span>
<span class="normal"><a href="#__codelineno-0-316">316</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-307" name="__codelineno-0-307"></a><span class="k">def</span> <span class="nf">get_coefficient</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">variable</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">:</span>
<a id="__codelineno-0-308" name="__codelineno-0-308"></a>    <span class="sd">&quot;&quot;&quot;Retrieve the coefficient tensor for the given variable.</span>
<a id="__codelineno-0-309" name="__codelineno-0-309"></a>
<a id="__codelineno-0-310" name="__codelineno-0-310"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-311" name="__codelineno-0-311"></a><span class="sd">        variable (str): the variable name.</span>
<a id="__codelineno-0-312" name="__codelineno-0-312"></a>
<a id="__codelineno-0-313" name="__codelineno-0-313"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-314" name="__codelineno-0-314"></a><span class="sd">        torch.Tensor: the corresponding coefficient tensor of the requested variable.</span>
<a id="__codelineno-0-315" name="__codelineno-0-315"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-316" name="__codelineno-0-316"></a>    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">state_dict</span><span class="p">()[</span><span class="sa">f</span><span class="s2">&quot;coef_dict.</span><span class="si">{</span><span class="n">variable</span><span class="si">}</span><span class="s2">.coef&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">detach</span><span class="p">()</span><span class="o">.</span><span class="n">clone</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h2 id="torch_choice.model.conditional_logit_model.ConditionalLogitModel.loss" class="doc doc-heading">
<code class="highlight language-python"><span class="n">loss</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>The loss function to be optimized. This is a wrapper of <code>negative_log_likelihood</code> + regularization loss if required.</p>

      <details class="quote">
        <summary>Source code in <code>torch_choice/model/conditional_logit_model.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-283">283</a></span>
<span class="normal"><a href="#__codelineno-0-284">284</a></span>
<span class="normal"><a href="#__codelineno-0-285">285</a></span>
<span class="normal"><a href="#__codelineno-0-286">286</a></span>
<span class="normal"><a href="#__codelineno-0-287">287</a></span>
<span class="normal"><a href="#__codelineno-0-288">288</a></span>
<span class="normal"><a href="#__codelineno-0-289">289</a></span>
<span class="normal"><a href="#__codelineno-0-290">290</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-283" name="__codelineno-0-283"></a><span class="k">def</span> <span class="nf">loss</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<a id="__codelineno-0-284" name="__codelineno-0-284"></a>    <span class="sd">&quot;&quot;&quot;The loss function to be optimized. This is a wrapper of `negative_log_likelihood` + regularization loss if required.&quot;&quot;&quot;</span>
<a id="__codelineno-0-285" name="__codelineno-0-285"></a>    <span class="n">nll</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">negative_log_likelihood</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
<a id="__codelineno-0-286" name="__codelineno-0-286"></a>    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">regularization</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-287" name="__codelineno-0-287"></a>        <span class="n">L</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;L1&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;L2&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">}[</span><span class="bp">self</span><span class="o">.</span><span class="n">regularization</span><span class="p">]</span>
<a id="__codelineno-0-288" name="__codelineno-0-288"></a>        <span class="k">for</span> <span class="n">param</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">():</span>
<a id="__codelineno-0-289" name="__codelineno-0-289"></a>            <span class="n">nll</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">regularization_weight</span> <span class="o">*</span> <span class="n">torch</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">param</span><span class="p">,</span> <span class="n">p</span><span class="o">=</span><span class="n">L</span><span class="p">)</span>
<a id="__codelineno-0-290" name="__codelineno-0-290"></a>    <span class="k">return</span> <span class="n">nll</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h2 id="torch_choice.model.conditional_logit_model.ConditionalLogitModel.negative_log_likelihood" class="doc doc-heading">
<code class="highlight language-python"><span class="n">negative_log_likelihood</span><span class="p">(</span><span class="n">batch</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">is_train</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Computes the log-likelihood for the batch and label.
TODO: consider remove y, change to label.
TODO: consider move this method outside the model, the role of the model is to compute the utility.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>batch</code></td>
          <td>
                <code><a class="autorefs autorefs-internal" title="torch_choice.data.choice_dataset.ChoiceDataset" href="#torch_choice.data.ChoiceDataset">ChoiceDataset</a></code>
          </td>
          <td><p>a ChoiceDataset object containing the data.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>y</code></td>
          <td>
                <code>torch.<span title="torch.Tensor">Tensor</span></code>
          </td>
          <td><p>the label.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>is_train</code></td>
          <td>
                <code>bool</code>
          </td>
          <td><p>whether to trace the gradient. Defaults to True.</p></td>
          <td>
                <code>True</code>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code>torch.<span title="torch.Tensor">Tensor</span></code>
          </td>
          <td><p>torch.Tensor: the negative log-likelihood.</p></td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>torch_choice/model/conditional_logit_model.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-260">260</a></span>
<span class="normal"><a href="#__codelineno-0-261">261</a></span>
<span class="normal"><a href="#__codelineno-0-262">262</a></span>
<span class="normal"><a href="#__codelineno-0-263">263</a></span>
<span class="normal"><a href="#__codelineno-0-264">264</a></span>
<span class="normal"><a href="#__codelineno-0-265">265</a></span>
<span class="normal"><a href="#__codelineno-0-266">266</a></span>
<span class="normal"><a href="#__codelineno-0-267">267</a></span>
<span class="normal"><a href="#__codelineno-0-268">268</a></span>
<span class="normal"><a href="#__codelineno-0-269">269</a></span>
<span class="normal"><a href="#__codelineno-0-270">270</a></span>
<span class="normal"><a href="#__codelineno-0-271">271</a></span>
<span class="normal"><a href="#__codelineno-0-272">272</a></span>
<span class="normal"><a href="#__codelineno-0-273">273</a></span>
<span class="normal"><a href="#__codelineno-0-274">274</a></span>
<span class="normal"><a href="#__codelineno-0-275">275</a></span>
<span class="normal"><a href="#__codelineno-0-276">276</a></span>
<span class="normal"><a href="#__codelineno-0-277">277</a></span>
<span class="normal"><a href="#__codelineno-0-278">278</a></span>
<span class="normal"><a href="#__codelineno-0-279">279</a></span>
<span class="normal"><a href="#__codelineno-0-280">280</a></span>
<span class="normal"><a href="#__codelineno-0-281">281</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-260" name="__codelineno-0-260"></a><span class="k">def</span> <span class="nf">negative_log_likelihood</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">batch</span><span class="p">:</span> <span class="n">ChoiceDataset</span><span class="p">,</span> <span class="n">y</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span> <span class="n">is_train</span><span class="p">:</span> <span class="nb">bool</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">:</span>
<a id="__codelineno-0-261" name="__codelineno-0-261"></a>    <span class="sd">&quot;&quot;&quot;Computes the log-likelihood for the batch and label.</span>
<a id="__codelineno-0-262" name="__codelineno-0-262"></a><span class="sd">    TODO: consider remove y, change to label.</span>
<a id="__codelineno-0-263" name="__codelineno-0-263"></a><span class="sd">    TODO: consider move this method outside the model, the role of the model is to compute the utility.</span>
<a id="__codelineno-0-264" name="__codelineno-0-264"></a>
<a id="__codelineno-0-265" name="__codelineno-0-265"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-266" name="__codelineno-0-266"></a><span class="sd">        batch (ChoiceDataset): a ChoiceDataset object containing the data.</span>
<a id="__codelineno-0-267" name="__codelineno-0-267"></a><span class="sd">        y (torch.Tensor): the label.</span>
<a id="__codelineno-0-268" name="__codelineno-0-268"></a><span class="sd">        is_train (bool, optional): whether to trace the gradient. Defaults to True.</span>
<a id="__codelineno-0-269" name="__codelineno-0-269"></a>
<a id="__codelineno-0-270" name="__codelineno-0-270"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-271" name="__codelineno-0-271"></a><span class="sd">        torch.Tensor: the negative log-likelihood.</span>
<a id="__codelineno-0-272" name="__codelineno-0-272"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-273" name="__codelineno-0-273"></a>    <span class="k">if</span> <span class="n">is_train</span><span class="p">:</span>
<a id="__codelineno-0-274" name="__codelineno-0-274"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">train</span><span class="p">()</span>
<a id="__codelineno-0-275" name="__codelineno-0-275"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-276" name="__codelineno-0-276"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">eval</span><span class="p">()</span>
<a id="__codelineno-0-277" name="__codelineno-0-277"></a>    <span class="c1"># (num_trips, num_items)</span>
<a id="__codelineno-0-278" name="__codelineno-0-278"></a>    <span class="n">total_utility</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">forward</span><span class="p">(</span><span class="n">batch</span><span class="p">)</span>
<a id="__codelineno-0-279" name="__codelineno-0-279"></a>    <span class="n">logP</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">log_softmax</span><span class="p">(</span><span class="n">total_utility</span><span class="p">,</span> <span class="n">dim</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-0-280" name="__codelineno-0-280"></a>    <span class="n">nll</span> <span class="o">=</span> <span class="o">-</span> <span class="n">logP</span><span class="p">[</span><span class="n">torch</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">y</span><span class="p">)),</span> <span class="n">y</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
<a id="__codelineno-0-281" name="__codelineno-0-281"></a>    <span class="k">return</span> <span class="n">nll</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h2 id="torch_choice.model.conditional_logit_model.ConditionalLogitModel.summary" class="doc doc-heading">
<code class="highlight language-python"><span class="n">summary</span><span class="p">()</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Print out the current model parameter.</p>

      <details class="quote">
        <summary>Source code in <code>torch_choice/model/conditional_logit_model.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-202">202</a></span>
<span class="normal"><a href="#__codelineno-0-203">203</a></span>
<span class="normal"><a href="#__codelineno-0-204">204</a></span>
<span class="normal"><a href="#__codelineno-0-205">205</a></span>
<span class="normal"><a href="#__codelineno-0-206">206</a></span>
<span class="normal"><a href="#__codelineno-0-207">207</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-202" name="__codelineno-0-202"></a><span class="k">def</span> <span class="nf">summary</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-0-203" name="__codelineno-0-203"></a>    <span class="sd">&quot;&quot;&quot;Print out the current model parameter.&quot;&quot;&quot;</span>
<a id="__codelineno-0-204" name="__codelineno-0-204"></a>    <span class="k">for</span> <span class="n">var_type</span><span class="p">,</span> <span class="n">coefficient</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">coef_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
<a id="__codelineno-0-205" name="__codelineno-0-205"></a>        <span class="k">if</span> <span class="n">coefficient</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-206" name="__codelineno-0-206"></a>            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Variable Type: &#39;</span><span class="p">,</span> <span class="n">var_type</span><span class="p">)</span>
<a id="__codelineno-0-207" name="__codelineno-0-207"></a>            <span class="nb">print</span><span class="p">(</span><span class="n">coefficient</span><span class="o">.</span><span class="n">coef</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>



  </div>

  </div>

</div>

<div class="doc doc-object doc-class">


<a id="torch_choice.model.NestedLogitModel"></a>
  <div class="doc doc-contents first">
      <p class="doc doc-class-bases">
        Bases: <code><span title="torch.nn">nn</span>.<span title="torch.nn.Module">Module</span></code></p>



        <details class="quote">
          <summary>Source code in <code>torch_choice/model/nested_logit_model.py</code></summary>
          <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-19"> 19</a></span>
<span class="normal"><a href="#__codelineno-0-20"> 20</a></span>
<span class="normal"><a href="#__codelineno-0-21"> 21</a></span>
<span class="normal"><a href="#__codelineno-0-22"> 22</a></span>
<span class="normal"><a href="#__codelineno-0-23"> 23</a></span>
<span class="normal"><a href="#__codelineno-0-24"> 24</a></span>
<span class="normal"><a href="#__codelineno-0-25"> 25</a></span>
<span class="normal"><a href="#__codelineno-0-26"> 26</a></span>
<span class="normal"><a href="#__codelineno-0-27"> 27</a></span>
<span class="normal"><a href="#__codelineno-0-28"> 28</a></span>
<span class="normal"><a href="#__codelineno-0-29"> 29</a></span>
<span class="normal"><a href="#__codelineno-0-30"> 30</a></span>
<span class="normal"><a href="#__codelineno-0-31"> 31</a></span>
<span class="normal"><a href="#__codelineno-0-32"> 32</a></span>
<span class="normal"><a href="#__codelineno-0-33"> 33</a></span>
<span class="normal"><a href="#__codelineno-0-34"> 34</a></span>
<span class="normal"><a href="#__codelineno-0-35"> 35</a></span>
<span class="normal"><a href="#__codelineno-0-36"> 36</a></span>
<span class="normal"><a href="#__codelineno-0-37"> 37</a></span>
<span class="normal"><a href="#__codelineno-0-38"> 38</a></span>
<span class="normal"><a href="#__codelineno-0-39"> 39</a></span>
<span class="normal"><a href="#__codelineno-0-40"> 40</a></span>
<span class="normal"><a href="#__codelineno-0-41"> 41</a></span>
<span class="normal"><a href="#__codelineno-0-42"> 42</a></span>
<span class="normal"><a href="#__codelineno-0-43"> 43</a></span>
<span class="normal"><a href="#__codelineno-0-44"> 44</a></span>
<span class="normal"><a href="#__codelineno-0-45"> 45</a></span>
<span class="normal"><a href="#__codelineno-0-46"> 46</a></span>
<span class="normal"><a href="#__codelineno-0-47"> 47</a></span>
<span class="normal"><a href="#__codelineno-0-48"> 48</a></span>
<span class="normal"><a href="#__codelineno-0-49"> 49</a></span>
<span class="normal"><a href="#__codelineno-0-50"> 50</a></span>
<span class="normal"><a href="#__codelineno-0-51"> 51</a></span>
<span class="normal"><a href="#__codelineno-0-52"> 52</a></span>
<span class="normal"><a href="#__codelineno-0-53"> 53</a></span>
<span class="normal"><a href="#__codelineno-0-54"> 54</a></span>
<span class="normal"><a href="#__codelineno-0-55"> 55</a></span>
<span class="normal"><a href="#__codelineno-0-56"> 56</a></span>
<span class="normal"><a href="#__codelineno-0-57"> 57</a></span>
<span class="normal"><a href="#__codelineno-0-58"> 58</a></span>
<span class="normal"><a href="#__codelineno-0-59"> 59</a></span>
<span class="normal"><a href="#__codelineno-0-60"> 60</a></span>
<span class="normal"><a href="#__codelineno-0-61"> 61</a></span>
<span class="normal"><a href="#__codelineno-0-62"> 62</a></span>
<span class="normal"><a href="#__codelineno-0-63"> 63</a></span>
<span class="normal"><a href="#__codelineno-0-64"> 64</a></span>
<span class="normal"><a href="#__codelineno-0-65"> 65</a></span>
<span class="normal"><a href="#__codelineno-0-66"> 66</a></span>
<span class="normal"><a href="#__codelineno-0-67"> 67</a></span>
<span class="normal"><a href="#__codelineno-0-68"> 68</a></span>
<span class="normal"><a href="#__codelineno-0-69"> 69</a></span>
<span class="normal"><a href="#__codelineno-0-70"> 70</a></span>
<span class="normal"><a href="#__codelineno-0-71"> 71</a></span>
<span class="normal"><a href="#__codelineno-0-72"> 72</a></span>
<span class="normal"><a href="#__codelineno-0-73"> 73</a></span>
<span class="normal"><a href="#__codelineno-0-74"> 74</a></span>
<span class="normal"><a href="#__codelineno-0-75"> 75</a></span>
<span class="normal"><a href="#__codelineno-0-76"> 76</a></span>
<span class="normal"><a href="#__codelineno-0-77"> 77</a></span>
<span class="normal"><a href="#__codelineno-0-78"> 78</a></span>
<span class="normal"><a href="#__codelineno-0-79"> 79</a></span>
<span class="normal"><a href="#__codelineno-0-80"> 80</a></span>
<span class="normal"><a href="#__codelineno-0-81"> 81</a></span>
<span class="normal"><a href="#__codelineno-0-82"> 82</a></span>
<span class="normal"><a href="#__codelineno-0-83"> 83</a></span>
<span class="normal"><a href="#__codelineno-0-84"> 84</a></span>
<span class="normal"><a href="#__codelineno-0-85"> 85</a></span>
<span class="normal"><a href="#__codelineno-0-86"> 86</a></span>
<span class="normal"><a href="#__codelineno-0-87"> 87</a></span>
<span class="normal"><a href="#__codelineno-0-88"> 88</a></span>
<span class="normal"><a href="#__codelineno-0-89"> 89</a></span>
<span class="normal"><a href="#__codelineno-0-90"> 90</a></span>
<span class="normal"><a href="#__codelineno-0-91"> 91</a></span>
<span class="normal"><a href="#__codelineno-0-92"> 92</a></span>
<span class="normal"><a href="#__codelineno-0-93"> 93</a></span>
<span class="normal"><a href="#__codelineno-0-94"> 94</a></span>
<span class="normal"><a href="#__codelineno-0-95"> 95</a></span>
<span class="normal"><a href="#__codelineno-0-96"> 96</a></span>
<span class="normal"><a href="#__codelineno-0-97"> 97</a></span>
<span class="normal"><a href="#__codelineno-0-98"> 98</a></span>
<span class="normal"><a href="#__codelineno-0-99"> 99</a></span>
<span class="normal"><a href="#__codelineno-0-100">100</a></span>
<span class="normal"><a href="#__codelineno-0-101">101</a></span>
<span class="normal"><a href="#__codelineno-0-102">102</a></span>
<span class="normal"><a href="#__codelineno-0-103">103</a></span>
<span class="normal"><a href="#__codelineno-0-104">104</a></span>
<span class="normal"><a href="#__codelineno-0-105">105</a></span>
<span class="normal"><a href="#__codelineno-0-106">106</a></span>
<span class="normal"><a href="#__codelineno-0-107">107</a></span>
<span class="normal"><a href="#__codelineno-0-108">108</a></span>
<span class="normal"><a href="#__codelineno-0-109">109</a></span>
<span class="normal"><a href="#__codelineno-0-110">110</a></span>
<span class="normal"><a href="#__codelineno-0-111">111</a></span>
<span class="normal"><a href="#__codelineno-0-112">112</a></span>
<span class="normal"><a href="#__codelineno-0-113">113</a></span>
<span class="normal"><a href="#__codelineno-0-114">114</a></span>
<span class="normal"><a href="#__codelineno-0-115">115</a></span>
<span class="normal"><a href="#__codelineno-0-116">116</a></span>
<span class="normal"><a href="#__codelineno-0-117">117</a></span>
<span class="normal"><a href="#__codelineno-0-118">118</a></span>
<span class="normal"><a href="#__codelineno-0-119">119</a></span>
<span class="normal"><a href="#__codelineno-0-120">120</a></span>
<span class="normal"><a href="#__codelineno-0-121">121</a></span>
<span class="normal"><a href="#__codelineno-0-122">122</a></span>
<span class="normal"><a href="#__codelineno-0-123">123</a></span>
<span class="normal"><a href="#__codelineno-0-124">124</a></span>
<span class="normal"><a href="#__codelineno-0-125">125</a></span>
<span class="normal"><a href="#__codelineno-0-126">126</a></span>
<span class="normal"><a href="#__codelineno-0-127">127</a></span>
<span class="normal"><a href="#__codelineno-0-128">128</a></span>
<span class="normal"><a href="#__codelineno-0-129">129</a></span>
<span class="normal"><a href="#__codelineno-0-130">130</a></span>
<span class="normal"><a href="#__codelineno-0-131">131</a></span>
<span class="normal"><a href="#__codelineno-0-132">132</a></span>
<span class="normal"><a href="#__codelineno-0-133">133</a></span>
<span class="normal"><a href="#__codelineno-0-134">134</a></span>
<span class="normal"><a href="#__codelineno-0-135">135</a></span>
<span class="normal"><a href="#__codelineno-0-136">136</a></span>
<span class="normal"><a href="#__codelineno-0-137">137</a></span>
<span class="normal"><a href="#__codelineno-0-138">138</a></span>
<span class="normal"><a href="#__codelineno-0-139">139</a></span>
<span class="normal"><a href="#__codelineno-0-140">140</a></span>
<span class="normal"><a href="#__codelineno-0-141">141</a></span>
<span class="normal"><a href="#__codelineno-0-142">142</a></span>
<span class="normal"><a href="#__codelineno-0-143">143</a></span>
<span class="normal"><a href="#__codelineno-0-144">144</a></span>
<span class="normal"><a href="#__codelineno-0-145">145</a></span>
<span class="normal"><a href="#__codelineno-0-146">146</a></span>
<span class="normal"><a href="#__codelineno-0-147">147</a></span>
<span class="normal"><a href="#__codelineno-0-148">148</a></span>
<span class="normal"><a href="#__codelineno-0-149">149</a></span>
<span class="normal"><a href="#__codelineno-0-150">150</a></span>
<span class="normal"><a href="#__codelineno-0-151">151</a></span>
<span class="normal"><a href="#__codelineno-0-152">152</a></span>
<span class="normal"><a href="#__codelineno-0-153">153</a></span>
<span class="normal"><a href="#__codelineno-0-154">154</a></span>
<span class="normal"><a href="#__codelineno-0-155">155</a></span>
<span class="normal"><a href="#__codelineno-0-156">156</a></span>
<span class="normal"><a href="#__codelineno-0-157">157</a></span>
<span class="normal"><a href="#__codelineno-0-158">158</a></span>
<span class="normal"><a href="#__codelineno-0-159">159</a></span>
<span class="normal"><a href="#__codelineno-0-160">160</a></span>
<span class="normal"><a href="#__codelineno-0-161">161</a></span>
<span class="normal"><a href="#__codelineno-0-162">162</a></span>
<span class="normal"><a href="#__codelineno-0-163">163</a></span>
<span class="normal"><a href="#__codelineno-0-164">164</a></span>
<span class="normal"><a href="#__codelineno-0-165">165</a></span>
<span class="normal"><a href="#__codelineno-0-166">166</a></span>
<span class="normal"><a href="#__codelineno-0-167">167</a></span>
<span class="normal"><a href="#__codelineno-0-168">168</a></span>
<span class="normal"><a href="#__codelineno-0-169">169</a></span>
<span class="normal"><a href="#__codelineno-0-170">170</a></span>
<span class="normal"><a href="#__codelineno-0-171">171</a></span>
<span class="normal"><a href="#__codelineno-0-172">172</a></span>
<span class="normal"><a href="#__codelineno-0-173">173</a></span>
<span class="normal"><a href="#__codelineno-0-174">174</a></span>
<span class="normal"><a href="#__codelineno-0-175">175</a></span>
<span class="normal"><a href="#__codelineno-0-176">176</a></span>
<span class="normal"><a href="#__codelineno-0-177">177</a></span>
<span class="normal"><a href="#__codelineno-0-178">178</a></span>
<span class="normal"><a href="#__codelineno-0-179">179</a></span>
<span class="normal"><a href="#__codelineno-0-180">180</a></span>
<span class="normal"><a href="#__codelineno-0-181">181</a></span>
<span class="normal"><a href="#__codelineno-0-182">182</a></span>
<span class="normal"><a href="#__codelineno-0-183">183</a></span>
<span class="normal"><a href="#__codelineno-0-184">184</a></span>
<span class="normal"><a href="#__codelineno-0-185">185</a></span>
<span class="normal"><a href="#__codelineno-0-186">186</a></span>
<span class="normal"><a href="#__codelineno-0-187">187</a></span>
<span class="normal"><a href="#__codelineno-0-188">188</a></span>
<span class="normal"><a href="#__codelineno-0-189">189</a></span>
<span class="normal"><a href="#__codelineno-0-190">190</a></span>
<span class="normal"><a href="#__codelineno-0-191">191</a></span>
<span class="normal"><a href="#__codelineno-0-192">192</a></span>
<span class="normal"><a href="#__codelineno-0-193">193</a></span>
<span class="normal"><a href="#__codelineno-0-194">194</a></span>
<span class="normal"><a href="#__codelineno-0-195">195</a></span>
<span class="normal"><a href="#__codelineno-0-196">196</a></span>
<span class="normal"><a href="#__codelineno-0-197">197</a></span>
<span class="normal"><a href="#__codelineno-0-198">198</a></span>
<span class="normal"><a href="#__codelineno-0-199">199</a></span>
<span class="normal"><a href="#__codelineno-0-200">200</a></span>
<span class="normal"><a href="#__codelineno-0-201">201</a></span>
<span class="normal"><a href="#__codelineno-0-202">202</a></span>
<span class="normal"><a href="#__codelineno-0-203">203</a></span>
<span class="normal"><a href="#__codelineno-0-204">204</a></span>
<span class="normal"><a href="#__codelineno-0-205">205</a></span>
<span class="normal"><a href="#__codelineno-0-206">206</a></span>
<span class="normal"><a href="#__codelineno-0-207">207</a></span>
<span class="normal"><a href="#__codelineno-0-208">208</a></span>
<span class="normal"><a href="#__codelineno-0-209">209</a></span>
<span class="normal"><a href="#__codelineno-0-210">210</a></span>
<span class="normal"><a href="#__codelineno-0-211">211</a></span>
<span class="normal"><a href="#__codelineno-0-212">212</a></span>
<span class="normal"><a href="#__codelineno-0-213">213</a></span>
<span class="normal"><a href="#__codelineno-0-214">214</a></span>
<span class="normal"><a href="#__codelineno-0-215">215</a></span>
<span class="normal"><a href="#__codelineno-0-216">216</a></span>
<span class="normal"><a href="#__codelineno-0-217">217</a></span>
<span class="normal"><a href="#__codelineno-0-218">218</a></span>
<span class="normal"><a href="#__codelineno-0-219">219</a></span>
<span class="normal"><a href="#__codelineno-0-220">220</a></span>
<span class="normal"><a href="#__codelineno-0-221">221</a></span>
<span class="normal"><a href="#__codelineno-0-222">222</a></span>
<span class="normal"><a href="#__codelineno-0-223">223</a></span>
<span class="normal"><a href="#__codelineno-0-224">224</a></span>
<span class="normal"><a href="#__codelineno-0-225">225</a></span>
<span class="normal"><a href="#__codelineno-0-226">226</a></span>
<span class="normal"><a href="#__codelineno-0-227">227</a></span>
<span class="normal"><a href="#__codelineno-0-228">228</a></span>
<span class="normal"><a href="#__codelineno-0-229">229</a></span>
<span class="normal"><a href="#__codelineno-0-230">230</a></span>
<span class="normal"><a href="#__codelineno-0-231">231</a></span>
<span class="normal"><a href="#__codelineno-0-232">232</a></span>
<span class="normal"><a href="#__codelineno-0-233">233</a></span>
<span class="normal"><a href="#__codelineno-0-234">234</a></span>
<span class="normal"><a href="#__codelineno-0-235">235</a></span>
<span class="normal"><a href="#__codelineno-0-236">236</a></span>
<span class="normal"><a href="#__codelineno-0-237">237</a></span>
<span class="normal"><a href="#__codelineno-0-238">238</a></span>
<span class="normal"><a href="#__codelineno-0-239">239</a></span>
<span class="normal"><a href="#__codelineno-0-240">240</a></span>
<span class="normal"><a href="#__codelineno-0-241">241</a></span>
<span class="normal"><a href="#__codelineno-0-242">242</a></span>
<span class="normal"><a href="#__codelineno-0-243">243</a></span>
<span class="normal"><a href="#__codelineno-0-244">244</a></span>
<span class="normal"><a href="#__codelineno-0-245">245</a></span>
<span class="normal"><a href="#__codelineno-0-246">246</a></span>
<span class="normal"><a href="#__codelineno-0-247">247</a></span>
<span class="normal"><a href="#__codelineno-0-248">248</a></span>
<span class="normal"><a href="#__codelineno-0-249">249</a></span>
<span class="normal"><a href="#__codelineno-0-250">250</a></span>
<span class="normal"><a href="#__codelineno-0-251">251</a></span>
<span class="normal"><a href="#__codelineno-0-252">252</a></span>
<span class="normal"><a href="#__codelineno-0-253">253</a></span>
<span class="normal"><a href="#__codelineno-0-254">254</a></span>
<span class="normal"><a href="#__codelineno-0-255">255</a></span>
<span class="normal"><a href="#__codelineno-0-256">256</a></span>
<span class="normal"><a href="#__codelineno-0-257">257</a></span>
<span class="normal"><a href="#__codelineno-0-258">258</a></span>
<span class="normal"><a href="#__codelineno-0-259">259</a></span>
<span class="normal"><a href="#__codelineno-0-260">260</a></span>
<span class="normal"><a href="#__codelineno-0-261">261</a></span>
<span class="normal"><a href="#__codelineno-0-262">262</a></span>
<span class="normal"><a href="#__codelineno-0-263">263</a></span>
<span class="normal"><a href="#__codelineno-0-264">264</a></span>
<span class="normal"><a href="#__codelineno-0-265">265</a></span>
<span class="normal"><a href="#__codelineno-0-266">266</a></span>
<span class="normal"><a href="#__codelineno-0-267">267</a></span>
<span class="normal"><a href="#__codelineno-0-268">268</a></span>
<span class="normal"><a href="#__codelineno-0-269">269</a></span>
<span class="normal"><a href="#__codelineno-0-270">270</a></span>
<span class="normal"><a href="#__codelineno-0-271">271</a></span>
<span class="normal"><a href="#__codelineno-0-272">272</a></span>
<span class="normal"><a href="#__codelineno-0-273">273</a></span>
<span class="normal"><a href="#__codelineno-0-274">274</a></span>
<span class="normal"><a href="#__codelineno-0-275">275</a></span>
<span class="normal"><a href="#__codelineno-0-276">276</a></span>
<span class="normal"><a href="#__codelineno-0-277">277</a></span>
<span class="normal"><a href="#__codelineno-0-278">278</a></span>
<span class="normal"><a href="#__codelineno-0-279">279</a></span>
<span class="normal"><a href="#__codelineno-0-280">280</a></span>
<span class="normal"><a href="#__codelineno-0-281">281</a></span>
<span class="normal"><a href="#__codelineno-0-282">282</a></span>
<span class="normal"><a href="#__codelineno-0-283">283</a></span>
<span class="normal"><a href="#__codelineno-0-284">284</a></span>
<span class="normal"><a href="#__codelineno-0-285">285</a></span>
<span class="normal"><a href="#__codelineno-0-286">286</a></span>
<span class="normal"><a href="#__codelineno-0-287">287</a></span>
<span class="normal"><a href="#__codelineno-0-288">288</a></span>
<span class="normal"><a href="#__codelineno-0-289">289</a></span>
<span class="normal"><a href="#__codelineno-0-290">290</a></span>
<span class="normal"><a href="#__codelineno-0-291">291</a></span>
<span class="normal"><a href="#__codelineno-0-292">292</a></span>
<span class="normal"><a href="#__codelineno-0-293">293</a></span>
<span class="normal"><a href="#__codelineno-0-294">294</a></span>
<span class="normal"><a href="#__codelineno-0-295">295</a></span>
<span class="normal"><a href="#__codelineno-0-296">296</a></span>
<span class="normal"><a href="#__codelineno-0-297">297</a></span>
<span class="normal"><a href="#__codelineno-0-298">298</a></span>
<span class="normal"><a href="#__codelineno-0-299">299</a></span>
<span class="normal"><a href="#__codelineno-0-300">300</a></span>
<span class="normal"><a href="#__codelineno-0-301">301</a></span>
<span class="normal"><a href="#__codelineno-0-302">302</a></span>
<span class="normal"><a href="#__codelineno-0-303">303</a></span>
<span class="normal"><a href="#__codelineno-0-304">304</a></span>
<span class="normal"><a href="#__codelineno-0-305">305</a></span>
<span class="normal"><a href="#__codelineno-0-306">306</a></span>
<span class="normal"><a href="#__codelineno-0-307">307</a></span>
<span class="normal"><a href="#__codelineno-0-308">308</a></span>
<span class="normal"><a href="#__codelineno-0-309">309</a></span>
<span class="normal"><a href="#__codelineno-0-310">310</a></span>
<span class="normal"><a href="#__codelineno-0-311">311</a></span>
<span class="normal"><a href="#__codelineno-0-312">312</a></span>
<span class="normal"><a href="#__codelineno-0-313">313</a></span>
<span class="normal"><a href="#__codelineno-0-314">314</a></span>
<span class="normal"><a href="#__codelineno-0-315">315</a></span>
<span class="normal"><a href="#__codelineno-0-316">316</a></span>
<span class="normal"><a href="#__codelineno-0-317">317</a></span>
<span class="normal"><a href="#__codelineno-0-318">318</a></span>
<span class="normal"><a href="#__codelineno-0-319">319</a></span>
<span class="normal"><a href="#__codelineno-0-320">320</a></span>
<span class="normal"><a href="#__codelineno-0-321">321</a></span>
<span class="normal"><a href="#__codelineno-0-322">322</a></span>
<span class="normal"><a href="#__codelineno-0-323">323</a></span>
<span class="normal"><a href="#__codelineno-0-324">324</a></span>
<span class="normal"><a href="#__codelineno-0-325">325</a></span>
<span class="normal"><a href="#__codelineno-0-326">326</a></span>
<span class="normal"><a href="#__codelineno-0-327">327</a></span>
<span class="normal"><a href="#__codelineno-0-328">328</a></span>
<span class="normal"><a href="#__codelineno-0-329">329</a></span>
<span class="normal"><a href="#__codelineno-0-330">330</a></span>
<span class="normal"><a href="#__codelineno-0-331">331</a></span>
<span class="normal"><a href="#__codelineno-0-332">332</a></span>
<span class="normal"><a href="#__codelineno-0-333">333</a></span>
<span class="normal"><a href="#__codelineno-0-334">334</a></span>
<span class="normal"><a href="#__codelineno-0-335">335</a></span>
<span class="normal"><a href="#__codelineno-0-336">336</a></span>
<span class="normal"><a href="#__codelineno-0-337">337</a></span>
<span class="normal"><a href="#__codelineno-0-338">338</a></span>
<span class="normal"><a href="#__codelineno-0-339">339</a></span>
<span class="normal"><a href="#__codelineno-0-340">340</a></span>
<span class="normal"><a href="#__codelineno-0-341">341</a></span>
<span class="normal"><a href="#__codelineno-0-342">342</a></span>
<span class="normal"><a href="#__codelineno-0-343">343</a></span>
<span class="normal"><a href="#__codelineno-0-344">344</a></span>
<span class="normal"><a href="#__codelineno-0-345">345</a></span>
<span class="normal"><a href="#__codelineno-0-346">346</a></span>
<span class="normal"><a href="#__codelineno-0-347">347</a></span>
<span class="normal"><a href="#__codelineno-0-348">348</a></span>
<span class="normal"><a href="#__codelineno-0-349">349</a></span>
<span class="normal"><a href="#__codelineno-0-350">350</a></span>
<span class="normal"><a href="#__codelineno-0-351">351</a></span>
<span class="normal"><a href="#__codelineno-0-352">352</a></span>
<span class="normal"><a href="#__codelineno-0-353">353</a></span>
<span class="normal"><a href="#__codelineno-0-354">354</a></span>
<span class="normal"><a href="#__codelineno-0-355">355</a></span>
<span class="normal"><a href="#__codelineno-0-356">356</a></span>
<span class="normal"><a href="#__codelineno-0-357">357</a></span>
<span class="normal"><a href="#__codelineno-0-358">358</a></span>
<span class="normal"><a href="#__codelineno-0-359">359</a></span>
<span class="normal"><a href="#__codelineno-0-360">360</a></span>
<span class="normal"><a href="#__codelineno-0-361">361</a></span>
<span class="normal"><a href="#__codelineno-0-362">362</a></span>
<span class="normal"><a href="#__codelineno-0-363">363</a></span>
<span class="normal"><a href="#__codelineno-0-364">364</a></span>
<span class="normal"><a href="#__codelineno-0-365">365</a></span>
<span class="normal"><a href="#__codelineno-0-366">366</a></span>
<span class="normal"><a href="#__codelineno-0-367">367</a></span>
<span class="normal"><a href="#__codelineno-0-368">368</a></span>
<span class="normal"><a href="#__codelineno-0-369">369</a></span>
<span class="normal"><a href="#__codelineno-0-370">370</a></span>
<span class="normal"><a href="#__codelineno-0-371">371</a></span>
<span class="normal"><a href="#__codelineno-0-372">372</a></span>
<span class="normal"><a href="#__codelineno-0-373">373</a></span>
<span class="normal"><a href="#__codelineno-0-374">374</a></span>
<span class="normal"><a href="#__codelineno-0-375">375</a></span>
<span class="normal"><a href="#__codelineno-0-376">376</a></span>
<span class="normal"><a href="#__codelineno-0-377">377</a></span>
<span class="normal"><a href="#__codelineno-0-378">378</a></span>
<span class="normal"><a href="#__codelineno-0-379">379</a></span>
<span class="normal"><a href="#__codelineno-0-380">380</a></span>
<span class="normal"><a href="#__codelineno-0-381">381</a></span>
<span class="normal"><a href="#__codelineno-0-382">382</a></span>
<span class="normal"><a href="#__codelineno-0-383">383</a></span>
<span class="normal"><a href="#__codelineno-0-384">384</a></span>
<span class="normal"><a href="#__codelineno-0-385">385</a></span>
<span class="normal"><a href="#__codelineno-0-386">386</a></span>
<span class="normal"><a href="#__codelineno-0-387">387</a></span>
<span class="normal"><a href="#__codelineno-0-388">388</a></span>
<span class="normal"><a href="#__codelineno-0-389">389</a></span>
<span class="normal"><a href="#__codelineno-0-390">390</a></span>
<span class="normal"><a href="#__codelineno-0-391">391</a></span>
<span class="normal"><a href="#__codelineno-0-392">392</a></span>
<span class="normal"><a href="#__codelineno-0-393">393</a></span>
<span class="normal"><a href="#__codelineno-0-394">394</a></span>
<span class="normal"><a href="#__codelineno-0-395">395</a></span>
<span class="normal"><a href="#__codelineno-0-396">396</a></span>
<span class="normal"><a href="#__codelineno-0-397">397</a></span>
<span class="normal"><a href="#__codelineno-0-398">398</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-19" name="__codelineno-0-19"></a><span class="k">class</span> <span class="nc">NestedLogitModel</span><span class="p">(</span><span class="n">nn</span><span class="o">.</span><span class="n">Module</span><span class="p">):</span>
<a id="__codelineno-0-20" name="__codelineno-0-20"></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-21" name="__codelineno-0-21"></a>                 <span class="n">nest_to_item</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">object</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">]],</span>
<a id="__codelineno-0-22" name="__codelineno-0-22"></a>                 <span class="c1"># method 1: specify variation and num param. dictionary.</span>
<a id="__codelineno-0-23" name="__codelineno-0-23"></a>                 <span class="n">nest_coef_variation_dict</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-24" name="__codelineno-0-24"></a>                 <span class="n">nest_num_param_dict</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">]]</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-25" name="__codelineno-0-25"></a>                 <span class="n">item_coef_variation_dict</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-26" name="__codelineno-0-26"></a>                 <span class="n">item_num_param_dict</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">]]</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-27" name="__codelineno-0-27"></a>                 <span class="c1"># method 2: specify formula and dataset.</span>
<a id="__codelineno-0-28" name="__codelineno-0-28"></a>                 <span class="n">item_formula</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-29" name="__codelineno-0-29"></a>                 <span class="n">nest_formula</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-30" name="__codelineno-0-30"></a>                 <span class="n">dataset</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">JointDataset</span><span class="p">]</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-31" name="__codelineno-0-31"></a>                 <span class="n">num_users</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-32" name="__codelineno-0-32"></a>                 <span class="n">shared_lambda</span><span class="p">:</span> <span class="nb">bool</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-33" name="__codelineno-0-33"></a>                 <span class="n">regularization</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-34" name="__codelineno-0-34"></a>                 <span class="n">regularization_weight</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span><span class="o">=</span><span class="kc">None</span>
<a id="__codelineno-0-35" name="__codelineno-0-35"></a>                 <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-36" name="__codelineno-0-36"></a>        <span class="sd">&quot;&quot;&quot;Initialization method of the nested logit model.</span>
<a id="__codelineno-0-37" name="__codelineno-0-37"></a>
<a id="__codelineno-0-38" name="__codelineno-0-38"></a><span class="sd">        Args:</span>
<a id="__codelineno-0-39" name="__codelineno-0-39"></a><span class="sd">            nest_to_item (Dict[object, List[int]]): a dictionary maps a nest ID to a list</span>
<a id="__codelineno-0-40" name="__codelineno-0-40"></a><span class="sd">                of items IDs of the queried nest.</span>
<a id="__codelineno-0-41" name="__codelineno-0-41"></a>
<a id="__codelineno-0-42" name="__codelineno-0-42"></a><span class="sd">            nest_coef_variation_dict (Dict[str, str]): a dictionary maps a variable type</span>
<a id="__codelineno-0-43" name="__codelineno-0-43"></a><span class="sd">                (i.e., variable group) to the level of variation for the coefficient of this type</span>
<a id="__codelineno-0-44" name="__codelineno-0-44"></a><span class="sd">                of variables.</span>
<a id="__codelineno-0-45" name="__codelineno-0-45"></a><span class="sd">            nest_num_param_dict (Dict[str, int]): a dictionary maps a variable type name to</span>
<a id="__codelineno-0-46" name="__codelineno-0-46"></a><span class="sd">                the number of parameters in this variable group.</span>
<a id="__codelineno-0-47" name="__codelineno-0-47"></a>
<a id="__codelineno-0-48" name="__codelineno-0-48"></a><span class="sd">            item_coef_variation_dict (Dict[str, str]): the same as nest_coef_variation_dict but</span>
<a id="__codelineno-0-49" name="__codelineno-0-49"></a><span class="sd">                for item features.</span>
<a id="__codelineno-0-50" name="__codelineno-0-50"></a><span class="sd">            item_num_param_dict (Dict[str, int]): the same as nest_num_param_dict but for item</span>
<a id="__codelineno-0-51" name="__codelineno-0-51"></a><span class="sd">                features.</span>
<a id="__codelineno-0-52" name="__codelineno-0-52"></a>
<a id="__codelineno-0-53" name="__codelineno-0-53"></a><span class="sd">            {nest, item}_formula (str): a string representing the utility formula for the {nest, item} level logit model.</span>
<a id="__codelineno-0-54" name="__codelineno-0-54"></a><span class="sd">                The formula consists of &#39;(variable_name|variation)&#39;s separated by &#39;+&#39;, for example:</span>
<a id="__codelineno-0-55" name="__codelineno-0-55"></a><span class="sd">                &quot;(var1|item) + (var2|user) + (var3|constant)&quot;</span>
<a id="__codelineno-0-56" name="__codelineno-0-56"></a><span class="sd">                where the first part of each term is the name of the variable</span>
<a id="__codelineno-0-57" name="__codelineno-0-57"></a><span class="sd">                and the second part is the variation of the coefficient.</span>
<a id="__codelineno-0-58" name="__codelineno-0-58"></a><span class="sd">                The variation can be one of the following:</span>
<a id="__codelineno-0-59" name="__codelineno-0-59"></a><span class="sd">                &#39;constant&#39;, &#39;item&#39;, &#39;item-full&#39;, &#39;user&#39;, &#39;user-item&#39;, &#39;user-item-full&#39;.</span>
<a id="__codelineno-0-60" name="__codelineno-0-60"></a><span class="sd">                All spaces in the formula will be ignored, hence please do not use spaces in variable/observable names.</span>
<a id="__codelineno-0-61" name="__codelineno-0-61"></a><span class="sd">            dataset (JointDataset): a JointDataset object for training the model, the parser will infer dimensions of variables</span>
<a id="__codelineno-0-62" name="__codelineno-0-62"></a><span class="sd">                and sizes of coefficients for the nest level model from dataset.datasets[&#39;nest&#39;]. The parser will infer dimensions of variables and sizes of coefficients for the item level model from dataset.datasets[&#39;item&#39;].</span>
<a id="__codelineno-0-63" name="__codelineno-0-63"></a>
<a id="__codelineno-0-64" name="__codelineno-0-64"></a><span class="sd">            num_users (Optional[int], optional): number of users to be modelled, this is only</span>
<a id="__codelineno-0-65" name="__codelineno-0-65"></a><span class="sd">                required if any of variable type requires user-specific variations.</span>
<a id="__codelineno-0-66" name="__codelineno-0-66"></a><span class="sd">                Defaults to None.</span>
<a id="__codelineno-0-67" name="__codelineno-0-67"></a>
<a id="__codelineno-0-68" name="__codelineno-0-68"></a><span class="sd">            shared_lambda (bool): a boolean indicating whether to enforce the elasticity lambda, which</span>
<a id="__codelineno-0-69" name="__codelineno-0-69"></a><span class="sd">                is the coefficient for inclusive values, to be constant for all nests.</span>
<a id="__codelineno-0-70" name="__codelineno-0-70"></a><span class="sd">                The lambda enters the nest-level selection as the following</span>
<a id="__codelineno-0-71" name="__codelineno-0-71"></a><span class="sd">                Utility of choosing nest k = lambda * inclusive value of nest k</span>
<a id="__codelineno-0-72" name="__codelineno-0-72"></a><span class="sd">                                               + linear combination of some other nest level features</span>
<a id="__codelineno-0-73" name="__codelineno-0-73"></a><span class="sd">                If set to True, a single lambda will be learned for all nests, otherwise, the</span>
<a id="__codelineno-0-74" name="__codelineno-0-74"></a><span class="sd">                model learns an individual lambda for each nest.</span>
<a id="__codelineno-0-75" name="__codelineno-0-75"></a><span class="sd">                Defaults to False.</span>
<a id="__codelineno-0-76" name="__codelineno-0-76"></a>
<a id="__codelineno-0-77" name="__codelineno-0-77"></a><span class="sd">            regularization (Optional[str]): this argument takes values from {&#39;L1&#39;, &#39;L2&#39;, None}, which specifies the type of</span>
<a id="__codelineno-0-78" name="__codelineno-0-78"></a><span class="sd">                regularization added to the log-likelihood.</span>
<a id="__codelineno-0-79" name="__codelineno-0-79"></a><span class="sd">                - &#39;L1&#39; will subtract regularization_weight * 1-norm of parameters from the log-likelihood.</span>
<a id="__codelineno-0-80" name="__codelineno-0-80"></a><span class="sd">                - &#39;L2&#39; will subtract regularization_weight * 2-norm of parameters from the log-likelihood.</span>
<a id="__codelineno-0-81" name="__codelineno-0-81"></a><span class="sd">                - None does not modify the log-likelihood.</span>
<a id="__codelineno-0-82" name="__codelineno-0-82"></a><span class="sd">                Defaults to None.</span>
<a id="__codelineno-0-83" name="__codelineno-0-83"></a>
<a id="__codelineno-0-84" name="__codelineno-0-84"></a><span class="sd">            regularization_weight (Optional[float]): the weight of parameter norm subtracted from the log-likelihood.</span>
<a id="__codelineno-0-85" name="__codelineno-0-85"></a><span class="sd">                This term controls the strength of regularization. This argument is required if and only if regularization</span>
<a id="__codelineno-0-86" name="__codelineno-0-86"></a><span class="sd">                is not None.</span>
<a id="__codelineno-0-87" name="__codelineno-0-87"></a><span class="sd">                Defaults to None.</span>
<a id="__codelineno-0-88" name="__codelineno-0-88"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-89" name="__codelineno-0-89"></a>        <span class="c1"># handle nest level model.</span>
<a id="__codelineno-0-90" name="__codelineno-0-90"></a>        <span class="n">using_formula_to_initiate</span> <span class="o">=</span> <span class="p">(</span><span class="n">item_formula</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">nest_formula</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span>
<a id="__codelineno-0-91" name="__codelineno-0-91"></a>        <span class="k">if</span> <span class="n">using_formula_to_initiate</span><span class="p">:</span>
<a id="__codelineno-0-92" name="__codelineno-0-92"></a>            <span class="c1"># make sure that the research does not specify duplicated information, which might cause conflict.</span>
<a id="__codelineno-0-93" name="__codelineno-0-93"></a>            <span class="k">if</span> <span class="p">(</span><span class="n">nest_coef_variation_dict</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">item_coef_variation_dict</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">):</span>
<a id="__codelineno-0-94" name="__codelineno-0-94"></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;You specify the {item, nest}_formula to initiate the model, you should not specify the {item, nest}_coef_variation_dict at the same time.&#39;</span><span class="p">)</span>
<a id="__codelineno-0-95" name="__codelineno-0-95"></a>            <span class="k">if</span> <span class="p">(</span><span class="n">nest_num_param_dict</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">item_num_param_dict</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">):</span>
<a id="__codelineno-0-96" name="__codelineno-0-96"></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;You specify the {item, nest}_formula to initiate the model, you should not specify the {item, nest}_num_param_dict at the same time.&#39;</span><span class="p">)</span>
<a id="__codelineno-0-97" name="__codelineno-0-97"></a>            <span class="k">if</span> <span class="n">dataset</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-98" name="__codelineno-0-98"></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Dataset is required if {item, nest}_formula is specified to initiate the model.&#39;</span><span class="p">)</span>
<a id="__codelineno-0-99" name="__codelineno-0-99"></a>
<a id="__codelineno-0-100" name="__codelineno-0-100"></a>            <span class="n">nest_coef_variation_dict</span><span class="p">,</span> <span class="n">nest_num_param_dict</span> <span class="o">=</span> <span class="n">parse_formula</span><span class="p">(</span><span class="n">nest_formula</span><span class="p">,</span> <span class="n">dataset</span><span class="o">.</span><span class="n">datasets</span><span class="p">[</span><span class="s1">&#39;nest&#39;</span><span class="p">])</span>
<a id="__codelineno-0-101" name="__codelineno-0-101"></a>            <span class="n">item_coef_variation_dict</span><span class="p">,</span> <span class="n">item_num_param_dict</span> <span class="o">=</span> <span class="n">parse_formula</span><span class="p">(</span><span class="n">item_formula</span><span class="p">,</span> <span class="n">dataset</span><span class="o">.</span><span class="n">datasets</span><span class="p">[</span><span class="s1">&#39;item&#39;</span><span class="p">])</span>
<a id="__codelineno-0-102" name="__codelineno-0-102"></a>
<a id="__codelineno-0-103" name="__codelineno-0-103"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-104" name="__codelineno-0-104"></a>            <span class="c1"># check for conflicting information.</span>
<a id="__codelineno-0-105" name="__codelineno-0-105"></a>            <span class="k">if</span> <span class="p">(</span><span class="n">nest_formula</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">item_formula</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">):</span>
<a id="__codelineno-0-106" name="__codelineno-0-106"></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;You should not specify {item, nest}_formula and {item, nest}_coef_variation_dict at the same time.&#39;</span><span class="p">)</span>
<a id="__codelineno-0-107" name="__codelineno-0-107"></a>            <span class="c1"># make sure that the research specifies all the required information.</span>
<a id="__codelineno-0-108" name="__codelineno-0-108"></a>            <span class="k">if</span> <span class="p">(</span><span class="n">nest_coef_variation_dict</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">item_coef_variation_dict</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">):</span>
<a id="__codelineno-0-109" name="__codelineno-0-109"></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;You should specify the {item, nest}_coef_variation_dict to initiate the model.&#39;</span><span class="p">)</span>
<a id="__codelineno-0-110" name="__codelineno-0-110"></a>            <span class="k">if</span> <span class="p">(</span><span class="n">nest_num_param_dict</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">item_num_param_dict</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">):</span>
<a id="__codelineno-0-111" name="__codelineno-0-111"></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;You should specify the {item, nest}_num_param_dict to initiate the model.&#39;</span><span class="p">)</span>
<a id="__codelineno-0-112" name="__codelineno-0-112"></a>
<a id="__codelineno-0-113" name="__codelineno-0-113"></a>        <span class="nb">super</span><span class="p">(</span><span class="n">NestedLogitModel</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
<a id="__codelineno-0-114" name="__codelineno-0-114"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">nest_to_item</span> <span class="o">=</span> <span class="n">nest_to_item</span>
<a id="__codelineno-0-115" name="__codelineno-0-115"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">nest_coef_variation_dict</span> <span class="o">=</span> <span class="n">nest_coef_variation_dict</span>
<a id="__codelineno-0-116" name="__codelineno-0-116"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">nest_num_param_dict</span> <span class="o">=</span> <span class="n">nest_num_param_dict</span>
<a id="__codelineno-0-117" name="__codelineno-0-117"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">item_coef_variation_dict</span> <span class="o">=</span> <span class="n">item_coef_variation_dict</span>
<a id="__codelineno-0-118" name="__codelineno-0-118"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">item_num_param_dict</span> <span class="o">=</span> <span class="n">item_num_param_dict</span>
<a id="__codelineno-0-119" name="__codelineno-0-119"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">num_users</span> <span class="o">=</span> <span class="n">num_users</span>
<a id="__codelineno-0-120" name="__codelineno-0-120"></a>
<a id="__codelineno-0-121" name="__codelineno-0-121"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">nests</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">nest_to_item</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
<a id="__codelineno-0-122" name="__codelineno-0-122"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">num_nests</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nests</span><span class="p">)</span>
<a id="__codelineno-0-123" name="__codelineno-0-123"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">num_items</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">items</span><span class="p">)</span> <span class="k">for</span> <span class="n">items</span> <span class="ow">in</span> <span class="n">nest_to_item</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
<a id="__codelineno-0-124" name="__codelineno-0-124"></a>
<a id="__codelineno-0-125" name="__codelineno-0-125"></a>        <span class="c1"># nest coefficients.</span>
<a id="__codelineno-0-126" name="__codelineno-0-126"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">nest_coef_dict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_build_coef_dict</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nest_coef_variation_dict</span><span class="p">,</span>
<a id="__codelineno-0-127" name="__codelineno-0-127"></a>                                                    <span class="bp">self</span><span class="o">.</span><span class="n">nest_num_param_dict</span><span class="p">,</span>
<a id="__codelineno-0-128" name="__codelineno-0-128"></a>                                                    <span class="bp">self</span><span class="o">.</span><span class="n">num_nests</span><span class="p">)</span>
<a id="__codelineno-0-129" name="__codelineno-0-129"></a>
<a id="__codelineno-0-130" name="__codelineno-0-130"></a>        <span class="c1"># item coefficients.</span>
<a id="__codelineno-0-131" name="__codelineno-0-131"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">item_coef_dict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_build_coef_dict</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">item_coef_variation_dict</span><span class="p">,</span>
<a id="__codelineno-0-132" name="__codelineno-0-132"></a>                                                    <span class="bp">self</span><span class="o">.</span><span class="n">item_num_param_dict</span><span class="p">,</span>
<a id="__codelineno-0-133" name="__codelineno-0-133"></a>                                                    <span class="bp">self</span><span class="o">.</span><span class="n">num_items</span><span class="p">)</span>
<a id="__codelineno-0-134" name="__codelineno-0-134"></a>
<a id="__codelineno-0-135" name="__codelineno-0-135"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">shared_lambda</span> <span class="o">=</span> <span class="n">shared_lambda</span>
<a id="__codelineno-0-136" name="__codelineno-0-136"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">shared_lambda</span><span class="p">:</span>
<a id="__codelineno-0-137" name="__codelineno-0-137"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">lambda_weight</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Parameter</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="n">requires_grad</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<a id="__codelineno-0-138" name="__codelineno-0-138"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-139" name="__codelineno-0-139"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">lambda_weight</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Parameter</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">num_nests</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="n">requires_grad</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<a id="__codelineno-0-140" name="__codelineno-0-140"></a>        <span class="c1"># breakpoint()</span>
<a id="__codelineno-0-141" name="__codelineno-0-141"></a>        <span class="c1"># self.iv_weights = nn.Parameter(torch.ones(1), requires_grad=True)</span>
<a id="__codelineno-0-142" name="__codelineno-0-142"></a>        <span class="c1"># used to warn users if forgot to call clamp.</span>
<a id="__codelineno-0-143" name="__codelineno-0-143"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_clamp_called_flag</span> <span class="o">=</span> <span class="kc">True</span>
<a id="__codelineno-0-144" name="__codelineno-0-144"></a>
<a id="__codelineno-0-145" name="__codelineno-0-145"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">regularization</span> <span class="o">=</span> <span class="n">regularization</span>
<a id="__codelineno-0-146" name="__codelineno-0-146"></a>        <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">regularization</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;L1&#39;</span><span class="p">,</span> <span class="s1">&#39;L2&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">],</span> <span class="sa">f</span><span class="s2">&quot;Provided regularization=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">regularization</span><span class="si">}</span><span class="s2"> is not allowed, allowed values are [&#39;L1&#39;, &#39;L2&#39;, None].&quot;</span>
<a id="__codelineno-0-147" name="__codelineno-0-147"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">regularization_weight</span> <span class="o">=</span> <span class="n">regularization_weight</span>
<a id="__codelineno-0-148" name="__codelineno-0-148"></a>        <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">regularization</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">regularization_weight</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">):</span>
<a id="__codelineno-0-149" name="__codelineno-0-149"></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;You specified regularization type </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">regularization</span><span class="si">}</span><span class="s1"> without providing regularization_weight.&#39;</span><span class="p">)</span>
<a id="__codelineno-0-150" name="__codelineno-0-150"></a>        <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">regularization</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">regularization_weight</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">):</span>
<a id="__codelineno-0-151" name="__codelineno-0-151"></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;You specified no regularization but you provide regularization_weight=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">regularization_weight</span><span class="si">}</span><span class="s1">, you should leave regularization_weight as None if you do not want to regularize the model.&#39;</span><span class="p">)</span>
<a id="__codelineno-0-152" name="__codelineno-0-152"></a>
<a id="__codelineno-0-153" name="__codelineno-0-153"></a>    <span class="nd">@property</span>
<a id="__codelineno-0-154" name="__codelineno-0-154"></a>    <span class="k">def</span> <span class="nf">num_params</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<a id="__codelineno-0-155" name="__codelineno-0-155"></a>        <span class="sd">&quot;&quot;&quot;Get the total number of parameters. For example, if there is only an user-specific coefficient to be multiplied</span>
<a id="__codelineno-0-156" name="__codelineno-0-156"></a><span class="sd">        with the K-dimensional observable, then the total number of parameters would be K x number of users, assuming no</span>
<a id="__codelineno-0-157" name="__codelineno-0-157"></a><span class="sd">        intercept is involved.</span>
<a id="__codelineno-0-158" name="__codelineno-0-158"></a>
<a id="__codelineno-0-159" name="__codelineno-0-159"></a><span class="sd">        Returns:</span>
<a id="__codelineno-0-160" name="__codelineno-0-160"></a><span class="sd">            int: the total number of learnable parameters.</span>
<a id="__codelineno-0-161" name="__codelineno-0-161"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-162" name="__codelineno-0-162"></a>        <span class="k">return</span> <span class="nb">sum</span><span class="p">(</span><span class="n">w</span><span class="o">.</span><span class="n">numel</span><span class="p">()</span> <span class="k">for</span> <span class="n">w</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">())</span>
<a id="__codelineno-0-163" name="__codelineno-0-163"></a>
<a id="__codelineno-0-164" name="__codelineno-0-164"></a>    <span class="k">def</span> <span class="nf">_build_coef_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-165" name="__codelineno-0-165"></a>                         <span class="n">coef_variation_dict</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">],</span>
<a id="__codelineno-0-166" name="__codelineno-0-166"></a>                         <span class="n">num_param_dict</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">],</span>
<a id="__codelineno-0-167" name="__codelineno-0-167"></a>                         <span class="n">num_items</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">nn</span><span class="o">.</span><span class="n">ModuleDict</span><span class="p">:</span>
<a id="__codelineno-0-168" name="__codelineno-0-168"></a>        <span class="sd">&quot;&quot;&quot;Builds a coefficient dictionary containing all trainable components of the model, mapping coefficient names</span>
<a id="__codelineno-0-169" name="__codelineno-0-169"></a><span class="sd">            to the corresponding Coefficient Module.</span>
<a id="__codelineno-0-170" name="__codelineno-0-170"></a><span class="sd">            num_items could be the actual number of items or the number of nests depends on the use case.</span>
<a id="__codelineno-0-171" name="__codelineno-0-171"></a><span class="sd">            NOTE: torch-choice users don&#39;t directly interact with this method.</span>
<a id="__codelineno-0-172" name="__codelineno-0-172"></a>
<a id="__codelineno-0-173" name="__codelineno-0-173"></a><span class="sd">        Args:</span>
<a id="__codelineno-0-174" name="__codelineno-0-174"></a><span class="sd">            coef_variation_dict (Dict[str, str]): a dictionary mapping coefficient names (e.g., theta_user) to the level</span>
<a id="__codelineno-0-175" name="__codelineno-0-175"></a><span class="sd">                of variation (e.g., &#39;user&#39;).</span>
<a id="__codelineno-0-176" name="__codelineno-0-176"></a><span class="sd">            num_param_dict (Dict[str, int]): a dictionary mapping coefficient names to the number of parameters in this</span>
<a id="__codelineno-0-177" name="__codelineno-0-177"></a><span class="sd">                coefficient. Be aware that, for example, if there is one K-dimensional coefficient for every user, then</span>
<a id="__codelineno-0-178" name="__codelineno-0-178"></a><span class="sd">                the `num_param` should be K instead of K x number of users.</span>
<a id="__codelineno-0-179" name="__codelineno-0-179"></a><span class="sd">            num_items (int): the total number of items in the prediction problem. `num_items` should be the number of nests if _build_coef_dict() is used for nest-level prediction.</span>
<a id="__codelineno-0-180" name="__codelineno-0-180"></a>
<a id="__codelineno-0-181" name="__codelineno-0-181"></a><span class="sd">        Returns:</span>
<a id="__codelineno-0-182" name="__codelineno-0-182"></a><span class="sd">            nn.ModuleDict: a PyTorch ModuleDict object mapping from coefficient names to training Coefficient.</span>
<a id="__codelineno-0-183" name="__codelineno-0-183"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-184" name="__codelineno-0-184"></a>        <span class="n">coef_dict</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
<a id="__codelineno-0-185" name="__codelineno-0-185"></a>        <span class="k">for</span> <span class="n">var_type</span><span class="p">,</span> <span class="n">variation</span> <span class="ow">in</span> <span class="n">coef_variation_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
<a id="__codelineno-0-186" name="__codelineno-0-186"></a>            <span class="n">num_params</span> <span class="o">=</span> <span class="n">num_param_dict</span><span class="p">[</span><span class="n">var_type</span><span class="p">]</span>
<a id="__codelineno-0-187" name="__codelineno-0-187"></a>            <span class="n">coef_dict</span><span class="p">[</span><span class="n">var_type</span><span class="p">]</span> <span class="o">=</span> <span class="n">Coefficient</span><span class="p">(</span><span class="n">variation</span><span class="o">=</span><span class="n">variation</span><span class="p">,</span>
<a id="__codelineno-0-188" name="__codelineno-0-188"></a>                                              <span class="n">num_items</span><span class="o">=</span><span class="n">num_items</span><span class="p">,</span>
<a id="__codelineno-0-189" name="__codelineno-0-189"></a>                                              <span class="n">num_users</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">num_users</span><span class="p">,</span>
<a id="__codelineno-0-190" name="__codelineno-0-190"></a>                                              <span class="n">num_params</span><span class="o">=</span><span class="n">num_params</span><span class="p">)</span>
<a id="__codelineno-0-191" name="__codelineno-0-191"></a>        <span class="k">return</span> <span class="n">nn</span><span class="o">.</span><span class="n">ModuleDict</span><span class="p">(</span><span class="n">coef_dict</span><span class="p">)</span>
<a id="__codelineno-0-192" name="__codelineno-0-192"></a>
<a id="__codelineno-0-193" name="__codelineno-0-193"></a>
<a id="__codelineno-0-194" name="__codelineno-0-194"></a>    <span class="k">def</span> <span class="nf">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">batch</span><span class="p">:</span> <span class="n">ChoiceDataset</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">:</span>
<a id="__codelineno-0-195" name="__codelineno-0-195"></a>        <span class="sd">&quot;&quot;&quot;An standard forward method for the model, the user feeds a ChoiceDataset batch and the model returns the</span>
<a id="__codelineno-0-196" name="__codelineno-0-196"></a><span class="sd">            predicted log-likelihood tensor. The main forward passing happens in the _forward() method, but we provide</span>
<a id="__codelineno-0-197" name="__codelineno-0-197"></a><span class="sd">            this wrapper forward() method for a cleaner API, as forward() only requires a single batch argument.</span>
<a id="__codelineno-0-198" name="__codelineno-0-198"></a><span class="sd">            For more details about the forward passing, please refer to the _forward() method.</span>
<a id="__codelineno-0-199" name="__codelineno-0-199"></a>
<a id="__codelineno-0-200" name="__codelineno-0-200"></a><span class="sd">        # TODO: the ConditionaLogitModel returns predicted utility, the NestedLogitModel behaves the same?</span>
<a id="__codelineno-0-201" name="__codelineno-0-201"></a>
<a id="__codelineno-0-202" name="__codelineno-0-202"></a><span class="sd">        Args:</span>
<a id="__codelineno-0-203" name="__codelineno-0-203"></a><span class="sd">            batch (ChoiceDataset): a ChoiceDataset object containing the data batch.</span>
<a id="__codelineno-0-204" name="__codelineno-0-204"></a>
<a id="__codelineno-0-205" name="__codelineno-0-205"></a><span class="sd">        Returns:</span>
<a id="__codelineno-0-206" name="__codelineno-0-206"></a><span class="sd">            torch.Tensor: a tensor of shape (num_trips, num_items) including the log probability</span>
<a id="__codelineno-0-207" name="__codelineno-0-207"></a><span class="sd">            of choosing item i in trip t.</span>
<a id="__codelineno-0-208" name="__codelineno-0-208"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-209" name="__codelineno-0-209"></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_forward</span><span class="p">(</span><span class="n">batch</span><span class="p">[</span><span class="s1">&#39;nest&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">x_dict</span><span class="p">,</span>
<a id="__codelineno-0-210" name="__codelineno-0-210"></a>                             <span class="n">batch</span><span class="p">[</span><span class="s1">&#39;item&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">x_dict</span><span class="p">,</span>
<a id="__codelineno-0-211" name="__codelineno-0-211"></a>                             <span class="n">batch</span><span class="p">[</span><span class="s1">&#39;item&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">user_index</span><span class="p">,</span>
<a id="__codelineno-0-212" name="__codelineno-0-212"></a>                             <span class="n">batch</span><span class="p">[</span><span class="s1">&#39;item&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">item_availability</span><span class="p">)</span>
<a id="__codelineno-0-213" name="__codelineno-0-213"></a>
<a id="__codelineno-0-214" name="__codelineno-0-214"></a>    <span class="k">def</span> <span class="nf">_forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-215" name="__codelineno-0-215"></a>                 <span class="n">nest_x_dict</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">],</span>
<a id="__codelineno-0-216" name="__codelineno-0-216"></a>                 <span class="n">item_x_dict</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">],</span>
<a id="__codelineno-0-217" name="__codelineno-0-217"></a>                 <span class="n">user_index</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">torch</span><span class="o">.</span><span class="n">LongTensor</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-218" name="__codelineno-0-218"></a>                 <span class="n">item_availability</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">torch</span><span class="o">.</span><span class="n">BoolTensor</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-219" name="__codelineno-0-219"></a>                 <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">:</span>
<a id="__codelineno-0-220" name="__codelineno-0-220"></a>        <span class="sd">&quot;&quot;&quot;&quot;Computes log P[t, i] = the log probability for the user involved in trip t to choose item i.</span>
<a id="__codelineno-0-221" name="__codelineno-0-221"></a><span class="sd">        Let n denote the ID of the user involved in trip t, then P[t, i] = P_{ni} on page 86 of the</span>
<a id="__codelineno-0-222" name="__codelineno-0-222"></a><span class="sd">        book &quot;discrete choice methods with simulation&quot; by Train.</span>
<a id="__codelineno-0-223" name="__codelineno-0-223"></a>
<a id="__codelineno-0-224" name="__codelineno-0-224"></a><span class="sd">        The `_forward` method is an internal API, users should refer to the `forward` method.</span>
<a id="__codelineno-0-225" name="__codelineno-0-225"></a>
<a id="__codelineno-0-226" name="__codelineno-0-226"></a><span class="sd">        Args:</span>
<a id="__codelineno-0-227" name="__codelineno-0-227"></a><span class="sd">            nest_x_dict (torch.Tensor): a dictionary mapping from nest-level feature names to the corresponding feature tensor.</span>
<a id="__codelineno-0-228" name="__codelineno-0-228"></a>
<a id="__codelineno-0-229" name="__codelineno-0-229"></a><span class="sd">            item_x_dict (torch.Tensor): a dictionary mapping from item-level feature names to the corresponding feature tensor.</span>
<a id="__codelineno-0-230" name="__codelineno-0-230"></a>
<a id="__codelineno-0-231" name="__codelineno-0-231"></a><span class="sd">                More details on the shape of the tensors can be found in the docstring of the `x_dict` method of `ChoiceDataset`.</span>
<a id="__codelineno-0-232" name="__codelineno-0-232"></a>
<a id="__codelineno-0-233" name="__codelineno-0-233"></a><span class="sd">            user_index (torch.LongTensor): a tensor of shape (num_trips,) indicating which user is</span>
<a id="__codelineno-0-234" name="__codelineno-0-234"></a><span class="sd">                making decision in each trip. Setting user_index = None assumes the same user is</span>
<a id="__codelineno-0-235" name="__codelineno-0-235"></a><span class="sd">                making decisions in all trips.</span>
<a id="__codelineno-0-236" name="__codelineno-0-236"></a><span class="sd">            item_availability (torch.BoolTensor): a boolean tensor with shape (num_trips, num_items)</span>
<a id="__codelineno-0-237" name="__codelineno-0-237"></a><span class="sd">                indicating the aviliability of items in each trip. If item_availability[t, i] = False,</span>
<a id="__codelineno-0-238" name="__codelineno-0-238"></a><span class="sd">                the utility of choosing item i in trip t, V[t, i], will be set to -inf.</span>
<a id="__codelineno-0-239" name="__codelineno-0-239"></a><span class="sd">                Given the decomposition V[t, i] = W[t, k(i)] + Y[t, i] + eps, V[t, i] is set to -inf</span>
<a id="__codelineno-0-240" name="__codelineno-0-240"></a><span class="sd">                by setting Y[t, i] = -inf for unavilable items.</span>
<a id="__codelineno-0-241" name="__codelineno-0-241"></a>
<a id="__codelineno-0-242" name="__codelineno-0-242"></a><span class="sd">        Returns:</span>
<a id="__codelineno-0-243" name="__codelineno-0-243"></a><span class="sd">            torch.Tensor: a tensor of shape (num_trips, num_items) including the log probability</span>
<a id="__codelineno-0-244" name="__codelineno-0-244"></a><span class="sd">            of choosing item i in trip t.</span>
<a id="__codelineno-0-245" name="__codelineno-0-245"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-246" name="__codelineno-0-246"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">shared_lambda</span><span class="p">:</span>
<a id="__codelineno-0-247" name="__codelineno-0-247"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">lambdas</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lambda_weight</span><span class="o">.</span><span class="n">expand</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">num_nests</span><span class="p">)</span>
<a id="__codelineno-0-248" name="__codelineno-0-248"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-249" name="__codelineno-0-249"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">lambdas</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lambda_weight</span>
<a id="__codelineno-0-250" name="__codelineno-0-250"></a>
<a id="__codelineno-0-251" name="__codelineno-0-251"></a>        <span class="c1"># if not self._clamp_called_flag:</span>
<a id="__codelineno-0-252" name="__codelineno-0-252"></a>        <span class="c1">#     warnings.warn(&#39;Did you forget to call clamp_lambdas() after optimizer.step()?&#39;)</span>
<a id="__codelineno-0-253" name="__codelineno-0-253"></a>
<a id="__codelineno-0-254" name="__codelineno-0-254"></a>        <span class="c1"># The overall utility of item can be decomposed into V[item] = W[nest] + Y[item] + eps.</span>
<a id="__codelineno-0-255" name="__codelineno-0-255"></a>        <span class="n">T</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">item_x_dict</span><span class="o">.</span><span class="n">values</span><span class="p">())[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-0-256" name="__codelineno-0-256"></a>        <span class="n">device</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">item_x_dict</span><span class="o">.</span><span class="n">values</span><span class="p">())[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">device</span>
<a id="__codelineno-0-257" name="__codelineno-0-257"></a>        <span class="c1"># compute nest-specific utility with shape (T, num_nests).</span>
<a id="__codelineno-0-258" name="__codelineno-0-258"></a>        <span class="n">W</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">T</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_nests</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">device</span><span class="p">)</span>
<a id="__codelineno-0-259" name="__codelineno-0-259"></a>
<a id="__codelineno-0-260" name="__codelineno-0-260"></a>        <span class="k">for</span> <span class="n">variable</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">nest_coef_variation_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
<a id="__codelineno-0-261" name="__codelineno-0-261"></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_intercept_term</span><span class="p">(</span><span class="n">variable</span><span class="p">):</span>
<a id="__codelineno-0-262" name="__codelineno-0-262"></a>                <span class="n">nest_x_dict</span><span class="p">[</span><span class="s1">&#39;intercept&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="n">T</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_nests</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">device</span><span class="p">)</span>
<a id="__codelineno-0-263" name="__codelineno-0-263"></a>                <span class="k">break</span>
<a id="__codelineno-0-264" name="__codelineno-0-264"></a>
<a id="__codelineno-0-265" name="__codelineno-0-265"></a>        <span class="k">for</span> <span class="n">variable</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">item_coef_variation_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
<a id="__codelineno-0-266" name="__codelineno-0-266"></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_intercept_term</span><span class="p">(</span><span class="n">variable</span><span class="p">):</span>
<a id="__codelineno-0-267" name="__codelineno-0-267"></a>                <span class="n">item_x_dict</span><span class="p">[</span><span class="s1">&#39;intercept&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="n">T</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_items</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">device</span><span class="p">)</span>
<a id="__codelineno-0-268" name="__codelineno-0-268"></a>                <span class="k">break</span>
<a id="__codelineno-0-269" name="__codelineno-0-269"></a>
<a id="__codelineno-0-270" name="__codelineno-0-270"></a>        <span class="k">for</span> <span class="n">var_type</span><span class="p">,</span> <span class="n">coef</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">nest_coef_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
<a id="__codelineno-0-271" name="__codelineno-0-271"></a>            <span class="n">corresponding_observable</span> <span class="o">=</span> <span class="n">var_type</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;[&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-0-272" name="__codelineno-0-272"></a>            <span class="n">W</span> <span class="o">+=</span> <span class="n">coef</span><span class="p">(</span><span class="n">nest_x_dict</span><span class="p">[</span><span class="n">corresponding_observable</span><span class="p">],</span> <span class="n">user_index</span><span class="p">)</span>
<a id="__codelineno-0-273" name="__codelineno-0-273"></a>
<a id="__codelineno-0-274" name="__codelineno-0-274"></a>        <span class="c1"># compute item-specific utility (T, num_items).</span>
<a id="__codelineno-0-275" name="__codelineno-0-275"></a>        <span class="n">Y</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">T</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_items</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">device</span><span class="p">)</span>
<a id="__codelineno-0-276" name="__codelineno-0-276"></a>        <span class="k">for</span> <span class="n">var_type</span><span class="p">,</span> <span class="n">coef</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">item_coef_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
<a id="__codelineno-0-277" name="__codelineno-0-277"></a>            <span class="n">corresponding_observable</span> <span class="o">=</span> <span class="n">var_type</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;[&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-0-278" name="__codelineno-0-278"></a>            <span class="n">Y</span> <span class="o">+=</span> <span class="n">coef</span><span class="p">(</span><span class="n">item_x_dict</span><span class="p">[</span><span class="n">corresponding_observable</span><span class="p">],</span> <span class="n">user_index</span><span class="p">)</span>
<a id="__codelineno-0-279" name="__codelineno-0-279"></a>
<a id="__codelineno-0-280" name="__codelineno-0-280"></a>        <span class="k">if</span> <span class="n">item_availability</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-281" name="__codelineno-0-281"></a>            <span class="n">Y</span><span class="p">[</span><span class="o">~</span><span class="n">item_availability</span><span class="p">]</span> <span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">finfo</span><span class="p">(</span><span class="n">Y</span><span class="o">.</span><span class="n">dtype</span><span class="p">)</span><span class="o">.</span><span class="n">min</span> <span class="o">/</span> <span class="mi">2</span>
<a id="__codelineno-0-282" name="__codelineno-0-282"></a>
<a id="__codelineno-0-283" name="__codelineno-0-283"></a>        <span class="c1"># =============================================================================</span>
<a id="__codelineno-0-284" name="__codelineno-0-284"></a>        <span class="c1"># compute the inclusive value of each nest.</span>
<a id="__codelineno-0-285" name="__codelineno-0-285"></a>        <span class="n">inclusive_value</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
<a id="__codelineno-0-286" name="__codelineno-0-286"></a>        <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">Bk</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">nest_to_item</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
<a id="__codelineno-0-287" name="__codelineno-0-287"></a>            <span class="c1"># for nest k, divide the Y of all items in Bk by lambda_k.</span>
<a id="__codelineno-0-288" name="__codelineno-0-288"></a>            <span class="n">Y</span><span class="p">[:,</span> <span class="n">Bk</span><span class="p">]</span> <span class="o">/=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lambdas</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
<a id="__codelineno-0-289" name="__codelineno-0-289"></a>            <span class="c1"># compute inclusive value for nest k.</span>
<a id="__codelineno-0-290" name="__codelineno-0-290"></a>            <span class="c1"># mask out unavilable items.</span>
<a id="__codelineno-0-291" name="__codelineno-0-291"></a>            <span class="n">inclusive_value</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">logsumexp</span><span class="p">(</span><span class="n">Y</span><span class="p">[:,</span> <span class="n">Bk</span><span class="p">],</span> <span class="n">dim</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">keepdim</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>  <span class="c1"># (T,)</span>
<a id="__codelineno-0-292" name="__codelineno-0-292"></a>        <span class="c1"># boardcast inclusive value from (T, num_nests) to (T, num_items).</span>
<a id="__codelineno-0-293" name="__codelineno-0-293"></a>        <span class="c1"># for trip t, I[t, i] is the inclusive value of the nest item i belongs to.</span>
<a id="__codelineno-0-294" name="__codelineno-0-294"></a>        <span class="n">I</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">T</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_items</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">device</span><span class="p">)</span>
<a id="__codelineno-0-295" name="__codelineno-0-295"></a>        <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">Bk</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">nest_to_item</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
<a id="__codelineno-0-296" name="__codelineno-0-296"></a>            <span class="n">I</span><span class="p">[:,</span> <span class="n">Bk</span><span class="p">]</span> <span class="o">=</span> <span class="n">inclusive_value</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">view</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>  <span class="c1"># (T, |Bk|)</span>
<a id="__codelineno-0-297" name="__codelineno-0-297"></a>
<a id="__codelineno-0-298" name="__codelineno-0-298"></a>        <span class="c1"># logP_item[t, i] = log P(ni|Bk), where Bk is the nest item i is in, n is the user in trip t.</span>
<a id="__codelineno-0-299" name="__codelineno-0-299"></a>        <span class="n">logP_item</span> <span class="o">=</span> <span class="n">Y</span> <span class="o">-</span> <span class="n">I</span>  <span class="c1"># (T, num_items)</span>
<a id="__codelineno-0-300" name="__codelineno-0-300"></a>
<a id="__codelineno-0-301" name="__codelineno-0-301"></a>        <span class="c1"># =============================================================================</span>
<a id="__codelineno-0-302" name="__codelineno-0-302"></a>        <span class="c1"># logP_nest[t, i] = log P(Bk), for item i in trip t, the probability of choosing the nest/bucket</span>
<a id="__codelineno-0-303" name="__codelineno-0-303"></a>        <span class="c1"># item i belongs to. logP_nest has shape (T, num_items)</span>
<a id="__codelineno-0-304" name="__codelineno-0-304"></a>        <span class="c1"># logit[t, i] = W[n, k] + lambda[k] I[n, k], where n is the user involved in trip t, k is</span>
<a id="__codelineno-0-305" name="__codelineno-0-305"></a>        <span class="c1"># the nest item i belongs to.</span>
<a id="__codelineno-0-306" name="__codelineno-0-306"></a>        <span class="n">logit</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">T</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_items</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">device</span><span class="p">)</span>
<a id="__codelineno-0-307" name="__codelineno-0-307"></a>        <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">Bk</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">nest_to_item</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
<a id="__codelineno-0-308" name="__codelineno-0-308"></a>            <span class="n">logit</span><span class="p">[:,</span> <span class="n">Bk</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">W</span><span class="p">[:,</span> <span class="n">k</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">lambdas</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">*</span> <span class="n">inclusive_value</span><span class="p">[</span><span class="n">k</span><span class="p">])</span><span class="o">.</span><span class="n">view</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>  <span class="c1"># (T, |Bk|)</span>
<a id="__codelineno-0-309" name="__codelineno-0-309"></a>        <span class="c1"># only count each nest once in the logsumexp within the nest level model.</span>
<a id="__codelineno-0-310" name="__codelineno-0-310"></a>        <span class="n">cols</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">nest_to_item</span><span class="o">.</span><span class="n">values</span><span class="p">()]</span>
<a id="__codelineno-0-311" name="__codelineno-0-311"></a>        <span class="n">logP_nest</span> <span class="o">=</span> <span class="n">logit</span> <span class="o">-</span> <span class="n">torch</span><span class="o">.</span><span class="n">logsumexp</span><span class="p">(</span><span class="n">logit</span><span class="p">[:,</span> <span class="n">cols</span><span class="p">],</span> <span class="n">dim</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">keepdim</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<a id="__codelineno-0-312" name="__codelineno-0-312"></a>
<a id="__codelineno-0-313" name="__codelineno-0-313"></a>        <span class="c1"># =============================================================================</span>
<a id="__codelineno-0-314" name="__codelineno-0-314"></a>        <span class="c1"># compute the joint log P_{ni} as in the textbook.</span>
<a id="__codelineno-0-315" name="__codelineno-0-315"></a>        <span class="n">logP</span> <span class="o">=</span> <span class="n">logP_item</span> <span class="o">+</span> <span class="n">logP_nest</span>
<a id="__codelineno-0-316" name="__codelineno-0-316"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_clamp_called_flag</span> <span class="o">=</span> <span class="kc">False</span>
<a id="__codelineno-0-317" name="__codelineno-0-317"></a>        <span class="k">return</span> <span class="n">logP</span>
<a id="__codelineno-0-318" name="__codelineno-0-318"></a>
<a id="__codelineno-0-319" name="__codelineno-0-319"></a>    <span class="k">def</span> <span class="nf">log_likelihood</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
<a id="__codelineno-0-320" name="__codelineno-0-320"></a>        <span class="sd">&quot;&quot;&quot;Computes the log likelihood of the model, please refer to the negative_log_likelihood() method.</span>
<a id="__codelineno-0-321" name="__codelineno-0-321"></a>
<a id="__codelineno-0-322" name="__codelineno-0-322"></a><span class="sd">        Returns:</span>
<a id="__codelineno-0-323" name="__codelineno-0-323"></a><span class="sd">            _type_: the log likelihood of the model.</span>
<a id="__codelineno-0-324" name="__codelineno-0-324"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-325" name="__codelineno-0-325"></a>        <span class="k">return</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">negative_log_likelihood</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">)</span>
<a id="__codelineno-0-326" name="__codelineno-0-326"></a>
<a id="__codelineno-0-327" name="__codelineno-0-327"></a>    <span class="k">def</span> <span class="nf">negative_log_likelihood</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-328" name="__codelineno-0-328"></a>                                <span class="n">batch</span><span class="p">:</span> <span class="n">ChoiceDataset</span><span class="p">,</span>
<a id="__codelineno-0-329" name="__codelineno-0-329"></a>                                <span class="n">y</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">LongTensor</span><span class="p">,</span>
<a id="__codelineno-0-330" name="__codelineno-0-330"></a>                                <span class="n">is_train</span><span class="p">:</span> <span class="nb">bool</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">torch</span><span class="o">.</span><span class="n">scalar_tensor</span><span class="p">:</span>
<a id="__codelineno-0-331" name="__codelineno-0-331"></a>        <span class="sd">&quot;&quot;&quot;Computes the negative log likelihood of the model. Please note the log-likelihood is summed over all samples</span>
<a id="__codelineno-0-332" name="__codelineno-0-332"></a><span class="sd">            in batch instead of the average.</span>
<a id="__codelineno-0-333" name="__codelineno-0-333"></a>
<a id="__codelineno-0-334" name="__codelineno-0-334"></a><span class="sd">        Args:</span>
<a id="__codelineno-0-335" name="__codelineno-0-335"></a><span class="sd">            batch (ChoiceDataset): the ChoiceDataset object containing the data.</span>
<a id="__codelineno-0-336" name="__codelineno-0-336"></a><span class="sd">            y (torch.LongTensor): the label.</span>
<a id="__codelineno-0-337" name="__codelineno-0-337"></a><span class="sd">            is_train (bool, optional): which mode of the model to be used for the forward passing, if we need Hessian</span>
<a id="__codelineno-0-338" name="__codelineno-0-338"></a><span class="sd">                of the NLL through auto-grad, `is_train` should be set to True. If we merely need a performance metric,</span>
<a id="__codelineno-0-339" name="__codelineno-0-339"></a><span class="sd">                then `is_train` can be set to False for better performance.</span>
<a id="__codelineno-0-340" name="__codelineno-0-340"></a><span class="sd">                Defaults to True.</span>
<a id="__codelineno-0-341" name="__codelineno-0-341"></a>
<a id="__codelineno-0-342" name="__codelineno-0-342"></a><span class="sd">        Returns:</span>
<a id="__codelineno-0-343" name="__codelineno-0-343"></a><span class="sd">            torch.scalar_tensor: the negative log likelihood of the model.</span>
<a id="__codelineno-0-344" name="__codelineno-0-344"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-345" name="__codelineno-0-345"></a>        <span class="c1"># compute the negative log-likelihood loss directly.</span>
<a id="__codelineno-0-346" name="__codelineno-0-346"></a>        <span class="k">if</span> <span class="n">is_train</span><span class="p">:</span>
<a id="__codelineno-0-347" name="__codelineno-0-347"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">train</span><span class="p">()</span>
<a id="__codelineno-0-348" name="__codelineno-0-348"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-349" name="__codelineno-0-349"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">eval</span><span class="p">()</span>
<a id="__codelineno-0-350" name="__codelineno-0-350"></a>        <span class="c1"># (num_trips, num_items)</span>
<a id="__codelineno-0-351" name="__codelineno-0-351"></a>        <span class="n">logP</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">forward</span><span class="p">(</span><span class="n">batch</span><span class="p">)</span>
<a id="__codelineno-0-352" name="__codelineno-0-352"></a>        <span class="n">nll</span> <span class="o">=</span> <span class="o">-</span> <span class="n">logP</span><span class="p">[</span><span class="n">torch</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">y</span><span class="p">)),</span> <span class="n">y</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
<a id="__codelineno-0-353" name="__codelineno-0-353"></a>        <span class="k">return</span> <span class="n">nll</span>
<a id="__codelineno-0-354" name="__codelineno-0-354"></a>
<a id="__codelineno-0-355" name="__codelineno-0-355"></a>    <span class="k">def</span> <span class="nf">loss</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<a id="__codelineno-0-356" name="__codelineno-0-356"></a>        <span class="sd">&quot;&quot;&quot;The loss function to be optimized. This is a wrapper of `negative_log_likelihood` + regularization loss if required.&quot;&quot;&quot;</span>
<a id="__codelineno-0-357" name="__codelineno-0-357"></a>        <span class="n">nll</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">negative_log_likelihood</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
<a id="__codelineno-0-358" name="__codelineno-0-358"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">regularization</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-359" name="__codelineno-0-359"></a>            <span class="n">L</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;L1&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;L2&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">}[</span><span class="bp">self</span><span class="o">.</span><span class="n">regularization</span><span class="p">]</span>
<a id="__codelineno-0-360" name="__codelineno-0-360"></a>            <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">param</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">named_parameters</span><span class="p">():</span>
<a id="__codelineno-0-361" name="__codelineno-0-361"></a>                <span class="k">if</span> <span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;lambda_weight&#39;</span><span class="p">:</span>
<a id="__codelineno-0-362" name="__codelineno-0-362"></a>                    <span class="c1"># we don&#39;t regularize the lambda term, we only regularize coefficients.</span>
<a id="__codelineno-0-363" name="__codelineno-0-363"></a>                    <span class="k">continue</span>
<a id="__codelineno-0-364" name="__codelineno-0-364"></a>                <span class="n">nll</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">regularization_weight</span> <span class="o">*</span> <span class="n">torch</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">param</span><span class="p">,</span> <span class="n">p</span><span class="o">=</span><span class="n">L</span><span class="p">)</span>
<a id="__codelineno-0-365" name="__codelineno-0-365"></a>        <span class="k">return</span> <span class="n">nll</span>
<a id="__codelineno-0-366" name="__codelineno-0-366"></a>
<a id="__codelineno-0-367" name="__codelineno-0-367"></a>    <span class="nd">@property</span>
<a id="__codelineno-0-368" name="__codelineno-0-368"></a>    <span class="k">def</span> <span class="nf">device</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">torch</span><span class="o">.</span><span class="n">device</span><span class="p">:</span>
<a id="__codelineno-0-369" name="__codelineno-0-369"></a>        <span class="sd">&quot;&quot;&quot;Returns the device of the coefficient.</span>
<a id="__codelineno-0-370" name="__codelineno-0-370"></a>
<a id="__codelineno-0-371" name="__codelineno-0-371"></a><span class="sd">        Returns:</span>
<a id="__codelineno-0-372" name="__codelineno-0-372"></a><span class="sd">            torch.device: the device of the model.</span>
<a id="__codelineno-0-373" name="__codelineno-0-373"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-374" name="__codelineno-0-374"></a>        <span class="k">return</span> <span class="nb">next</span><span class="p">(</span><span class="nb">iter</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">item_coef_dict</span><span class="o">.</span><span class="n">values</span><span class="p">()))</span><span class="o">.</span><span class="n">device</span>
<a id="__codelineno-0-375" name="__codelineno-0-375"></a>
<a id="__codelineno-0-376" name="__codelineno-0-376"></a>    <span class="nd">@staticmethod</span>
<a id="__codelineno-0-377" name="__codelineno-0-377"></a>    <span class="k">def</span> <span class="nf">is_intercept_term</span><span class="p">(</span><span class="n">variable</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<a id="__codelineno-0-378" name="__codelineno-0-378"></a>        <span class="c1"># check if the given variable is an intercept (fixed effect) term.</span>
<a id="__codelineno-0-379" name="__codelineno-0-379"></a>        <span class="c1"># intercept (fixed effect) terms are defined as &#39;intercept[*]&#39; and looks like &#39;intercept[user]&#39;, &#39;intercept[item]&#39;, etc.</span>
<a id="__codelineno-0-380" name="__codelineno-0-380"></a>        <span class="k">return</span> <span class="p">(</span><span class="n">variable</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;intercept[&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">variable</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;]&#39;</span><span class="p">))</span>
<a id="__codelineno-0-381" name="__codelineno-0-381"></a>
<a id="__codelineno-0-382" name="__codelineno-0-382"></a>    <span class="k">def</span> <span class="nf">get_coefficient</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">variable</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">level</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">:</span>
<a id="__codelineno-0-383" name="__codelineno-0-383"></a>        <span class="sd">&quot;&quot;&quot;Retrieve the coefficient tensor for the given variable.</span>
<a id="__codelineno-0-384" name="__codelineno-0-384"></a>
<a id="__codelineno-0-385" name="__codelineno-0-385"></a><span class="sd">        Args:</span>
<a id="__codelineno-0-386" name="__codelineno-0-386"></a><span class="sd">            variable (str): the variable name.</span>
<a id="__codelineno-0-387" name="__codelineno-0-387"></a><span class="sd">            level (str): from which level of model to extract the coefficient, can be &#39;item&#39; or &#39;nest&#39;. The `level` argument will be discarded if `variable` is `lambda`.</span>
<a id="__codelineno-0-388" name="__codelineno-0-388"></a>
<a id="__codelineno-0-389" name="__codelineno-0-389"></a><span class="sd">        Returns:</span>
<a id="__codelineno-0-390" name="__codelineno-0-390"></a><span class="sd">            torch.Tensor: the corresponding coefficient tensor of the requested variable.</span>
<a id="__codelineno-0-391" name="__codelineno-0-391"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-392" name="__codelineno-0-392"></a>        <span class="k">if</span> <span class="n">variable</span> <span class="o">==</span> <span class="s1">&#39;lambda&#39;</span><span class="p">:</span>
<a id="__codelineno-0-393" name="__codelineno-0-393"></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">lambda_weight</span><span class="o">.</span><span class="n">detach</span><span class="p">()</span><span class="o">.</span><span class="n">clone</span><span class="p">()</span>
<a id="__codelineno-0-394" name="__codelineno-0-394"></a>
<a id="__codelineno-0-395" name="__codelineno-0-395"></a>        <span class="k">if</span> <span class="n">level</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;item&#39;</span><span class="p">,</span> <span class="s1">&#39;nest&#39;</span><span class="p">]:</span>
<a id="__codelineno-0-396" name="__codelineno-0-396"></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Level should be either &#39;item&#39; or &#39;nest&#39;, got </span><span class="si">{</span><span class="n">level</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span>
<a id="__codelineno-0-397" name="__codelineno-0-397"></a>
<a id="__codelineno-0-398" name="__codelineno-0-398"></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">state_dict</span><span class="p">()[</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">level</span><span class="si">}</span><span class="s1">_coef_dict.</span><span class="si">{</span><span class="n">variable</span><span class="si">}</span><span class="s1">.coef&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">detach</span><span class="p">()</span><span class="o">.</span><span class="n">clone</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
        </details>

  

  <div class="doc doc-children">







<div class="doc doc-object doc-attribute">



<h2 id="torch_choice.model.nested_logit_model.NestedLogitModel.device" class="doc doc-heading">
<code class="highlight language-python"><span class="n">device</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">device</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h2>


  <div class="doc doc-contents ">
  
      <p>Returns the device of the coefficient.</p>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code>torch.<span title="torch.device">device</span></code>
          </td>
          <td><p>torch.device: the device of the model.</p></td>
        </tr>
    </tbody>
  </table>
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h2 id="torch_choice.model.nested_logit_model.NestedLogitModel.num_params" class="doc doc-heading">
<code class="highlight language-python"><span class="n">num_params</span><span class="p">:</span> <span class="nb">int</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h2>


  <div class="doc doc-contents ">
  
      <p>Get the total number of parameters. For example, if there is only an user-specific coefficient to be multiplied
with the K-dimensional observable, then the total number of parameters would be K x number of users, assuming no
intercept is involved.</p>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
<th>Name</th>        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
<td><code>int</code></td>          <td>
                <code>int</code>
          </td>
          <td><p>the total number of learnable parameters.</p></td>
        </tr>
    </tbody>
  </table>
  </div>

</div>



<div class="doc doc-object doc-function">



<h2 id="torch_choice.model.nested_logit_model.NestedLogitModel.__init__" class="doc doc-heading">
<code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">nest_to_item</span><span class="p">,</span> <span class="n">nest_coef_variation_dict</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">nest_num_param_dict</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">item_coef_variation_dict</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">item_num_param_dict</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">item_formula</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">nest_formula</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">dataset</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">num_users</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">shared_lambda</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">regularization</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">regularization_weight</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Initialization method of the nested logit model.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>nest_to_item</code></td>
          <td>
                <code><span title="typing.Dict">Dict</span>[object, <span title="typing.List">List</span>[int]]</code>
          </td>
          <td><p>a dictionary maps a nest ID to a list
of items IDs of the queried nest.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>nest_coef_variation_dict</code></td>
          <td>
                <code><span title="typing.Dict">Dict</span>[str, str]</code>
          </td>
          <td><p>a dictionary maps a variable type
(i.e., variable group) to the level of variation for the coefficient of this type
of variables.</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>nest_num_param_dict</code></td>
          <td>
                <code><span title="typing.Dict">Dict</span>[str, int]</code>
          </td>
          <td><p>a dictionary maps a variable type name to
the number of parameters in this variable group.</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>item_coef_variation_dict</code></td>
          <td>
                <code><span title="typing.Dict">Dict</span>[str, str]</code>
          </td>
          <td><p>the same as nest_coef_variation_dict but
for item features.</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>item_num_param_dict</code></td>
          <td>
                <code><span title="typing.Dict">Dict</span>[str, int]</code>
          </td>
          <td><p>the same as nest_num_param_dict but for item
features.</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>{nest,</code></td>
          <td>
                <code>item}_formula (str</code>
          </td>
          <td><p>a string representing the utility formula for the {nest, item} level logit model.
The formula consists of '(variable_name|variation)'s separated by '+', for example:
"(var1|item) + (var2|user) + (var3|constant)"
where the first part of each term is the name of the variable
and the second part is the variation of the coefficient.
The variation can be one of the following:
'constant', 'item', 'item-full', 'user', 'user-item', 'user-item-full'.
All spaces in the formula will be ignored, hence please do not use spaces in variable/observable names.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>dataset</code></td>
          <td>
                <code><a class="autorefs autorefs-internal" title="torch_choice.data.joint_dataset.JointDataset" href="#torch_choice.data.JointDataset">JointDataset</a></code>
          </td>
          <td><p>a JointDataset object for training the model, the parser will infer dimensions of variables
and sizes of coefficients for the nest level model from dataset.datasets['nest']. The parser will infer dimensions of variables and sizes of coefficients for the item level model from dataset.datasets['item'].</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>num_users</code></td>
          <td>
                <code><span title="typing.Optional">Optional</span>[int]</code>
          </td>
          <td><p>number of users to be modelled, this is only
required if any of variable type requires user-specific variations.
Defaults to None.</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>shared_lambda</code></td>
          <td>
                <code>bool</code>
          </td>
          <td><p>a boolean indicating whether to enforce the elasticity lambda, which
is the coefficient for inclusive values, to be constant for all nests.
The lambda enters the nest-level selection as the following
Utility of choosing nest k = lambda * inclusive value of nest k
                               + linear combination of some other nest level features
If set to True, a single lambda will be learned for all nests, otherwise, the
model learns an individual lambda for each nest.
Defaults to False.</p></td>
          <td>
                <code>False</code>
          </td>
        </tr>
        <tr>
          <td><code>regularization</code></td>
          <td>
                <code><span title="typing.Optional">Optional</span>[str]</code>
          </td>
          <td><p>this argument takes values from {'L1', 'L2', None}, which specifies the type of
regularization added to the log-likelihood.
- 'L1' will subtract regularization_weight * 1-norm of parameters from the log-likelihood.
- 'L2' will subtract regularization_weight * 2-norm of parameters from the log-likelihood.
- None does not modify the log-likelihood.
Defaults to None.</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>regularization_weight</code></td>
          <td>
                <code><span title="typing.Optional">Optional</span>[float]</code>
          </td>
          <td><p>the weight of parameter norm subtracted from the log-likelihood.
This term controls the strength of regularization. This argument is required if and only if regularization
is not None.
Defaults to None.</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>torch_choice/model/nested_logit_model.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-20"> 20</a></span>
<span class="normal"><a href="#__codelineno-0-21"> 21</a></span>
<span class="normal"><a href="#__codelineno-0-22"> 22</a></span>
<span class="normal"><a href="#__codelineno-0-23"> 23</a></span>
<span class="normal"><a href="#__codelineno-0-24"> 24</a></span>
<span class="normal"><a href="#__codelineno-0-25"> 25</a></span>
<span class="normal"><a href="#__codelineno-0-26"> 26</a></span>
<span class="normal"><a href="#__codelineno-0-27"> 27</a></span>
<span class="normal"><a href="#__codelineno-0-28"> 28</a></span>
<span class="normal"><a href="#__codelineno-0-29"> 29</a></span>
<span class="normal"><a href="#__codelineno-0-30"> 30</a></span>
<span class="normal"><a href="#__codelineno-0-31"> 31</a></span>
<span class="normal"><a href="#__codelineno-0-32"> 32</a></span>
<span class="normal"><a href="#__codelineno-0-33"> 33</a></span>
<span class="normal"><a href="#__codelineno-0-34"> 34</a></span>
<span class="normal"><a href="#__codelineno-0-35"> 35</a></span>
<span class="normal"><a href="#__codelineno-0-36"> 36</a></span>
<span class="normal"><a href="#__codelineno-0-37"> 37</a></span>
<span class="normal"><a href="#__codelineno-0-38"> 38</a></span>
<span class="normal"><a href="#__codelineno-0-39"> 39</a></span>
<span class="normal"><a href="#__codelineno-0-40"> 40</a></span>
<span class="normal"><a href="#__codelineno-0-41"> 41</a></span>
<span class="normal"><a href="#__codelineno-0-42"> 42</a></span>
<span class="normal"><a href="#__codelineno-0-43"> 43</a></span>
<span class="normal"><a href="#__codelineno-0-44"> 44</a></span>
<span class="normal"><a href="#__codelineno-0-45"> 45</a></span>
<span class="normal"><a href="#__codelineno-0-46"> 46</a></span>
<span class="normal"><a href="#__codelineno-0-47"> 47</a></span>
<span class="normal"><a href="#__codelineno-0-48"> 48</a></span>
<span class="normal"><a href="#__codelineno-0-49"> 49</a></span>
<span class="normal"><a href="#__codelineno-0-50"> 50</a></span>
<span class="normal"><a href="#__codelineno-0-51"> 51</a></span>
<span class="normal"><a href="#__codelineno-0-52"> 52</a></span>
<span class="normal"><a href="#__codelineno-0-53"> 53</a></span>
<span class="normal"><a href="#__codelineno-0-54"> 54</a></span>
<span class="normal"><a href="#__codelineno-0-55"> 55</a></span>
<span class="normal"><a href="#__codelineno-0-56"> 56</a></span>
<span class="normal"><a href="#__codelineno-0-57"> 57</a></span>
<span class="normal"><a href="#__codelineno-0-58"> 58</a></span>
<span class="normal"><a href="#__codelineno-0-59"> 59</a></span>
<span class="normal"><a href="#__codelineno-0-60"> 60</a></span>
<span class="normal"><a href="#__codelineno-0-61"> 61</a></span>
<span class="normal"><a href="#__codelineno-0-62"> 62</a></span>
<span class="normal"><a href="#__codelineno-0-63"> 63</a></span>
<span class="normal"><a href="#__codelineno-0-64"> 64</a></span>
<span class="normal"><a href="#__codelineno-0-65"> 65</a></span>
<span class="normal"><a href="#__codelineno-0-66"> 66</a></span>
<span class="normal"><a href="#__codelineno-0-67"> 67</a></span>
<span class="normal"><a href="#__codelineno-0-68"> 68</a></span>
<span class="normal"><a href="#__codelineno-0-69"> 69</a></span>
<span class="normal"><a href="#__codelineno-0-70"> 70</a></span>
<span class="normal"><a href="#__codelineno-0-71"> 71</a></span>
<span class="normal"><a href="#__codelineno-0-72"> 72</a></span>
<span class="normal"><a href="#__codelineno-0-73"> 73</a></span>
<span class="normal"><a href="#__codelineno-0-74"> 74</a></span>
<span class="normal"><a href="#__codelineno-0-75"> 75</a></span>
<span class="normal"><a href="#__codelineno-0-76"> 76</a></span>
<span class="normal"><a href="#__codelineno-0-77"> 77</a></span>
<span class="normal"><a href="#__codelineno-0-78"> 78</a></span>
<span class="normal"><a href="#__codelineno-0-79"> 79</a></span>
<span class="normal"><a href="#__codelineno-0-80"> 80</a></span>
<span class="normal"><a href="#__codelineno-0-81"> 81</a></span>
<span class="normal"><a href="#__codelineno-0-82"> 82</a></span>
<span class="normal"><a href="#__codelineno-0-83"> 83</a></span>
<span class="normal"><a href="#__codelineno-0-84"> 84</a></span>
<span class="normal"><a href="#__codelineno-0-85"> 85</a></span>
<span class="normal"><a href="#__codelineno-0-86"> 86</a></span>
<span class="normal"><a href="#__codelineno-0-87"> 87</a></span>
<span class="normal"><a href="#__codelineno-0-88"> 88</a></span>
<span class="normal"><a href="#__codelineno-0-89"> 89</a></span>
<span class="normal"><a href="#__codelineno-0-90"> 90</a></span>
<span class="normal"><a href="#__codelineno-0-91"> 91</a></span>
<span class="normal"><a href="#__codelineno-0-92"> 92</a></span>
<span class="normal"><a href="#__codelineno-0-93"> 93</a></span>
<span class="normal"><a href="#__codelineno-0-94"> 94</a></span>
<span class="normal"><a href="#__codelineno-0-95"> 95</a></span>
<span class="normal"><a href="#__codelineno-0-96"> 96</a></span>
<span class="normal"><a href="#__codelineno-0-97"> 97</a></span>
<span class="normal"><a href="#__codelineno-0-98"> 98</a></span>
<span class="normal"><a href="#__codelineno-0-99"> 99</a></span>
<span class="normal"><a href="#__codelineno-0-100">100</a></span>
<span class="normal"><a href="#__codelineno-0-101">101</a></span>
<span class="normal"><a href="#__codelineno-0-102">102</a></span>
<span class="normal"><a href="#__codelineno-0-103">103</a></span>
<span class="normal"><a href="#__codelineno-0-104">104</a></span>
<span class="normal"><a href="#__codelineno-0-105">105</a></span>
<span class="normal"><a href="#__codelineno-0-106">106</a></span>
<span class="normal"><a href="#__codelineno-0-107">107</a></span>
<span class="normal"><a href="#__codelineno-0-108">108</a></span>
<span class="normal"><a href="#__codelineno-0-109">109</a></span>
<span class="normal"><a href="#__codelineno-0-110">110</a></span>
<span class="normal"><a href="#__codelineno-0-111">111</a></span>
<span class="normal"><a href="#__codelineno-0-112">112</a></span>
<span class="normal"><a href="#__codelineno-0-113">113</a></span>
<span class="normal"><a href="#__codelineno-0-114">114</a></span>
<span class="normal"><a href="#__codelineno-0-115">115</a></span>
<span class="normal"><a href="#__codelineno-0-116">116</a></span>
<span class="normal"><a href="#__codelineno-0-117">117</a></span>
<span class="normal"><a href="#__codelineno-0-118">118</a></span>
<span class="normal"><a href="#__codelineno-0-119">119</a></span>
<span class="normal"><a href="#__codelineno-0-120">120</a></span>
<span class="normal"><a href="#__codelineno-0-121">121</a></span>
<span class="normal"><a href="#__codelineno-0-122">122</a></span>
<span class="normal"><a href="#__codelineno-0-123">123</a></span>
<span class="normal"><a href="#__codelineno-0-124">124</a></span>
<span class="normal"><a href="#__codelineno-0-125">125</a></span>
<span class="normal"><a href="#__codelineno-0-126">126</a></span>
<span class="normal"><a href="#__codelineno-0-127">127</a></span>
<span class="normal"><a href="#__codelineno-0-128">128</a></span>
<span class="normal"><a href="#__codelineno-0-129">129</a></span>
<span class="normal"><a href="#__codelineno-0-130">130</a></span>
<span class="normal"><a href="#__codelineno-0-131">131</a></span>
<span class="normal"><a href="#__codelineno-0-132">132</a></span>
<span class="normal"><a href="#__codelineno-0-133">133</a></span>
<span class="normal"><a href="#__codelineno-0-134">134</a></span>
<span class="normal"><a href="#__codelineno-0-135">135</a></span>
<span class="normal"><a href="#__codelineno-0-136">136</a></span>
<span class="normal"><a href="#__codelineno-0-137">137</a></span>
<span class="normal"><a href="#__codelineno-0-138">138</a></span>
<span class="normal"><a href="#__codelineno-0-139">139</a></span>
<span class="normal"><a href="#__codelineno-0-140">140</a></span>
<span class="normal"><a href="#__codelineno-0-141">141</a></span>
<span class="normal"><a href="#__codelineno-0-142">142</a></span>
<span class="normal"><a href="#__codelineno-0-143">143</a></span>
<span class="normal"><a href="#__codelineno-0-144">144</a></span>
<span class="normal"><a href="#__codelineno-0-145">145</a></span>
<span class="normal"><a href="#__codelineno-0-146">146</a></span>
<span class="normal"><a href="#__codelineno-0-147">147</a></span>
<span class="normal"><a href="#__codelineno-0-148">148</a></span>
<span class="normal"><a href="#__codelineno-0-149">149</a></span>
<span class="normal"><a href="#__codelineno-0-150">150</a></span>
<span class="normal"><a href="#__codelineno-0-151">151</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-20" name="__codelineno-0-20"></a><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-21" name="__codelineno-0-21"></a>             <span class="n">nest_to_item</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">object</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">]],</span>
<a id="__codelineno-0-22" name="__codelineno-0-22"></a>             <span class="c1"># method 1: specify variation and num param. dictionary.</span>
<a id="__codelineno-0-23" name="__codelineno-0-23"></a>             <span class="n">nest_coef_variation_dict</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-24" name="__codelineno-0-24"></a>             <span class="n">nest_num_param_dict</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">]]</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-25" name="__codelineno-0-25"></a>             <span class="n">item_coef_variation_dict</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-26" name="__codelineno-0-26"></a>             <span class="n">item_num_param_dict</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">]]</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-27" name="__codelineno-0-27"></a>             <span class="c1"># method 2: specify formula and dataset.</span>
<a id="__codelineno-0-28" name="__codelineno-0-28"></a>             <span class="n">item_formula</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-29" name="__codelineno-0-29"></a>             <span class="n">nest_formula</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-30" name="__codelineno-0-30"></a>             <span class="n">dataset</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">JointDataset</span><span class="p">]</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-31" name="__codelineno-0-31"></a>             <span class="n">num_users</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-32" name="__codelineno-0-32"></a>             <span class="n">shared_lambda</span><span class="p">:</span> <span class="nb">bool</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-33" name="__codelineno-0-33"></a>             <span class="n">regularization</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-34" name="__codelineno-0-34"></a>             <span class="n">regularization_weight</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span><span class="o">=</span><span class="kc">None</span>
<a id="__codelineno-0-35" name="__codelineno-0-35"></a>             <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-36" name="__codelineno-0-36"></a>    <span class="sd">&quot;&quot;&quot;Initialization method of the nested logit model.</span>
<a id="__codelineno-0-37" name="__codelineno-0-37"></a>
<a id="__codelineno-0-38" name="__codelineno-0-38"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-39" name="__codelineno-0-39"></a><span class="sd">        nest_to_item (Dict[object, List[int]]): a dictionary maps a nest ID to a list</span>
<a id="__codelineno-0-40" name="__codelineno-0-40"></a><span class="sd">            of items IDs of the queried nest.</span>
<a id="__codelineno-0-41" name="__codelineno-0-41"></a>
<a id="__codelineno-0-42" name="__codelineno-0-42"></a><span class="sd">        nest_coef_variation_dict (Dict[str, str]): a dictionary maps a variable type</span>
<a id="__codelineno-0-43" name="__codelineno-0-43"></a><span class="sd">            (i.e., variable group) to the level of variation for the coefficient of this type</span>
<a id="__codelineno-0-44" name="__codelineno-0-44"></a><span class="sd">            of variables.</span>
<a id="__codelineno-0-45" name="__codelineno-0-45"></a><span class="sd">        nest_num_param_dict (Dict[str, int]): a dictionary maps a variable type name to</span>
<a id="__codelineno-0-46" name="__codelineno-0-46"></a><span class="sd">            the number of parameters in this variable group.</span>
<a id="__codelineno-0-47" name="__codelineno-0-47"></a>
<a id="__codelineno-0-48" name="__codelineno-0-48"></a><span class="sd">        item_coef_variation_dict (Dict[str, str]): the same as nest_coef_variation_dict but</span>
<a id="__codelineno-0-49" name="__codelineno-0-49"></a><span class="sd">            for item features.</span>
<a id="__codelineno-0-50" name="__codelineno-0-50"></a><span class="sd">        item_num_param_dict (Dict[str, int]): the same as nest_num_param_dict but for item</span>
<a id="__codelineno-0-51" name="__codelineno-0-51"></a><span class="sd">            features.</span>
<a id="__codelineno-0-52" name="__codelineno-0-52"></a>
<a id="__codelineno-0-53" name="__codelineno-0-53"></a><span class="sd">        {nest, item}_formula (str): a string representing the utility formula for the {nest, item} level logit model.</span>
<a id="__codelineno-0-54" name="__codelineno-0-54"></a><span class="sd">            The formula consists of &#39;(variable_name|variation)&#39;s separated by &#39;+&#39;, for example:</span>
<a id="__codelineno-0-55" name="__codelineno-0-55"></a><span class="sd">            &quot;(var1|item) + (var2|user) + (var3|constant)&quot;</span>
<a id="__codelineno-0-56" name="__codelineno-0-56"></a><span class="sd">            where the first part of each term is the name of the variable</span>
<a id="__codelineno-0-57" name="__codelineno-0-57"></a><span class="sd">            and the second part is the variation of the coefficient.</span>
<a id="__codelineno-0-58" name="__codelineno-0-58"></a><span class="sd">            The variation can be one of the following:</span>
<a id="__codelineno-0-59" name="__codelineno-0-59"></a><span class="sd">            &#39;constant&#39;, &#39;item&#39;, &#39;item-full&#39;, &#39;user&#39;, &#39;user-item&#39;, &#39;user-item-full&#39;.</span>
<a id="__codelineno-0-60" name="__codelineno-0-60"></a><span class="sd">            All spaces in the formula will be ignored, hence please do not use spaces in variable/observable names.</span>
<a id="__codelineno-0-61" name="__codelineno-0-61"></a><span class="sd">        dataset (JointDataset): a JointDataset object for training the model, the parser will infer dimensions of variables</span>
<a id="__codelineno-0-62" name="__codelineno-0-62"></a><span class="sd">            and sizes of coefficients for the nest level model from dataset.datasets[&#39;nest&#39;]. The parser will infer dimensions of variables and sizes of coefficients for the item level model from dataset.datasets[&#39;item&#39;].</span>
<a id="__codelineno-0-63" name="__codelineno-0-63"></a>
<a id="__codelineno-0-64" name="__codelineno-0-64"></a><span class="sd">        num_users (Optional[int], optional): number of users to be modelled, this is only</span>
<a id="__codelineno-0-65" name="__codelineno-0-65"></a><span class="sd">            required if any of variable type requires user-specific variations.</span>
<a id="__codelineno-0-66" name="__codelineno-0-66"></a><span class="sd">            Defaults to None.</span>
<a id="__codelineno-0-67" name="__codelineno-0-67"></a>
<a id="__codelineno-0-68" name="__codelineno-0-68"></a><span class="sd">        shared_lambda (bool): a boolean indicating whether to enforce the elasticity lambda, which</span>
<a id="__codelineno-0-69" name="__codelineno-0-69"></a><span class="sd">            is the coefficient for inclusive values, to be constant for all nests.</span>
<a id="__codelineno-0-70" name="__codelineno-0-70"></a><span class="sd">            The lambda enters the nest-level selection as the following</span>
<a id="__codelineno-0-71" name="__codelineno-0-71"></a><span class="sd">            Utility of choosing nest k = lambda * inclusive value of nest k</span>
<a id="__codelineno-0-72" name="__codelineno-0-72"></a><span class="sd">                                           + linear combination of some other nest level features</span>
<a id="__codelineno-0-73" name="__codelineno-0-73"></a><span class="sd">            If set to True, a single lambda will be learned for all nests, otherwise, the</span>
<a id="__codelineno-0-74" name="__codelineno-0-74"></a><span class="sd">            model learns an individual lambda for each nest.</span>
<a id="__codelineno-0-75" name="__codelineno-0-75"></a><span class="sd">            Defaults to False.</span>
<a id="__codelineno-0-76" name="__codelineno-0-76"></a>
<a id="__codelineno-0-77" name="__codelineno-0-77"></a><span class="sd">        regularization (Optional[str]): this argument takes values from {&#39;L1&#39;, &#39;L2&#39;, None}, which specifies the type of</span>
<a id="__codelineno-0-78" name="__codelineno-0-78"></a><span class="sd">            regularization added to the log-likelihood.</span>
<a id="__codelineno-0-79" name="__codelineno-0-79"></a><span class="sd">            - &#39;L1&#39; will subtract regularization_weight * 1-norm of parameters from the log-likelihood.</span>
<a id="__codelineno-0-80" name="__codelineno-0-80"></a><span class="sd">            - &#39;L2&#39; will subtract regularization_weight * 2-norm of parameters from the log-likelihood.</span>
<a id="__codelineno-0-81" name="__codelineno-0-81"></a><span class="sd">            - None does not modify the log-likelihood.</span>
<a id="__codelineno-0-82" name="__codelineno-0-82"></a><span class="sd">            Defaults to None.</span>
<a id="__codelineno-0-83" name="__codelineno-0-83"></a>
<a id="__codelineno-0-84" name="__codelineno-0-84"></a><span class="sd">        regularization_weight (Optional[float]): the weight of parameter norm subtracted from the log-likelihood.</span>
<a id="__codelineno-0-85" name="__codelineno-0-85"></a><span class="sd">            This term controls the strength of regularization. This argument is required if and only if regularization</span>
<a id="__codelineno-0-86" name="__codelineno-0-86"></a><span class="sd">            is not None.</span>
<a id="__codelineno-0-87" name="__codelineno-0-87"></a><span class="sd">            Defaults to None.</span>
<a id="__codelineno-0-88" name="__codelineno-0-88"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-89" name="__codelineno-0-89"></a>    <span class="c1"># handle nest level model.</span>
<a id="__codelineno-0-90" name="__codelineno-0-90"></a>    <span class="n">using_formula_to_initiate</span> <span class="o">=</span> <span class="p">(</span><span class="n">item_formula</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">nest_formula</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span>
<a id="__codelineno-0-91" name="__codelineno-0-91"></a>    <span class="k">if</span> <span class="n">using_formula_to_initiate</span><span class="p">:</span>
<a id="__codelineno-0-92" name="__codelineno-0-92"></a>        <span class="c1"># make sure that the research does not specify duplicated information, which might cause conflict.</span>
<a id="__codelineno-0-93" name="__codelineno-0-93"></a>        <span class="k">if</span> <span class="p">(</span><span class="n">nest_coef_variation_dict</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">item_coef_variation_dict</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">):</span>
<a id="__codelineno-0-94" name="__codelineno-0-94"></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;You specify the {item, nest}_formula to initiate the model, you should not specify the {item, nest}_coef_variation_dict at the same time.&#39;</span><span class="p">)</span>
<a id="__codelineno-0-95" name="__codelineno-0-95"></a>        <span class="k">if</span> <span class="p">(</span><span class="n">nest_num_param_dict</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">item_num_param_dict</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">):</span>
<a id="__codelineno-0-96" name="__codelineno-0-96"></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;You specify the {item, nest}_formula to initiate the model, you should not specify the {item, nest}_num_param_dict at the same time.&#39;</span><span class="p">)</span>
<a id="__codelineno-0-97" name="__codelineno-0-97"></a>        <span class="k">if</span> <span class="n">dataset</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-98" name="__codelineno-0-98"></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Dataset is required if {item, nest}_formula is specified to initiate the model.&#39;</span><span class="p">)</span>
<a id="__codelineno-0-99" name="__codelineno-0-99"></a>
<a id="__codelineno-0-100" name="__codelineno-0-100"></a>        <span class="n">nest_coef_variation_dict</span><span class="p">,</span> <span class="n">nest_num_param_dict</span> <span class="o">=</span> <span class="n">parse_formula</span><span class="p">(</span><span class="n">nest_formula</span><span class="p">,</span> <span class="n">dataset</span><span class="o">.</span><span class="n">datasets</span><span class="p">[</span><span class="s1">&#39;nest&#39;</span><span class="p">])</span>
<a id="__codelineno-0-101" name="__codelineno-0-101"></a>        <span class="n">item_coef_variation_dict</span><span class="p">,</span> <span class="n">item_num_param_dict</span> <span class="o">=</span> <span class="n">parse_formula</span><span class="p">(</span><span class="n">item_formula</span><span class="p">,</span> <span class="n">dataset</span><span class="o">.</span><span class="n">datasets</span><span class="p">[</span><span class="s1">&#39;item&#39;</span><span class="p">])</span>
<a id="__codelineno-0-102" name="__codelineno-0-102"></a>
<a id="__codelineno-0-103" name="__codelineno-0-103"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-104" name="__codelineno-0-104"></a>        <span class="c1"># check for conflicting information.</span>
<a id="__codelineno-0-105" name="__codelineno-0-105"></a>        <span class="k">if</span> <span class="p">(</span><span class="n">nest_formula</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">item_formula</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">):</span>
<a id="__codelineno-0-106" name="__codelineno-0-106"></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;You should not specify {item, nest}_formula and {item, nest}_coef_variation_dict at the same time.&#39;</span><span class="p">)</span>
<a id="__codelineno-0-107" name="__codelineno-0-107"></a>        <span class="c1"># make sure that the research specifies all the required information.</span>
<a id="__codelineno-0-108" name="__codelineno-0-108"></a>        <span class="k">if</span> <span class="p">(</span><span class="n">nest_coef_variation_dict</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">item_coef_variation_dict</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">):</span>
<a id="__codelineno-0-109" name="__codelineno-0-109"></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;You should specify the {item, nest}_coef_variation_dict to initiate the model.&#39;</span><span class="p">)</span>
<a id="__codelineno-0-110" name="__codelineno-0-110"></a>        <span class="k">if</span> <span class="p">(</span><span class="n">nest_num_param_dict</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">item_num_param_dict</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">):</span>
<a id="__codelineno-0-111" name="__codelineno-0-111"></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;You should specify the {item, nest}_num_param_dict to initiate the model.&#39;</span><span class="p">)</span>
<a id="__codelineno-0-112" name="__codelineno-0-112"></a>
<a id="__codelineno-0-113" name="__codelineno-0-113"></a>    <span class="nb">super</span><span class="p">(</span><span class="n">NestedLogitModel</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
<a id="__codelineno-0-114" name="__codelineno-0-114"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">nest_to_item</span> <span class="o">=</span> <span class="n">nest_to_item</span>
<a id="__codelineno-0-115" name="__codelineno-0-115"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">nest_coef_variation_dict</span> <span class="o">=</span> <span class="n">nest_coef_variation_dict</span>
<a id="__codelineno-0-116" name="__codelineno-0-116"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">nest_num_param_dict</span> <span class="o">=</span> <span class="n">nest_num_param_dict</span>
<a id="__codelineno-0-117" name="__codelineno-0-117"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">item_coef_variation_dict</span> <span class="o">=</span> <span class="n">item_coef_variation_dict</span>
<a id="__codelineno-0-118" name="__codelineno-0-118"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">item_num_param_dict</span> <span class="o">=</span> <span class="n">item_num_param_dict</span>
<a id="__codelineno-0-119" name="__codelineno-0-119"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">num_users</span> <span class="o">=</span> <span class="n">num_users</span>
<a id="__codelineno-0-120" name="__codelineno-0-120"></a>
<a id="__codelineno-0-121" name="__codelineno-0-121"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">nests</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">nest_to_item</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
<a id="__codelineno-0-122" name="__codelineno-0-122"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">num_nests</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nests</span><span class="p">)</span>
<a id="__codelineno-0-123" name="__codelineno-0-123"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">num_items</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">items</span><span class="p">)</span> <span class="k">for</span> <span class="n">items</span> <span class="ow">in</span> <span class="n">nest_to_item</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
<a id="__codelineno-0-124" name="__codelineno-0-124"></a>
<a id="__codelineno-0-125" name="__codelineno-0-125"></a>    <span class="c1"># nest coefficients.</span>
<a id="__codelineno-0-126" name="__codelineno-0-126"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">nest_coef_dict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_build_coef_dict</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nest_coef_variation_dict</span><span class="p">,</span>
<a id="__codelineno-0-127" name="__codelineno-0-127"></a>                                                <span class="bp">self</span><span class="o">.</span><span class="n">nest_num_param_dict</span><span class="p">,</span>
<a id="__codelineno-0-128" name="__codelineno-0-128"></a>                                                <span class="bp">self</span><span class="o">.</span><span class="n">num_nests</span><span class="p">)</span>
<a id="__codelineno-0-129" name="__codelineno-0-129"></a>
<a id="__codelineno-0-130" name="__codelineno-0-130"></a>    <span class="c1"># item coefficients.</span>
<a id="__codelineno-0-131" name="__codelineno-0-131"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">item_coef_dict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_build_coef_dict</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">item_coef_variation_dict</span><span class="p">,</span>
<a id="__codelineno-0-132" name="__codelineno-0-132"></a>                                                <span class="bp">self</span><span class="o">.</span><span class="n">item_num_param_dict</span><span class="p">,</span>
<a id="__codelineno-0-133" name="__codelineno-0-133"></a>                                                <span class="bp">self</span><span class="o">.</span><span class="n">num_items</span><span class="p">)</span>
<a id="__codelineno-0-134" name="__codelineno-0-134"></a>
<a id="__codelineno-0-135" name="__codelineno-0-135"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">shared_lambda</span> <span class="o">=</span> <span class="n">shared_lambda</span>
<a id="__codelineno-0-136" name="__codelineno-0-136"></a>    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">shared_lambda</span><span class="p">:</span>
<a id="__codelineno-0-137" name="__codelineno-0-137"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">lambda_weight</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Parameter</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="n">requires_grad</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<a id="__codelineno-0-138" name="__codelineno-0-138"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-139" name="__codelineno-0-139"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">lambda_weight</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Parameter</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">num_nests</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="n">requires_grad</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<a id="__codelineno-0-140" name="__codelineno-0-140"></a>    <span class="c1"># breakpoint()</span>
<a id="__codelineno-0-141" name="__codelineno-0-141"></a>    <span class="c1"># self.iv_weights = nn.Parameter(torch.ones(1), requires_grad=True)</span>
<a id="__codelineno-0-142" name="__codelineno-0-142"></a>    <span class="c1"># used to warn users if forgot to call clamp.</span>
<a id="__codelineno-0-143" name="__codelineno-0-143"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">_clamp_called_flag</span> <span class="o">=</span> <span class="kc">True</span>
<a id="__codelineno-0-144" name="__codelineno-0-144"></a>
<a id="__codelineno-0-145" name="__codelineno-0-145"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">regularization</span> <span class="o">=</span> <span class="n">regularization</span>
<a id="__codelineno-0-146" name="__codelineno-0-146"></a>    <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">regularization</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;L1&#39;</span><span class="p">,</span> <span class="s1">&#39;L2&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">],</span> <span class="sa">f</span><span class="s2">&quot;Provided regularization=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">regularization</span><span class="si">}</span><span class="s2"> is not allowed, allowed values are [&#39;L1&#39;, &#39;L2&#39;, None].&quot;</span>
<a id="__codelineno-0-147" name="__codelineno-0-147"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">regularization_weight</span> <span class="o">=</span> <span class="n">regularization_weight</span>
<a id="__codelineno-0-148" name="__codelineno-0-148"></a>    <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">regularization</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">regularization_weight</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">):</span>
<a id="__codelineno-0-149" name="__codelineno-0-149"></a>        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;You specified regularization type </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">regularization</span><span class="si">}</span><span class="s1"> without providing regularization_weight.&#39;</span><span class="p">)</span>
<a id="__codelineno-0-150" name="__codelineno-0-150"></a>    <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">regularization</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">regularization_weight</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">):</span>
<a id="__codelineno-0-151" name="__codelineno-0-151"></a>        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;You specified no regularization but you provide regularization_weight=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">regularization_weight</span><span class="si">}</span><span class="s1">, you should leave regularization_weight as None if you do not want to regularize the model.&#39;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h2 id="torch_choice.model.nested_logit_model.NestedLogitModel.forward" class="doc doc-heading">
<code class="highlight language-python"><span class="n">forward</span><span class="p">(</span><span class="n">batch</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>An standard forward method for the model, the user feeds a ChoiceDataset batch and the model returns the
    predicted log-likelihood tensor. The main forward passing happens in the _forward() method, but we provide
    this wrapper forward() method for a cleaner API, as forward() only requires a single batch argument.
    For more details about the forward passing, please refer to the _forward() method.</p>
<h3 id="torch_choice.model.nested_logit_model.NestedLogitModel.forward--todo-the-conditionalogitmodel-returns-predicted-utility-the-nestedlogitmodel-behaves-the-same">TODO: the ConditionaLogitModel returns predicted utility, the NestedLogitModel behaves the same?</h3>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>batch</code></td>
          <td>
                <code><a class="autorefs autorefs-internal" title="torch_choice.data.choice_dataset.ChoiceDataset" href="#torch_choice.data.ChoiceDataset">ChoiceDataset</a></code>
          </td>
          <td><p>a ChoiceDataset object containing the data batch.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code>torch.<span title="torch.Tensor">Tensor</span></code>
          </td>
          <td><p>torch.Tensor: a tensor of shape (num_trips, num_items) including the log probability</p></td>
        </tr>
        <tr>
          <td>
                <code>torch.<span title="torch.Tensor">Tensor</span></code>
          </td>
          <td><p>of choosing item i in trip t.</p></td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>torch_choice/model/nested_logit_model.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-194">194</a></span>
<span class="normal"><a href="#__codelineno-0-195">195</a></span>
<span class="normal"><a href="#__codelineno-0-196">196</a></span>
<span class="normal"><a href="#__codelineno-0-197">197</a></span>
<span class="normal"><a href="#__codelineno-0-198">198</a></span>
<span class="normal"><a href="#__codelineno-0-199">199</a></span>
<span class="normal"><a href="#__codelineno-0-200">200</a></span>
<span class="normal"><a href="#__codelineno-0-201">201</a></span>
<span class="normal"><a href="#__codelineno-0-202">202</a></span>
<span class="normal"><a href="#__codelineno-0-203">203</a></span>
<span class="normal"><a href="#__codelineno-0-204">204</a></span>
<span class="normal"><a href="#__codelineno-0-205">205</a></span>
<span class="normal"><a href="#__codelineno-0-206">206</a></span>
<span class="normal"><a href="#__codelineno-0-207">207</a></span>
<span class="normal"><a href="#__codelineno-0-208">208</a></span>
<span class="normal"><a href="#__codelineno-0-209">209</a></span>
<span class="normal"><a href="#__codelineno-0-210">210</a></span>
<span class="normal"><a href="#__codelineno-0-211">211</a></span>
<span class="normal"><a href="#__codelineno-0-212">212</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-194" name="__codelineno-0-194"></a><span class="k">def</span> <span class="nf">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">batch</span><span class="p">:</span> <span class="n">ChoiceDataset</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">:</span>
<a id="__codelineno-0-195" name="__codelineno-0-195"></a>    <span class="sd">&quot;&quot;&quot;An standard forward method for the model, the user feeds a ChoiceDataset batch and the model returns the</span>
<a id="__codelineno-0-196" name="__codelineno-0-196"></a><span class="sd">        predicted log-likelihood tensor. The main forward passing happens in the _forward() method, but we provide</span>
<a id="__codelineno-0-197" name="__codelineno-0-197"></a><span class="sd">        this wrapper forward() method for a cleaner API, as forward() only requires a single batch argument.</span>
<a id="__codelineno-0-198" name="__codelineno-0-198"></a><span class="sd">        For more details about the forward passing, please refer to the _forward() method.</span>
<a id="__codelineno-0-199" name="__codelineno-0-199"></a>
<a id="__codelineno-0-200" name="__codelineno-0-200"></a><span class="sd">    # TODO: the ConditionaLogitModel returns predicted utility, the NestedLogitModel behaves the same?</span>
<a id="__codelineno-0-201" name="__codelineno-0-201"></a>
<a id="__codelineno-0-202" name="__codelineno-0-202"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-203" name="__codelineno-0-203"></a><span class="sd">        batch (ChoiceDataset): a ChoiceDataset object containing the data batch.</span>
<a id="__codelineno-0-204" name="__codelineno-0-204"></a>
<a id="__codelineno-0-205" name="__codelineno-0-205"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-206" name="__codelineno-0-206"></a><span class="sd">        torch.Tensor: a tensor of shape (num_trips, num_items) including the log probability</span>
<a id="__codelineno-0-207" name="__codelineno-0-207"></a><span class="sd">        of choosing item i in trip t.</span>
<a id="__codelineno-0-208" name="__codelineno-0-208"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-209" name="__codelineno-0-209"></a>    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_forward</span><span class="p">(</span><span class="n">batch</span><span class="p">[</span><span class="s1">&#39;nest&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">x_dict</span><span class="p">,</span>
<a id="__codelineno-0-210" name="__codelineno-0-210"></a>                         <span class="n">batch</span><span class="p">[</span><span class="s1">&#39;item&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">x_dict</span><span class="p">,</span>
<a id="__codelineno-0-211" name="__codelineno-0-211"></a>                         <span class="n">batch</span><span class="p">[</span><span class="s1">&#39;item&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">user_index</span><span class="p">,</span>
<a id="__codelineno-0-212" name="__codelineno-0-212"></a>                         <span class="n">batch</span><span class="p">[</span><span class="s1">&#39;item&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">item_availability</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h2 id="torch_choice.model.nested_logit_model.NestedLogitModel.get_coefficient" class="doc doc-heading">
<code class="highlight language-python"><span class="n">get_coefficient</span><span class="p">(</span><span class="n">variable</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Retrieve the coefficient tensor for the given variable.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>variable</code></td>
          <td>
                <code>str</code>
          </td>
          <td><p>the variable name.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>level</code></td>
          <td>
                <code>str</code>
          </td>
          <td><p>from which level of model to extract the coefficient, can be 'item' or 'nest'. The <code>level</code> argument will be discarded if <code>variable</code> is <code>lambda</code>.</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code>torch.<span title="torch.Tensor">Tensor</span></code>
          </td>
          <td><p>torch.Tensor: the corresponding coefficient tensor of the requested variable.</p></td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>torch_choice/model/nested_logit_model.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-382">382</a></span>
<span class="normal"><a href="#__codelineno-0-383">383</a></span>
<span class="normal"><a href="#__codelineno-0-384">384</a></span>
<span class="normal"><a href="#__codelineno-0-385">385</a></span>
<span class="normal"><a href="#__codelineno-0-386">386</a></span>
<span class="normal"><a href="#__codelineno-0-387">387</a></span>
<span class="normal"><a href="#__codelineno-0-388">388</a></span>
<span class="normal"><a href="#__codelineno-0-389">389</a></span>
<span class="normal"><a href="#__codelineno-0-390">390</a></span>
<span class="normal"><a href="#__codelineno-0-391">391</a></span>
<span class="normal"><a href="#__codelineno-0-392">392</a></span>
<span class="normal"><a href="#__codelineno-0-393">393</a></span>
<span class="normal"><a href="#__codelineno-0-394">394</a></span>
<span class="normal"><a href="#__codelineno-0-395">395</a></span>
<span class="normal"><a href="#__codelineno-0-396">396</a></span>
<span class="normal"><a href="#__codelineno-0-397">397</a></span>
<span class="normal"><a href="#__codelineno-0-398">398</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-382" name="__codelineno-0-382"></a><span class="k">def</span> <span class="nf">get_coefficient</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">variable</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">level</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">:</span>
<a id="__codelineno-0-383" name="__codelineno-0-383"></a>    <span class="sd">&quot;&quot;&quot;Retrieve the coefficient tensor for the given variable.</span>
<a id="__codelineno-0-384" name="__codelineno-0-384"></a>
<a id="__codelineno-0-385" name="__codelineno-0-385"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-386" name="__codelineno-0-386"></a><span class="sd">        variable (str): the variable name.</span>
<a id="__codelineno-0-387" name="__codelineno-0-387"></a><span class="sd">        level (str): from which level of model to extract the coefficient, can be &#39;item&#39; or &#39;nest&#39;. The `level` argument will be discarded if `variable` is `lambda`.</span>
<a id="__codelineno-0-388" name="__codelineno-0-388"></a>
<a id="__codelineno-0-389" name="__codelineno-0-389"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-390" name="__codelineno-0-390"></a><span class="sd">        torch.Tensor: the corresponding coefficient tensor of the requested variable.</span>
<a id="__codelineno-0-391" name="__codelineno-0-391"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-392" name="__codelineno-0-392"></a>    <span class="k">if</span> <span class="n">variable</span> <span class="o">==</span> <span class="s1">&#39;lambda&#39;</span><span class="p">:</span>
<a id="__codelineno-0-393" name="__codelineno-0-393"></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">lambda_weight</span><span class="o">.</span><span class="n">detach</span><span class="p">()</span><span class="o">.</span><span class="n">clone</span><span class="p">()</span>
<a id="__codelineno-0-394" name="__codelineno-0-394"></a>
<a id="__codelineno-0-395" name="__codelineno-0-395"></a>    <span class="k">if</span> <span class="n">level</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;item&#39;</span><span class="p">,</span> <span class="s1">&#39;nest&#39;</span><span class="p">]:</span>
<a id="__codelineno-0-396" name="__codelineno-0-396"></a>        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Level should be either &#39;item&#39; or &#39;nest&#39;, got </span><span class="si">{</span><span class="n">level</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span>
<a id="__codelineno-0-397" name="__codelineno-0-397"></a>
<a id="__codelineno-0-398" name="__codelineno-0-398"></a>    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">state_dict</span><span class="p">()[</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">level</span><span class="si">}</span><span class="s1">_coef_dict.</span><span class="si">{</span><span class="n">variable</span><span class="si">}</span><span class="s1">.coef&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">detach</span><span class="p">()</span><span class="o">.</span><span class="n">clone</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h2 id="torch_choice.model.nested_logit_model.NestedLogitModel.log_likelihood" class="doc doc-heading">
<code class="highlight language-python"><span class="n">log_likelihood</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Computes the log likelihood of the model, please refer to the negative_log_likelihood() method.</p>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
<th>Name</th>        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
<td><code>_type_</code></td>          <td>
          </td>
          <td><p>the log likelihood of the model.</p></td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>torch_choice/model/nested_logit_model.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-319">319</a></span>
<span class="normal"><a href="#__codelineno-0-320">320</a></span>
<span class="normal"><a href="#__codelineno-0-321">321</a></span>
<span class="normal"><a href="#__codelineno-0-322">322</a></span>
<span class="normal"><a href="#__codelineno-0-323">323</a></span>
<span class="normal"><a href="#__codelineno-0-324">324</a></span>
<span class="normal"><a href="#__codelineno-0-325">325</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-319" name="__codelineno-0-319"></a><span class="k">def</span> <span class="nf">log_likelihood</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
<a id="__codelineno-0-320" name="__codelineno-0-320"></a>    <span class="sd">&quot;&quot;&quot;Computes the log likelihood of the model, please refer to the negative_log_likelihood() method.</span>
<a id="__codelineno-0-321" name="__codelineno-0-321"></a>
<a id="__codelineno-0-322" name="__codelineno-0-322"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-323" name="__codelineno-0-323"></a><span class="sd">        _type_: the log likelihood of the model.</span>
<a id="__codelineno-0-324" name="__codelineno-0-324"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-325" name="__codelineno-0-325"></a>    <span class="k">return</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">negative_log_likelihood</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h2 id="torch_choice.model.nested_logit_model.NestedLogitModel.loss" class="doc doc-heading">
<code class="highlight language-python"><span class="n">loss</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>The loss function to be optimized. This is a wrapper of <code>negative_log_likelihood</code> + regularization loss if required.</p>

      <details class="quote">
        <summary>Source code in <code>torch_choice/model/nested_logit_model.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-355">355</a></span>
<span class="normal"><a href="#__codelineno-0-356">356</a></span>
<span class="normal"><a href="#__codelineno-0-357">357</a></span>
<span class="normal"><a href="#__codelineno-0-358">358</a></span>
<span class="normal"><a href="#__codelineno-0-359">359</a></span>
<span class="normal"><a href="#__codelineno-0-360">360</a></span>
<span class="normal"><a href="#__codelineno-0-361">361</a></span>
<span class="normal"><a href="#__codelineno-0-362">362</a></span>
<span class="normal"><a href="#__codelineno-0-363">363</a></span>
<span class="normal"><a href="#__codelineno-0-364">364</a></span>
<span class="normal"><a href="#__codelineno-0-365">365</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-355" name="__codelineno-0-355"></a><span class="k">def</span> <span class="nf">loss</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<a id="__codelineno-0-356" name="__codelineno-0-356"></a>    <span class="sd">&quot;&quot;&quot;The loss function to be optimized. This is a wrapper of `negative_log_likelihood` + regularization loss if required.&quot;&quot;&quot;</span>
<a id="__codelineno-0-357" name="__codelineno-0-357"></a>    <span class="n">nll</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">negative_log_likelihood</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
<a id="__codelineno-0-358" name="__codelineno-0-358"></a>    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">regularization</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-359" name="__codelineno-0-359"></a>        <span class="n">L</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;L1&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;L2&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">}[</span><span class="bp">self</span><span class="o">.</span><span class="n">regularization</span><span class="p">]</span>
<a id="__codelineno-0-360" name="__codelineno-0-360"></a>        <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">param</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">named_parameters</span><span class="p">():</span>
<a id="__codelineno-0-361" name="__codelineno-0-361"></a>            <span class="k">if</span> <span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;lambda_weight&#39;</span><span class="p">:</span>
<a id="__codelineno-0-362" name="__codelineno-0-362"></a>                <span class="c1"># we don&#39;t regularize the lambda term, we only regularize coefficients.</span>
<a id="__codelineno-0-363" name="__codelineno-0-363"></a>                <span class="k">continue</span>
<a id="__codelineno-0-364" name="__codelineno-0-364"></a>            <span class="n">nll</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">regularization_weight</span> <span class="o">*</span> <span class="n">torch</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">param</span><span class="p">,</span> <span class="n">p</span><span class="o">=</span><span class="n">L</span><span class="p">)</span>
<a id="__codelineno-0-365" name="__codelineno-0-365"></a>    <span class="k">return</span> <span class="n">nll</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h2 id="torch_choice.model.nested_logit_model.NestedLogitModel.negative_log_likelihood" class="doc doc-heading">
<code class="highlight language-python"><span class="n">negative_log_likelihood</span><span class="p">(</span><span class="n">batch</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">is_train</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Computes the negative log likelihood of the model. Please note the log-likelihood is summed over all samples
    in batch instead of the average.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>batch</code></td>
          <td>
                <code><a class="autorefs autorefs-internal" title="torch_choice.data.choice_dataset.ChoiceDataset" href="#torch_choice.data.ChoiceDataset">ChoiceDataset</a></code>
          </td>
          <td><p>the ChoiceDataset object containing the data.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>y</code></td>
          <td>
                <code>torch.<span title="torch.LongTensor">LongTensor</span></code>
          </td>
          <td><p>the label.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>is_train</code></td>
          <td>
                <code>bool</code>
          </td>
          <td><p>which mode of the model to be used for the forward passing, if we need Hessian
of the NLL through auto-grad, <code>is_train</code> should be set to True. If we merely need a performance metric,
then <code>is_train</code> can be set to False for better performance.
Defaults to True.</p></td>
          <td>
                <code>True</code>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code>torch.<span title="torch.scalar_tensor">scalar_tensor</span></code>
          </td>
          <td><p>torch.scalar_tensor: the negative log likelihood of the model.</p></td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>torch_choice/model/nested_logit_model.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-327">327</a></span>
<span class="normal"><a href="#__codelineno-0-328">328</a></span>
<span class="normal"><a href="#__codelineno-0-329">329</a></span>
<span class="normal"><a href="#__codelineno-0-330">330</a></span>
<span class="normal"><a href="#__codelineno-0-331">331</a></span>
<span class="normal"><a href="#__codelineno-0-332">332</a></span>
<span class="normal"><a href="#__codelineno-0-333">333</a></span>
<span class="normal"><a href="#__codelineno-0-334">334</a></span>
<span class="normal"><a href="#__codelineno-0-335">335</a></span>
<span class="normal"><a href="#__codelineno-0-336">336</a></span>
<span class="normal"><a href="#__codelineno-0-337">337</a></span>
<span class="normal"><a href="#__codelineno-0-338">338</a></span>
<span class="normal"><a href="#__codelineno-0-339">339</a></span>
<span class="normal"><a href="#__codelineno-0-340">340</a></span>
<span class="normal"><a href="#__codelineno-0-341">341</a></span>
<span class="normal"><a href="#__codelineno-0-342">342</a></span>
<span class="normal"><a href="#__codelineno-0-343">343</a></span>
<span class="normal"><a href="#__codelineno-0-344">344</a></span>
<span class="normal"><a href="#__codelineno-0-345">345</a></span>
<span class="normal"><a href="#__codelineno-0-346">346</a></span>
<span class="normal"><a href="#__codelineno-0-347">347</a></span>
<span class="normal"><a href="#__codelineno-0-348">348</a></span>
<span class="normal"><a href="#__codelineno-0-349">349</a></span>
<span class="normal"><a href="#__codelineno-0-350">350</a></span>
<span class="normal"><a href="#__codelineno-0-351">351</a></span>
<span class="normal"><a href="#__codelineno-0-352">352</a></span>
<span class="normal"><a href="#__codelineno-0-353">353</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-327" name="__codelineno-0-327"></a><span class="k">def</span> <span class="nf">negative_log_likelihood</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-328" name="__codelineno-0-328"></a>                            <span class="n">batch</span><span class="p">:</span> <span class="n">ChoiceDataset</span><span class="p">,</span>
<a id="__codelineno-0-329" name="__codelineno-0-329"></a>                            <span class="n">y</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">LongTensor</span><span class="p">,</span>
<a id="__codelineno-0-330" name="__codelineno-0-330"></a>                            <span class="n">is_train</span><span class="p">:</span> <span class="nb">bool</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">torch</span><span class="o">.</span><span class="n">scalar_tensor</span><span class="p">:</span>
<a id="__codelineno-0-331" name="__codelineno-0-331"></a>    <span class="sd">&quot;&quot;&quot;Computes the negative log likelihood of the model. Please note the log-likelihood is summed over all samples</span>
<a id="__codelineno-0-332" name="__codelineno-0-332"></a><span class="sd">        in batch instead of the average.</span>
<a id="__codelineno-0-333" name="__codelineno-0-333"></a>
<a id="__codelineno-0-334" name="__codelineno-0-334"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-335" name="__codelineno-0-335"></a><span class="sd">        batch (ChoiceDataset): the ChoiceDataset object containing the data.</span>
<a id="__codelineno-0-336" name="__codelineno-0-336"></a><span class="sd">        y (torch.LongTensor): the label.</span>
<a id="__codelineno-0-337" name="__codelineno-0-337"></a><span class="sd">        is_train (bool, optional): which mode of the model to be used for the forward passing, if we need Hessian</span>
<a id="__codelineno-0-338" name="__codelineno-0-338"></a><span class="sd">            of the NLL through auto-grad, `is_train` should be set to True. If we merely need a performance metric,</span>
<a id="__codelineno-0-339" name="__codelineno-0-339"></a><span class="sd">            then `is_train` can be set to False for better performance.</span>
<a id="__codelineno-0-340" name="__codelineno-0-340"></a><span class="sd">            Defaults to True.</span>
<a id="__codelineno-0-341" name="__codelineno-0-341"></a>
<a id="__codelineno-0-342" name="__codelineno-0-342"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-343" name="__codelineno-0-343"></a><span class="sd">        torch.scalar_tensor: the negative log likelihood of the model.</span>
<a id="__codelineno-0-344" name="__codelineno-0-344"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-345" name="__codelineno-0-345"></a>    <span class="c1"># compute the negative log-likelihood loss directly.</span>
<a id="__codelineno-0-346" name="__codelineno-0-346"></a>    <span class="k">if</span> <span class="n">is_train</span><span class="p">:</span>
<a id="__codelineno-0-347" name="__codelineno-0-347"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">train</span><span class="p">()</span>
<a id="__codelineno-0-348" name="__codelineno-0-348"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-349" name="__codelineno-0-349"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">eval</span><span class="p">()</span>
<a id="__codelineno-0-350" name="__codelineno-0-350"></a>    <span class="c1"># (num_trips, num_items)</span>
<a id="__codelineno-0-351" name="__codelineno-0-351"></a>    <span class="n">logP</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">forward</span><span class="p">(</span><span class="n">batch</span><span class="p">)</span>
<a id="__codelineno-0-352" name="__codelineno-0-352"></a>    <span class="n">nll</span> <span class="o">=</span> <span class="o">-</span> <span class="n">logP</span><span class="p">[</span><span class="n">torch</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">y</span><span class="p">)),</span> <span class="n">y</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
<a id="__codelineno-0-353" name="__codelineno-0-353"></a>    <span class="k">return</span> <span class="n">nll</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>



  </div>

  </div>

</div>

              
            </article>
          </div>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
    <nav class="md-footer__inner md-grid" aria-label="Footer">
      
        
        <a href="../test/" class="md-footer__link md-footer__link--prev" aria-label="Previous: Compatibility Tests" rel="prev">
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
          </div>
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Previous
              </span>
              Compatibility Tests
            </div>
          </div>
        </a>
      
      
    </nav>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    <script id="__config" type="application/json">{"base": "..", "features": [], "search": "../assets/javascripts/workers/search.2a1c317c.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version.title": "Select version"}}</script>
    
    
      <script src="../assets/javascripts/bundle.ed9748b7.min.js"></script>
      
        <script src="../javascripts/mathjax.js"></script>
      
        <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
      
        <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
      
    
  </body>
</html>