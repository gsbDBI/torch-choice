
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <link rel="canonical" href="https://gsbdbi.github.io/torch-choice/easy_data_management/">
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.3.0, mkdocs-material-8.2.13">
    
    
      
        <title>Easy Data Management and Stata Users - Torch Choice</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.e411adfe.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.cc9b2e1e.min.css">
        
      
    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../assets/_mkdocstrings.css">
    
    <script>__md_scope=new URL("..",location),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="" data-md-color-primary="none" data-md-color-accent="none">
  
    
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#easy-data-wrapper-tutorial" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="Torch Choice" class="md-header__button md-logo" aria-label="Torch Choice" data-md-component="logo">
      
  
  <?xml version="1.0" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 20010904//EN"
 "http://www.w3.org/TR/2001/REC-SVG-20010904/DTD/svg10.dtd">
<svg version="1.0" xmlns="http://www.w3.org/2000/svg"
 width="500.000000pt" height="500.000000pt" viewBox="0 0 500.000000 500.000000"
 preserveAspectRatio="xMidYMid meet">

<g transform="translate(0.000000,500.000000) scale(0.100000,-0.100000)"
fill="#000000" stroke="none">
<path d="M3039 4192 c-24 -15 -53 -32 -64 -38 -16 -9 -19 -19 -15 -55 2 -24 4
-60 4 -79 l1 -35 -83 -3 c-81 -3 -83 -3 -102 -35 -23 -38 -35 -87 -23 -96 4
-3 30 -32 56 -63 47 -55 48 -57 28 -70 -12 -7 -21 -20 -21 -28 0 -8 -18 -28
-40 -43 -45 -32 -47 -43 -21 -106 22 -53 34 -59 127 -60 86 -1 87 -4 78 -105
l-6 -71 62 -33 c35 -17 69 -32 77 -32 8 0 38 23 67 50 66 62 92 65 150 13 22
-20 43 -40 44 -45 2 -4 -38 -8 -88 -8 -106 0 -151 -19 -174 -73 -7 -18 -25
-38 -39 -46 -23 -12 -34 -11 -93 5 -78 22 -87 37 -82 129 l3 60 -42 3 c-41 3
-42 4 -58 55 -24 74 -91 196 -120 219 -28 22 -32 50 -10 68 31 26 18 64 -37
111 -58 49 -122 89 -142 89 -7 0 -28 -10 -47 -23 l-34 -23 -65 22 c-63 20 -65
22 -68 57 -2 19 -10 41 -18 48 -9 8 -57 14 -122 17 -119 5 -137 -3 -144 -63
-3 -26 -9 -31 -66 -47 l-62 -19 -27 26 c-38 35 -74 32 -147 -12 -94 -56 -96
-59 -96 -122 -1 -74 -15 -93 -72 -90 -54 3 -59 0 -106 -64 -46 -62 -52 -76
-61 -144 -7 -51 -7 -52 26 -70 18 -9 33 -19 33 -21 0 -2 -9 -35 -21 -73 -18
-60 -26 -71 -53 -83 -55 -23 -61 -37 -46 -119 24 -133 24 -144 0 -174 -74 -93
-173 -235 -200 -284 -25 -47 -30 -68 -30 -122 0 -59 3 -69 27 -92 16 -15 45
-35 66 -46 21 -11 40 -28 43 -37 3 -9 12 -31 21 -49 13 -27 14 -37 3 -62 -15
-38 -6 -67 24 -75 23 -6 24 -10 28 -118 4 -138 25 -191 97 -243 66 -49 144
-65 306 -65 l135 0 0 -126 c0 -119 -1 -125 -19 -119 -21 6 -19 14 -97 -355
-47 -221 -52 -277 -28 -287 16 -6 97 1 319 27 220 26 482 49 513 45 21 -2 91
-9 157 -15 66 -6 201 -21 300 -33 202 -23 231 -25 247 -9 8 8 3 55 -21 174
-18 90 -39 197 -47 238 -8 41 -22 105 -30 143 -15 64 -18 67 -45 67 l-29 0 0
134 c0 127 1 134 23 149 12 8 42 33 66 56 34 31 50 39 68 35 13 -4 30 -1 38 6
11 9 32 11 69 6 30 -3 74 -3 98 0 39 5 46 11 60 43 38 86 104 116 161 71 14
-11 28 -20 32 -20 21 0 225 190 225 210 0 6 -9 29 -21 51 -14 28 -18 50 -14
70 7 32 50 89 67 89 5 0 23 9 39 21 l29 20 0 137 c0 153 -8 181 -55 197 -45
15 -54 23 -70 63 -14 33 -14 40 7 100 l23 63 -100 95 c-55 52 -111 98 -124
101 -14 3 -35 -1 -51 -11 -16 -9 -42 -16 -59 -16 -26 0 -36 9 -71 59 -22 33
-40 64 -40 70 0 5 20 17 45 26 72 28 81 44 66 116 -16 80 -8 89 75 89 56 0 68
4 95 28 23 21 32 39 36 72 5 44 4 46 -46 88 -28 24 -51 52 -51 62 0 11 23 42
50 69 56 56 63 85 30 138 -23 38 -66 52 -137 46 -30 -3 -53 -1 -57 5 -4 6 -1
42 5 79 13 75 20 64 -71 123 -25 16 -53 30 -64 30 -10 0 -40 -22 -66 -50 -39
-41 -54 -50 -83 -50 -28 0 -43 9 -83 50 -27 28 -56 50 -65 50 -8 0 -35 -12
-60 -28z m83 -129 c38 -37 40 -38 121 -39 l82 -1 37 39 c54 56 68 51 68 -22 0
-109 37 -147 146 -152 l69 -3 -52 -49 c-51 -48 -53 -52 -53 -103 0 -56 5 -64
70 -115 19 -15 32 -29 29 -32 -3 -3 -36 -8 -72 -11 -76 -5 -97 -16 -122 -58
-14 -24 -16 -43 -11 -97 8 -86 -5 -93 -58 -33 l-38 43 -92 0 -92 0 -39 -40
c-21 -22 -45 -40 -52 -40 -16 0 -17 32 -3 80 9 31 6 40 -24 86 l-35 52 -70 4
c-38 2 -74 7 -78 12 -8 7 16 30 71 69 23 16 26 25 26 77 0 58 -1 59 -50 102
-27 24 -50 46 -50 51 0 4 29 7 64 7 83 0 91 4 128 57 28 42 30 48 19 83 -24
81 -1 93 61 33z m-957 -243 c12 -37 33 -51 105 -71 25 -7 71 -26 104 -43 55
-29 59 -30 70 -13 30 49 29 49 66 19 34 -29 34 -29 17 -55 -23 -35 -22 -40 16
-78 46 -47 101 -144 133 -236 32 -93 50 -116 80 -109 17 5 23 0 28 -17 12 -45
7 -56 -33 -68 -38 -11 -39 -12 -59 -96 -29 -115 -89 -236 -151 -303 -28 -30
-51 -57 -51 -60 0 -4 7 -15 15 -26 21 -27 19 -39 -10 -58 -24 -16 -27 -15 -54
5 l-30 22 -48 -20 c-47 -20 -85 -30 -191 -54 -58 -12 -82 -36 -82 -82 0 -27
-2 -28 -42 -25 -43 3 -43 3 -46 44 -4 52 -20 66 -102 88 -36 10 -88 31 -116
47 -61 34 -71 35 -99 9 l-21 -20 -24 25 c-20 21 -21 28 -11 53 14 34 4 67 -29
97 -24 21 -74 124 -85 173 -9 43 -38 66 -74 59 -25 -5 -31 -2 -42 24 -13 33
-3 49 32 49 28 0 37 22 53 125 8 55 21 115 29 134 19 44 12 67 -24 80 -33 12
-36 26 -10 60 17 22 21 23 51 12 37 -13 34 -14 127 76 50 49 53 55 53 102 0
46 3 52 30 66 29 15 31 15 39 -8 13 -32 37 -40 71 -23 16 7 70 24 121 37 90
22 92 23 107 61 14 35 19 39 45 36 25 -2 33 -10 42 -38z m1193 -739 c23 -55
63 -83 140 -96 33 -5 52 -2 88 15 l46 23 46 -46 45 -45 -26 -32 c-31 -37 -32
-46 -11 -97 61 -144 74 -165 114 -181 l40 -17 0 -66 c0 -62 -2 -67 -23 -73
-49 -12 -105 -96 -138 -204 -11 -38 -10 -43 15 -73 l27 -32 -47 -48 -47 -48
-38 25 c-46 29 -90 30 -144 5 -47 -22 -79 -55 -92 -96 -9 -29 -13 -30 -71 -33
l-61 -3 -10 39 c-13 48 -34 68 -100 93 -64 24 -89 24 -121 -1 -34 -27 -45 -25
-101 15 l-48 36 25 37 c33 47 28 76 -28 190 -38 76 -47 88 -73 92 -27 5 -30 9
-33 45 -6 64 6 98 40 120 35 22 50 46 92 149 33 77 29 118 -12 124 -29 4 -28
16 3 36 14 9 34 34 45 56 l20 40 40 -21 c95 -50 238 -1 254 87 l7 34 58 0 58
0 21 -49z m-1922 -218 c3 -10 10 -25 15 -33 35 -55 38 -75 21 -124 l-17 -47
65 -62 c116 -111 142 -123 187 -87 22 17 28 18 56 6 99 -42 107 -49 119 -93
16 -66 33 -73 171 -73 l118 0 23 53 c23 50 26 53 77 66 30 8 60 16 66 18 7 3
21 -9 30 -26 26 -45 55 -40 156 28 l87 60 0 -69 c0 -47 6 -78 17 -99 20 -34
57 -54 84 -46 14 5 19 1 19 -14 0 -11 5 -31 11 -45 10 -20 8 -33 -10 -70 -11
-25 -21 -49 -21 -53 0 -9 -106 -109 -198 -184 l-72 -61 -101 89 c-125 109
-123 107 -142 100 -23 -9 -48 -52 -41 -70 3 -9 45 -51 92 -93 48 -43 91 -83
95 -90 8 -15 8 -15 -96 -101 -82 -68 -101 -99 -84 -134 19 -37 57 -36 100 3
40 37 114 101 166 144 19 16 73 63 120 105 47 42 97 84 110 95 13 10 44 36 68
57 46 39 55 39 88 2 6 -7 35 -30 65 -53 l54 -41 22 20 c33 31 94 36 118 10 14
-15 17 -26 10 -40 -8 -18 -107 -101 -149 -126 -15 -9 -16 -32 -15 -212 1 -199
0 -202 -22 -217 -13 -9 -66 -52 -118 -96 -214 -179 -305 -252 -332 -266 -33
-17 -16 -28 -179 105 -98 80 -135 111 -220 185 -20 17 -60 51 -88 75 l-51 43
0 183 c0 157 -2 184 -16 196 -13 10 -66 15 -203 19 -173 5 -189 7 -235 30 -75
37 -85 58 -90 175 -3 90 -37 247 -63 287 -3 6 -7 24 -8 40 -3 37 -38 74 -95
102 -45 22 -45 22 -43 70 3 41 11 58 60 122 32 42 72 96 90 122 72 105 94 132
109 132 8 0 17 -8 20 -17z m1314 -43 c0 -17 -27 -77 -38 -84 -19 -12 -19 32 0
63 20 31 38 41 38 21z m-846 -1553 c47 -41 68 -59 116 -97 76 -59 81 -64 134
-111 28 -26 62 -56 76 -67 l25 -20 -45 -6 c-112 -14 -234 -26 -338 -32 l-113
-7 5 24 c3 13 10 53 16 89 18 104 40 212 51 248 12 36 9 37 73 -21z m1135
-148 c18 -99 31 -182 28 -185 -4 -4 -214 12 -267 20 -8 2 -49 6 -91 10 -42 5
-81 11 -88 15 -10 7 174 163 314 268 24 17 46 37 50 42 3 6 9 11 14 11 4 0 22
-81 40 -181z"/>
<path d="M3180 3892 c-81 -36 -130 -127 -110 -204 22 -78 100 -138 182 -138
38 0 99 23 97 38 -1 20 -64 55 -102 57 -28 2 -46 9 -59 25 -32 39 -33 67 -4
105 25 32 31 35 81 35 34 0 55 5 58 13 2 6 7 10 10 7 4 -3 0 -18 -7 -32 -8
-15 -10 -31 -5 -39 5 -8 7 -21 4 -29 -11 -41 -14 -91 -5 -85 5 3 8 0 5 -7 -3
-7 5 -19 17 -27 20 -12 24 -11 45 15 61 77 27 223 -62 260 -35 14 -118 18
-145 6z m167 -244 c-3 -7 -5 -2 -5 12 0 14 2 19 5 13 2 -7 2 -19 0 -25z"/>
<path d="M1913 3682 c-82 -29 -123 -49 -160 -79 -113 -96 -169 -183 -194 -301
-23 -109 -23 -165 0 -273 28 -135 83 -219 211 -320 117 -93 318 -126 476 -79
38 12 80 26 94 33 70 33 200 160 236 229 95 184 77 449 -42 605 -51 67 -159
149 -230 176 -159 59 -238 61 -391 9z m288 -83 c111 -35 229 -128 283 -223 92
-161 65 -364 -68 -518 -22 -26 -45 -48 -50 -48 -6 0 -19 -9 -30 -19 -29 -27
-114 -59 -192 -71 -105 -17 -201 9 -326 88 -63 39 -137 156 -164 257 -57 213
91 459 319 531 52 16 182 18 228 3z"/>
<path d="M2057 3373 c-19 -5 -44 -51 -102 -185 -21 -49 -41 -88 -45 -88 -8 0
-17 25 -65 169 -26 78 -57 107 -98 92 -22 -9 -27 -17 -27 -46 0 -19 9 -61 19
-92 10 -32 36 -111 56 -175 44 -141 69 -182 111 -186 38 -4 45 4 88 105 48
113 88 193 96 193 4 0 14 -17 23 -37 52 -125 101 -230 114 -245 9 -10 28 -18
43 -18 50 0 68 35 159 312 22 70 41 135 41 145 0 28 -20 43 -56 43 -35 0 -50
-14 -64 -57 -5 -15 -24 -71 -43 -123 l-35 -94 -35 74 c-19 41 -44 97 -56 125
-37 83 -65 103 -124 88z"/>
<path d="M3185 2891 c-118 -33 -200 -113 -243 -235 -20 -59 -23 -82 -18 -138
11 -117 71 -219 171 -288 80 -55 247 -65 338 -21 68 33 142 105 173 169 36 75
45 204 20 280 -40 119 -140 208 -263 236 -87 19 -102 19 -178 -3z m200 -112
c167 -88 205 -287 78 -410 -65 -63 -104 -81 -177 -82 -69 0 -129 25 -184 77
-133 124 -85 345 90 421 51 22 146 19 193 -6z"/>
</g>
</svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Torch Choice
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Easy Data Management and Stata Users
            
          </span>
        </div>
      </div>
    </div>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="Torch Choice" class="md-nav__button md-logo" aria-label="Torch Choice" data-md-component="logo">
      
  
  <?xml version="1.0" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 20010904//EN"
 "http://www.w3.org/TR/2001/REC-SVG-20010904/DTD/svg10.dtd">
<svg version="1.0" xmlns="http://www.w3.org/2000/svg"
 width="500.000000pt" height="500.000000pt" viewBox="0 0 500.000000 500.000000"
 preserveAspectRatio="xMidYMid meet">

<g transform="translate(0.000000,500.000000) scale(0.100000,-0.100000)"
fill="#000000" stroke="none">
<path d="M3039 4192 c-24 -15 -53 -32 -64 -38 -16 -9 -19 -19 -15 -55 2 -24 4
-60 4 -79 l1 -35 -83 -3 c-81 -3 -83 -3 -102 -35 -23 -38 -35 -87 -23 -96 4
-3 30 -32 56 -63 47 -55 48 -57 28 -70 -12 -7 -21 -20 -21 -28 0 -8 -18 -28
-40 -43 -45 -32 -47 -43 -21 -106 22 -53 34 -59 127 -60 86 -1 87 -4 78 -105
l-6 -71 62 -33 c35 -17 69 -32 77 -32 8 0 38 23 67 50 66 62 92 65 150 13 22
-20 43 -40 44 -45 2 -4 -38 -8 -88 -8 -106 0 -151 -19 -174 -73 -7 -18 -25
-38 -39 -46 -23 -12 -34 -11 -93 5 -78 22 -87 37 -82 129 l3 60 -42 3 c-41 3
-42 4 -58 55 -24 74 -91 196 -120 219 -28 22 -32 50 -10 68 31 26 18 64 -37
111 -58 49 -122 89 -142 89 -7 0 -28 -10 -47 -23 l-34 -23 -65 22 c-63 20 -65
22 -68 57 -2 19 -10 41 -18 48 -9 8 -57 14 -122 17 -119 5 -137 -3 -144 -63
-3 -26 -9 -31 -66 -47 l-62 -19 -27 26 c-38 35 -74 32 -147 -12 -94 -56 -96
-59 -96 -122 -1 -74 -15 -93 -72 -90 -54 3 -59 0 -106 -64 -46 -62 -52 -76
-61 -144 -7 -51 -7 -52 26 -70 18 -9 33 -19 33 -21 0 -2 -9 -35 -21 -73 -18
-60 -26 -71 -53 -83 -55 -23 -61 -37 -46 -119 24 -133 24 -144 0 -174 -74 -93
-173 -235 -200 -284 -25 -47 -30 -68 -30 -122 0 -59 3 -69 27 -92 16 -15 45
-35 66 -46 21 -11 40 -28 43 -37 3 -9 12 -31 21 -49 13 -27 14 -37 3 -62 -15
-38 -6 -67 24 -75 23 -6 24 -10 28 -118 4 -138 25 -191 97 -243 66 -49 144
-65 306 -65 l135 0 0 -126 c0 -119 -1 -125 -19 -119 -21 6 -19 14 -97 -355
-47 -221 -52 -277 -28 -287 16 -6 97 1 319 27 220 26 482 49 513 45 21 -2 91
-9 157 -15 66 -6 201 -21 300 -33 202 -23 231 -25 247 -9 8 8 3 55 -21 174
-18 90 -39 197 -47 238 -8 41 -22 105 -30 143 -15 64 -18 67 -45 67 l-29 0 0
134 c0 127 1 134 23 149 12 8 42 33 66 56 34 31 50 39 68 35 13 -4 30 -1 38 6
11 9 32 11 69 6 30 -3 74 -3 98 0 39 5 46 11 60 43 38 86 104 116 161 71 14
-11 28 -20 32 -20 21 0 225 190 225 210 0 6 -9 29 -21 51 -14 28 -18 50 -14
70 7 32 50 89 67 89 5 0 23 9 39 21 l29 20 0 137 c0 153 -8 181 -55 197 -45
15 -54 23 -70 63 -14 33 -14 40 7 100 l23 63 -100 95 c-55 52 -111 98 -124
101 -14 3 -35 -1 -51 -11 -16 -9 -42 -16 -59 -16 -26 0 -36 9 -71 59 -22 33
-40 64 -40 70 0 5 20 17 45 26 72 28 81 44 66 116 -16 80 -8 89 75 89 56 0 68
4 95 28 23 21 32 39 36 72 5 44 4 46 -46 88 -28 24 -51 52 -51 62 0 11 23 42
50 69 56 56 63 85 30 138 -23 38 -66 52 -137 46 -30 -3 -53 -1 -57 5 -4 6 -1
42 5 79 13 75 20 64 -71 123 -25 16 -53 30 -64 30 -10 0 -40 -22 -66 -50 -39
-41 -54 -50 -83 -50 -28 0 -43 9 -83 50 -27 28 -56 50 -65 50 -8 0 -35 -12
-60 -28z m83 -129 c38 -37 40 -38 121 -39 l82 -1 37 39 c54 56 68 51 68 -22 0
-109 37 -147 146 -152 l69 -3 -52 -49 c-51 -48 -53 -52 -53 -103 0 -56 5 -64
70 -115 19 -15 32 -29 29 -32 -3 -3 -36 -8 -72 -11 -76 -5 -97 -16 -122 -58
-14 -24 -16 -43 -11 -97 8 -86 -5 -93 -58 -33 l-38 43 -92 0 -92 0 -39 -40
c-21 -22 -45 -40 -52 -40 -16 0 -17 32 -3 80 9 31 6 40 -24 86 l-35 52 -70 4
c-38 2 -74 7 -78 12 -8 7 16 30 71 69 23 16 26 25 26 77 0 58 -1 59 -50 102
-27 24 -50 46 -50 51 0 4 29 7 64 7 83 0 91 4 128 57 28 42 30 48 19 83 -24
81 -1 93 61 33z m-957 -243 c12 -37 33 -51 105 -71 25 -7 71 -26 104 -43 55
-29 59 -30 70 -13 30 49 29 49 66 19 34 -29 34 -29 17 -55 -23 -35 -22 -40 16
-78 46 -47 101 -144 133 -236 32 -93 50 -116 80 -109 17 5 23 0 28 -17 12 -45
7 -56 -33 -68 -38 -11 -39 -12 -59 -96 -29 -115 -89 -236 -151 -303 -28 -30
-51 -57 -51 -60 0 -4 7 -15 15 -26 21 -27 19 -39 -10 -58 -24 -16 -27 -15 -54
5 l-30 22 -48 -20 c-47 -20 -85 -30 -191 -54 -58 -12 -82 -36 -82 -82 0 -27
-2 -28 -42 -25 -43 3 -43 3 -46 44 -4 52 -20 66 -102 88 -36 10 -88 31 -116
47 -61 34 -71 35 -99 9 l-21 -20 -24 25 c-20 21 -21 28 -11 53 14 34 4 67 -29
97 -24 21 -74 124 -85 173 -9 43 -38 66 -74 59 -25 -5 -31 -2 -42 24 -13 33
-3 49 32 49 28 0 37 22 53 125 8 55 21 115 29 134 19 44 12 67 -24 80 -33 12
-36 26 -10 60 17 22 21 23 51 12 37 -13 34 -14 127 76 50 49 53 55 53 102 0
46 3 52 30 66 29 15 31 15 39 -8 13 -32 37 -40 71 -23 16 7 70 24 121 37 90
22 92 23 107 61 14 35 19 39 45 36 25 -2 33 -10 42 -38z m1193 -739 c23 -55
63 -83 140 -96 33 -5 52 -2 88 15 l46 23 46 -46 45 -45 -26 -32 c-31 -37 -32
-46 -11 -97 61 -144 74 -165 114 -181 l40 -17 0 -66 c0 -62 -2 -67 -23 -73
-49 -12 -105 -96 -138 -204 -11 -38 -10 -43 15 -73 l27 -32 -47 -48 -47 -48
-38 25 c-46 29 -90 30 -144 5 -47 -22 -79 -55 -92 -96 -9 -29 -13 -30 -71 -33
l-61 -3 -10 39 c-13 48 -34 68 -100 93 -64 24 -89 24 -121 -1 -34 -27 -45 -25
-101 15 l-48 36 25 37 c33 47 28 76 -28 190 -38 76 -47 88 -73 92 -27 5 -30 9
-33 45 -6 64 6 98 40 120 35 22 50 46 92 149 33 77 29 118 -12 124 -29 4 -28
16 3 36 14 9 34 34 45 56 l20 40 40 -21 c95 -50 238 -1 254 87 l7 34 58 0 58
0 21 -49z m-1922 -218 c3 -10 10 -25 15 -33 35 -55 38 -75 21 -124 l-17 -47
65 -62 c116 -111 142 -123 187 -87 22 17 28 18 56 6 99 -42 107 -49 119 -93
16 -66 33 -73 171 -73 l118 0 23 53 c23 50 26 53 77 66 30 8 60 16 66 18 7 3
21 -9 30 -26 26 -45 55 -40 156 28 l87 60 0 -69 c0 -47 6 -78 17 -99 20 -34
57 -54 84 -46 14 5 19 1 19 -14 0 -11 5 -31 11 -45 10 -20 8 -33 -10 -70 -11
-25 -21 -49 -21 -53 0 -9 -106 -109 -198 -184 l-72 -61 -101 89 c-125 109
-123 107 -142 100 -23 -9 -48 -52 -41 -70 3 -9 45 -51 92 -93 48 -43 91 -83
95 -90 8 -15 8 -15 -96 -101 -82 -68 -101 -99 -84 -134 19 -37 57 -36 100 3
40 37 114 101 166 144 19 16 73 63 120 105 47 42 97 84 110 95 13 10 44 36 68
57 46 39 55 39 88 2 6 -7 35 -30 65 -53 l54 -41 22 20 c33 31 94 36 118 10 14
-15 17 -26 10 -40 -8 -18 -107 -101 -149 -126 -15 -9 -16 -32 -15 -212 1 -199
0 -202 -22 -217 -13 -9 -66 -52 -118 -96 -214 -179 -305 -252 -332 -266 -33
-17 -16 -28 -179 105 -98 80 -135 111 -220 185 -20 17 -60 51 -88 75 l-51 43
0 183 c0 157 -2 184 -16 196 -13 10 -66 15 -203 19 -173 5 -189 7 -235 30 -75
37 -85 58 -90 175 -3 90 -37 247 -63 287 -3 6 -7 24 -8 40 -3 37 -38 74 -95
102 -45 22 -45 22 -43 70 3 41 11 58 60 122 32 42 72 96 90 122 72 105 94 132
109 132 8 0 17 -8 20 -17z m1314 -43 c0 -17 -27 -77 -38 -84 -19 -12 -19 32 0
63 20 31 38 41 38 21z m-846 -1553 c47 -41 68 -59 116 -97 76 -59 81 -64 134
-111 28 -26 62 -56 76 -67 l25 -20 -45 -6 c-112 -14 -234 -26 -338 -32 l-113
-7 5 24 c3 13 10 53 16 89 18 104 40 212 51 248 12 36 9 37 73 -21z m1135
-148 c18 -99 31 -182 28 -185 -4 -4 -214 12 -267 20 -8 2 -49 6 -91 10 -42 5
-81 11 -88 15 -10 7 174 163 314 268 24 17 46 37 50 42 3 6 9 11 14 11 4 0 22
-81 40 -181z"/>
<path d="M3180 3892 c-81 -36 -130 -127 -110 -204 22 -78 100 -138 182 -138
38 0 99 23 97 38 -1 20 -64 55 -102 57 -28 2 -46 9 -59 25 -32 39 -33 67 -4
105 25 32 31 35 81 35 34 0 55 5 58 13 2 6 7 10 10 7 4 -3 0 -18 -7 -32 -8
-15 -10 -31 -5 -39 5 -8 7 -21 4 -29 -11 -41 -14 -91 -5 -85 5 3 8 0 5 -7 -3
-7 5 -19 17 -27 20 -12 24 -11 45 15 61 77 27 223 -62 260 -35 14 -118 18
-145 6z m167 -244 c-3 -7 -5 -2 -5 12 0 14 2 19 5 13 2 -7 2 -19 0 -25z"/>
<path d="M1913 3682 c-82 -29 -123 -49 -160 -79 -113 -96 -169 -183 -194 -301
-23 -109 -23 -165 0 -273 28 -135 83 -219 211 -320 117 -93 318 -126 476 -79
38 12 80 26 94 33 70 33 200 160 236 229 95 184 77 449 -42 605 -51 67 -159
149 -230 176 -159 59 -238 61 -391 9z m288 -83 c111 -35 229 -128 283 -223 92
-161 65 -364 -68 -518 -22 -26 -45 -48 -50 -48 -6 0 -19 -9 -30 -19 -29 -27
-114 -59 -192 -71 -105 -17 -201 9 -326 88 -63 39 -137 156 -164 257 -57 213
91 459 319 531 52 16 182 18 228 3z"/>
<path d="M2057 3373 c-19 -5 -44 -51 -102 -185 -21 -49 -41 -88 -45 -88 -8 0
-17 25 -65 169 -26 78 -57 107 -98 92 -22 -9 -27 -17 -27 -46 0 -19 9 -61 19
-92 10 -32 36 -111 56 -175 44 -141 69 -182 111 -186 38 -4 45 4 88 105 48
113 88 193 96 193 4 0 14 -17 23 -37 52 -125 101 -230 114 -245 9 -10 28 -18
43 -18 50 0 68 35 159 312 22 70 41 135 41 145 0 28 -20 43 -56 43 -35 0 -50
-14 -64 -57 -5 -15 -24 -71 -43 -123 l-35 -94 -35 74 c-19 41 -44 97 -56 125
-37 83 -65 103 -124 88z"/>
<path d="M3185 2891 c-118 -33 -200 -113 -243 -235 -20 -59 -23 -82 -18 -138
11 -117 71 -219 171 -288 80 -55 247 -65 338 -21 68 33 142 105 173 169 36 75
45 204 20 280 -40 119 -140 208 -263 236 -87 19 -102 19 -178 -3z m200 -112
c167 -88 205 -287 78 -410 -65 -63 -104 -81 -177 -82 -69 0 -129 25 -184 77
-133 124 -85 345 90 421 51 22 146 19 193 -6z"/>
</g>
</svg>

    </a>
    Torch Choice
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        Home
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../install/" class="md-nav__link">
        Installation
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../intro/" class="md-nav__link">
        Introduction
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../data_management/" class="md-nav__link">
        Data Management
      </a>
    </li>
  

    
      
      
      

  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          Easy Data Management and Stata Users
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        Easy Data Management and Stata Users
      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#references-and-background-for-stata-users" class="md-nav__link">
    References and Background for Stata Users
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../conditional_logit_model_mode_canada/" class="md-nav__link">
        Conditional Logit Model
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../nested_logit_model_house_cooling/" class="md-nav__link">
        Nested Logit Model
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../post_estimation_demos/" class="md-nav__link">
        Post Estimation
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../coefficient_initialization/" class="md-nav__link">
        Coefficient Initialization
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../projects/" class="md-nav__link">
        Related Projects
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../test/" class="md-nav__link">
        Compatibility Tests
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../api_torch_choice/" class="md-nav__link">
        API Reference Torch-Choice
      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#references-and-background-for-stata-users" class="md-nav__link">
    References and Background for Stata Users
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content" data-md-component="content">
            <article class="md-content__inner md-typeset">
              
                


<h1 id="easy-data-wrapper-tutorial">Easy Data Wrapper Tutorial</h1>
<p>The data construction covered in the Data Management tutorial might be too complicated for users without prior experience in PyTorch.
This tutorial offers a helper class to wrap the dataset, all the user needs to know is</p>
<p>(1) loading data-frames to Python, Pandas provides one-line solution to loading various types of data files including CSV, TSV, Stata, and Excel.</p>
<p>(2) basic usage of pandas. </p>
<p>We aim to make this tutorial as self-contained as possible, so you don't need to be worried if you haven't went through the <em>Data Management tutorial</em>. But we invite you to go through that tutorial to obtain a more in-depth understanding of data management in this project.</p>
<p>Author: Tianyu Du</p>
<p>Date: May. 20, 2022</p>
<p>Update: Jul. 9, 2022</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="n">__author__</span> <span class="o">=</span> <span class="s1">&#39;Tianyu Du&#39;</span>
</code></pre></div>
<p>Let's import a few necessary packages.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<a id="__codelineno-1-2" name="__codelineno-1-2" href="#__codelineno-1-2"></a><span class="kn">import</span> <span class="nn">torch</span>
<a id="__codelineno-1-3" name="__codelineno-1-3" href="#__codelineno-1-3"></a><span class="kn">from</span> <span class="nn">torch_choice.utils.easy_data_wrapper</span> <span class="kn">import</span> <span class="n">EasyDatasetWrapper</span>
</code></pre></div>
<h2 id="references-and-background-for-stata-users">References and Background for Stata Users</h2>
<p>This tutorial aim to show how to manage choice datasets using the <code>torch-choice</code> package, we will follow the Stata documentation <a href="https://www.stata.com/manuals/cm.pdf">here</a> to offer a seamless experience for the user to transfer prior knowledge in other packages to our package.</p>
<p><em>From Stata Documentation</em>: Choice models (CM) are models for data with outcomes that are choices. The choices are selected by a decision maker, such as a person or a business (i.e., the <strong>user</strong>), from a set of possible alternatives (i.e., the <strong>items</strong>). For instance, we could model choices made by consumers who select a breakfast cereal from several different brands. Or we could model choices made by businesses who chose whether to buy TV, radio, Internet, or newspaper advertising.</p>
<p>Models for choice data come in two varieties—models for discrete choices and models for rank-ordered alternatives. When each individual selects a single alternative, say, he or she purchases one box of cereal, the data are discrete choice data. When each individual ranks the choices, say, he or she orders cereals from most favorite to least favorite, the data are rank-ordered data. Stata has commands for fitting both discrete choice models and rank-ordered models.</p>
<p>Our <code>torch-choice</code> package handles the <strong>discrete choice</strong> models in the Stata document above.</p>
<h1 id="motivations">Motivations</h1>
<p>In the following parts, we demonstrate how to convert a long-format data (e.g., the one used in Stata) to the <code>ChoiceDataset</code> data format expected by our package.</p>
<p>But first, <em>Why do we want another <code>ChoiceDataset</code> object instead of just one long-format data-frame?</em>
In earlier versions of Stata, we can only have one single data-frame loaded in memory, this would introduce memory error especially when teh dataset is large. For example, you have a dataset of a million decisions recorded, each consists of four items, and each item has a persistent <em>built quality</em> that stay the same in all observations. The Stata format would make a million copy of these variables, which is very inefficient.</p>
<p>We would need to collect a couple of data-frames as the essential pieces to build our <code>ChoiceDataset</code>. Don't worry, as soon as you have the data-frames ready, the <code>EasyDataWrapper</code> helper class would take care of the rest.</p>
<p>We call a single statistical observation a <strong>"purchase record"</strong> and use this terminology throughout the tutorial. </p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_stata</span><span class="p">(</span><span class="s1">&#39;https://www.stata-press.com/data/r17/carchoice.dta&#39;</span><span class="p">)</span>
</code></pre></div>
<p>We load the artificial dataset from the Stata website. Here we borrow the description of dataset reported from the <code>describe</code> command in Stata. </p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a>Contains data from https://www.stata-press.com/data/r17/carchoice.dta
<a id="__codelineno-3-2" name="__codelineno-3-2" href="#__codelineno-3-2"></a> Observations:         3,160                  Car choice data
<a id="__codelineno-3-3" name="__codelineno-3-3" href="#__codelineno-3-3"></a>    Variables:             6                  30 Jul 2020 14:58
<a id="__codelineno-3-4" name="__codelineno-3-4" href="#__codelineno-3-4"></a>---------------------------------------------------------------------------------------------------------------------------------------------------
<a id="__codelineno-3-5" name="__codelineno-3-5" href="#__codelineno-3-5"></a>Variable      Storage   Display    Value
<a id="__codelineno-3-6" name="__codelineno-3-6" href="#__codelineno-3-6"></a>    name         type    format    label      Variable label
<a id="__codelineno-3-7" name="__codelineno-3-7" href="#__codelineno-3-7"></a>---------------------------------------------------------------------------------------------------------------------------------------------------
<a id="__codelineno-3-8" name="__codelineno-3-8" href="#__codelineno-3-8"></a>consumerid      int     %8.0g                 ID of individual consumer
<a id="__codelineno-3-9" name="__codelineno-3-9" href="#__codelineno-3-9"></a>car             byte    %9.0g      nation     Nationality of car
<a id="__codelineno-3-10" name="__codelineno-3-10" href="#__codelineno-3-10"></a>purchase        byte    %10.0g                Indicator of car purchased
<a id="__codelineno-3-11" name="__codelineno-3-11" href="#__codelineno-3-11"></a>gender          byte    %9.0g      gender     Gender: 0 = Female, 1 = Male
<a id="__codelineno-3-12" name="__codelineno-3-12" href="#__codelineno-3-12"></a>income          float   %9.0g                 Income (in $1,000)
<a id="__codelineno-3-13" name="__codelineno-3-13" href="#__codelineno-3-13"></a>dealers         byte    %9.0g                 No. of dealerships in community
<a id="__codelineno-3-14" name="__codelineno-3-14" href="#__codelineno-3-14"></a>---------------------------------------------------------------------------------------------------------------------------------------------------
<a id="__codelineno-3-15" name="__codelineno-3-15" href="#__codelineno-3-15"></a>Sorted by: consumerid  car
</code></pre></div>
<p>In this dataset, the first four rows with <code>consumerid == 1</code> corresponds to the first <strong>purchasing record</strong>, it means the consumer with ID 1 was making the decision among four types of cars (i.e., <strong>items</strong>) and chose <code>American</code> car (since the <code>purchase == 1</code> in that row of <code>American</code> car).</p>
<p>Even though there were four types of cars, not all of them were available all the time. For example, for the <strong>purchase record</strong> by consumer with ID 4, only American, Japanese, and European cars were available (note that there is no row in the dataset with <code>consumerid == 4</code> and <code>car == 'Korean'</code>, this indicates unavailability of a certain item.)</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-4-1" name="__codelineno-4-1" href="#__codelineno-4-1"></a><span class="n">df</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">30</span><span class="p">)</span>
</code></pre></div>
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>consumerid</th>
      <th>car</th>
      <th>purchase</th>
      <th>gender</th>
      <th>income</th>
      <th>dealers</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1</td>
      <td>American</td>
      <td>1</td>
      <td>Male</td>
      <td>46.699997</td>
      <td>9</td>
    </tr>
    <tr>
      <th>1</th>
      <td>1</td>
      <td>Japanese</td>
      <td>0</td>
      <td>Male</td>
      <td>46.699997</td>
      <td>11</td>
    </tr>
    <tr>
      <th>2</th>
      <td>1</td>
      <td>European</td>
      <td>0</td>
      <td>Male</td>
      <td>46.699997</td>
      <td>5</td>
    </tr>
    <tr>
      <th>3</th>
      <td>1</td>
      <td>Korean</td>
      <td>0</td>
      <td>Male</td>
      <td>46.699997</td>
      <td>1</td>
    </tr>
    <tr>
      <th>4</th>
      <td>2</td>
      <td>American</td>
      <td>1</td>
      <td>Male</td>
      <td>26.100000</td>
      <td>10</td>
    </tr>
    <tr>
      <th>5</th>
      <td>2</td>
      <td>Japanese</td>
      <td>0</td>
      <td>Male</td>
      <td>26.100000</td>
      <td>7</td>
    </tr>
    <tr>
      <th>6</th>
      <td>2</td>
      <td>European</td>
      <td>0</td>
      <td>Male</td>
      <td>26.100000</td>
      <td>2</td>
    </tr>
    <tr>
      <th>7</th>
      <td>2</td>
      <td>Korean</td>
      <td>0</td>
      <td>Male</td>
      <td>26.100000</td>
      <td>1</td>
    </tr>
    <tr>
      <th>8</th>
      <td>3</td>
      <td>American</td>
      <td>0</td>
      <td>Male</td>
      <td>32.700001</td>
      <td>8</td>
    </tr>
    <tr>
      <th>9</th>
      <td>3</td>
      <td>Japanese</td>
      <td>1</td>
      <td>Male</td>
      <td>32.700001</td>
      <td>6</td>
    </tr>
    <tr>
      <th>10</th>
      <td>3</td>
      <td>European</td>
      <td>0</td>
      <td>Male</td>
      <td>32.700001</td>
      <td>2</td>
    </tr>
    <tr>
      <th>11</th>
      <td>4</td>
      <td>American</td>
      <td>1</td>
      <td>Female</td>
      <td>49.199997</td>
      <td>5</td>
    </tr>
    <tr>
      <th>12</th>
      <td>4</td>
      <td>Japanese</td>
      <td>0</td>
      <td>Female</td>
      <td>49.199997</td>
      <td>4</td>
    </tr>
    <tr>
      <th>13</th>
      <td>4</td>
      <td>European</td>
      <td>0</td>
      <td>Female</td>
      <td>49.199997</td>
      <td>3</td>
    </tr>
    <tr>
      <th>14</th>
      <td>5</td>
      <td>American</td>
      <td>0</td>
      <td>Male</td>
      <td>24.299999</td>
      <td>8</td>
    </tr>
    <tr>
      <th>15</th>
      <td>5</td>
      <td>Japanese</td>
      <td>0</td>
      <td>Male</td>
      <td>24.299999</td>
      <td>3</td>
    </tr>
    <tr>
      <th>16</th>
      <td>5</td>
      <td>European</td>
      <td>1</td>
      <td>Male</td>
      <td>24.299999</td>
      <td>3</td>
    </tr>
    <tr>
      <th>17</th>
      <td>6</td>
      <td>American</td>
      <td>1</td>
      <td>Female</td>
      <td>39.000000</td>
      <td>10</td>
    </tr>
    <tr>
      <th>18</th>
      <td>6</td>
      <td>Japanese</td>
      <td>0</td>
      <td>Female</td>
      <td>39.000000</td>
      <td>6</td>
    </tr>
    <tr>
      <th>19</th>
      <td>6</td>
      <td>European</td>
      <td>0</td>
      <td>Female</td>
      <td>39.000000</td>
      <td>1</td>
    </tr>
    <tr>
      <th>20</th>
      <td>7</td>
      <td>American</td>
      <td>0</td>
      <td>Male</td>
      <td>33.000000</td>
      <td>10</td>
    </tr>
    <tr>
      <th>21</th>
      <td>7</td>
      <td>Japanese</td>
      <td>0</td>
      <td>Male</td>
      <td>33.000000</td>
      <td>6</td>
    </tr>
    <tr>
      <th>22</th>
      <td>7</td>
      <td>European</td>
      <td>1</td>
      <td>Male</td>
      <td>33.000000</td>
      <td>4</td>
    </tr>
    <tr>
      <th>23</th>
      <td>7</td>
      <td>Korean</td>
      <td>0</td>
      <td>Male</td>
      <td>33.000000</td>
      <td>1</td>
    </tr>
    <tr>
      <th>24</th>
      <td>8</td>
      <td>American</td>
      <td>1</td>
      <td>Male</td>
      <td>20.299999</td>
      <td>6</td>
    </tr>
    <tr>
      <th>25</th>
      <td>8</td>
      <td>Japanese</td>
      <td>0</td>
      <td>Male</td>
      <td>20.299999</td>
      <td>5</td>
    </tr>
    <tr>
      <th>26</th>
      <td>8</td>
      <td>European</td>
      <td>0</td>
      <td>Male</td>
      <td>20.299999</td>
      <td>3</td>
    </tr>
    <tr>
      <th>27</th>
      <td>9</td>
      <td>American</td>
      <td>0</td>
      <td>Male</td>
      <td>38.000000</td>
      <td>9</td>
    </tr>
    <tr>
      <th>28</th>
      <td>9</td>
      <td>Japanese</td>
      <td>1</td>
      <td>Male</td>
      <td>38.000000</td>
      <td>9</td>
    </tr>
    <tr>
      <th>29</th>
      <td>9</td>
      <td>European</td>
      <td>0</td>
      <td>Male</td>
      <td>38.000000</td>
      <td>2</td>
    </tr>
  </tbody>
</table>
</div>

<h1 id="components-of-the-consumer-choice-modelling-problem">Components of the Consumer Choice Modelling Problem</h1>
<p>We begin with essential component of the consumer choice modelling problem. Walking through these components should help you understand what kind of data our models are working on.</p>
<h3 id="purchasing-record">Purchasing Record</h3>
<p>Each row (record) of the dataset is called a <strong>purchasing record</strong>, which includes <em>who</em> bought <em>what</em> at <em>when</em> and <em>where</em>.
Let <span class="arithmatex">\(B\)</span> denote the number of <strong>purchasing records</strong> in the dataset (i.e., number of rows of the dataset). Each row <span class="arithmatex">\(b \in \{1,2,\dots, B\}\)</span> corresponds to a purchase record (i.e., <em>who</em> bought <em>what</em> at <em>where and when</em>).</p>
<h3 id="items-and-categories">Items and Categories</h3>
<p>To begin with, there are <span class="arithmatex">\(I\)</span> <strong>items</strong> indexed by <span class="arithmatex">\(i \in \{1,2,\dots,I\}\)</span> under our consideration.</p>
<p>Further, the researcher can optionally partition the set items into <span class="arithmatex">\(C\)</span> <strong>categories</strong> indexed by <span class="arithmatex">\(c \in \{1,2,\dots,C\}\)</span>. Let <span class="arithmatex">\(I_c\)</span> denote the collection of items in category <span class="arithmatex">\(c\)</span>, it is easy to verify that</p>
<div class="arithmatex">\[
\bigcup_{c \in \{1, 2, \dots, C\}} I_c = \{1, 2, \dots I\}
\]</div>
<p>If the researcher does not wish to model different categories differently, the researcher can simply put all items in one single category: <span class="arithmatex">\(I_1 = \{1, 2, \dots I\}\)</span>, so that all items belong to the same category.</p>
<p><strong>Note</strong>: since we will be using PyTorch to train our model, we represent their identities with integer values instead of the raw human-readable names of items (e.g., Dell 24 inch LCD monitor).
Raw item names can be encoded easily with <a href="https://scikit-learn.org/stable/modules/generated/sklearn.preprocessing.OrdinalEncoder.html">sklearn.preprocessing.OrdinalEncoder</a>.</p>
<h3 id="users">Users</h3>
<p>Each purchaing reocrd is naturally associated with an <strong>user</strong> indexed by <span class="arithmatex">\(u \in \{1,2,\dots,U\}\)</span> (<em>who</em>) as well.</p>
<h3 id="sessions">Sessions</h3>
<p>Our data structure encompasses <em>where and when</em> using a notion called <strong>session</strong> indexed by <span class="arithmatex">\(s \in \{1,2,\dots, S\}\)</span>.
For example, when the data came from a single store over the period of a year. In this case, the notion of <em>where</em> does not matter that much, and session <span class="arithmatex">\(s\)</span> is simply the date of purchase.</p>
<p>Another example is that we have the purchase record from different stores, the session <span class="arithmatex">\(s\)</span> can be defined as a pair of <em>(date, store)</em> instead.</p>
<p>If the researcher does not wish to handle records from different sessions differently, the researcher can assign the same session ID to all rows of the dataset.</p>
<p>To summarize, each purchasing record <span class="arithmatex">\(b\)</span> in the dataset is characterized by a user-session-item tuple <span class="arithmatex">\((u, s, i)\)</span>.</p>
<p>When there are multiple items bought by the same user in the same session, there will be multiple rows in the dataset with the same <span class="arithmatex">\((u, s)\)</span> corresponding to the same receipt.</p>
<h1 id="format-the-dataset-a-little-bit">Format the Dataset a Little Bit</h1>
<p>The wrapper we built requires several data frames, providing the correct information is all we need to do in this tutorial, the data wrapper will handle the construction of <code>ChoiceDataset</code> for you.</p>
<p><strong>Note</strong>: The dataset in this tutorial is a bit over-simplified, we only have one purchase record for each user in each session, so the <code>consumerid</code> column identifies all of the user, the session, and the purchase record (because we have different dealers for the same type of car, we define each purchase record of it's session instead of assigning all purchase records to the same session).
That is, we have a single user makes a single choice in each single session.</p>
<p>The <strong>main dataset</strong> should contain the following columns:</p>
<ol>
<li><code>purchase_record_column</code>: a column identifies <strong>purchase record</strong> (also called <strong>case</strong> in Stata syntax). this tutorial, the <code>consumerid</code> column is the identifier. For example, the first 4 rows of the dataset (see above) has <code>consumerid == 1</code>, this means we should look at the first 4 rows together and they constitute the first purchase record.</li>
<li><code>item_name_column</code>: a column identifies <strong>names of items</strong>, which is <code>car</code> in the dataset above. This column provides information above the availability as well. As mentioned above, there is no column with <code>car == Korean</code> in the fourth purchasing record (<code>consumerid == 4</code>), so we know that Korean car was not available that time.</li>
<li><code>choice_column</code>: a column identifies the <strong>choice</strong> made by the consumer in each purchase record, which is the <code>purchase</code> column in our example. Exactly one row per purchase record (i.e., rows with the same values in <code>purchase_record_column</code>) should have 1, while the values are zeros for all other rows.</li>
<li><code>user_index_column</code>: a <em>optional</em> column identifies the <strong>user</strong> making the choice, which is also <code>consumerid</code> in our case.</li>
<li><code>session_index_column</code>: a <em>optional</em> column identifies the <strong>session</strong> of the choice, which is also <code>consumerid</code> in our case.</li>
</ol>
<p>As you might have noticed, the <code>consumerid</code> column in the data-frame identifies multiple pieces of information: <code>purchase_record</code>, <code>user_index</code>, and <code>session_index</code>. This is not a mistake, you can use the same column in <code>df</code> to supply multiple pieces of information. </p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-5-1" name="__codelineno-5-1" href="#__codelineno-5-1"></a><span class="n">df</span><span class="o">.</span><span class="n">gender</span><span class="o">.</span><span class="n">value_counts</span><span class="p">(</span><span class="n">dropna</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code>Male      2283
Female     854
NaN         23
Name: gender, dtype: int64
</code></pre></div>
<p>The only modification required is to convert <code>gender</code> (with values of <code>Male</code>, <code>Female</code> or <code>NaN</code>) to integers because PyTorch does <strong>not</strong> handle strings. For simplicity, we will assume all <code>NaN</code> gender to be <code>Female</code> (you should <strong>not</strong> do this in a real application!) and re-define the gender variable as <span class="arithmatex">\(\mathbb{I}\{\texttt{gender} == \texttt{Male}\}\)</span>.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-6-1" name="__codelineno-6-1" href="#__codelineno-6-1"></a><span class="c1"># we change gender to binary 0/1 because pytorch doesn&#39;t handle strings.</span>
<a id="__codelineno-6-2" name="__codelineno-6-2" href="#__codelineno-6-2"></a><span class="n">df</span><span class="p">[</span><span class="s1">&#39;gender&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;gender&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;Male&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
</code></pre></div>
<p>Now the <code>gender</code> column contains only binary integers.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-7-1" name="__codelineno-7-1" href="#__codelineno-7-1"></a><span class="n">df</span><span class="o">.</span><span class="n">gender</span><span class="o">.</span><span class="n">value_counts</span><span class="p">(</span><span class="n">dropna</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code>1    2283
0     877
Name: gender, dtype: int64
</code></pre></div>
<p>The data-frame looks like the following right now:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-8-1" name="__codelineno-8-1" href="#__codelineno-8-1"></a><span class="n">df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</code></pre></div>
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>consumerid</th>
      <th>car</th>
      <th>purchase</th>
      <th>gender</th>
      <th>income</th>
      <th>dealers</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1</td>
      <td>American</td>
      <td>1</td>
      <td>1</td>
      <td>46.699997</td>
      <td>9</td>
    </tr>
    <tr>
      <th>1</th>
      <td>1</td>
      <td>Japanese</td>
      <td>0</td>
      <td>1</td>
      <td>46.699997</td>
      <td>11</td>
    </tr>
    <tr>
      <th>2</th>
      <td>1</td>
      <td>European</td>
      <td>0</td>
      <td>1</td>
      <td>46.699997</td>
      <td>5</td>
    </tr>
    <tr>
      <th>3</th>
      <td>1</td>
      <td>Korean</td>
      <td>0</td>
      <td>1</td>
      <td>46.699997</td>
      <td>1</td>
    </tr>
    <tr>
      <th>4</th>
      <td>2</td>
      <td>American</td>
      <td>1</td>
      <td>1</td>
      <td>26.100000</td>
      <td>10</td>
    </tr>
  </tbody>
</table>
</div>

<h1 id="adding-the-observables">Adding the Observables</h1>
<p>The next step is to identify observables going into the model.</p>
<p>Specifically, we would want to add:
1. <code>gender</code> and <code>income</code> as user-specific observables
2. and <code>dealers</code> as (session, item)-specific observable. Such observables are called <strong>price observables</strong> in our setting, why? because price is the most typical (session, item)-specific observable.</p>
<h2 id="method-1-adding-observables-by-extracting-columns-of-the-dataset">Method 1: Adding Observables by Extracting Columns of the Dataset</h2>
<p>As you can see, <code>gender</code>, <code>income</code> and <code>dealers</code> are already encompassed in <code>df</code>, the first way to add observables is simply mentioning these columns while initializing the <code>EasyDatasetWrapper</code> object.</p>
<p>You can supply a list of names of columns to each of <code>{user, item, session, price}_observable_columns</code> keyword argument. For example, we use <code>user_observable_columns=['gender', 'income']</code> to inform the <code>EasyDatasetWrapper</code> that we wish to derive user-specific observables from the <code>gender</code> and <code>income</code> columns of <code>df</code>.</p>
<p>Also, we inform the <code>EasyDatasetWrapper</code> that we want to derive (session, item)-specific (i.e., price observable) by specifying <code>price_observable_columns=['dealers']</code>.</p>
<p>Since our package leverages GPU-acceleration, it is necessary to supply the <strong>device</strong> on which the dataset should reside.
The <code>EasyDatasetWrapper</code> also takes a <code>device</code> keyword, which can be either <code>'cpu'</code> or an appropriate CUDA device.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-9-1" name="__codelineno-9-1" href="#__codelineno-9-1"></a><span class="k">if</span> <span class="n">torch</span><span class="o">.</span><span class="n">cuda</span><span class="o">.</span><span class="n">is_available</span><span class="p">():</span>
<a id="__codelineno-9-2" name="__codelineno-9-2" href="#__codelineno-9-2"></a>    <span class="n">device</span> <span class="o">=</span> <span class="s1">&#39;cuda&#39;</span>  <span class="c1"># use GPU if available</span>
<a id="__codelineno-9-3" name="__codelineno-9-3" href="#__codelineno-9-3"></a><span class="k">else</span><span class="p">:</span>
<a id="__codelineno-9-4" name="__codelineno-9-4" href="#__codelineno-9-4"></a>    <span class="n">device</span> <span class="o">=</span> <span class="s1">&#39;cpu&#39;</span>  <span class="c1"># use CPU otherwise</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-10-1" name="__codelineno-10-1" href="#__codelineno-10-1"></a><span class="n">data_1</span> <span class="o">=</span> <span class="n">EasyDatasetWrapper</span><span class="p">(</span><span class="n">main_data</span><span class="o">=</span><span class="n">df</span><span class="p">,</span>
<a id="__codelineno-10-2" name="__codelineno-10-2" href="#__codelineno-10-2"></a>                            <span class="c1"># TODO: better naming convention? Need to discuss.</span>
<a id="__codelineno-10-3" name="__codelineno-10-3" href="#__codelineno-10-3"></a>                            <span class="c1"># after discussion, we add it to the default value</span>
<a id="__codelineno-10-4" name="__codelineno-10-4" href="#__codelineno-10-4"></a>                            <span class="c1"># in the data wrapper class.</span>
<a id="__codelineno-10-5" name="__codelineno-10-5" href="#__codelineno-10-5"></a>                            <span class="c1"># these are just names.</span>
<a id="__codelineno-10-6" name="__codelineno-10-6" href="#__codelineno-10-6"></a>                            <span class="n">purchase_record_column</span><span class="o">=</span><span class="s1">&#39;consumerid&#39;</span><span class="p">,</span>
<a id="__codelineno-10-7" name="__codelineno-10-7" href="#__codelineno-10-7"></a>                            <span class="n">choice_column</span><span class="o">=</span><span class="s1">&#39;purchase&#39;</span><span class="p">,</span>
<a id="__codelineno-10-8" name="__codelineno-10-8" href="#__codelineno-10-8"></a>                            <span class="n">item_name_column</span><span class="o">=</span><span class="s1">&#39;car&#39;</span><span class="p">,</span>
<a id="__codelineno-10-9" name="__codelineno-10-9" href="#__codelineno-10-9"></a>                            <span class="n">user_index_column</span><span class="o">=</span><span class="s1">&#39;consumerid&#39;</span><span class="p">,</span>
<a id="__codelineno-10-10" name="__codelineno-10-10" href="#__codelineno-10-10"></a>                            <span class="n">session_index_column</span><span class="o">=</span><span class="s1">&#39;consumerid&#39;</span><span class="p">,</span>
<a id="__codelineno-10-11" name="__codelineno-10-11" href="#__codelineno-10-11"></a>                            <span class="c1"># it can be derived from columns of the dataframe or supplied as</span>
<a id="__codelineno-10-12" name="__codelineno-10-12" href="#__codelineno-10-12"></a>                            <span class="n">user_observable_columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;gender&#39;</span><span class="p">,</span> <span class="s1">&#39;income&#39;</span><span class="p">],</span>
<a id="__codelineno-10-13" name="__codelineno-10-13" href="#__codelineno-10-13"></a>                            <span class="n">price_observable_columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;dealers&#39;</span><span class="p">],</span>
<a id="__codelineno-10-14" name="__codelineno-10-14" href="#__codelineno-10-14"></a>                            <span class="n">device</span><span class="o">=</span><span class="n">device</span><span class="p">)</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code>Creating choice dataset from stata format data-frames...
Note: choice sets of different sizes found in different purchase records: {&#39;size 4&#39;: &#39;occurrence 505&#39;, &#39;size 3&#39;: &#39;occurrence 380&#39;}
Finished Creating Choice Dataset.
</code></pre></div>
<p>The dataset has a <code>summary()</code> method, which can be used to print out the summary of the dataset.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-11-1" name="__codelineno-11-1" href="#__codelineno-11-1"></a><span class="n">data_1</span><span class="o">.</span><span class="n">summary</span><span class="p">()</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code>* purchase record index range: [1 2 3] ... [883 884 885]
* Space of 4 items:
                   0         1         2       3
item name  American  European  Japanese  Korean
* Number of purchase records/cases: 885.
* Preview of main data frame:
      consumerid       car  purchase  gender     income  dealers
0              1  American         1       1  46.699997        9
1              1  Japanese         0       1  46.699997       11
2              1  European         0       1  46.699997        5
3              1    Korean         0       1  46.699997        1
4              2  American         1       1  26.100000       10
...          ...       ...       ...     ...        ...      ...
3155         884  Japanese         1       1  20.900000       10
3156         884  European         0       1  20.900000        4
3157         885  American         1       1  30.600000       10
3158         885  Japanese         0       1  30.600000        5
3159         885  European         0       1  30.600000        4

[3160 rows x 6 columns]
* Preview of ChoiceDataset:
ChoiceDataset(label=[], item_index=[885], provided_num_items=[], user_index=[885], session_index=[885], item_availability=[885, 4], user_gender=[885, 1], user_income=[885, 1], itemsession_dealers=[885, 4, 1], device=cpu)
</code></pre></div>
<p>You can access the <code>ChoiceDataset</code> object constructed by calling the <code>data.choice_dataset</code> object. </p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-12-1" name="__codelineno-12-1" href="#__codelineno-12-1"></a><span class="n">data_1</span><span class="o">.</span><span class="n">choice_dataset</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code>ChoiceDataset(label=[], item_index=[885], provided_num_items=[], user_index=[885], session_index=[885], item_availability=[885, 4], user_gender=[885, 1], user_income=[885, 1], itemsession_dealers=[885, 4, 1], device=cpu)
</code></pre></div>
<h2 id="method-2-adding-observables-as-data-frames">Method 2: Adding Observables as Data Frames</h2>
<p>We can also construct data frames and use data frames to supply different observables. This is useful when you have a large dataset, for example, if there are many purchase records for the same user (to be concrete, say <span class="arithmatex">\(U\)</span> users and <span class="arithmatex">\(N\)</span> purchase records for each user, resulting <span class="arithmatex">\(U \times N\)</span> total purchase records). Using a single data-frame requires a lot of memory: you need to store <span class="arithmatex">\(U \times N\)</span> entires of user genders in total. However, user genders should be persistent across all purchasing records, if we use a separate data-frame mapping user index to gender of the user, we only need to store <span class="arithmatex">\(U\)</span> entries (i.e., one for each user) of gender information.</p>
<p>Similarly, the long-format data requires storing each piece of item-specific information for number of purchase records times, which leads to inefficient usage of disk/memory space.</p>
<h3 id="how-do-observable-data-frame-look-like">How Do Observable Data-frame Look Like?</h3>
<p>Our package natively support the following four types of observables:</p>
<ol>
<li>
<p><strong>User Observables</strong>: user-specific observables (e.g., gender and income) should (1) have length equal to the number of unique users in the dataset (885 here); (2) contains a column named as <code>user_index_column</code> (<code>user_index_column</code> is a variable, the actual column name should be the <strong>value</strong> of variable <code>user_index_column</code>! E.g., here the user observable data-frame should have a column named <code>'consumerid'</code>); (3) the user observable can have any number of other columns beside the <code>user_index_column</code> column, each of them corresponding to a user-specific observable. For example, a data-frame containing <span class="arithmatex">\(X\)</span> user-specific observables has shape <code>(num_users, X + 1)</code>.</p>
</li>
<li>
<p><strong>Item Observables</strong> item-specific observables (not shown in this tutorial) should be (1) have length equal to the number of unique items in the dataset (4 here); (2) contain a column named as <code>item_index_column</code> (<code>item_index_column</code> is a variable, the actual column name should be the <strong>value</strong> of variable <code>item_index_column</code>! E.g., here the item observable data-frame should have a column named <code>'car'</code>); (3) the item observable can have any number of other columns beside the <code>item_index_column</code> column, each of them corresponding to a item-specific observable.</p>
</li>
<li>
<p><strong>Session Observable</strong> session-specific observables (not shown in this tutorial) should be (1) have length equal to the number of unique sessions in the dataset; (2) contain a column named as <code>session_index_column</code> (<code>session_index_column</code> is a variable, the actual column name should be the <strong>value</strong> of variable <code>session_index_column</code>! E.g., here the session observable data-frame should have a column named <code>'consumerid'</code>); (3) the session observable can have any number of other columns beside the <code>session_index_column</code> column, each of them corresponding to a session-specific observable.</p>
</li>
<li>
<p><strong>Price Observables</strong> (session, item)-specific observables (e.g., dealers) should be (1) contains a column named as <code>session_index_column</code> (e.g., <code>consumerid</code> in our example) <strong>and</strong> a column named as <code>item_name_column</code> (e.g., <code>car</code> in our example), (2) the price observable can have any number of other columns beside the <code>session_index_column</code> and <code>item_name_column</code> columns, each of them corresponding to a (session, item)-specific observable. For example, a data-frame containing <span class="arithmatex">\(X\)</span> (session, item)-specific observables has shape <code>(num_sessions, num_items, X + 2)</code>.</p>
</li>
</ol>
<p>We encourage the reader to review the <em>Data Management Tutorial</em> for more details on types of observables.</p>
<h3 id="suggested-procedure-of-storing-and-loading-data">Suggested Procedure of Storing and Loading Data</h3>
<ol>
<li>Suppose <code>SESSION_INDEX</code> column in <code>df_main</code> is the index of the session, <code>ALTERNATIVES</code> column is the index of the car.</li>
<li>For user-specific observables, you should have a CSV on disk with columns {<code>consumerid</code>, <code>var_1</code>, <code>var_2</code>, ...}.</li>
<li>You load the user-specific dataset as <code>user_obs = pd.read_csv(..., index='consumerid')</code>.</li>
</ol>
<p>Let's first construct the data frame for user genders first.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-13-1" name="__codelineno-13-1" href="#__codelineno-13-1"></a><span class="n">gender</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;consumerid&#39;</span><span class="p">)[</span><span class="s1">&#39;gender&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">first</span><span class="p">()</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
</code></pre></div>
<p>The user-observable data-frame contains a column of user IDs (the <code>consumerid</code> column), this column should have exactly the same name as the column containing user indices. Otherwise, the wrapper won't know which column corresponds to user IDs and which column corresponds to variables.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-14-1" name="__codelineno-14-1" href="#__codelineno-14-1"></a><span class="n">gender</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</code></pre></div>
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>consumerid</th>
      <th>gender</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1</td>
      <td>1</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2</td>
      <td>1</td>
    </tr>
    <tr>
      <th>2</th>
      <td>3</td>
      <td>1</td>
    </tr>
    <tr>
      <th>3</th>
      <td>4</td>
      <td>0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>5</td>
      <td>1</td>
    </tr>
  </tbody>
</table>
</div>

<p>Then, let's build the data-frame for user-specific income variables.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-15-1" name="__codelineno-15-1" href="#__codelineno-15-1"></a><span class="n">income</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;consumerid&#39;</span><span class="p">)[</span><span class="s1">&#39;income&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">first</span><span class="p">()</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-16-1" name="__codelineno-16-1" href="#__codelineno-16-1"></a><span class="n">income</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</code></pre></div>
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>consumerid</th>
      <th>income</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1</td>
      <td>46.699997</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2</td>
      <td>26.100000</td>
    </tr>
    <tr>
      <th>2</th>
      <td>3</td>
      <td>32.700001</td>
    </tr>
    <tr>
      <th>3</th>
      <td>4</td>
      <td>49.199997</td>
    </tr>
    <tr>
      <th>4</th>
      <td>5</td>
      <td>24.299999</td>
    </tr>
  </tbody>
</table>
</div>

<p>Please note that we can have multiple observables contained in the same data-frame as well.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-17-1" name="__codelineno-17-1" href="#__codelineno-17-1"></a><span class="n">gender_and_income</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;consumerid&#39;</span><span class="p">)[[</span><span class="s1">&#39;gender&#39;</span><span class="p">,</span> <span class="s1">&#39;income&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">first</span><span class="p">()</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
<a id="__codelineno-17-2" name="__codelineno-17-2" href="#__codelineno-17-2"></a><span class="n">gender_and_income</span>
</code></pre></div>
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>consumerid</th>
      <th>gender</th>
      <th>income</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1</td>
      <td>1</td>
      <td>46.699997</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2</td>
      <td>1</td>
      <td>26.100000</td>
    </tr>
    <tr>
      <th>2</th>
      <td>3</td>
      <td>1</td>
      <td>32.700001</td>
    </tr>
    <tr>
      <th>3</th>
      <td>4</td>
      <td>0</td>
      <td>49.199997</td>
    </tr>
    <tr>
      <th>4</th>
      <td>5</td>
      <td>1</td>
      <td>24.299999</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>880</th>
      <td>881</td>
      <td>1</td>
      <td>45.700001</td>
    </tr>
    <tr>
      <th>881</th>
      <td>882</td>
      <td>1</td>
      <td>69.800003</td>
    </tr>
    <tr>
      <th>882</th>
      <td>883</td>
      <td>0</td>
      <td>45.599998</td>
    </tr>
    <tr>
      <th>883</th>
      <td>884</td>
      <td>1</td>
      <td>20.900000</td>
    </tr>
    <tr>
      <th>884</th>
      <td>885</td>
      <td>1</td>
      <td>30.600000</td>
    </tr>
  </tbody>
</table>
<p>885 rows × 3 columns</p>
</div>

<p>The price observable data-frame contains two columns identifying session (i.e., the <code>consumerid</code> column) and item (i.e., the <code>car</code> column). The session index column should have exactly the same name as the session index column in <code>df</code> and the column indexing columns should have exactly the same name as the item-name-column in <code>df</code>.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-18-1" name="__codelineno-18-1" href="#__codelineno-18-1"></a><span class="n">dealers</span> <span class="o">=</span> <span class="n">df</span><span class="p">[[</span><span class="s1">&#39;consumerid&#39;</span><span class="p">,</span> <span class="s1">&#39;car&#39;</span><span class="p">,</span> <span class="s1">&#39;dealers&#39;</span><span class="p">]]</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-19-1" name="__codelineno-19-1" href="#__codelineno-19-1"></a><span class="n">dealers</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</code></pre></div>
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>consumerid</th>
      <th>car</th>
      <th>dealers</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1</td>
      <td>American</td>
      <td>9</td>
    </tr>
    <tr>
      <th>1</th>
      <td>1</td>
      <td>Japanese</td>
      <td>11</td>
    </tr>
    <tr>
      <th>2</th>
      <td>1</td>
      <td>European</td>
      <td>5</td>
    </tr>
    <tr>
      <th>3</th>
      <td>1</td>
      <td>Korean</td>
      <td>1</td>
    </tr>
    <tr>
      <th>4</th>
      <td>2</td>
      <td>American</td>
      <td>10</td>
    </tr>
  </tbody>
</table>
</div>

<h2 id="build-datasets-using-easydatasetwrapper-with-observables-as-data-frames">Build Datasets using <code>EasyDatasetWrapper</code> with Observables as Data-Frames</h2>
<p>We can observables as data-frames using <code>{user, item, session, price}_observable_data</code> keyword arguments. </p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-20-1" name="__codelineno-20-1" href="#__codelineno-20-1"></a><span class="n">data_2</span> <span class="o">=</span> <span class="n">EasyDatasetWrapper</span><span class="p">(</span><span class="n">main_data</span><span class="o">=</span><span class="n">df</span><span class="p">,</span>
<a id="__codelineno-20-2" name="__codelineno-20-2" href="#__codelineno-20-2"></a>                            <span class="n">purchase_record_column</span><span class="o">=</span><span class="s1">&#39;consumerid&#39;</span><span class="p">,</span>
<a id="__codelineno-20-3" name="__codelineno-20-3" href="#__codelineno-20-3"></a>                            <span class="n">choice_column</span><span class="o">=</span><span class="s1">&#39;purchase&#39;</span><span class="p">,</span>
<a id="__codelineno-20-4" name="__codelineno-20-4" href="#__codelineno-20-4"></a>                            <span class="n">item_name_column</span><span class="o">=</span><span class="s1">&#39;car&#39;</span><span class="p">,</span>
<a id="__codelineno-20-5" name="__codelineno-20-5" href="#__codelineno-20-5"></a>                            <span class="n">user_index_column</span><span class="o">=</span><span class="s1">&#39;consumerid&#39;</span><span class="p">,</span>
<a id="__codelineno-20-6" name="__codelineno-20-6" href="#__codelineno-20-6"></a>                            <span class="n">session_index_column</span><span class="o">=</span><span class="s1">&#39;consumerid&#39;</span><span class="p">,</span>
<a id="__codelineno-20-7" name="__codelineno-20-7" href="#__codelineno-20-7"></a>                            <span class="c1"># above are the same as before, but we update the following.</span>
<a id="__codelineno-20-8" name="__codelineno-20-8" href="#__codelineno-20-8"></a>                            <span class="n">user_observable_data</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;gender&#39;</span><span class="p">:</span> <span class="n">gender</span><span class="p">,</span> <span class="s1">&#39;income&#39;</span><span class="p">:</span> <span class="n">income</span><span class="p">},</span>
<a id="__codelineno-20-9" name="__codelineno-20-9" href="#__codelineno-20-9"></a>                            <span class="n">price_observable_data</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;dealers&#39;</span><span class="p">:</span> <span class="n">dealers</span><span class="p">},</span>
<a id="__codelineno-20-10" name="__codelineno-20-10" href="#__codelineno-20-10"></a>                            <span class="n">device</span><span class="o">=</span><span class="n">device</span><span class="p">)</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code>Creating choice dataset from stata format data-frames...
Note: choice sets of different sizes found in different purchase records: {&#39;size 4&#39;: &#39;occurrence 505&#39;, &#39;size 3&#39;: &#39;occurrence 380&#39;}
Finished Creating Choice Dataset.
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-21-1" name="__codelineno-21-1" href="#__codelineno-21-1"></a><span class="c1"># Use summary to see what&#39;s inside the data wrapper.</span>
<a id="__codelineno-21-2" name="__codelineno-21-2" href="#__codelineno-21-2"></a><span class="n">data_2</span><span class="o">.</span><span class="n">summary</span><span class="p">()</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code>* purchase record index range: [1 2 3] ... [883 884 885]
* Space of 4 items:
                   0         1         2       3
item name  American  European  Japanese  Korean
* Number of purchase records/cases: 885.
* Preview of main data frame:
      consumerid       car  purchase  gender     income  dealers
0              1  American         1       1  46.699997        9
1              1  Japanese         0       1  46.699997       11
2              1  European         0       1  46.699997        5
3              1    Korean         0       1  46.699997        1
4              2  American         1       1  26.100000       10
...          ...       ...       ...     ...        ...      ...
3155         884  Japanese         1       1  20.900000       10
3156         884  European         0       1  20.900000        4
3157         885  American         1       1  30.600000       10
3158         885  Japanese         0       1  30.600000        5
3159         885  European         0       1  30.600000        4

[3160 rows x 6 columns]
* Preview of ChoiceDataset:
ChoiceDataset(label=[], item_index=[885], provided_num_items=[], user_index=[885], session_index=[885], item_availability=[885, 4], user_gender=[885, 1], user_income=[885, 1], itemsession_dealers=[885, 4, 1], device=cpu)
</code></pre></div>
<p>Alternatively, we can supply user income and gender as a single dataframe, instead of <code>user_gender</code> and <code>user_income</code> tensors, now the constructed <code>ChoiceDataset</code> contains a single <code>user_gender_and_income</code> tensor with shape (885, 2) encompassing both income and gender of users.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-22-1" name="__codelineno-22-1" href="#__codelineno-22-1"></a><span class="n">data_3</span> <span class="o">=</span> <span class="n">EasyDatasetWrapper</span><span class="p">(</span><span class="n">main_data</span><span class="o">=</span><span class="n">df</span><span class="p">,</span>
<a id="__codelineno-22-2" name="__codelineno-22-2" href="#__codelineno-22-2"></a>                            <span class="n">purchase_record_column</span><span class="o">=</span><span class="s1">&#39;consumerid&#39;</span><span class="p">,</span>
<a id="__codelineno-22-3" name="__codelineno-22-3" href="#__codelineno-22-3"></a>                            <span class="n">choice_column</span><span class="o">=</span><span class="s1">&#39;purchase&#39;</span><span class="p">,</span>
<a id="__codelineno-22-4" name="__codelineno-22-4" href="#__codelineno-22-4"></a>                            <span class="n">item_name_column</span><span class="o">=</span><span class="s1">&#39;car&#39;</span><span class="p">,</span>
<a id="__codelineno-22-5" name="__codelineno-22-5" href="#__codelineno-22-5"></a>                            <span class="n">user_index_column</span><span class="o">=</span><span class="s1">&#39;consumerid&#39;</span><span class="p">,</span>
<a id="__codelineno-22-6" name="__codelineno-22-6" href="#__codelineno-22-6"></a>                            <span class="n">session_index_column</span><span class="o">=</span><span class="s1">&#39;consumerid&#39;</span><span class="p">,</span>
<a id="__codelineno-22-7" name="__codelineno-22-7" href="#__codelineno-22-7"></a>                            <span class="c1"># above are the same as before, but we update the following.</span>
<a id="__codelineno-22-8" name="__codelineno-22-8" href="#__codelineno-22-8"></a>                            <span class="n">user_observable_data</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;gender_and_income&#39;</span><span class="p">:</span> <span class="n">gender_and_income</span><span class="p">},</span>
<a id="__codelineno-22-9" name="__codelineno-22-9" href="#__codelineno-22-9"></a>                            <span class="n">price_observable_data</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;dealers&#39;</span><span class="p">:</span> <span class="n">dealers</span><span class="p">},</span>
<a id="__codelineno-22-10" name="__codelineno-22-10" href="#__codelineno-22-10"></a>                            <span class="n">device</span><span class="o">=</span><span class="n">device</span><span class="p">)</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code>Creating choice dataset from stata format data-frames...
Note: choice sets of different sizes found in different purchase records: {&#39;size 4&#39;: &#39;occurrence 505&#39;, &#39;size 3&#39;: &#39;occurrence 380&#39;}
Finished Creating Choice Dataset.
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-23-1" name="__codelineno-23-1" href="#__codelineno-23-1"></a><span class="n">data_3</span><span class="o">.</span><span class="n">summary</span><span class="p">()</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code>* purchase record index range: [1 2 3] ... [883 884 885]
* Space of 4 items:
                   0         1         2       3
item name  American  European  Japanese  Korean
* Number of purchase records/cases: 885.
* Preview of main data frame:
      consumerid       car  purchase  gender     income  dealers
0              1  American         1       1  46.699997        9
1              1  Japanese         0       1  46.699997       11
2              1  European         0       1  46.699997        5
3              1    Korean         0       1  46.699997        1
4              2  American         1       1  26.100000       10
...          ...       ...       ...     ...        ...      ...
3155         884  Japanese         1       1  20.900000       10
3156         884  European         0       1  20.900000        4
3157         885  American         1       1  30.600000       10
3158         885  Japanese         0       1  30.600000        5
3159         885  European         0       1  30.600000        4

[3160 rows x 6 columns]
* Preview of ChoiceDataset:
ChoiceDataset(label=[], item_index=[885], provided_num_items=[], user_index=[885], session_index=[885], item_availability=[885, 4], user_gender_and_income=[885, 2], itemsession_dealers=[885, 4, 1], device=cpu)
</code></pre></div>
<h2 id="method-3-mixing-method-1-and-method-2">Method 3: Mixing Method 1 and Method 2</h2>
<p>The <code>EasyDataWrapper</code> also support supplying observables as a mixture of above methods. The following example supplies <code>gender</code> user observable as a data-frame but <code>income</code> and <code>dealers</code> as column names. </p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-24-1" name="__codelineno-24-1" href="#__codelineno-24-1"></a><span class="n">data_4</span> <span class="o">=</span> <span class="n">EasyDatasetWrapper</span><span class="p">(</span><span class="n">main_data</span><span class="o">=</span><span class="n">df</span><span class="p">,</span>
<a id="__codelineno-24-2" name="__codelineno-24-2" href="#__codelineno-24-2"></a>                            <span class="n">purchase_record_column</span><span class="o">=</span><span class="s1">&#39;consumerid&#39;</span><span class="p">,</span>
<a id="__codelineno-24-3" name="__codelineno-24-3" href="#__codelineno-24-3"></a>                            <span class="n">choice_column</span><span class="o">=</span><span class="s1">&#39;purchase&#39;</span><span class="p">,</span>
<a id="__codelineno-24-4" name="__codelineno-24-4" href="#__codelineno-24-4"></a>                            <span class="n">item_name_column</span><span class="o">=</span><span class="s1">&#39;car&#39;</span><span class="p">,</span>
<a id="__codelineno-24-5" name="__codelineno-24-5" href="#__codelineno-24-5"></a>                            <span class="n">user_index_column</span><span class="o">=</span><span class="s1">&#39;consumerid&#39;</span><span class="p">,</span>
<a id="__codelineno-24-6" name="__codelineno-24-6" href="#__codelineno-24-6"></a>                            <span class="n">session_index_column</span><span class="o">=</span><span class="s1">&#39;consumerid&#39;</span><span class="p">,</span>
<a id="__codelineno-24-7" name="__codelineno-24-7" href="#__codelineno-24-7"></a>                            <span class="c1"># above are the same as before, but we update the following.</span>
<a id="__codelineno-24-8" name="__codelineno-24-8" href="#__codelineno-24-8"></a>                            <span class="n">user_observable_data</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;gender&#39;</span><span class="p">:</span> <span class="n">gender</span><span class="p">},</span>
<a id="__codelineno-24-9" name="__codelineno-24-9" href="#__codelineno-24-9"></a>                            <span class="n">user_observable_columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;income&#39;</span><span class="p">],</span>
<a id="__codelineno-24-10" name="__codelineno-24-10" href="#__codelineno-24-10"></a>                            <span class="n">price_observable_columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;dealers&#39;</span><span class="p">],</span>
<a id="__codelineno-24-11" name="__codelineno-24-11" href="#__codelineno-24-11"></a>                            <span class="n">device</span><span class="o">=</span><span class="n">device</span><span class="p">)</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code>Creating choice dataset from stata format data-frames...
Note: choice sets of different sizes found in different purchase records: {&#39;size 4&#39;: &#39;occurrence 505&#39;, &#39;size 3&#39;: &#39;occurrence 380&#39;}
Finished Creating Choice Dataset.
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-25-1" name="__codelineno-25-1" href="#__codelineno-25-1"></a><span class="n">data_4</span><span class="o">.</span><span class="n">summary</span><span class="p">()</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code>* purchase record index range: [1 2 3] ... [883 884 885]
* Space of 4 items:
                   0         1         2       3
item name  American  European  Japanese  Korean
* Number of purchase records/cases: 885.
* Preview of main data frame:
      consumerid       car  purchase  gender     income  dealers
0              1  American         1       1  46.699997        9
1              1  Japanese         0       1  46.699997       11
2              1  European         0       1  46.699997        5
3              1    Korean         0       1  46.699997        1
4              2  American         1       1  26.100000       10
...          ...       ...       ...     ...        ...      ...
3155         884  Japanese         1       1  20.900000       10
3156         884  European         0       1  20.900000        4
3157         885  American         1       1  30.600000       10
3158         885  Japanese         0       1  30.600000        5
3159         885  European         0       1  30.600000        4

[3160 rows x 6 columns]
* Preview of ChoiceDataset:
ChoiceDataset(label=[], item_index=[885], provided_num_items=[], user_index=[885], session_index=[885], item_availability=[885, 4], user_gender=[885, 1], user_income=[885, 1], itemsession_dealers=[885, 4, 1], device=cpu)
</code></pre></div>
<h1 id="sanity-checks">Sanity Checks</h1>
<p>Lastly, let's check choice datasets constructed via different methods are actually the same.</p>
<p>The <code>==</code> method of choice datasets will compare the non-NAN entries of all tensors in datasets. </p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-26-1" name="__codelineno-26-1" href="#__codelineno-26-1"></a><span class="nb">print</span><span class="p">(</span><span class="n">data_1</span><span class="o">.</span><span class="n">choice_dataset</span> <span class="o">==</span> <span class="n">data_2</span><span class="o">.</span><span class="n">choice_dataset</span><span class="p">)</span>
<a id="__codelineno-26-2" name="__codelineno-26-2" href="#__codelineno-26-2"></a><span class="nb">print</span><span class="p">(</span><span class="n">data_1</span><span class="o">.</span><span class="n">choice_dataset</span> <span class="o">==</span> <span class="n">data_4</span><span class="o">.</span><span class="n">choice_dataset</span><span class="p">)</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code>True
True
</code></pre></div>
<p>For <code>data_3</code>, we have <code>income</code> and <code>gender</code> combined:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-27-1" name="__codelineno-27-1" href="#__codelineno-27-1"></a><span class="n">data_3</span><span class="o">.</span><span class="n">choice_dataset</span><span class="o">.</span><span class="n">user_gender_and_income</span> <span class="o">==</span> <span class="n">torch</span><span class="o">.</span><span class="n">cat</span><span class="p">([</span><span class="n">data_1</span><span class="o">.</span><span class="n">choice_dataset</span><span class="o">.</span><span class="n">user_gender</span><span class="p">,</span> <span class="n">data_1</span><span class="o">.</span><span class="n">choice_dataset</span><span class="o">.</span><span class="n">user_income</span><span class="p">],</span> <span class="n">dim</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code>tensor([[True, True],
        [True, True],
        [True, True],
        ...,
        [True, True],
        [True, True],
        [True, True]])
</code></pre></div>
<p>Now let's compare what's inside the data structure and our raw data.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-28-1" name="__codelineno-28-1" href="#__codelineno-28-1"></a><span class="n">bought_raw</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;purchase&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">][</span><span class="s1">&#39;car&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
<a id="__codelineno-28-2" name="__codelineno-28-2" href="#__codelineno-28-2"></a><span class="n">bought_data</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
<a id="__codelineno-28-3" name="__codelineno-28-3" href="#__codelineno-28-3"></a><span class="n">encoder</span> <span class="o">=</span> <span class="p">{</span><span class="mi">0</span><span class="p">:</span> <span class="s1">&#39;American&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span> <span class="s1">&#39;European&#39;</span><span class="p">,</span> <span class="mi">2</span><span class="p">:</span> <span class="s1">&#39;Japanese&#39;</span><span class="p">,</span> <span class="mi">3</span><span class="p">:</span> <span class="s1">&#39;Korean&#39;</span><span class="p">}</span>
<a id="__codelineno-28-4" name="__codelineno-28-4" href="#__codelineno-28-4"></a><span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="n">data_1</span><span class="o">.</span><span class="n">choice_dataset</span><span class="o">.</span><span class="n">item_index</span><span class="p">:</span>
<a id="__codelineno-28-5" name="__codelineno-28-5" href="#__codelineno-28-5"></a>    <span class="n">bought_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">encoder</span><span class="p">[</span><span class="nb">float</span><span class="p">(</span><span class="n">b</span><span class="p">)])</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-29-1" name="__codelineno-29-1" href="#__codelineno-29-1"></a><span class="nb">all</span><span class="p">(</span><span class="n">bought_raw</span> <span class="o">==</span> <span class="n">bought_data</span><span class="p">)</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code>True
</code></pre></div>
<p>Then, let's compare the income and gender variable contained in the dataset. </p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-30-1" name="__codelineno-30-1" href="#__codelineno-30-1"></a><span class="n">X</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;consumerid&#39;</span><span class="p">)[</span><span class="s1">&#39;income&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">first</span><span class="p">()</span><span class="o">.</span><span class="n">values</span>
<a id="__codelineno-30-2" name="__codelineno-30-2" href="#__codelineno-30-2"></a><span class="n">Y</span> <span class="o">=</span> <span class="n">data_1</span><span class="o">.</span><span class="n">choice_dataset</span><span class="o">.</span><span class="n">user_income</span><span class="o">.</span><span class="n">cpu</span><span class="p">()</span><span class="o">.</span><span class="n">numpy</span><span class="p">()</span><span class="o">.</span><span class="n">squeeze</span><span class="p">()</span>
<a id="__codelineno-30-3" name="__codelineno-30-3" href="#__codelineno-30-3"></a><span class="nb">all</span><span class="p">(</span><span class="n">X</span> <span class="o">==</span> <span class="n">Y</span><span class="p">)</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code>True
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-31-1" name="__codelineno-31-1" href="#__codelineno-31-1"></a><span class="n">X</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;consumerid&#39;</span><span class="p">)[</span><span class="s1">&#39;gender&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">first</span><span class="p">()</span><span class="o">.</span><span class="n">values</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-32-1" name="__codelineno-32-1" href="#__codelineno-32-1"></a><span class="n">Y</span> <span class="o">=</span> <span class="n">data_1</span><span class="o">.</span><span class="n">choice_dataset</span><span class="o">.</span><span class="n">user_gender</span><span class="o">.</span><span class="n">cpu</span><span class="p">()</span><span class="o">.</span><span class="n">numpy</span><span class="p">()</span><span class="o">.</span><span class="n">squeeze</span><span class="p">()</span>
<a id="__codelineno-32-2" name="__codelineno-32-2" href="#__codelineno-32-2"></a><span class="nb">all</span><span class="p">(</span><span class="n">X</span> <span class="o">==</span> <span class="n">Y</span><span class="p">)</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code>True
</code></pre></div>
<p>Lastly, let's compare the <code>price_dealer</code> variable. Since there are NAN-values in it for unavailable cars, we can't not use <code>all(X == Y)</code> to compare them. We will first fill NANs values with <code>-1</code> and then compare resulted data-frames.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-33-1" name="__codelineno-33-1" href="#__codelineno-33-1"></a><span class="c1"># rearrange columns to align it with the internal encoding scheme of the data wrapper.</span>
<a id="__codelineno-33-2" name="__codelineno-33-2" href="#__codelineno-33-2"></a><span class="n">X</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">pivot</span><span class="p">(</span><span class="s1">&#39;consumerid&#39;</span><span class="p">,</span> <span class="s1">&#39;car&#39;</span><span class="p">,</span> <span class="s1">&#39;dealers&#39;</span><span class="p">)[[</span><span class="s1">&#39;American&#39;</span><span class="p">,</span> <span class="s1">&#39;European&#39;</span><span class="p">,</span> <span class="s1">&#39;Japanese&#39;</span><span class="p">,</span> <span class="s1">&#39;Korean&#39;</span><span class="p">]]</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-34-1" name="__codelineno-34-1" href="#__codelineno-34-1"></a><span class="n">X</span>
</code></pre></div>
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th>car</th>
      <th>American</th>
      <th>European</th>
      <th>Japanese</th>
      <th>Korean</th>
    </tr>
    <tr>
      <th>consumerid</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>1</th>
      <td>9.0</td>
      <td>5.0</td>
      <td>11.0</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>10.0</td>
      <td>2.0</td>
      <td>7.0</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>8.0</td>
      <td>2.0</td>
      <td>6.0</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>4</th>
      <td>5.0</td>
      <td>3.0</td>
      <td>4.0</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>5</th>
      <td>8.0</td>
      <td>3.0</td>
      <td>3.0</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>881</th>
      <td>8.0</td>
      <td>2.0</td>
      <td>10.0</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>882</th>
      <td>8.0</td>
      <td>6.0</td>
      <td>8.0</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>883</th>
      <td>9.0</td>
      <td>5.0</td>
      <td>8.0</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>884</th>
      <td>12.0</td>
      <td>4.0</td>
      <td>10.0</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>885</th>
      <td>10.0</td>
      <td>4.0</td>
      <td>5.0</td>
      <td>NaN</td>
    </tr>
  </tbody>
</table>
<p>885 rows × 4 columns</p>
</div>

<div class="highlight"><pre><span></span><code><a id="__codelineno-35-1" name="__codelineno-35-1" href="#__codelineno-35-1"></a><span class="n">Y</span> <span class="o">=</span> <span class="n">data_1</span><span class="o">.</span><span class="n">choice_dataset</span><span class="o">.</span><span class="n">itemsession_dealers</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">dim</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-36-1" name="__codelineno-36-1" href="#__codelineno-36-1"></a><span class="n">Y</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code>tensor([[ 9.,  5., 11.,  1.],
        [10.,  2.,  7.,  1.],
        [ 8.,  2.,  6., nan],
        ...,
        [ 9.,  5.,  8.,  1.],
        [12.,  4., 10., nan],
        [10.,  4.,  5., nan]])
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-37-1" name="__codelineno-37-1" href="#__codelineno-37-1"></a><span class="nb">print</span><span class="p">(</span><span class="n">X</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">values</span> <span class="o">==</span> <span class="n">torch</span><span class="o">.</span><span class="n">nan_to_num</span><span class="p">(</span><span class="n">Y</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">cpu</span><span class="p">()</span><span class="o">.</span><span class="n">numpy</span><span class="p">())</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code>[[ True  True  True  True]
 [ True  True  True  True]
 [ True  True  True  True]
 ...
 [ True  True  True  True]
 [ True  True  True  True]
 [ True  True  True  True]]
</code></pre></div>
<p>This concludes our tutorial on building the dataset, if you wish more in-depth understanding of the data structure, please refer to the <em>Data Management Tutorial</em>.</p>

              
            </article>
          </div>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
    <nav class="md-footer__inner md-grid" aria-label="Footer">
      
        
        <a href="../data_management/" class="md-footer__link md-footer__link--prev" aria-label="Previous: Data Management" rel="prev">
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
          </div>
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Previous
              </span>
              Data Management
            </div>
          </div>
        </a>
      
      
        
        <a href="../conditional_logit_model_mode_canada/" class="md-footer__link md-footer__link--next" aria-label="Next: Conditional Logit Model" rel="next">
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Next
              </span>
              Conditional Logit Model
            </div>
          </div>
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4Z"/></svg>
          </div>
        </a>
      
    </nav>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    <script id="__config" type="application/json">{"base": "..", "features": [], "search": "../assets/javascripts/workers/search.2a1c317c.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version.title": "Select version"}}</script>
    
    
      <script src="../assets/javascripts/bundle.ed9748b7.min.js"></script>
      
        <script src="../javascripts/mathjax.js"></script>
      
        <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
      
        <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
      
    
  </body>
</html>